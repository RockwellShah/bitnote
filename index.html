<!DOCTYPE html>
<html lang=en>
    <head>
        <link rel=manifest href="/manifest.json">
        <meta charset="utf-8">
        <title>BitNote</title>
        <meta content="Store your secrets safely. Ultra-secure notes powered by blockchain." name="description">
        <meta content="BitNote" property="og:title">
        <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=5.0, minimum-scale=0.5"/>
        <link rel="apple-touch-icon" sizes="256x256" href="/pages/imgs/icon_256.png">
        <link rel="apple-touch-icon" sizes="512x512" href="/pages/imgs/icon_512.png">
        <link rel="apple-touch-startup-image" href="/pages/imgs/icon_512.png">
        <meta name="apple-mobile-web-app-title" content="Bitnote">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta content="Store your secrets safely. Ultra-secure notes powered by blockchain." property="og:description">
        <meta content="/pages/imgs/main_card.png" property="og:image">
        <meta content="BitNote" property="twitter:title">
        <meta content="Ultra-secure notes on the blockchain." property="twitter:description">
        <meta content="/pages/imgs/main_card.png" property="twitter:image">
        <meta property="og:type" content="website">
        <meta content="summary_large_image" name="twitter:card">
        <link href='/pages/fonts/inter_variable.ttf' rel='preload' as='font' crossorigin/>
        <link rel=icon type=image/png href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAMAAAD04JH5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAZQTFRF////AAAAVcLTfgAAAJFJREFUeNrs2kEOwCAIBED6/0/3CVbRKma4GjZzMgaMZ3MFAAAAAAAAQBlAdBYAAMA9gN7A3j4AAIBzAa2ArxdP8xwAAOA4wGjgcB8AAAAAAABAGUB2QAEAAAAAAAAAAAAAAAAAAFAHkF1Y/rYxAQAAWA7IQnzhAAC4BzDrQQIAAFAfsKoAAAAAAAAAtgNeAQYAzqswgc0CbIoAAAAASUVORK5CYII="/>
        <style>
            html {
                font-family: 'inter_variable', system-ui;
                color: #fff;
                text-align: left;
                line-height: 1.6;
                box-sizing: border-box;
                background-color: #000;
                height: 100%;
                padding: 0 2%;
                text-rendering: optimizeSpeed;
            }

            body {
                display: flex;
                min-height: 100%;
                height: 100%;
                flex-direction: column;
                font-size: 20px;
                margin: 0;
            }

            ::selection {
                background-color: #fff;
                color: #000
            }

            *,*:before,*:after {
                box-sizing: inherit;
            }

            *:focus {
                outline: none;
                transform: scale(1.01);
            }

            svg:focus {
                transform: scale(1.1);
            }

            input:focus, textarea:focus {
                transform: unset;
            }

            #user_notes_menu p:focus, #user_notes_menu a:focus {
                color: #ffffffff;
                transform: scale(1);
            }

            #user_notes_menu:focus {
                transform: none;
            }

            #menu_delete_biometrics {
                display: none;
            }

            html::-webkit-scrollbar {
                width: 0 !important;
            }

            html {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }

            button {
                color: #000;
            }

            input, textarea {
                border-radius: 0
            }

            textarea {
                font-family: 'inter_variable', system-ui;
            }

            input {
                font-family: 'inter_variable', system-ui;
            }

            #main_content_container_outer {
                opacity: 0;
                transition: opacity 1s;
                position: relative;
                min-height: calc(100% - 92px);
            }

            #main_content_container_inner {
                min-height: 100%;
                width: 100%;
                position: absolute;
                top: 0;
                left: 0;
            }

            #title_enc_status {
                align-items: center;
                justify-content: center;
            }

            #title_enc_status svg {
                fill: #fff
            }

            #menu_enc_label {
                display: flex;
                flex-grow: 1
            }

            .standard_back_arrow {
                height: 16px;
                fill: #fff;
                cursor: pointer;
            }

            .standard_small_lock {
                height: 12px;
            }

            .standard_container {
                width: 100%;
                max-width: 1050px;
                margin: 60px auto;
                padding: 2%
            }

            .standard_container_topbar {
                display: flex;
                align-items: center;
                min-height: 50px;
            }

            .standard_icon {
                width: 16px;
                line-height: 0;
                user-select: none;
                fill: #ffffff;
            }

            .standard_close_icon {
                width: 16px;
                position: absolute;
                top: 19px;
                right: 22px;
                line-height: 0;
                cursor: pointer;
                user-select: none;
                fill: #ffffffaa;
            }

            .standard_close_icon:hover {
                fill: #fff
            }

            .standard_close_icon:active {
                transform: scale(.98)
            }

            .standard_menu_modal {
                background-color: #1a1a1a;
                padding: 8px 16px;
            }

            .standard_menu_modal p {
                color: #ffffff80;
                cursor: pointer;
                margin: 0;
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                -khtml-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
                font-size: 20px;
                line-height: 1.8
            }

            .standard_menu_modal p:hover, .standard_menu_modal a:hover {
                color: #ffffffff
            }

            .standard_menu_modal a {
                text-decoration: none;
                color: #ffffff80;
            }

            #loading_container {
                width: 100%;
                height: 100vh;
                display: none;
                align-items: center;
                justify-content: center;
                position: fixed;
                background-color: #000000aa;
                flex-direction: column;
                z-index: 10000000000000;
                left: 0;
            }

            #loading_container span {
                background-color: #fff;
                height: 256px;
                width: 256px;
                -webkit-mask-size: contain
            }

            #loading_close {
                position: absolute;
                left: 0;
                top: 0;
                padding: 10px;
                height: 40px;
                width: 40px;
            }

            #topbar_container {
                height: 92px;
                border-bottom: 1px solid #000;
                display: flex;
                align-items: center;
                justify-content: center;
                width: 100%;
                position: relative;
            }

            #topbar_logo_container {
                align-items: center;
                justify-content: center;
                flex-grow: 1;
                display: none;
            }

            #user_note_titlebox, #user_pk_titlebox {
                border: none;
                outline: none;
                background-color: #000;
                color: #fff;
            }

            .topbar_left_flex {
                display: flex;
                flex-grow: 1;
                min-width: 30%;
                flex-grow: 1;
                align-items: center;
                margin: 0;
                font-size: 22px;
            }

            .topbar_link {
                text-decoration: none;
                color: #fff;
                line-height: 0;
                font-size: 0;
                display: flex;
                align-items: center;
            }

            #topbar_title {
                font-size: 44px;
            }

            #topbar_title, #landing_title {
                font-family: 'neuebit_bold';
                margin: 0;
            }

            .logo_container {
                display: flex;
                justify-content: center;
                align-items: center;
            }

            #hamburger_svg {
                fill: #fff;
                height: 28px;
                cursor: pointer;
                position: absolute;
                left: 0%;
            }

            #topbar_title_container {
                display: flex;
                flex-grow: 1;
                justify-content: center;
            }

            .bitnote_logo_text {
                height: 28px;
                fill: #fff;
                margin-right: 2.16px;
            }

            .bitnote_logo_icon {
                height: 20px;
                fill: #fff;
                margin: 4px 2.16px 0
            }

            #topbar_logo_icon {
                cursor: pointer;
            }

            #topbar_logo_icon svg {
                fill: #fff;
            }

            #menu_container {
                display: none;
            }

            #hamburger_svg {
                display: none;
            }

            #menu_container, #user_notes_menu_container, #shortcut_outer_menu, #user_note_3d_mc {
                z-index: 10;
                position: fixed;
                display: none;
                width: 100%;
                height: 100%;
                color: #ffffff80;
                top: 0px;
                left: 0px;
            }

            #menu_more_settings_container {
                display: none;
            }

            #menu_modal, #user_notes_menu {
                position: fixed;
                background-color: #1a1a1a;
                padding: 8px 16px
            }

            #menu_modal {
                top: 70px;
                left: 2%;
            }

            #menu_modal a:hover {
                color: #fff
            }

            #menu_container a {
                text-decoration: none;
                color: #ffffff80;
                line-height: 1.8;
                display: block;
            }

            .network_main_container {
                display: none;
            }

            #contract_button {
                display: flex;
                align-items: center;
                cursor: pointer;
                background-color: #333334;
                padding: 8px 8px 8px 12px;
                user-select: none;
                min-width: 160px;
            }

            #contract_button span {
                flex-grow: 1;
                font-size: 14px;
                color: #fff;
            }

            #contract_dropdown_container {
            }

            .contract_dropdown_ic {
                background-color: #333334;
                padding: 0 8px 8px 12px
            }

            #contract_dropdown_modal {
                border-top: 1px #3f3f40 solid;
            }

            #contract_dropdown_modal p {
                font-size: 14px
            }

            .contract_network_label {
                font-size: 14px;
                font-weight: 400;
                margin: 7px 0;
            }

            .landing_logo_container {
                text-align: center;
                margin: 10vh 0 50px
            }

            #landing_title {
                font-size: 128px;
                display: inline-flex;
                line-height: 1;
                margin-bottom: 18px;
            }

            #landing_logo_icon {
                max-width: 90%;
                margin: 0 auto;
            }

            #landing_logo_icon svg:nth-of-type(1) {
                height: 72px;
                margin-right: 14px
            }

            #landing_logo_icon svg:nth-of-type(2) {
                height: 54px;
            }

            #landing_container {
                display: flex;
                flex-direction: column;
                min-height: calc(100vh - 92px);
                margin: 0 auto;
            }

            .landing_cta, #landing_container h5, #create_username_container h5 {
                font-weight: 400;
                font-size: 18px;
                text-align: center;
                color: #ffffff99;
                line-height: 1.6;
                margin: 2px auto;
            }

            #landing_container a {
                color: #ffffff99;
                height: calc(100% - 60px);
            }

            #learn_more_link {
                flex-grow: 1;
            }

            #learn_more_link a {
                width: fit-content;
                text-decoration: none;
                display: block;
                border-bottom: 1px #ffffff99 solid;
                margin: 0 auto;
            }

            #learn_more_link a:hover {
                color: #fff
            }

            .landing_input_container {
                display: flex;
                justify-content: center;
                margin-bottom: 40px;
            }

            .standard_input {
                background-color: #1e1e1e;
                outline: none;
                border: none;
                color: #fff;
                text-align: left;
                line-height: 1.2
            }

            .handled_textarea {
                resize: none;
                overflow: hidden;
                white-space: break-spaces;
                word-break: break-all;
            }

            .handled_textarea::placeholder {
                white-space: nowrap
            }

            #signin_form {
                max-width: 575px;
                width: 100%;
                display: flex;
                flex-direction: column;
            }

            #landing_input, .signin_mp_c_input {
                font-size: 18px;
                padding: 23px 50px 23px 23px;
                width: 100%;
                flex: 1 0;
            }

            .input_eye_box {
                cursor: pointer;
                margin: 0 18px 0 0;
                opacity: .5;
                user-select: none;
                position: absolute;
                right: 0;
                display: flex;
                fill: #fff
            }

            .input_inline_eye_svg {
                height: 20px;
                width: 20px;
                padding: 3px 0;
                position: absolute;
                right: 18px;
                opacity: .5;
                fill: #fff;
                cursor: pointer;
                user-select: none;
            }

            .mp_input_container {
                position: relative;
                display: flex;
                align-items: center;
                margin: 16px 0;
            }

            #signin_submit_button, #create_mp_main_button, #create_mp_generate_button {
                font-size: 20px;
                font-weight: 500;
            }

            #create_mp_generate_button {
                background-color: #000;
                border: 1px solid #fff;
                color: #fff;
                margin-top: 10px;
            }

            #sec_key_store {
                opacity: 0.35;
            }

            .use_security_key, .use_security_key_alert {
                text-align: center;
                margin: 14px 0;
                cursor: pointer;
                font-size: 14px;
                text-decoration: underline;
            }

            .use_security_key_alert {
                ;margin: 2px 0 12px;
            }

            #landing_container h2 {
                font-size: 38px;
                font-weight: 600;
                text-align: center;
                margin: 24px;
            }

            #notes_home_back_arrow {
                display: none;
            }

            #notes_address_container {
            }

            #notes_address_container h5, #user_note_titlebox, #user_pk_titlebox {
                display: flex;
                flex-grow: 1;
                min-width: 30%;
                flex-grow: 1;
                align-items: baseline;
                font-size: 22px;
            }

            #notes_address_container h5 {
                margin: 0
            }

            #user_note_titlebox {
                margin: 0 0 0 21px;
                word-break: keep-all;
            }

            #user_pk_titlebox {
                margin: 0;
            }

            .user_note_titlebox_container {
                display: flex;
                align-items: center;
                flex-grow: 1;
            }

            #user_notes_menu_container {
            }

            #user_notes_menu {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }

            #user_notes_menu::-webkit-scrollbar {
                width: 0 !important;
            }

            #archive_note {
                display: none !important;
            }

            #notes_home_search_container {
                position: relative;
                margin: 12px 0;
                display: flex;
                align-items: center;
            }

            .notes_home_search_icon {
                display: block;
                fill: #fff;
                height: 22px;
                width: 22px;
                margin-left: 18px;
                position: absolute;
            }

            .notes_home_search_icon circle {
                fill: none;
                stroke: #fff
            }

            #notes_home_search_x {
                display: none;
                fill: #fff;
                padding: 2px;
                height: 18px;
                width: 18px;
                margin-right: 18px;
                position: absolute;
                right: 0;
                cursor: pointer;
                opacity: .8
            }

            #notes_home_search_input {
                width: 100%;
                padding: 16px 50px;
                font-size: 18px;
                background-color: #000;
                border: 1px solid rgba(255, 255, 255, 0.2);
            }

            #notes_home_search_input {
                opacity: .7;
            }

            #notes_home_search_input:focus {
                opacity: 1;
            }

            #notes_three_dot_button {
                fill: #fff;
                cursor: pointer;
                height: 16px;
                display: flex;
            }

            .notes_home_menu_icons, #notes_home_logout_icon {
                fill: #fff;
                height: 16px;
                display: flex;
                margin-right: 12px;
            }

            .note_three_dot {
                fill: #fff;
                height: 32px;
                display: flex;
                padding: 8px;
            }

            .notes_home_menu_label_container, .notes_home_menu_locks_label {
                display: flex;
                justify-content: center;
                align-items: center;
                background-color: #000;
                border: 1px solid #fff;
                padding: 11.5px;
                cursor: pointer;
            }

            .notes_home_menu_label_container, .notes_home_menu_locks_label {
                font-size: 16px;
                line-height: 1;
                color: #fff;
            }

            .notes_home_menu_locks_label {
                width: 155px;
                padding: 11.5px 0;
            }

            #notes_box_container {
                margin-top: 28px;
                font-size: 18px
            }

            #notes_output_container {
            }

            #new_note {
                background-color: #191919;
                color: #878787;
                border: none;
            }

            #new_note svg {
                fill: #878787;
                height: 18px;
                margin: 7px;
            }

            .get_note_box {
                display: flex;
                align-items: center;
                cursor: pointer;
                padding: 24px;
                background-color: #242424;
            }

            .get_note_box span:nth-of-type(1) {
                flex-grow: 1;
                padding: 0 6px 0 0
            }

            .get_note_box span:nth-of-type(2) {
                color: #878787
            }

            .get_note_box:nth-of-type(2) {
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                border-top: 1px solid rgba(255, 255, 255, 0.1);
            }

            .get_note_box:nth-of-type(n+3) {
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            .line_divider {
                height: 1px;
                background-color: #353535;
                width: 100%;
                display: block;
                margin: 14px 0;
            }

            .notes_for_box {
                flex-direction: column;
                line-height: 1.2;
            }

            #notes_user_address {
                cursor: pointer;
            }

            .three_dot_menu_label {
                color: #5f5f5f;
                margin: 0;
                font-size: 14px;
                font-weight: 400;
                line-height: 1;
            }

            #user_note_textbox, #textbox_conversion_container, #import_notes_textarea {
                width: 100%;
                margin-top: 55px;
                background-color: #000;
                outline: none;
                border: none;
                resize: none;
                color: #fff;
                font-size: 18px;
                line-height: 1.5;
                padding: 2px;
            }

            #user_note_textbox, #textbox_conversion_container {
                word-break: break-all;
            }

            #import_notes_textarea {
                overflow: auto;
                white-space: nowrap;
                height: 55vh;
                resize: horizontal;
            }

            #import_notes_textarea::placeholder {
                white-space: break-spaces;
            }

            #user_note_textbox::-webkit-scrollbar {
                display: none;
            }

            #user_note_additional_controls {
                font-size: 14px;
                color: #878787;
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                align-items: center;
            }

            #user_note_additional_controls span {
                cursor: pointer;
                margin: 0 12px;
            }

            #publish_button, #import_notes_button {
                background-color: #eef3fa;
                color: #000;
                padding: 11.5px;
                font-weight: 400;
                border: none;
                line-height: 1;
                font-size: 16px;
                border: #eef3fa 1px solid;
            }

            #publish_button, #decrypt_key, #note_3d_container {
                display: none;
            }

            #note_3d_container {
                line-height: 0;
            }

            #gen_random_string, #gen_random_phrase {
                cursor: pointer;
            }

            #results_outer_container {
            }

            #results_inner_container {
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                width: 385px;
                max-width: 100%;
                margin: 0 auto;
            }

            #results_msg_container {
                text-align: center;
            }

            #results_msg_container h5 {
                font-size: 20px;
                margin: 0 0 10px
            }

            #results_msg_container p {
                font-size: 16px;
                margin: 0;
                color: #878787
            }

            #results_msg_container a {
                color: #878787
            }

            #results_main_icon_container {
                line-height: 0;
                margin-bottom: 38px
            }

            #results_done_button {
                height: 60px;
                width: 100%;
                background-color: #eef3fa;
                color: #000;
                font-weight: 500;
                padding: 16px 0;
                line-height: 1.4;
                margin-top: 38px;
                text-align: center;
                cursor: pointer;
            }

            .results_loading_icon {
                width: 75px;
                height: 75px;
                background-color: white;
                -webkit-mask-size: cover;
            }

            .results_success_svg {
                width: 75px;
                height: 75px;
                fill: #4ffd64
            }

            #results_bitnote_svg {
                width: 75px;
                height: 75px;
                fill: #fff
            }

            #results_success_icon {
            }

            .results_link {
                color: #4ffd64;
                text-decoration: none;
            }

            .full_width_button {
                width: 100%;
                height: 60px;
                background-color: #eef3fa;
                margin: 0;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                border: none;
                user-select: none;
            }

            .button_len_cap {
                max-width: 548px;
            }

            .dark_button {
                font-size: 20px;
                font-weight: 500;
                background-color: #181819;
                color: #fff;
                background-color: transparent;
                border: 1px solid #fff;
            }

            .no_decoration_link {
                text-decoration: none;
            }

            #create_username_main_button {
                font-size: 20px;
                background-color: #1e1e1e;
                color: #fff;
            }

            #continue_payment_button, #select_payment_method {
                font-size: 20px;
                font-weight: 500;
            }

            #continue_payment_button {
                margin-top: 15px;
                width: 100%;
            }

            #fund_ac_copy_address {
                margin-bottom: 15px;
            }

            .func_ac_address_container {
                padding: 20px;
                background-color: #191919;
                position: relative;
            }

            .func_ac_address_container h5 {
                font-weight: 600;
                font-size: 22px;
                margin: 0;
            }

            .fund_ac_title_container {
                display: flex;
                align-items: center;
            }

            .fund_ac_title_container h5 {
                flex-grow: 1;
            }

            .func_ac_address_box {
                padding: 20px 5px;
                text-align: center;
                background-color: #303030;
                margin: 20px 0;
                overflow: auto;
                font-size: 17px;
                line-break: anywhere;
            }

            #private_key_container {
                padding: 20px;
            }

            #create_username_input_container, #create_mp_input_container {
                width: 100%;
                margin: 24px 0 15px;
                position: relative;
                display: flex;
                justify-content: center;
                align-items: center;
            }

            #create_username_input_container svg {
                width: 16px;
                height: 16px;
                position: absolute;
                right: 18px
            }

            #create_mp_container {
                max-width: 545px
            }

            .new_user_container {
                display: flex;
                flex-direction: column;
                min-height: calc(100% - 92px);
                text-align: center;
                max-width: 420px;
                padding: 0;
                margin: 60px auto;
                width: 100%;
            }

            #create_username_container h2, #create_mp_container h2 {
                font-size: 38px;
                line-height: 1.4;
                font-weight: 600;
                margin: 14px 0 0
            }

            .current_step_label {
                font-size: 16px;
                line-height: 1.2;
                font-weight: 400;
                color: #ffffff;
                margin: 8px 0 0 0;
                text-align: center;
            }

            #create_username_form, #create_mp_form {
                max-width: 100%;
                display: flex;
                justify-content: center;
                align-items: center;
                flex-direction: column;
            }

            #create_username_input, #create_mp_input {
                font-size: 16px;
                padding: 20px 70px 20px 20px;
                width: 100%;
                line-height: 22px;
            }

            #create_mp_input {
                word-break: break-word;
            }

            .signin_mp_c_input::placeholder, #create_mp_input::placeholder {
                font-family: 'inter_variable', system-ui
            }

            #create_username_type_box {
                opacity: 0;
                margin-top: 10px;
            }

            #invalid_username_icon {
                fill: red;
                padding: 2px;
                display: none;
            }

            #valid_username_icon, .standard_checkmark {
                fill: #4ffd64;
                display: none;
            }

            .questionmark_container {
                background-color: #191919;
                height: 32px;
                width: 32px;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                margin-left: 8px;
            }

            .crack_cost_label {
                font-weight: 700
            }

            #reserve_username_container {
                text-align: center;
            }

            #reserve_form {
                max-width: 100%;
                display: flex;
                justify-content: center;
                align-items: center;
            }

            #reserve_input_container {
                width: 385px;
                max-width: 80%;
                margin: 31px 0;
                position: relative;
                display: flex;
                justify-content: center;
                align-items: center;
            }

            #reserve_input_container svg {
                width: 16px;
                height: 16px;
                position: absolute;
                right: 18px
            }

            #reserve_username_container h5 {
                font-size: 32px;
                line-height: 1.4;
                font-weight: 600;
                margin: 0
            }

            #reserve_username_container p {
                font-size: 18px;
                line-height: 1.6;
                font-weight: 400;
                color: #ffffffaa;
                margin: 8px 0 0 0
            }

            #reserve_username_input {
                font-size: 16px;
                padding: 20px;
                width: 100%;
                line-height: 22px;
            }

            #reserve_main_button {
                padding: 20px 0;
                line-height: 22px;
                font-weight: 500;
                margin-left: 18px;
                color: #fff;
                background-color: #1e1e1e;
                outline: none;
                border: none;
                cursor: pointer;
                width: 95px;
            }

            .ns {
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                -khtml-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }

            .rotate_270 {
                transform: rotate(270deg)
            }

            .svg_checkbox {
                width: 15px;
                height: 15px;
                display: block;
            }

            .svg_checkbox rect:nth-child(n+1) {
                fill: none;
                stroke: #fff;
                stroke-width: .1px;
            }

            .svg_checkbox rect:nth-child(n+2) {
                fill: #fff;
                stroke: #fff
            }

            .dont_match_container {
                display: flex;
                flex-direction: row;
                align-items: center;
                margin: 14px;
            }

            #create_mp_go_back {
                cursor: pointer;
                display: none;
                font-size: 14px;
            }

            #landing_footer_container {
                text-align: center;
                font-size: 0;
                margin: 20px
            }

            .landing_footer_icon {
                height: 20px;
                width: 20px;
                fill: #fff;
                margin: 0 12px;
            }

            .contract_dd_topitem {
                border-top: 1px #3f3f40 solid;
                margin: 17px 0 8px !important;
                padding-top: 17px;
            }

            #sign_up_button {
                cursor: pointer;
                text-decoration: underline;
                user-select: none;
            }

            .small_text {
                font-size: 12px;
            }

            .standard_hc_outer {
                width: 100%;
                display: flex;
                min-height: 100%;
                justify-content: center;
                align-items: center;
                padding: 5vh 0 8vh;
                flex-direction: column;
            }

            .standard_hc {
                width: 50%;
                display: flex;
                justify-content: center;
            }

            .inner_hc {
                width: 100%;
                max-width: 548px;
                padding: 30px 24px
            }

            .thin_gb {
                border: 1px solid #4c4c4c;
            }

            .thin_gl {
                border: 0.5px solid #1c1c1c;
                margin: 4px 0;
            }

            .thin_gl2 {
                border: 0.1px solid #5e5e5e;
                margin: 20px 0;
            }

            .thin_gl3 {
                border: 0.1px solid #ffffff3c;
                margin: 18px 0;
            }

            #pay_with_crypto_3d {
                cursor: pointer;
            }

            #pay_with_crypto_3d svg {
                width: 24px;
                fill: #949494
            }

            #your_bno_container {
                display: flex;
                flex-direction: column;
                margin: 25px 0;
            }

            #your_bno_outer_container {
                display: none;
                flex-direction: column;
                align-items: center;
            }

            .your_bno_username {
                background-color: #191919;
                overflow: auto;
                padding: 23px 16px;
                display: flex;
                align-items: center;
            }

            .your_bno_username span:first-child {
                font-size: 20px;
                flex-grow: 1
            }

            .your_bno_username span:last-child {
                line-break: anywhere;
                color: #dbdbdb;
                font-size: 16px
            }

            .six_hundo {
                font-weight: 600;
            }

            #add_username_fee_container, #add_money_fee_container, #add_misc_note_fee_container, #your_bno_total_container {
                display: flex;
                flex-direction: row;
                margin: 20px 0;
            }

            #your_bno_total_container {
                margin: 20px 0 0;
            }

            .bno_summary_flex_c {
                display: flex;
                flex-direction: column;
                font-size: 16px;
                justify-content: center;
            }

            .bno_summary_flex_c:first-child {
                flex-grow: 1
            }

            .bno_summary_flex_c:last-child {
                text-align: right;
            }

            .bno_summary_flex_c h6 {
                margin: 0;
                font-size: 20px;
                font-weight: 400;
            }

            .bno_summary_flex_c span:last-child {
                font-size: 14px;
                opacity: .8
            }

            #add_money_options_container {
                display: flex;
                margin-bottom: 20px;
            }

            .add_money_option_cont {
                width: calc(100% / 3);
                text-align: center;
                font-size: 16px;
                border: 1px #fff solid;
                padding: 15px 0;
                opacity: .6;
                cursor: pointer;
            }

            .add_money_option_cont:nth-child(2) {
                margin: 0 8px;
            }

            .add_money_option_cont input {
                max-width: 100%;
                height: 100%;
                text-align: center;
                background-color: transparent;
                color: #fff;
                border: none;
                font-size: 16px;
                outline: none;
            }

            .add_money_input_container {
                padding: 0;
                cursor: default;
            }

            .add_money_option_cont input::-webkit-outer-spin-button, .add_money_option_cont input::-webkit-inner-spin-button {
                -webkit-appearance: none;
                margin: 0;
            }

            .add_money_option_cont input[type=number] {
                -moz-appearance: textfield;
            }

            #tb_back {
                display: none;
                position: fixed;
                left: 0%;
                cursor: pointer;
            }

            #tb_exit {
                display: none;
                position: fixed;
                left: 2%;
                top: 2%;
                cursor: pointer;
                font-size: 22px;
                z-index: 2130002000
            }

            #tb_exit_x {
                font-size: 0;
                margin-right: 21px;
            }

            .tips_container {
                width: 100%;
                padding: 0;
                margin: 50px auto;
                flex-grow: 1;
                max-width: 420px;
            }

            .tips_box {
                border: 1px solid #ffffff33;
                padding: 16px;
            }

            .tips_label_container {
                display: flex;
            }

            .tips_label {
                font-size: 18px;
                font-weight: 700;
                margin: 0 8px;
            }

            .tips_label_svg {
            }

            .tips_container li {
                font-size: 16px;
                text-align: left;
                line-height: 1.6;
                color: #ffffffcc;
                margin: 8px 0;
            }

            .tips_container ul {
                padding: 0 25px;
                margin: 10px 0;
            }

            #create_username_login_button {
                text-decoration: underline;
                cursor: pointer;
            }

            #crack_cost_container {
                margin-bottom: 30px;
            }

            #crack_cost_container span {
                font-size: 14px;
            }

            #crack_cost {
            }

            #crack_cost sup {
                font-size: 8px
            }

            #crack_cost_learn_more {
                text-decoration: underline;
                cursor: pointer;
            }

            .failed_input_text {
                display: none;
                font-size: 14px;
                color: #ff6c6c
            }

            .func_ac_step_label {
                margin-top: 30px;
            }

            .onboarding_header {
                font-size: 38px;
                font-weight: 600;
                margin: 16px 0;
                line-height: 1.2;
                text-align: center;
            }

            #fund_ac_sub_title {
                font-size: 22px;
                font-weight: 400;
                margin: 0 0 22px;
                line-height: 1.3;
                color: #ffffffcc;
                text-align: center;
            }

            .fund_types_container {
            }

            .fund_types_container svg {
                width: 20px;
                margin-right: 12px;
            }

            .security_types_container {
                padding-top: 1px;
                display: flex;
                flex-direction: column
            }

            .security_types_container svg {
                min-width: 20px;
                margin: 0 20px 0 10px;
            }

            #how_do_i_delete_sk {
                font-size: 16px;
                text-align: center;
                cursor: pointer;
            }

            #sk_icon_shifter, #chain_icon_shifter {
                line-height: 0;
            }

            .fund_ac_payment_tc, .security_type_box {
                background-color: #191919;
                display: flex;
                flex-direction: row;
                align-items: center;
                margin: 20px 0;
                opacity: .7;
                cursor: pointer;
                padding: 16px
            }

            .security_type_box {
                opacity: 1;
                padding: 24px 16px;
            }

            .security_type_box h4 {
                font-weight: 600;
                line-height: 1;
                margin: 0 0 10px;
            }

            .security_type_box p {
                opacity: .7;
                font-size: 16px;
                line-height: 1.6;
                margin: 0;
            }

            .fund_ac_payment_lc {
                flex-grow: 1;
                display: flex;
            }

            .fund_ac_select_box {
                background-color: #343435;
                height: 24px;
                width: 24px;
                margin-right: 22px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .fund_ac_selected {
                background-color: #fff;
                width: 10.5px;
                height: 10.5px;
                display: none;
            }

            .fund_ac_current_bal {
                opacity: 1;
                margin: 0;
            }

            .wallet_functions_ac_bal {
                opacity: 1;
                margin: 0;
                padding: 0;
            }

            .fund_ac_current_bal svg, .wallet_functions_ac_bal svg {
                width: 24px;
                margin-right: 8px;
            }

            #waiting_for_funds_icon {
                background-color: #fff;
                height: 30px;
                width: 30px;
                -webkit-mask-size: contain;
            }

            .dim_subtext {
                color: #bbb;
                font-size: 14px;
                margin: 0;
                line-height: 1.2
            }

            .title_text {
                border-bottom: 1px dashed #fff
            }

            #small_avax_cost {
                display: block;
                margin: 0;
                font-size: 12px;
            }

            .c_card {
                fill: none;
                stroke: #fff
            }

            .ul {
                text-decoration: underline;
            }

            .tooltip_box {
                position: fixed;
                background-color: #222;
                border: 1px solid #3a3a3a;
                padding: 12px;
                line-height: 1.5;
                font-size: 15px;
                max-width: 300px;
                z-index: 2100000002;
                color: #fff;
                font-weight: 400;
                text-align: center;
                touch-action: none;
                user-select: none;
            }

            .tooltip_target {
                cursor: help;
                text-decoration: underline;
                text-decoration-style: dashed;
                color: #fff;
                touch-action: none;
                user-select: none;
            }

            #version_number {
                margin: 0;
                text-align: center;
                color: #555;
                font-weight: 500;
                font-size: 12px;
            }

            #copy_note {
                display: unset;
                padding: 11.5px;
                color: #fff
            }

            .portrait_br {
                display: none
            }

            #nef_container, #share_note_container, #referral_container {
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 10px 20px 20px;
                position: fixed;
                background-color: #000;
                left: 0;
                top: 0;
                min-height: 100vh;
                width: 100vw;
                z-index: 2020000001;
            }

            #nef_container {
                z-index: 2130001000
            }

            #referral_link_container {
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            #referral_icon {
                width: 52px;
                height: 52px;
                fill: #fff;
                margin-bottom: 12px;
            }

            .extra_no_margin {
                margin: 0 !important
            }

            .white_link {
                color: #fff !important;
            }

            .standard_full_modal_container {
                width: 100%;
                min-height: 100vh;
                padding: 0 4%;
                background-color: #000;
                z-index: 2100000001;
                position: fixed;
                left: 0;
                top: 0;
                justify-content: center;
                align-items: center;
                display: flex;
            }

            .standard_modal_outer_container {
                overflow: auto;
                max-height: 95vh;
                overscroll-behavior: contain;
            }

            .standard_modal_container {
                position: relative;
                max-width: 100%;
                width: 575px;
                text-align: center;
                margin-bottom: 70px;
                background-color: #191919;
                padding: 37.5px;
            }

            .standard_modal_main_button {
                font-size: 20px;
                margin: 16px 0;
            }

            .standard_modal_sub_heading {
                font-size: 22px;
                line-height: 1.4;
                opacity: .8;
                margin: 14px 0 34px;
            }

            .secret_outer_container {
                position: relative;
                max-width: 100%;
                width: 492px;
                text-align: center;
                margin-bottom: 70px;
            }

            .secret_heading, .standard_modal_heading {
                font-size: 32px;
                font-weight: 600;
                margin: 0;
            }

            .secret_sub_heading {
                font-size: 22px;
                line-height: 1.4;
                opacity: .8;
                margin: 8px 0;
            }

            #wallet_functions_migration_addr {
                width: 100%;
                padding: 20px;
                font-size: 16px;
                margin: 18px 0 2px;
                overflow: auto;
                resize: none;
                white-space: nowrap;
                overflow: hidden;
            }

            .secret_inner_container {
                padding: 32px 28px;
                background-color: #191919
            }

            #secret_link_container {
                display: none;
            }

            #secret_link_text, #referral_link_text {
                background-color: #313131;
                height: 200px;
                margin: 32px 0 16px;
                padding: 16px 18px;
                text-align: left;
                word-break: break-all;
                overflow: auto;
            }

            #referral_link_text {
                height: auto;
            }

            #secret_username, #secret_link {
                width: 100%;
                padding: 20px;
                font-size: 16px;
                margin: 24px 0;
                overflow: auto;
                resize: none;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }

            #secret_username::-webkit-scrollbar, #secret_link::-webkit-scrollbar {
                display: none;
            }

            #secret_next_button {
                font-size: 20px
            }

            #invalid_secret_username {
                margin: 24px 0px 0px;
            }

            #shortcut_outer_menu {
                display: flex;
                align-items: center;
                justify-content: center;
                background-color: #000000ee
            }

            #shortcut_menu {
                width: 612px;
                min-height: 612px;
                max-width: 100%;
                background-color: #1a1a1a;
                padding: 60px 40px 54px;
                position: relative;
                max-height: 70vh;
                overflow: hidden;
                display: flex;
                flex-direction: column;
            }

            .shortcut_title {
                font-size: 30px;
                color: #fff;
                font-weight: 600;
                margin: 0 0 44px;
            }

            .shortcut_overflow_container {
                overflow: auto;
                height: 100%;
                -ms-overflow-style: none;
                scrollbar-width: none;
            }

            .shortcut_overflow_container::-webkit-scrollbar {
                width: 0 !important;
            }

            .shortcut_row {
                display: flex;
                align-items: center;
                margin: 28px 0;
            }

            .shortcut_heading {
                flex-grow: 1;
                font-size: 19px;
                color: #fff;
                font-weight: 400;
            }

            .shortcut_or {
                font-size: 12.4;
                opacity: .4
            }

            .key_svg {
                border-radius: 3px;
                font-family: 'inter_variable';
                fill: #d3d3d3;
                font-size: 11px;
                height: 37px;
                margin: 0 4px;
            }

            .apple_cmd {
                font-size: 11px;
            }

            .enter_key {
                border-radius: 3px 2px 2px 3px;
            }

            .km {
                fill: #2b2b2a
            }

            .kt {
                fill: #313030
            }

            .kb {
                fill: #212121
            }

            .kf {
                fill: #333332
            }

            #import_notes_modal {
                flex-direction: column;
                position: fixed;
                padding: 5vh 5%;
            }

            #import_notes_public_key {
                display: none;
            }

            #upload_file {
                display: none;
            }

            #import_file_button {
            }

            #last_updated {
                position: absolute;
                top: 0;
                right: 0;
                font-size: 10px;
                color: black;
                z-index: 1;
            }

            .mobile_br {
                display: none;
            }

            .converted_text_line {
                min-height: 27px;
                position: relative;
                display: flex;
            }

            .line_butter {
                flex-grow: 1;
                background-color: #000;
                position: relative;
            }

            #copy_bar {
                position: absolute;
                top: -32px;
                background-color: #222;
                text-align: center;
                opacity: .90;
                display: flex;
                align-items: center;
                padding: 2px 8px;
                cursor: pointer;
                white-space: nowrap;
            }

            #copy_bar:hover {
                opacity: 1
            }

            #copy_icon {
                height: 22px;
                fill: #fff;
                margin-right: 8px;
                padding-bottom: 3px;
                pointer-events: none;
            }

            #copy_bar span {
                pointer-events: none;
            }

            .flip_180 {
                transform: rotate(180deg);
            }

            .flip_270_asc {
                transform: rotate(270deg);
                align-self: center
            }

            .dim_ele {
                opacity: .7
            }

            .align_baseline {
                align-self: baseline;
            }

            @media(orientation: portrait) and (max-width: 800px) {
                html {
                    padding:0 4%;
                }

                body {
                }

                #signin_form {
                    flex-direction: column;
                    width: 100%;
                }

                #landing_input, .signin_mp_c_input {
                    width: 100%;
                    font-size: 16px;
                    max-width: 100%;
                }

                #landing_container {
                    padding: 2% 0 12%;
                }

                #landing_logo_icon svg:nth-of-type(1) {
                    height: 50px
                }

                #landing_logo_icon svg:nth-of-type(2) {
                    height: 38px;
                }

                .landing_logo_container {
                    margin: 2vh 0 50px;
                }

                .standard_container {
                    margin: 20px auto;
                    padding: 2% 0;
                }

                #reserve_username_container {
                    margin: 40px auto 20px;
                }

                #user_note_topbar {
                    flex-wrap: wrap-reverse
                }

                #user_note_additional_controls {
                    width: 100%;
                    margin-bottom: 42px;
                    justify-content: right;
                    min-height: 50px
                }

                #user_note_additional_controls span {
                    margin-left: 0;
                }

                #user_note_outer_container {
                    margin: 12px auto 20px;
                }

                #loading_container span {
                    height: 128px;
                    width: 128px;
                }

                #user_note_titlebox {
                    margin: 0 0 0 12px;
                }

                .fund_ac_current_bal {
                    flex-direction: column;
                }

                .tb_exit_label {
                    display: none;
                }

                .standard_hc {
                    width: 100%
                }

                .standard_hc_outer {
                    flex-direction: column;
                }

                .inner_hc {
                    max-width: 100%;
                    padding: 30px 0;
                }

                #how_you_pay {
                    margin: 0
                }

                #pay_with_crypto {
                    margin: 0
                }

                #your_bno_container {
                    margin: 0;
                    padding: 30px 14px;
                }

                .notes_home_menu_icons {
                    margin: 0;
                }

                .notes_home_menu_label {
                    display: none;
                }

                .notes_home_menu_locks_label {
                    width: unset;
                    padding: 11.5px;
                }

                .portrait_br {
                    display: unset
                }

                .get_note_box {
                    padding: 24px 18px;
                }

                #fund_ac_cc_box {
                    align-items: center;
                }

                .button_len_cap {
                    max-width: unset
                }

                #user_note_textbox, #textbox_conversion_container, #import_notes_textarea {
                    margin-top: 28px;
                    padding: 2px 0;
                }

                .standard_modal_container {
                    padding: 37.5px 25px
                }

                .mobile_br {
                    display: unset;
                }
            }

            #lock_all_notes, #unlock_many_notes {
                display: none;
            }
        </style>
    </head>
    <body>
        <span id=last_updated></span>
        <div id=tb_exit>
            <span id=tb_exit_x></span>
            <span class=tb_exit_label>Exit</span>
        </div>
        <div id=loading_container>
            <span></span>
            <p id=loading_message>&nbsp;</p>
        </div>
        <div id=topbar_container class=ns>
            <div id=tb_back>
                <span id=tb_back_arrow></span>
                <span id=tb_back_text>Back</span>
            </div>
            <svg viewBox="0 0 9 9" id=hamburger_svg tabindex=0 data-keyevent=default_key_event>
                <rect width="9" height="1" x="0" y="1.5" rx=".5"/>
                <rect width="9" height="1" x="0" y="4" rx=".5"/>
                <rect width="9" height="1" x="0" y="6.5" rx=".5"/>
            </svg>
            <div id=topbar_logo_container class=ns>
                <div class=topbar_link id=topbar_logo_icon tabindex=0 data-keyevent=default_key_event></div>
            </div>
        </div>
        <div id=menu_container>
            <div id=menu_modal class=standard_menu_modal>
                <div class=network_main_container>
                    <h3 class=contract_network_label>Network:</h3>
                    <div id=contract_button></div>
                    <div id=contract_dropdown_container>
                        <div class=contract_dropdown_ic>
                            <div id=contract_dropdown_modal></div>
                        </div>
                    </div>
                </div>
                <a href="mailto:support@bitnote.xyz" target=_blank>Contact Us</a>
                <a href="https://twitter.com/bitnote_xyz" target=_blank>Twitter</a>
                <a href="https://t.me/bitnote_xyz" target=_blank>Telegram</a>
                <h5 id=version_number></h5>
            </div>
        </div>
        <div id=main_content_container_outer>
            <div id=main_content_container_inner></div>
        </div>
        <script>
            "use strict";
            let app_version = "1.04";
            let current_version = {
                app_version: app_version,
                ww_version: "",
                sw_version: ""
            };
            let no_leave_flag = false;
            let app;
            let main_currency_symbol = "AVAX";
            let current_mod_contract = setByChainType("0x225afdeb639e4cb7a128e348898a02e4730f2f2a", "0xdb25fb5bec4914828463b5dfca6688c50bf93aca");
            let current_sk_contract = setByChainType("0x78d35c5341f9625f6ec7c497ed875e0dee0ef3ac", "0xb24493f943b35eb8bd45fb6c2122e553a89d7cf4");
            let swc = null;
            let system_vars = {
                load_fired: false
            };
            let ls_h = new loading_screen_handler();
            let xhr_h_chain, kh, eh, hb, active_contract, active_url_paths, alerts_h, ww_h, tb_h, loading_icon_b64;
            let toast_h;
            let ww_script = null;
            window.addEventListener("DOMContentLoaded", domInit);
            window.addEventListener("load", loadInit);
            window.addEventListener("beforeunload", appLeave, true);
            function appLeave(e) {
                if (no_leave_flag) {
                    e.preventDefault();
                    e.returnValue = '';
                    alerts_h.setAlert("confirm", {
                        submit_label: "I Understand, Continue",
                        cancel_label: "Go Back",
                        sub_heading: "You will lose access to your funds forever if the account is not initialized",
                        alert_msg: "Beware!",
                        simple_close: true,
                        confirm_req: 1
                    }, function(ret) {
                        if (ret)
                            no_leave_flag = false;
                    });
                } else {
                    ww_h.sendMessageToWorker({
                        msg_type: "remove_keys",
                    }, [], null);
                    document.body.style.display = "none";
                    app.backToLanding();
                    window.setTimeout(function() {
                        document.body.style.display = null;
                    }, 500);
                }
            }
            function domInit() {
                (function() {
                    active_url_paths = emptyUrlPaths();
                    hb = new html_builder();
                    tb_h = new topbar_ns_handler({
                        z_index: 2139002000
                    });
                    xhr_h_chain = new best_choice_handler(new simple_xhr(),{});
                    kh = new keccak_handler();
                    toast_h = new toasts_handler(getCustomToastCss());
                    loading_icon_b64 = "data:image/gif;base64,R0lGODlh0gDSAIABAAQCBP///yH/C05FVFNDQVBFMi4wAwEAAAAh+QQFBQABACwAAAAA0gDSAAAC/4yPqcvtD6OctNqLs968+w+G4kiW5omm6sq27gvH8kzX9o3n+s73/g8MCofEovGITCqXzKbzCY1KpzGA9YrNarfcrvcLDoOpH7H5jE6rsWTP+g2Po9sduf2OB9A5+b7/vLfxN0i4FahRmFh4mKHo6MeIYdY0GWlRuYRpOaGZ1LkJ8XkkCtpAWnRaqpA6xKp64BoU+zr7U1v6mHv3GqHrC8cb+js8F+xAjCxmfJzc3LVs6iydBc0wfW1VvYB9rS1hyATufSGuVD5OcY6kjt6rRfneXsFuRC8fTR0ef/+9b+7P74E9IgMDIrCHEOBBhbAYGiho8KHDAAnzbZtYkU1Egf8YO1pc5VHjxY8bR4oESXJhyoYrJbakOLEkzJcZr+A7maBmNpnWQtrsSdPnTpM/eaLEqRIpS6Uumc50CjGiTj1AoQqlSnSo0aRF+wX96rRq161NxwoDa3ZpWmYvZUblqjXn1XkxS75VGxcu1qNrb/Z1W5dvXrx75bbNWpjs3bKDGScmTPfwxsVP+06NHNZuYMNW0Tb2+xmwZHeeH1/abJCy2M+qEZPl/JfTXD6oA7YWbLpyaNmjU9dm2zmzV+FSf4POfRv27snGVyNv7vo1ZNql60BHd+u49TDSCXPZTvzsmO66n1EPz5E7+ezOwX8hX/77+djD369XNn856fHd2Uf/F4RffwEicp1y5sGHm3wr+Ccdg40MiGB6/KngoGIQolDhVhmepl6E4tm34IUeIqYghSKOaGCJKWwI3ylTqYgigR3idhyMMUpyYnk1JnejXjY6tmOBPXp3mXM/DsnbhAYG2RuSRhZJIo9IunjVkU7iOGOKUl65H4gJbsmlhF5qKWSYH3rBJHpmcqikj2CuGWWVb8JJZmlW0ollm0SWieeXcvLZp5t/NhnomQf6SWihwI0paKKKPjmomo9CauecgVKZ5aRsMrqno4WyyOKNoOao6KiZamqqnpOmyumqpCbZ6qOsoqlpnZJSemuMocJKa5i71tcrl792GeyVwxp6J4rH/4pZrJPLLtrslK+K8Ow91eJK32vXAniqUdvKqCpP3z7YrbjTVnGub+XSMO4h7ZKTrm3xuvDuHvViFqtouepgKS/9wvCvKgHTC+gyA7dw8CYJh+gpdgXPsHAkEa/4cDATY1ixvxkDvLHAHRPc8DgXnzCyvR8jfLLCKTO8r8grmxiyNyWXMHMbNY9wMxU5h7CzFD2X8TIjP7sRtLtFk3y0yTHfMPQTTeeXm77ZAvE0PEvbULU+V9eQdSZJ0/y1zWHjPLbOZfN8ts9pA721wWsT3bYxXec5tbxxyzC3LNxIY+3ezvTtdzKAB07M4IT/YvjhuiSu+COMN67I43lvGm0192CScDkq8/aQOUGb89B5K5/vELoQpbMdrtvrir66xaPz+7rQkPsi+eyD1G47JPLkngvuvOPh++92BC98HMQX/0atyi/PfPPOPw999NJPT3311l+Pffbab899995/D372BQAAIfkEBQUAAQAsAAAAAAEAAQAAAgJMAQAh+QQJBQABACxPAC8AHwBQAAACQoyPqcvtD6OctNqLs968+w+G4kiW5omm6sq27gvH8kzX9o3n+s73/g8MCofEojEGSCoBnKWy6WRuolINFerELrXKAgAh+QQFBQABACwAAAAA0gDSAAAC/4yPqcvtD6OctNqLs968+w+G4kiW5omm6sq27gvH8kzX9o3n+s73/g8MCofEovGITCqXzKbzCY1Kp9Sq9YrNarfcrvcLDovH5LL5jE6r1+y2+w2Py+f0uv2Oz+v3/L7/DxgoOEhYaHiImKi4yNjo+Ag5BjBJCRApVEl5GZQ5uQnUafnpEzpK2mnaU5q6s8oa46oQ+2oyi2BLO4JrsJsL0tvr6wGMKlxCnGl8XLwQrKyBXPm84jx9Um29nJz9gs0t4v39yyyuEl7ecY6uS75e2+5Ooh5/MU9fYX8/ka8fwd//4N80gQAZECwoCx7CDQcXHmjoMABEhxMXVkQYKmNEC+MZL67rqHCjA5DbREogKc3kSZSeVPpjKcplQJgyMcCMWdMgzZwNbvLsufNnQpZCmwUt+vAoUolKkfpcmpQoVF5Niz6dehVq1qVbnVY12TVqyohhqZak+JXpWYtpPbIqq3YsWqlG12JsG7IfXLep+Orzew8wPcHxCLsz/DHv1LiaFjt+DDmy5MmUK1u+jDmz5s2cO3v+DDq06NGkS5s+jTq16tWsW+u0CxkxOtnlaIuz/Q03N93ZeLv+DTy48OHEixs/jjy58uXMmzt/Dj269OnUq1u/jj279u3cu3v/Dj68eBAFAAAh+QQJBQABACxnAC8ADwBIAAACH4yPqcvtD6OctNqLs968+w+G4kiW5omm6sq27gvHcQEAIfkEBQUAAQAsAAAAANIA0gAAAv+Mj6nL7Q+jnLTai7PevPsPhuJIluaJpurKtu4Lx/JM1/aN5/rO9/4PDAqHxKLxiEwql8ym8wmNSqfUqvWKzWq33K73Cw6Lx+Sy+YxOq9fstvsNj8vn9Lr9js/r9/y+/w8YKDhIWGh4iJiouMjY6PgIGSk5SVlpeYmZqbnJ2QHwCQrQaRMKOlpT+nlKkyq6KtP6CpsqGxNb+3KLi0q726LrqwIcjDJMbGJ8TJKsLMLcDPIMbSE9zVFtrYGdjbHNTd37HR0u7uFdLnGOvs7e7v4OHy8/P6ROH2BPnz+/L98f/w9ewHcD7+EjZ/BBwXYL2TVc9xBdxHITxVX8dpFbxmyKG611nPYRWshmI5WVTIgypcqVLFu6fInmJDGZwWj6srkLJy6dtXjK8gkzqNChRIsaPYo0qdKlTJs6fQo1qtSpVKtavYo1q9atXLt6/ZoD6Cqxp8iOMtsJLSe1m9hqcgs2rty5dOvavYs3r969fPv6/Qs4sODBhAsbPow4seLFjBs7fgw5suTJsgoAACH5BAkFAAEALGcALwAfAFAAAAIyjI+py+0Po5y02ouz3rz7D4biSJbmiabqyrbuC8fyTNf2jef6zvf+DwwKh8Si8YhMFgsAIfkEBQUAAQAsAAAAANIA0gAAAv+Mj6nL7Q+jnLTai7PevPsPhuJIluaJpurKtu4Lx/JM1/aN5/rO9/4PDAqHxKLxiEwql8ym8wmNSqfUqvWKzWq33K73Cw6Lx+Sy+YxOq9fstvsNj8vn9Lr9js/r9/y+/w8YKDhIWGh4iJiouMjY6PgIGSk5SVlpeYmZqbnJ2QHwCQrQEAraaUL6OYpqWoIqyuDKShILuyorQruQe/uxm+DLywF8MBycURyAbOyhvDxr67zSHB0yTd0LfX1irS2c3f1MCo4tPt76bQ7CnW6xzk7h/i4RLw9BX+9wjx8eus+M7u+CvoAIBhI0YPBgQoILAzY05yriwXkRAU5UUNHixYLSGfttzNex1EdVIV+N1FXS5MlfKU+mVLmSWMuYLEvSrBnyJkebOhHO7Pmyp0+eQH/qDCoUaVGiR43eVNqU6VOnE5FBrWeV6rusUuVxzenva0eHGq96LauVndiMQkl6bItRY1K5S9/C3Wn37tC8eh/u86s3sODBhAsbPow4seLFjBs7fgw5suTJlCtbvkwNMFa6Ufne1Xy23GDQWzlPFY05terVrFu7fg07tuzZtGvbvo07t+7dvHv7/g08uPDhxIsbP448ufLlzJs7fw49uvTpYQoAACH5BAkFAAEALF8ALwAPAEgAAAIfjI+py+0Po5y02ouz3rz7D4biSJbmiabqyrbuC8dxAQAh+QQFBQABACwAAAAA0gDSAAAC/4yPqcvtD6OctNqLs968+w+G4kiW5omm6sq27gvH8kzX9o3n+s73/g8MCofEovGITCqXzKbzCY1Kp9Sq9YrNarfcrvcLDovH5LL5jE6r1+y2+w2Py+f0uv2Oz+v3/L7/DxgoOEhYaHiImKi4yNjo+AgZKTlJWWl5iZmpucnZAfAJCtBpEwo6WlP6eUqTKroq0/oKmyobE1v7cotboru70uubAhx8MkzMS3ssnKxczNyMXAqd+zwtYmztgZ3Nsc2t4f2NES5uQV5OcY6+zt7u/g4fLz9fpE5/YH8fkH/PT+8/D6A8gfEIijP4DqE7he0YsnO4DiI6ieUoHqymz4HFb4obuXXM9tFayGkjoZXMiDKlypUsW7p8qeekMpnHaBKzGQynL527eOLyCTOo0KFEixo9ijSp0qVMmzp9CjWq1KlUq1q9ijWr1q1cu3r9ugSoLLGvyK4yewrtKLWd2HJyCzau3Ll069q9izev3r18+/r9Cziw4MGECxs+jDix4sWMGzt+DDmy5MmUCgAAIfkECQUAAQAsZwA3AAcASAAAAhSMj6nL7Q+jnLTai7PevPsPhuLIFAAh+QQFBQABACwAAAAA0gDSAAAC/4yPqcvtD6OctNqLs968+w+G4kiW5omm6sq27gvH8kzX9o3n+s73/g8MCofEovGITCqXzKbzCY1Kp9Sq9YrNarfcrvcLDovH5LL5jE6r1+y2+w2Py+f0uv2Oz+v3/L7/DxgoOEhYaHiImKi4yNjo+AgZKTlJWWl5iZmpucnZ6fkJGio6SlpqeoqaqrrK2ur6CrsIMEsLECtSS3sbkju7C9Jr++sRPEzca9xRnLyxzPwMHS09TV1tfY2drb3N3e39DR4uPk5ebn6Onq6+zt7u/g5/nFvuLF4ffg+e/73v3d/9L57AgQQLGjyIMKHChQwbOnwIMaLEiRQrWryIMaPGjUUcO3qMEHBbSG0js5XEdvJaSmsrq7X8CDOmzJk0a9q8iTOnzp08e/r8CTSo0KFEixo9ijSp0qVMmzp9CjWq1KlUq1p9WAAAIfkECQUAAQAsVwA3ABcAQAAAAiWMj6nL7Q+jnLTai7PevPsPhuJIluaJpurKtu4Lx/JM1/aN520BACH5BAUFAAEALAAAAADSANIAAAL/jI+py+0Po5y02ouz3rz7D4biSJbmiabqyrbuC8fyTNf2jef6zvf+DwwKh8Si8YhMKpfMpvMJjUqn1Kr1is1qt9yu9wsOi8fksvmMTqvX7Lb7DY/L5/S6/Y7P6/f8vv8PGCg4SFhoeIiYqLjI2Oj4CBkpOUlZaXmJmam5ydnp+QkaKjpKWmrqB5CqCnDKsqrauvKaGqsyy1qLcpurO8t7svtbEiws61s8QowMorzs0ezMAR2tMU2NYX1tka3d7f0NHi4+Tl4+fLzAfZ2tTs2OLv7+Wi6/Sg+f0B5dD0vOT+vvlj5wAgd+K4jPnAGE8xTmY9jP4QGIESUGoAjQ4kWMnxoXcuyIEZfGkB03UixJEuTHkSstpmTZsKQCg+Zo3ospE4HNgDhzeuzpc6fPiQlzCo1XVObRcEsJJkX5VCXQoVSrWr2KNavWrVy7ev0KNqzYsWTLmj2LNq3atWzbun0LN67cEE0PRoVpz2pdb3u79dX2d93duYQLGz6MOLHixYwbO34MObLkyZQrW76MObPmzZw7e/4MOrTo0aRLm85ZAAAh+QQJBQABACxnADcAFwBIAAACKIyPqcvtD6OctNqLs968+w+G4kiW5omm6sq27gvH8kzX9o3n+s73RwEAIfkEBQUAAQAsAAAAANIA0gAAAv+Mj6nL7Q+jnLTai7PevPsPhuJIluaJpurKtu4Lx/JM1/aN5/rO9/4PDAqHxKLxiEwql8ym8wmNSqfUqvWKzWq33K73Cw6Lx+Sy+YxOq9fstvsNj8vn9Lr9js/r9/y+/w8YKDhIWGh4iJiouMjY6PgIGSk5SVlpeYmZqbnJ2en5CRoqOkpaauoIkKoKcMqyqtq68poaqzLLWotym6s7y3uy+1sSLLxBXBxyjPyhvNzR7GzsG808Tf1sfS39qt3t/Q0eLj5OXu4Ebc6Anq6wzo7g/m4QL0//bs+O/33LL3/Ar88bwGz3Bq7yN88gLIQKF/prSIshRIQBIOJ6OFFiQ4qQFjlmxLhRo0KPIcetC1jsJEFwKrmRa3nw5cp/MwXWrHhTG0yH4nZGpAg0qNChRIsaPYo0qdKlTJs6fQo1qtSpVKtavYo1q9atXLt6NZkTZMyiKGW6JBu2XtqCZ4mW/Qo3rty5dOvavYs3r969fPv6/Qs4sODBhAsbPow4seLFjBs7fgw5suTJlCtbvow5M50CACH5BAkFAAEALGcAPwAPADgAAAIbjI+py+0Po5y02ouz3rz7D4biSJbmiabqymIFACH5BAUFAAEALAAAAADSANIAAAL/jI+py+0Po5y02ouz3rz7D4biSJbmiabqyrbuC8fyTNf2jef6zvf+DwwKh8Si8YhMKpfMpvMJjUqn1Kr1is1qt9yu9wsOi8fksvmMTqvX7Lb7DY/L5/S6/Y7P6/f8vv8PGCg4SFhoeIiYqLjI2Oj4CBkpOUlZaXmJmam5ydnp+QkaKjpKWmp6ipqqusra6voKuwgwSwsQK1JLexuSO7sL0mv76xE8TNxr3FGcvLHM/AwdLT1NXW19jeKM7aC9zdDtrQAejjBObmB+nk6+fi6O7P6eGy9fS5/Q7p2/vY/df/3PWsBqA6kVnHZQWsJoC6E1fPbwnsSJFCtavIgxozJ4bxMjJvNoDOQwkb9I7jJ5C6XGlSxbunwJM6bMmTRr2ryJM2cYlbB4vvLpCmgroayIrjKqCqnOpUybOn0KNarUqVSrWr2KNavWrVy7ev0KNqzYsWTLmj2LNq3atWzbun0LN67cuXTr2r2LN6/evRcKAAAh+QQJBQABACxfAD8ABwAIAAACB4yPqcvtUQAAIfkEBQUAAQAsAAAAANIA0gAAAv+Mj6nL7Q+jnLTai7PevPsPhuJIluaJpurKtu4Lx/JM1/aN5/rO9/4PDAqHxKLxiEwql8ym8wmNSqfUqvWKzWq33K73Cw6Lx+Sy+YxOq9fstvsNj8vn9Lr9js/r9/y+/w8YKDhIWGh4iJiouMjY6PgIGSk5SVlpeYmZqbnJ2en5CRoqOkpaanqKmqq6ytrq+gobKztLW2t7i5uru8vb6/sLHCw8TFxsfIycrLzM3Oz8DB0tPU1dbX2Nna29zd3t/Q0eLj5OXm5+jp6uvs7e7v4OHy8/T19vf4//DrDPD/Dcz+8fQH/OBhJsZlAgQIX9GAbMBzGixIkUK1q8iDGjxo0oHDt6/AgypMiRJEuaPIkypcqVLFu6fAkzpsyZNGvavIkzp86dPIkVAAAh+QQJBQABACxnAEcABwA4AAACEYyPqcvtD6OctNqLs968+y8VACH5BAUFAAEALAAAAADSANIAAAL/jI+py+0Po5y02ouz3rz7D4biSJbmiabqyrbuC8fyTNf2jef6zvf+DwwKh8Si8YhMKpfMpvMJjUqn1Kr1is1qt9yu9wsOi8fksvmMTqvX7Lb7DY/L5/S6/Y7P6/f8vv8PGCg4SFhoeIiYqLjI2Oj4CBkpOUlZaXmJmam5ydnp+QkaKjpKWmp6ipqqusra6voKGys7S1tre4ubq7vL2+v7CxwsPExcbHyMnKy8zNzs/AwdLT1NXW19jZ2tvV0M4P0N8Az+LT4e7mx+3pxePt4O/k7OPU9fb3+Pn6+/z9/v/w9wHjt05uJ5M6iO2cB1BQm6cwgvoMSJFCtavIgxo8aNMxw7evwIMqTIkSRLmjyJMqXKlSxbunwJM6bMmTRr2ryJM6fOnTx7+vwJNKjQoUSLGpVZAAAh+QQJBQABACxnAG8ABwAIAAACB4yPqcvtUQAAIfkEBQUAAQAsAAAAANIA0gAAAv+Mj6nL7Q+jnLTai7PevPsPhuJIluaJpurKtu4Lx/JM1/aN5/rO9/4PDAqHxKLxiEwql8ym8wmNSqfUqvWKzWq33K73Cw6Lx+Sy+YxOq9fstvsNj8vn9Lr9js/r9/y+/w8YKDhIWGh4iJiouMjY6PgIGSk5SVlpeYmZqbnJ2en5CRoqOkpaanqKmqq6ytrq+gobKztLW2t7i5uru8vb6/sLHCw8TFxsfIycrLzM3Oz8DB0tPU1dbX2Nna29zd3t/Q0eLj5OXm5+jp6uvs7e7v4OHy8/T19vf4+fr7/P3+//DzCgwIEECxo8iDChwoUMGzp8CDGixIkUK1q8iDGjxo0WHDt6/AgypMiRJEuaPIkypcqVLCkVAAAh+QQFBQABACwAAAAAAQABAAACAkwBACH5BAUFAAEALAAAAAABAAEAAAICTAEAIfkECQUAAQAsNwAPAGcAsAAAAqSMj6nL7Q+jnLTai7PevPsPhuJIluaJpurKtu4Lx/JM1/aN5/rO9/4PDAqHxKLxiEwql8ym8wmNSqfUqvWKzWq33K73Cw6Lx+Sy+YxOq9fstvsNj8vn9Lr9js/r9/y+/w8YKDhIWGh4iJiouMjY6PgIGSk5SVlpeYmZqbnJ2en5CRoqOkpaanqKmqq6ytrq+gobKztLW2t7i5uru8vb6/sLHBxbAAAh+QQFBQABACwAAAAA0gDSAAAC/4yPqcvtD6OctNqLs94L+A9w4kiW5imBH8q27gsbqhfX9o0zc5j3/l/aAYfEYkRoTCqLyKXzaWtCp9TM7nqtarcdrHfFDW+/ZLGZSv6e1860lw03urHxOnCetetxeOn+P+KHIAhYGDTTQGi4uKEY4MgYWeEIKWkJQYl4uTmp2aXCGZriqVApKpoJenqaCpJIulrYCvbpGrs4S6MDe7uXy1NL2/v3+6o6TMx7UIycfFyqLBPdvMYcrEstZq1hmv2zbTXtPQSO0T2eU35xjn6jbsHeXvPe+SxPRE8Rf/+SP7HPT4S/EwAD/ptWkJs4gwrtDVpIECLDdQglHnI4kcNAE/8JMxqzdQ3YPIseR2GUdrJFx5LQUq6kmJLlR2EJXrqw6W2jD5zZdPbgSc1nOpIMhfIhatCoO6QBlUZhys/pyJhRK1JtA7WZ1G9ZkW3d2XXY159he40delXe2aNp261d2hbd26dxb829U/bSXa51Y+0F23fVX7KBWVkFGQcoo8FoEas9TJONYlyQsSXO66xP5Myb7Wp2DGjy5c+WZWH2Rbp06NN6Uqvm/Npz6kii4bgWabrwYte0We926ZsvaLmVcUsObogx2+HjlMNlnrN4a+S5oddu3Dk6cN1LrsM2vow69tgyZ5KHMqf8Lu6Ay6hvCR29m/fws8tPQ7+meJXz84f/Z0+Ye/49sh8L6Q1IIIDj0YHgevE9cVuEfhWIQoS3TajgchZqhuGDWG34WYf2QQhiiIJRGFGJfYh4Hokq4sEieGi8CGNPNB4Yhncz3oifNii6yKMaPmZ4RpA95vjjh0YyiCSRZiwpZJMeUgZlHlKO+FuVSZKgY1D9XdliSThy0SUqX5K5pV5njpGmJWOy6aRWa2pRZihv0tmmJHdWUadYeVYoXVN/pmjdoGDK+GSgVcUpXHZ92mboRYUymlykXCp6z6M3YfoYpQE6aime201KKqh9XWjjqKaWSt4+qHqpaqucPnQqb6myiig9rtoKK67m5TrrA6/KGSuwxf5aD2na//nq4KrOhqnfbLc+ayyzISVrYq9YRmttfdDS2m2nU4JLLbL6BNscUrqqi+6y25Ir67HnyrvouP+FCy+izcZrr2z9Jojvve8KzO/A/hoMcLn76nvtwkmxS6+3DEtsbr0KN4yxSQEX1a5RzvUWMbcXazyyR+uGjEm7gqJMcLUIf5xlyflWTHLB3xLHMkob0yzyzenmnLDNE/fsss/uGu2xyiztCrTDTg/I9M5PU4xg1DILq7SYEEudMdENWi00tmFXvfXVDsBsZ9ljH9Q01GoPPfPUDaZca91czx032/+i7dbbYhcNN95gB66z2XhTrffLWR8eNOGN/80z413Tvffikqoj3tDdl9fsuNx5b545wp63DLpGmPH9Hk6oq6e65aVHDpPmr8MOj+uzc07747f303GoX/fu6e6fez268JcCrSnoJ/9r/Lw7J7/58qI3H/ra1Ldn+PUxrK498ZN3P5Xs4HNk+/iBlG++6W2nH4607G/P6/u8uy//pvTXb2D8+AN6//7k9++/4ykrgHRhHgH/Z8ADCnB6Cjxf8BpIOQZCsBG+8x/0JnjBCTKiAAAh+QQJBQABACwBAAEAzwDQAAAC/4yPqcvtD6OctNqLs968+w+G4kiW5omm6sq27gvH8kzX9o3n+s73/g8MCofEovGITCqXzKbzCY1Kp9Sq9YrNarfcrvcLDovH5LL5jE6r1+y2+w2Py+f0uv2Oz+v3/L7/DxgoOEhYaHiImKi4yNjo+AgZKTlJWWl5iZmpucnZ6fkJGio6SlpqeoqaqrrK2ur6ChsrO0tba3uLm6u7y9vr+wscLDxMXGx8jJysvMzc7PwMHS09TV1tfY2drb3N3e39DR4uPk5ebn6Onq6+zt7u/g4fLz9PX29/j5+vv8/f7/8PMKDAgQQLGjyIMKHChQwbOnwIMaLEiRQrWryIMaPGjREcO3r8CDKkyJEkS5o8iVJjAQAh+QQFBQABACwAAAAA0gDSAAAC/4yPqcvtD6OctNqLs968+w+G4kiW5omm6sq27gvH8kzX9o3n+s73/g8MCofEovGITCqXzKbzCY1Kp9Sq9YrNarfcrvcLDovH5LL5jE6r1+y2+w2Py+f0uv2Oz+v3/L7/DxgoOEhYaHiImKi4yNjo+AgZKTlJWWl5iZmpuTkG4PkJGirqWThqanpyqgpaurqa6qraGotqQns6exsKq7tL2CvKC0z6O/wpPJybbGtMPNjsTAI9DVxDfU2LjL3tO8P9HcwMPm49Ti5uzl2ero7Ofr3+Du8uDx1fb0+Pv+y9P63tr9e9gAL1NRhV4lbCbNLCLUBokAHEEQobxlrYTcFEi/+sJDoUUZEiQ5EZE2wk2fHhxxAhQY50WRLBSZgpNa4E0ZLlS50xD8zkWdPkzQ85ce402tPAT6RBZQ71UJToUalJAyyl2tTn0w5RoU71WvUq2KxKt3J8RaErRrJWzXLdKhYl2glqz0YTWnXsMY955cpK+3XtXpV9OVyNS3OuhLp+ARx0axguZKCKIzBOfNdp4Q2HJzOtDOEy5cxaN2vobBor6AeiP5MumxoDarZ2cQG+yGL24NqPYwvGNtAxX9pvw3oGSC14b+KRjfuunZyG7teqqSNOca6fc+acJT9vHF072+unvXNHkV3GdOG/2dv8jnme+N14z2dYHzy8evP04y//739Da8jhFxFh9rkgoD61GAiga+7V12B+5A3IH3V6WXccgoHlFtiEslX4IA4JtrfgewdeQOAOI0KXIm/DRSjdhiuo5SGKIPawIngtNvafhUvsqNl4NxZoIow/DskghtsZ2ZyQ8AUBZGlOTslkd0v6qESUsFGp5IkWaNkEmGJmaOOVIT4xppk9nungmlWkySWbbT25GJJSwBkhmBfKWSOHuNFlJ4R/JSnnnm7yMCKegxaJpZVx4igjo3yCWKKghRb3KKKRWnoooZUGWWV5amr6Z52jeqonpnmS6acrFShqG6EAdapDooGCuiinROqq4qa4Tmrmp1KGet+tL6RnmbFb/65KZ7Kn7vfNq8rOmWl7tMaAbGjTptoks17qmA+gz/Iq6awvNooeONKO++u1/p17qQrZsrbttIbCK2G4plZbLr67thtjtLfxS27B78ra6moO2Bost456S+yewi7s67BdKkxtxGUSnG6pzro6MMS5AmytvzNWvOzI9DZsr6oXo1tdrPtibLKkE2cM84fsUugbw3He3Oe6HPN8os8iy2zwaMB+KyrI4jo988tIk+wiwuA2S7HHbdbMI9cO3tytyvdaXXW/VzP9Mc0PS20u2UqDvfbUMburNN0SBx213GObXXbSd7P6tNpNH90232/jnbbYLi+t8ZctD6542HovbnfMBK+hTOLlUJ+tOeJfdx754qCHLu/oOYZsOunYpa714ayj/fnrjQstu+eW157zxrhjLfruRL+eb+2/q47HPwqeHofxmWNOh/IsMj+H85wTf4f08emiTDXHQy+H9a637of3nIxPfvnmn49++uqvz3777r8Pf/zyz09//fbfj3/++u/Pf//+/w/AAApwgAQsoAEPiMAEKnCBDGygAx8IwQhKcIIUrKAFL4jBDGpwgxxUQQEAACH5BAkFAAEALBUANwCvAGgAAAKnjI+py+0Po5y02ouz3rz7D4biSJbmiabqyrbuC8fyTNf2jef6zvf+DwwKh8Si8YhMKpfMppMEeEqn1Kr1is1qt9yu9wsOi8fksvmMTqvX7Lb7DY/L5/S6/Y7P6/f8vv8PGCg4SFhoeIiYqLjI2Oj4CBkpOUlZaXmJmam5ydnp+QkaKjpKWmp6ipqqusra6voKGys7S1tre4ubq7vL2+v7CxwsPEysUQAAIfkEBQUAAQAsAAAAANIA0gAAAv+Mj6nL7Q+jnLTai7PevEcAhqBHluaJoqKYtu4Lp2sY1/aNL/OY9/5P2gGAxKIRIjwql8Yk8wm1OaPUqkaInVm3XF32O+yKueDv+FwtZ9Hspxrbjh/fU7m9R9/d97m8lg/oU4cwGGhYUmiQeMh4pef11yi5sbg4efnxqGCJ2clQqekp6gAaOXq6GUqoinpZuvLJ2rr3ygIJO2tYS3Nrmwu4y5Nq+nsXHDaMW0wrG3C8zPfcywttJ53sW03WTHGtvcQp4f09xz0xTl4Unkl8sJ5+8/6ADv8jT9p8X/+iH9uuaG6flIDslCXoJ5ASQUT5Fia0gNDRP2cOH3ar2IGeRYn/BmFo3IghYoaPICFi5ECy5MWJMhqyVLmyIz+XMmHOewkkZcmTAyeKhMezhk6QQWMM3VjUI81sNlfVbLKUWlOnTJUctZh0ps+s5LjiuPrNa7yownbiZAJWm9ieT3/+WiuULDKzT6OkrQbXqFybeZVuPQsUMNWqAP/WxSZ1cOJ0JzXeu3uq8d5pZW8aJhxWsLvJiCvju7y4q+bCbTkjMR34MOW5ij2Txrzan+plkkG7pqgZ8qjapW2z/tx7djFujlED93O7FXHjr0PjFt7cj1qWxX2fQw4b1XLrsbsXxD69bvXg2Q9id66cOvPnmB+fT65dPffOv6PXlw0er3zyzq++/4cf2Wjs9beed+YJGB90m813oIK6icJbewXShx96+iloX4W3ucdgauVRaGBr94W4IIbpmTjehyVKiGCAKK7HIX8A0iZgihY2yKKJk7zRgI0zrngjXWD0CGNFbolWBpEdAvljhlPhuIaG9/nX11tqKCnjlEZWmQuPUn5JIpYqInUlmCCeeVqL9XgZ5oAbbqmmGP/NOcaRbcz5X51cboHne3rGKUef5/2pIzOCSifnnlYcihyhY+rCaB6OBslIpJImCug2mX5lKZu7KapCp2W6WKg9oiaZYKmCnDpkqo9CxWqUpL6qTqyyfrrpWLbayQavbO2qahe+xoXqk0yOCIWnxv8Oq1exxrqJrBujPsusX60+C+2kcGCbLabXUgvqCcpauSQa1UJa7hnnBvKgVeFaM6Gw7wYar6bBYtJuOblKki+s97pSL5/z2pvfIev2mmelAwvsp8L7GpOwwQsvGjG6/0ZTMbsTp5ExMBtTQafDF/MbMMUPi5wjrcl+rK2WJ6/6ssUpU2ryyI30W2vMGqfbskA4E3Ewxjx7qzKNQ0urM8BHo8UyvEuD0zS9T7ub9I4l62szhFf7W/RwW+ectSc/Ext2l1//SvNDY5sQ9KwEVq0Q3LhmaVfUMr9dtgdtzz1zk33YvTPdK8ut9dR/E06u4GR3/eTaaeadkOOWQe7z2RzNMT6V5MelzW23aFqLeVOai8k5t6Ob2XlIlkPpd+rXGU56665/h3fons+e0eoi4h6E7sfyrrfvTgIft+IjAR658LcTz1C6ezO/e5vPQz886y5TTn30n/+evVbGa999S84jb3qRiFPvY7Thhwr7+i2c7v7r38d/+Pz062r//YvXXrr+vbfvv+ABMIDiKxgB0XapAyKQDgrEX6MauL8EQtB7D5wgBRFlQRd0LIPNsh0HBejBD6LkfCLcnPpKeMETovB9JFxhZ1wIsxDC8IMFAAA7";
                }
                )();
                var script_list = ["/pages/js/new_wl.js", ];
                loadScripts(script_list);
                var font_h = new font_handler();
                font_h.fontLoader(['/pages/fonts/inter_variable.ttf', ], {
                    font_display: "swap"
                });
                ww_h = new blobWorkersHandler();
                ww_h.loadWorkerScript('/pages/js/ww.js', storeAndWaitForWorker);
                registerSW(function(valid) {
                    system_vars.sw = true;
                    swc = navigator.serviceWorker.controller;
                    if (swc != null) {
                        sendSwMessage({
                            type: "init"
                        }, function(ret) {
                            current_version.sw_version = ret.data.sw_version;
                            current_version.live_version = ret.data.live_version;
                            waitForBothWorkers();
                        });
                    }
                });
                determineSystemVars();
            }
            function storeAndWaitForWorker(valid, external_script) {
                ww_script = external_script;
                waitForWebWorker(valid);
            }
            function waitForWebWorker(valid=true) {
                if (valid) {
                    if (system_vars.load_fired && ww_h.scriptReady()) {
                        ww_h.initWorkers(function(worker_version) {
                            current_version.ww_version = worker_version;
                            app = new initApp();
                            document.getElementById("main_content_container_outer").style.opacity = "1";
                            waitForBothWorkers();
                        });
                    }
                } else
                    toast_h.setToast(0, "Error", "Failed to load web worker, please try again.", 600);
            }
            function waitForBothWorkers() {
                if (swc != null && current_version.ww_version != "" && checkForProperty(current_version.live_version))
                    determineUpdateButton();
            }
            function getCurrentVersion() {
                return current_version.app_version + current_version.ww_version + current_version.sw_version;
            }
            function sendSwMessage(data, cb) {
                var msg_channel = new MessageChannel();
                if (swc.state === 'activated') {
                    msg_channel.port1.onmessage = cb;
                    swc.postMessage(data, [msg_channel.port2]);
                } else if (swc.state === 'redundant' && navigator.serviceWorker.controller.state != 'redundant') {
                    swc = navigator.serviceWorker.controller;
                    sendSwMessage(data, cb);
                } else
                    console.log(swc.state);
            }
            function registerSW(cb) {
                var wait_count = 10;
                if ('serviceWorker'in navigator) {
                    if (navigator.serviceWorker.controller)
                        cb(true);
                    else {
                        navigator.serviceWorker.register("/sw.js").then(function(registration) {
                            registration.onupdatefound = function() {
                                var installingWorker = registration.installing;
                                installingWorker.onstatechange = function() {
                                    if (installingWorker.state === 'activated')
                                        cb(true);
                                }
                                ;
                            }
                            ;
                        });
                    }
                } else
                    cb(false);
            }
            function loadScripts(script_list) {
                for (var i = 0; i < script_list.length; i++) {
                    var new_script = document.createElement("script");
                    new_script.src = script_list[i];
                    document.body.appendChild(new_script);
                }
            }
            function loadInit() {
                system_vars.load_fired = true;
                loadScripts(["/pages/js/zxcvbn.js"]);
                setImageMask(document.getElementById("loading_container").firstElementChild, loading_icon_b64);
                var settings = initAlerts();
                alerts_h = new alerts_handler(settings.alert_params);
                waitForWebWorker(true);
                var font_h = new font_handler();
                font_h.fontLoader(['/pages/fonts/bitnote_box_font.woff2', ], {
                    font_display: "swap"
                });
            }
            function determineUpdateButton() {
                var cv = getCurrentVersion();
                if (checkForProperty(cv) && cv != current_version.live_version)
                    tb_h.newNotification({
                        msg_html: "New BitNote update! Tap to use the latest version",
                        full_bar_target: true,
                        custom_bg_color: "#e99a32",
                        custom_color: "#fff",
                        svg_icon: hb.getSvg("warning_w_border", {
                            class_string: "std_icon"
                        }),
                        close_icon: hb.getSvg("x", {
                            class_string: "std_close_icon"
                        })
                    }, triggerUpdate);
            }
            function triggerUpdate(res) {
                if (res) {
                    setLoadingScreen(true);
                    sendSwMessage({
                        type: "update_version"
                    }, function(ret) {
                        setLoadingScreen(false);
                        alerts_h.setAlert("confirm", {
                            submit_label: "Reload",
                            cancel_label: "Maybe later",
                            sub_heading: "A page reload is required for updated version to take effect.",
                            alert_msg: "Reload Page?",
                            simple_close: true,
                            confirm_req: 1
                        }, function(ret) {
                            if (ret)
                                window.location.reload();
                        });
                    });
                }
            }
            function determineSystemVars() {
                system_vars.mobile = false;
                if ("maxTouchPoints"in navigator)
                    system_vars.mobile = (navigator.maxTouchPoints > 0) ? true : false;
                else
                    system_vars.mobile = navigator.userAgentData.mobile;
            }
            function blobWorkersHandler() {
                let workers = [];
                let worker_pointer = 0;
                let worker_blob = null;
                this.loadWorkerScript = loadWorkerScript;
                function loadWorkerScript(new_worker_url, cb) {
                    getWorkerScript(new_worker_url, function(ret_blob, ret_script) {
                        if (ret_blob != null) {
                            worker_blob = ret_blob;
                            cb(true, ret_script);
                        } else
                            cb(false, null);
                    });
                }
                this.loadWorkerFromBlob = loadWorkerFromBlob;
                function loadWorkerFromBlob(new_blob, cb) {
                    worker_blob = new_blob;
                    buildWorkers(worker_blob);
                }
                this.scriptReady = scriptReady;
                function scriptReady() {
                    return (worker_blob != null) ? true : false
                }
                this.initWorkers = initWorkers;
                function initWorkers(cb) {
                    buildWorkers(worker_blob);
                    sendMessageToWorker({
                        msg_type: "get_version"
                    }, [], function(ret) {
                        cb(ret);
                    });
                }
                this.sendMessageToWorker = sendMessageToWorker;
                function sendMessageToWorker(msg_param, transfer_array, cb) {
                    let temp_pointer = worker_pointer;
                    worker_pointer = (worker_pointer + 1 < workers.length) ? worker_pointer + 1 : 0;
                    sendArrayBufferToWorker(temp_pointer, msg_param, transfer_array, cb);
                }
                function sendArrayBufferToWorker(worker_pointer, msg_param, transfer_array, cb) {
                    workers[worker_pointer].worker.postMessage(msg_param, transfer_array);
                    if (cb != null)
                        workers[worker_pointer].worker.addEventListener("message", handleDeResponse);
                    function handleDeResponse(event) {
                        workers[worker_pointer].worker.removeEventListener("message", handleDeResponse);
                        var data = event.data;
                        if (cb != null)
                            cb(data);
                    }
                }
                function buildWorkers(worker_blob_obj) {
                    const num_workers = 1;
                    for (var i = 0; i < num_workers; i++)
                        workers.push({
                            id: i,
                            worker: createWorker_blob(worker_blob_obj),
                            in_use: false
                        });
                    function createWorker_blob(blobURL) {
                        const worker = new Worker(blobURL);
                        return worker;
                    }
                }
                function getWorkerScript(main_worker_url, cb) {
                    const xhr = new XMLHttpRequest();
                    xhr.open('GET', main_worker_url, true);
                    xhr.onreadystatechange = function() {
                        var ret;
                        if (xhr.readyState === 4 && xhr.status === 200)
                            cb(URL.createObjectURL(new Blob([xhr.response],{
                                type: 'application/javascript'
                            })), xhr.responseText);
                        else if (xhr.readyState === 4)
                            cb(null);
                    }
                    ;
                    xhr.send();
                }
            }
            function getNewLogo() {
                var svg = hb.getSvg("bitnote_text", {
                    class_string: "bitnote_logo_text"
                });
                svg += hb.getSvg("bitnote_lock", {
                    class_string: "bitnote_logo_icon"
                });
                return svg;
            }
            function getContractArray() {
                return [{
                    address: "0x3b0f15dab71e3c609ecbb4c99e3ad7ea6532c8c9",
                    chain_name: "avax",
                    display_name: "AVAX",
                    coin_dn: "AVAX",
                    chain_id: "a86a",
                    rpc_list: getRpcList("avax"),
                    displayed_tax_rate: "10%",
                    scan_url: "https://subnets-test.avax.network/c-chain",
                }, {
                    address: "0x4c1ce9fd81ba9c3a899187b4f884860b6773bd27",
                    chain_name: "fuji",
                    display_name: "Fuji (AVAX)",
                    coin_dn: "TEST_AVAX",
                    chain_id: "a869",
                    rpc_list: getRpcList("fuji"),
                    displayed_tax_rate: "10%",
                    scan_url: "https://subnets-test.avax.network/c-chain",
                }, ];
            }
            function getRpcList(chain_name) {
                var valid_rpc_list = ["https://api.avax.network/ext/bc/C/rpc", "https://rpc.ankr.com/avalanche", "https://api.avax-test.network/ext/bc/C/rpc", "https://rpc.ankr.com/avalanche_fuji", "https://ava-testnet.public.blastapi.io/ext/bc/C/rpc", "https://avalanche-fuji.drpc.org"];
                switch (chain_name) {
                case "goerli":
                    return ["https://goerli.infura.io/v3/9aa3d95b3bc440fa88ea12eaa4456161"];
                    break;
                case "sepolia":
                    return ["https://rpc2.sepolia.org/"];
                    break;
                case "fuji":
                    return ["https://api.avax-test.network/ext/bc/C/rpc", "https://rpc.ankr.com/avalanche_fuji", "https://ava-testnet.public.blastapi.io/ext/bc/C/rpc", "https://avalanche-fuji.drpc.org"];
                    break;
                case "avax":
                    return ["https://api.avax.network/ext/bc/C/rpc", "https://rpc.ankr.com/avalanche"];
                    break;
                }
            }
            function getExchangeUrl() {
                var valid_exchange_url = "https://api.coinbase.com/v2/exchange-rates?currency=" + main_currency_symbol;
                return valid_exchange_url;
            }
            function setByChainType(if_live, if_testnet) {
                return (window.location.host === "app.bitnote.xyz" || window.location.host === "deploy.bitnote.xyz") ? if_live : if_testnet;
            }
            function initApp() {
                let vh, th, active_account, app_obj, watcher_h, apple_mode, shortcut_h, biometrics_h, selected_length, very_temp_cred;
                (function() {
                    app_obj = {
                        tax_rate: null,
                        active_view: "",
                        active_unlock_attempt: false,
                        base_username_cost: BigInt(10000000000000000),
                        max_note_length: 20000,
                        known_gas_obj: {
                            sec_key_addr_link: BigInt(130000),
                            sec_key_register: BigInt(180000)
                        },
                    };
                    very_temp_cred = null;
                    watcher_h = new watcher_handler();
                    apple_mode = checkIfApple();
                    shortcut_h = new shortcut_handler({
                        apple_mode: apple_mode
                    });
                    biometrics_h = new biometrics_handler();
                    active_account = setNullAccount();
                    eh = new encryption_handler();
                    vh = new view_handler();
                    var custom_html_func = customTransactionHtml;
                    var custom_css = customTransactionCss();
                    th = new transaction_handler({
                        loading_screen_handler: ls_h,
                        xhr: xhr_h_chain,
                        alert_handler: alerts_h,
                        tb_h: tb_h,
                        custom_html_func: custom_html_func,
                        custom_css: custom_css,
                        nef_h: notEnoughFundsHandler,
                        exchange_url: getExchangeUrl(),
                    });
                    setContractContainer(setByChainType(0, 1));
                    var main_logo = document.getElementById("topbar_logo_icon");
                    main_logo.innerHTML = getNewLogo();
                    main_logo.addEventListener("click", backToHomepage);
                    initView();
                    window.addEventListener('popstate', popstateHandler, true);
                    window.addEventListener('keyup', globalKeyUpEvent);
                    document.addEventListener('selectionchange', selectionCheck, true);
                    function selectionCheck(e) {
                        selected_length = window.getSelection().toString().length;
                    }
                }
                )();
                function setNullAccount() {
                    return {
                        address: null,
                        username: null,
                        ecdh_enc_pk: null,
                        ecdh_public: null,
                        encrypted_key: null,
                        active_note: null,
                        ref: null,
                        coin_total: null,
                        note_obj: {
                            last_update: null,
                            note_array: []
                        }
                    };
                }
                this.externalDetermineUserNotes = externalDetermineUserNotes;
                function externalDetermineUserNotes(e) {
                    vh.determineUserNote(e);
                }
                function notEnoughFundsHandler(params) {
                    history.pushState({}, '', window.location.pathname + "?fund_account");
                    var new_container = document.createElement("div");
                    new_container.id = "nef_container";
                    document.body.prepend(new_container);
                    var temp_params = {
                        address: active_account.address,
                        coin_in_usd: params.eth_price,
                        container: new_container,
                        username: active_account.username,
                        misc_note_cost: params.required_funds
                    };
                    temp_params.bitnote_balance = hexToBigInt(params.user_eth);
                    vh.setView("fund_existing_account", temp_params);
                }
                function coinToUsd(coin, currency_rate) {
                    var tc = weiToEth(coin);
                    tc = tc * currency_rate;
                    return tc.toFixed(2);
                }
                function popstateHandler(e) {
                    e.preventDefault();
                    var temp_qs = get_query_strings(true);
                    if (app_obj.active_view == "landing")
                        history.back();
                    else if (app_obj.active_view == "fund_existing_account") {
                        vh.resolveFundMiscNotes();
                        backToNotesHome();
                    } else if (/^.+\/{1}$/.test(window.location.pathname) && app_obj.active_view != "notes_home")
                        backToNotesHome();
                    else if (/^\/$/.test(window.location.pathname) && app_obj.active_view != "landing") {
                        backToLanding();
                    } else
                        history.back();
                }
                function initView() {
                    let params;
                    let user_input = checkForUserUrl();
                    if (checkForPassedNote(get_query_strings(true)) == false)
                        history.replaceState({}, '', window.location.pathname);
                    document.getElementById("tb_exit_x").innerHTML = hb.getSvg("x", {
                        class_string: "standard_back_arrow"
                    });
                    if (/ref\=/.test(window.location.search))
                        saveRef();
                    else {
                        var local_ref = localStorage.getItem("ref");
                        if (local_ref != "")
                            active_account.ref = local_ref;
                    }
                    if (/\?sign_up/.test(window.location.search)) {
                        vh.setView("new_sign_up", {
                            init_name: ""
                        });
                        return;
                    } else if (/\?(su|st|sm)\=/.test(window.location.search) === false) {
                        if (!isValidNoteId(window.location.search))
                            history.replaceState({}, '', window.location.pathname);
                    }
                    if (user_input != null) {
                        checkForAccount(user_input, function(ret_param) {
                            if (ret_param != null) {
                                params = ret_param;
                                params.user_input = user_input;
                            } else
                                params = {
                                    user_input: user_input
                                };
                            vh.setView("landing", params);
                            document.getElementsByClassName("signin_mp_c_input")[0].focus();
                        });
                    } else
                        vh.setView("landing", {});
                }
                function saveRef() {
                    var ref = window.location.search.match(/ref=0x.{40}/)[0];
                    if (ref != null) {
                        ref = ref.replace("ref=", "");
                        localStorage.setItem("ref", ref);
                        active_account.ref = ref;
                    }
                }
                function isValidNoteId(query_string) {
                    if (/^\?0x[a-f0-9]{12}/.test(query_string))
                        return true;
                }
                function checkForPassedContract(query_strings) {
                    for (var i = 0; i < query_strings.length; i++) {
                        var next_string = query_strings[i];
                        if (/^cn_/.test(next_string)) {
                            next_string = next_string.replace("cn_", "");
                            return (validAddress(next_string)) ? next_string : null;
                        }
                    }
                    return null;
                }
                function checkForPassedNote(query_strings) {
                    for (var i = 0; i < query_strings.length; i++) {
                        var next_string = query_strings[i];
                        if (/^n_/.test(next_string)) {
                            next_string = next_string.replace("n_", "");
                            next_string = parseInt(next_string);
                            return (isNaN(next_string)) ? null : next_string;
                        } else if (/^0x[0-9a-f]{12}/.test(next_string)) {
                            return next_string;
                        }
                    }
                    return null;
                }
                function getTaxRate(cb=null) {
                    var default_tax_rate = BigInt(10);
                    app_obj.tax_rate = default_tax_rate;
                    var cpe = new contract_param_encoder();
                    var fcn_call = "tax_rate()";
                    var func_str = genFunctionHash(fcn_call);
                    miscFunctionCall(func_str, current_mod_contract, active_contract.rpc_list, function(res) {
                        if (checkForProperty(res)) {
                            var tc = hexToBigInt(res);
                            app_obj.tax_rate = tc;
                            if (cb != null)
                                cb(tc);
                        }
                    });
                }
                function checkForUserUrl() {
                    var user_input = window.location.pathname.replace(/(^\/|\/$)/g, "");
                    user_input = decodeURI(user_input);
                    return (user_input != "") ? user_input : null;
                }
                function setTopbar(show_topbar=true) {
                    if (show_topbar)
                        document.getElementById("topbar_logo_container").style.display = "flex";
                    else
                        document.getElementById("topbar_logo_container").style.display = "none";
                }
                function setContractContainer(contract_num) {
                    var tc = document.getElementById("contract_button");
                    tc.innerHTML = "<span></span>" + hb.getSvg("back_arrow", {
                        class_string: "standard_back_arrow rotate_270"
                    });
                    var contract_array = getContractArray();
                    setContract(contract_array[contract_num]);
                    fillContractDropdown(contract_array);
                    tc.addEventListener("click", showContractDropdownClick);
                    document.getElementById("contract_dropdown_modal").addEventListener("click", stopProp);
                    function fillContractDropdown(contract_array) {
                        var cm = document.getElementById("contract_dropdown_modal");
                        for (var i = 0; i < contract_array.length; i++) {
                            var new_contract = document.createElement("p");
                            new_contract.dataset.contract_id = i;
                            new_contract.innerHTML = contract_array[i].display_name;
                            new_contract.title = contract_array[i].address;
                            cm.appendChild(new_contract);
                            new_contract.addEventListener("click", selectNewContract);
                        }
                    }
                    function selectNewContract() {
                        var tc = parseInt(this.dataset.contract_id);
                        if (JSON.stringify(active_contract) != JSON.stringify(contract_array[tc])) {
                            setContract(contract_array[tc]);
                            active_account.note_obj.note_array = [];
                            backToNotesHome();
                        } else
                            showContractDropdown(false);
                    }
                }
                function showContractDropdownClick(e) {
                    if (e.currentTarget.id == "contract_button") {
                        if (e.currentTarget.dataset.showing == "true")
                            showContractDropdown(false);
                        else
                            showContractDropdown(true);
                    }
                }
                function showContractDropdown(open_menu=true) {
                    var contract_button = document.getElementById("contract_button");
                    if (open_menu) {
                        document.getElementById("contract_dropdown_container").style.display = "block";
                        contract_button.dataset.showing = true;
                        contract_button.lastElementChild.style.transform = "rotate(90deg)";
                    } else {
                        document.getElementById("contract_dropdown_container").style.display = "none";
                        contract_button.dataset.showing = false;
                        contract_button.lastElementChild.style.transform = "rotate(270deg)";
                    }
                }
                function setContractFromAddress() {
                    var passed_contract = checkForPassedContract(get_query_strings(true));
                    if (passed_contract != null) {
                        var contract_array = getContractArray();
                        for (var i = 0; i < contract_array.length; i++) {
                            if (contract_address == contract_array[i].address)
                                setContract(contract_array[i]);
                        }
                    }
                }
                function setContract(new_contract) {
                    active_contract = new_contract;
                    getTaxRate();
                    var tc = document.getElementById("contract_button").firstElementChild;
                    tc.innerHTML = active_contract.display_name;
                    tc.title = active_contract.address;
                    th.setContract(active_contract);
                    showContractDropdown(false);
                }
                this.backToHomepage = backToHomepage;
                function backToHomepage() {
                    vh.reset_full();
                    window.location.href = "https://bitnote.xyz";
                }
                this.backToLanding = backToLanding;
                function backToLanding(save_active_params=true) {
                    active_account.coin_total = null;
                    if (save_active_params == true) {
                        var params = getActiveUserParams();
                        if (params.username)
                            params.user_input = params.username;
                        else
                            params.user_input = params.address;
                    } else {
                        params = {};
                        clearUrlPath();
                    }
                    vh.clearLastUpdated();
                    vh.reset_full();
                    vh.setView("landing", params);
                    xhr_h_chain.refreshStats();
                }
                function backToNotesHome() {
                    var params = getActiveUserParams();
                    setNewQueryParam("note", null);
                    setNewQueryParam("note_id", null);
                    vh.reset_basic();
                    vh.setView("notes_home", params);
                }
                function getActiveUserParams() {
                    return {
                        user_encrypted_key: active_account.encrypted_key,
                        address: active_account.address,
                        username: active_account.username,
                        active_user_note: active_account.active_note
                    };
                }
                function view_handler() {
                    let active_listeners = [];
                    let decrypted_note_array;
                    let main_container;
                    let unlock_all_active;
                    let allow_note_publishing;
                    let note_ta_handler;
                    let title_ta_handler;
                    let notes_tt_h;
                    (function() {
                        reset_full();
                        main_container = document.getElementById("main_content_container_inner");
                    }
                    )();
                    function hideMenu(hide_menu=true) {
                        document.getElementById("hamburger_svg").style.display = (hide_menu) ? "none" : null;
                    }
                    function setMenu() {
                        document.getElementById("hamburger_svg").addEventListener("click", showMenu);
                        document.getElementById("menu_modal").addEventListener("click", stopProp);
                        document.getElementById("menu_container").addEventListener("click", function() {
                            showMenu(false)
                        });
                    }
                    function showMenu(open_menu=true) {
                        document.getElementById("menu_container").style.display = (open_menu) ? "block" : "none";
                        if (!open_menu)
                            showContractDropdown(false);
                    }
                    function replaceActiveNote(cb) {
                        if (active_account.active_note == null || active_account.note_obj.note_array.length == 0)
                            cb(null);
                        else {
                            let temp_active_note = {
                                active_note: active_account.active_note,
                                note_obj: {},
                                id: active_account.note_obj.note_array[active_account.active_note].id
                            };
                            Object.assign(temp_active_note.note_obj, active_account.note_obj);
                            refreshNotes(function() {
                                var new_pos = findNoteId(temp_active_note.id);
                                if (new_pos != null) {
                                    setActiveNote(new_pos);
                                } else {
                                    setActiveNote(temp_active_note.active_note);
                                    active_account.note_obj = temp_active_note.note_obj;
                                }
                                cb(new_pos);
                            });
                        }
                    }
                    this.reset_basic = reset_basic;
                    function reset_basic() {
                        shortcut_h.clearAll();
                        removeActiveListeners();
                        active_listeners = [];
                        note_ta_handler = null;
                        title_ta_handler = null;
                        notes_tt_h = null;
                        unlock_all_active = false;
                        allow_note_publishing = true;
                        clearActiveNote();
                        watcher_h.evalWatchers();
                    }
                    this.reset_full = reset_full;
                    function reset_full() {
                        reset_basic();
                        active_account = setNullAccount();
                    }
                    this.setView = setView;
                    function setView(type, params, cb=null) {
                        app_obj.active_view = type;
                        switch (type) {
                        case "landing":
                            ww_h.sendMessageToWorker({
                                msg_type: "remove_keys"
                            });
                            setTopbar(true);
                            hideMenu(false);
                            no_leave_flag = false;
                            removeExitButton();
                            setLanding(params);
                            break;
                        case "notes_home":
                            hideMenu(false);
                            removeExitButton();
                            no_leave_flag = false;
                            setNotesHome(params);
                            scroll(0, 0);
                            newUnlockManyNotesFromView(function() {
                                setLoadingScreen(false);
                                lockAllNotes();
                            });
                            break;
                        case "import_notes":
                            menuImportNotes();
                            break;
                        case "new_sign_up":
                            no_leave_flag = true;
                            setTopbar(true);
                            initCreateUsername(params.init_name);
                            break;
                        case "security_type":
                            selectSecurityType(params);
                            break;
                        case "create_mp":
                            initCreateMP(params);
                            break;
                        case "fund_account":
                            initFundAccount(params, main_container, initAccount);
                            break;
                        case "fund_existing_account":
                            setFundMiscExitButton();
                            initFundAccount(params, params.container, resolveFundMiscNotes);
                            document.getElementById("fund_ac_step_label").remove();
                            document.getElementById("fund_ac_sub_title").innerText = "Insufficient funds. Please refill your account to proceed.";
                            break;
                        case "wallet_functions":
                            setWalletFunctions();
                            break;
                        }
                    }
                    function initAccount(params) {
                        let current_username = params.username;
                        var username_hash = kh.keccak256(params.username);
                        var valid_address = params.address;
                        var encrypted_data = params.enc_pk;
                        var decoded_params = [];
                        var username_cost = getUsernameCost(params.username);
                        var ref = (checkForProperty(active_account.ref)) ? active_account.ref : "0x0000000000000000000000000000000000000000";
                        var fcn_params = [encrypted_data, username_hash, params.username, params.ecdh_priv, params.ecdh_pub, ref];
                        var fcn_call = "initAccount(bytes,bytes32,string,bytes,bytes,address)";
                        var trans_obj = {
                            fcn_call: fcn_call,
                            fcn_params: fcn_params,
                            user_address: valid_address,
                            contract_address: current_mod_contract,
                            custom_title: "Initialize Account",
                            constant_value: username_cost
                        };
                        if (checkForProperty(params.sec_key_obj)) {
                            trans_obj = [trans_obj];
                            var bonus_trans = prep_SecKeyInit(current_username, valid_address, params.sec_key_obj);
                            trans_obj.push(bonus_trans[0], bonus_trans[1]);
                        }
                        th.newTransactionPreview(trans_obj, handleAcCreation);
                        function handleAcCreation(tx_address) {
                            if (tx_address != null) {
                                no_leave_flag = false;
                                active_account.username = current_username;
                                var params = {
                                    success_title: "<h5>Success!</h5>",
                                    success_msg: "<p>Your BitNote account has been created</p>",
                                    hide_skip: true,
                                };
                                if (Array.isArray(tx_address)) {
                                    multiHandleResults(tx_address, params);
                                    biometrics_h.clearTempCred();
                                } else
                                    handleResults(tx_address, params);
                            }
                        }
                    }
                    function setFundMiscExitButton() {
                        hideMenu(true);
                        document.getElementById("tb_exit").style.display = "unset";
                        setListener({
                            ele: document.getElementById("tb_exit"),
                            func: resolveFundMiscNotes
                        });
                    }
                    this.resolveFundMiscNotes = resolveFundMiscNotes;
                    function resolveFundMiscNotes() {
                        no_leave_flag = false;
                        removeListener({
                            ele: document.getElementById("tb_exit"),
                            func: resolveFundMiscNotes
                        });
                        document.getElementById("tb_exit").style.display = "none";
                        hideMenu(false);
                        document.getElementById("nef_container").remove();
                    }
                    function initFundAccount(params, element, cb) {
                        let selected_type = "";
                        params.currency_balance = (checkForProperty(params.bitnote_balance)) ? "$" + coinToUsd(params.bitnote_balance, th.getActiveCurrencyRate()) : "$0.00";
                        params.wei_balance = (checkForProperty(params.bitnote_balance)) ? params.bitnote_balance : BigInt(0);
                        element.innerHTML = hb.fundAccount(params);
                        let osh = new order_summary_handler(params.coin_in_usd);
                        if (checkForProperty(params.username_cost)) {
                            var wei_value = params.username_cost;
                            osh.add_username(wei_value);
                        }
                        if (checkForProperty(params.misc_note_cost)) {
                            var wei_value = params.misc_note_cost;
                            osh.add_misc_note_cost(wei_value);
                        }
                        osh.add_add_money_html();
                        osh.add_add_money_listeners();
                        document.getElementsByClassName("add_money_option_cont")[0].dispatchEvent(new Event('click'));
                        if (checkForProperty(params.username_cost))
                            new tooltip_handler(document.getElementById("what_is_this"),'The fee to create your BitNote account. A portion goes to pay the blockchain to register your account, and the rest goes to fund BitNote development.');
                        setListener({
                            ele: document.getElementById("select_payment_method"),
                            func: selectPaymentMethod
                        });
                        var payment_types = [document.getElementsByClassName("fund_ac_payment_tc")[0]];
                        for (var i = 0; i < payment_types.length; i++) {
                            setListener({
                                ele: payment_types[i],
                                func: selectPaymentType
                            });
                        }
                        function selectPaymentType(e) {
                            selected_type = e.currentTarget.dataset.type;
                            setSelected(e.currentTarget);
                        }
                        function setSelected(target_ele) {
                            for (var i = 0; i < payment_types.length; i++) {
                                payment_types[i].style.opacity = "0.7";
                                payment_types[i].lastElementChild.lastElementChild.style.display = "none";
                            }
                            target_ele.style.opacity = "1";
                            target_ele.lastElementChild.lastElementChild.style.display = "unset";
                        }
                        function selectPaymentMethod() {
                            if (selected_type == "")
                                inputFlash(document.getElementById("primay_fund_ac_container"));
                            else {
                                removeListener({
                                    ele: document.getElementById("select_payment_method"),
                                    func: selectPaymentMethod
                                });
                                document.getElementById("your_bno_outer_container").style.display = "flex";
                                document.getElementById("primay_fund_ac_container").style.display = "none";
                                setListener({
                                    ele: document.getElementById("continue_payment_button"),
                                    func: continueToPayment
                                });
                            }
                            function continueToPayment() {
                                switch (selected_type) {
                                case "crypto":
                                    var display_total_req = osh.getSummaryTotal();
                                    params.display_total_req = display_total_req;
                                    document.getElementById("your_bno_outer_container").style.display = "none";
                                    document.getElementById("primay_fund_ac_container").style.display = "flex";
                                    var actual_total_req = osh.getSummaryTotal();
                                    payWithCrypto(params, actual_total_req);
                                    osh.removeContainer();
                                    break;
                                }
                            }
                        }
                        function payWithCrypto(params, actual_total_req) {
                            scroll(0, 0);
                            params.actual_total_req = actual_total_req;
                            document.getElementById("primay_fund_ac_container").innerHTML = hb.fundWithCrypto(params.address, trimEth(weiToEth(params.display_total_req), 6), active_contract.chain_name, active_contract.coin_dn, "0");
                            setListener({
                                ele: document.getElementById("fund_ac_copy_address"),
                                func: copyAddressToCB
                            });
                            startCoinWatcher(params);
                            setListener({
                                ele: document.getElementById("pay_with_crypto_3d"),
                                func: obWalletFunctions
                            });
                            function copyAddressToCB() {
                                copy_to_clipboard(params.address);
                                let cc = this;
                                let tc = cc.innerText;
                                cc.innerText = "Copied!";
                                window.setTimeout(function() {
                                    cc.innerText = tc;
                                }, 1000);
                            }
                            function obWalletFunctions() {
                                vh.setView("wallet_functions", {});
                            }
                        }
                        function startCoinWatcher(params) {
                            var total_coin_req = params.actual_total_req;
                            let payment_button = document.getElementById("continue_payment_button");
                            payment_button.innerHTML = "Waiting for funds... " + "<span id=waiting_for_funds_icon></span>";
                            payment_button.style.backgroundColor = "#181819";
                            payment_button.style.color = "#5d5d5e";
                            setImageMask(document.getElementById("waiting_for_funds_icon"), loading_icon_b64);
                            var watcher_obj = {
                                type: "fund_ac_coin_check",
                                timeout_ms: secsToMs(31536000),
                                interval_ms: secsToMs(6),
                                func: callFunc,
                                cb: handleWatcherResponse,
                            };
                            watcher_h.setWatcher(watcher_obj);
                            function updateCoinTotals(value) {
                                var fund_ac_cc_box = document.getElementById("fund_ac_cc_box");
                                if (fund_ac_cc_box != null) {
                                    fund_ac_cc_box.firstElementChild.innerText = "$" + coinToUsd(value, th.getActiveCurrencyRate());
                                    fund_ac_cc_box.lastElementChild.innerText = trimEth(weiToEth(value), 6) + " " + active_contract.coin_dn;
                                    var remaining_req = params.display_total_req - value;
                                    if (remaining_req > BigInt(0))
                                        document.getElementById("fund_ac_remaining_coin_req").innerText = removeTrailingZeros(trimEth(weiToEth(remaining_req), 4, true)) + " " + active_contract.coin_dn + " ($" + coinToUsd(remaining_req, th.getActiveCurrencyRate()) + ") ";
                                    else
                                        document.getElementById("fund_ac_remaining_coin_req").innerText = "0 " + active_contract.coin_dn + " ($0.00) ";
                                    return true;
                                } else
                                    return false;
                            }
                            function callFunc(resolve_watcher) {
                                getTotalCoin(active_account.address, function(ret_params) {
                                    if (ret_params != null) {
                                        var ret_value = hexToBigInt(ret_params.result);
                                        if (updateCoinTotals(ret_value) == false) {
                                            resolve_watcher(true);
                                            return;
                                        }
                                        if (ret_value >= total_coin_req)
                                            resolve_watcher(true, {
                                                value: ret_value
                                            });
                                        else
                                            resolve_watcher(false);
                                    } else
                                        resolve_watcher(false);
                                });
                            }
                            function handleWatcherResponse(ret_obj) {
                                if (ret_obj != null) {
                                    payment_button.innerText = "Complete checkout";
                                    payment_button.style.backgroundColor = "#eef3fa";
                                    payment_button.style.color = "#000";
                                    setListener({
                                        ele: payment_button,
                                        func: completeCheckoutClick
                                    });
                                    removeExitButton();
                                }
                            }
                            function completeCheckoutClick() {
                                cb(params);
                            }
                        }
                        function order_summary_handler() {
                            let summary = {};
                            var your_bno_summary_container = document.getElementById("your_bno_summary_container");
                            let add_money_cont;
                            let custom_preset_active = false;
                            let custom_preset = null;
                            let order_summary_total = BigInt(0);
                            this.add_username = add_username;
                            function add_username(wei_value) {
                                var base_registration_fee = app_obj.base_username_cost * BigInt(4);
                                wei_value = (wei_value === 0) ? BigInt(0) : wei_value;
                                wei_value += base_registration_fee;
                                var dollar_value = coinToUsd(wei_value, th.getActiveCurrencyRate());
                                var eth_value = trimEth(weiToEth(wei_value), 6);
                                your_bno_summary_container.innerHTML += hb.addUsernameFee(eth_value, dollar_value);
                                summary.username = wei_value;
                                updateYouPay();
                            }
                            this.add_misc_note_cost = add_misc_note_cost;
                            function add_misc_note_cost(wei_value) {
                                wei_value = (wei_value === 0) ? BigInt(0) : wei_value;
                                var dollar_value = coinToUsd(wei_value, th.getActiveCurrencyRate());
                                var eth_value = trimEth(weiToEth(wei_value), 6);
                                your_bno_summary_container.innerHTML += hb.addMiscNoteCost(eth_value, dollar_value);
                                summary.misc_cost = wei_value;
                                updateYouPay();
                            }
                            this.removeContainer = removeContainer;
                            function removeContainer() {
                                document.getElementById("your_bno_container").remove();
                            }
                            this.add_add_money_html = add_add_money_html;
                            function add_add_money_html() {
                                your_bno_summary_container.innerHTML += hb.addAddMoney();
                            }
                            this.add_add_money_listeners = add_add_money_listeners;
                            function add_add_money_listeners() {
                                add_money_cont = document.getElementById("add_money_options_container");
                                for (var i = 0; i < add_money_cont.children.length - 1; i++)
                                    setListener({
                                        ele: add_money_cont.children[i],
                                        func: addPresetClick
                                    });
                                setListener({
                                    ele: add_money_cont.lastElementChild.firstElementChild,
                                    func: addPresetClick
                                });
                                addMoney(0);
                            }
                            function addPresetClick(e) {
                                if (checkForProperty(e.target.dataset.preset)) {
                                    removePresetFocus();
                                    custom_preset_active = false;
                                    addMoney(e.target.dataset.preset);
                                } else {
                                    if (custom_preset_active == false) {
                                        removePresetFocus();
                                        custom_preset_active = true;
                                        addMoney(0);
                                        setListener({
                                            ele: add_money_cont.lastElementChild.firstElementChild,
                                            func: handleCustomPreset,
                                            action: "beforeinput"
                                        });
                                    }
                                }
                                if (e.target.classList.contains("add_money_option_cont"))
                                    e.target.style.opacity = "1";
                                else
                                    e.target.parentNode.style.opacity = "1";
                            }
                            function handleCustomPreset(e) {
                                let main_target = e.target;
                                if (customPreset(e)) {
                                    window.setTimeout(function() {
                                        if (main_target.value != "") {
                                            var new_preset = main_target.value;
                                            custom_preset = parseInt(new_preset);
                                            addMoney(custom_preset);
                                        } else
                                            addMoney(0);
                                    }, 1);
                                } else
                                    e.preventDefault();
                            }
                            function customPreset(e) {
                                if (/[0-9]/.test(e.data))
                                    return true;
                                else if ((e.data) == null && /delete/.test(e.inputType)) {
                                    if (e.target.value != "")
                                        return true;
                                }
                                return false;
                            }
                            function removePresetFocus() {
                                for (var i = 0; i < add_money_cont.children.length; i++)
                                    add_money_cont.children[i].style.opacity = "0.6";
                                if (custom_preset != null) {
                                    removeListener({
                                        ele: add_money_cont.lastElementChild.firstElementChild,
                                        func: customPreset,
                                        action: "beforeinput"
                                    });
                                    add_money_cont.lastElementChild.firstElementChild.value = "";
                                }
                                summary.add_money = BigInt(0);
                            }
                            function addMoney(amount) {
                                var tc = document.getElementById("add_money_fee_cost");
                                tc.firstElementChild.innerText = "$" + amount + " (~" + Math.floor(amount * 10) + " notes)";
                                var current_rate = th.getActiveCurrencyRate();
                                if (current_rate != null) {
                                    amount = amount / current_rate;
                                    var wei_amount = ethToWei(amount);
                                    tc.lastElementChild.innerText = amount.toFixed(6) + " " + main_currency_symbol;
                                    summary.add_money = wei_amount;
                                    updateYouPay();
                                }
                            }
                            this.remove_add_money = remove_add_money;
                            function remove_add_money() {
                                addMoney(0);
                                document.getElementById("add_money_fee_container").remove();
                                for (var i = 0; i < add_money_cont.children.length - 1; i++)
                                    removeListener({
                                        ele: add_money_cont.children[i],
                                        func: addPresetClick
                                    });
                                removeListener({
                                    ele: add_money_cont.lastElementChild.firstElementChild,
                                    func: addPresetClick
                                });
                                add_money_cont.remove();
                            }
                            function updateYouPay() {
                                var new_coin_total = BigInt(0);
                                var keys = Object.keys(summary);
                                for (var i = 0; i < keys.length; i++)
                                    new_coin_total += (summary[keys[i]] === 0) ? BigInt(0) : summary[keys[i]];
                                var tc = document.getElementById("you_pay_fee_cost");
                                tc.firstElementChild.innerText = "$" + coinToUsd(new_coin_total, th.getActiveCurrencyRate());
                                tc.lastElementChild.innerText = trimEth(weiToEth(new_coin_total), 6) + " " + main_currency_symbol;
                                order_summary_total = new_coin_total;
                            }
                            this.getSummaryTotal = getSummaryTotal;
                            function getSummaryTotal() {
                                return order_summary_total;
                            }
                        }
                    }
                    function newSignUpClick() {
                        var init_name = document.getElementById("landing_input").value;
                        init_name = (checkForProperty(init_name)) ? init_name.trim() : "";
                        setView("new_sign_up", {
                            init_name: init_name
                        });
                    }
                    function setLanding(params) {
                        app_obj.active_unlock_attempt = false;
                        main_container.innerHTML = hb.newLanding();
                        setListener({
                            ele: document.getElementById("signin_mp_view_input"),
                            func: hideLandingPasswordToggle
                        });
                        setListener({
                            ele: document.getElementById("signin_submit_button"),
                            func: checkLandingInput
                        });
                        setListener({
                            ele: document.getElementById("sign_up_button"),
                            func: newSignUpClick
                        });
                        var landing_input = document.getElementById("landing_input");
                        landing_input.value = (checkForProperty(params.user_input) ? escapeSpecial(params.user_input) : "");
                        landing_input.focus();
                        setBiometricsLanding();
                    }
                    function hideLandingPasswordToggle(e) {
                        var signin_mp_c_input = document.getElementsByClassName("signin_mp_c_input")[0];
                        if (signin_mp_c_input.type === "password") {
                            signin_mp_c_input.type = "text";
                            e.target.style.opacity = 1;
                        } else {
                            signin_mp_c_input.type = "password";
                            e.target.style.opacity = 0.5;
                        }
                    }
                    function setBiometricsLanding() {
                        document.getElementById("use_biometrics").addEventListener("click", biometricsClickLanding);
                        function biometricsClickLanding() {
                            var prf_obj = getPrfObject();
                            biometrics_h.biometricsClick(prf_obj, function(key_mat, cred) {
                                if (key_mat == null) {
                                    useBiometricsErrorHandler("no_prf");
                                    return;
                                }
                                if (cred.misc_data.byteLength > 0) {
                                    var extra_cred_md = cred.misc_data.slice();
                                    convertBioRet(key_mat, cred, function(ret_key) {
                                        cred.misc_data = extra_cred_md;
                                        var current_input = document.getElementById("landing_input");
                                        if (checkForProperty(ret_key)) {
                                            document.getElementById("landing_input").value = (checkForProperty(cred.username)) ? cred.username : document.getElementById("landing_input").value;
                                            document.getElementsByClassName("signin_mp_c_input")[0].value = new TextDecoder().decode(ret_key);
                                            checkLandingInput(null, {
                                                cred
                                            });
                                        }
                                    });
                                } else
                                    useBiometricsErrorHandler("no_stored_pk");
                            });
                        }
                    }
                    function useBiometricsErrorHandler(error_value) {
                        var error_obj;
                        switch (error_value) {
                        case "no_prf":
                            error_obj = {
                                msg_html: "Invalid passkey, or unsupported device.",
                                full_bar_target: true,
                                self_remove_ms: 8000,
                                custom_bg_color: "#e93232",
                                custom_color: "#fff",
                                svg_icon: hb.getSvg("warning_w_border", {
                                    class_string: "std_icon"
                                }),
                                close_icon: hb.getSvg("x", {
                                    class_string: "std_close_icon"
                                })
                            };
                            break;
                        case "no_stored_pk":
                        default:
                            error_obj = {
                                msg_html: "No account detected.",
                                full_bar_target: true,
                                self_remove_ms: 8000,
                                custom_bg_color: "#500202",
                                custom_color: "#fff",
                                svg_icon: hb.getSvg("warning_w_border", {
                                    class_string: "std_icon"
                                }),
                                close_icon: hb.getSvg("x", {
                                    class_string: "std_close_icon"
                                })
                            };
                            break;
                        }
                        tb_h.newNotification(error_obj);
                    }
                    function deleteBiometrics() {
                        biometrics_h.deleteLocalBiometrics(active_account.username);
                    }
                    function clearCache() {
                        closeNotesMenu();
                        setLoadingScreen(true);
                        deleteBiometrics();
                        sendSwMessage({
                            type: "clear_cache"
                        }, function() {
                            xhr_h_chain.clearStats();
                            setLoadingScreen(false);
                            alerts_h.setAlert("confirm", {
                                submit_label: "Reload",
                                cancel_label: "Maybe later",
                                sub_heading: "A page reload is required for updated version to take effect.",
                                alert_msg: "Reload Page?",
                                simple_close: true,
                                confirm_req: 1
                            }, function(ret) {
                                if (ret)
                                    window.location.reload();
                            });
                        });
                    }
                    function setExitObButton() {
                        document.getElementById("tb_exit").style.display = "unset";
                        setListener({
                            ele: document.getElementById("tb_exit"),
                            func: exitOnboarding
                        });
                        hideMenu(true);
                        function exitOnboarding() {
                            alerts_h.setAlert("confirm", {
                                submit_label: "I Understand, Continue",
                                cancel_label: "Go Back",
                                sub_heading: "You will lose all your account data up to this point.",
                                alert_msg: "Are you sure you want to leave?",
                                simple_close: true,
                                confirm_req: 1
                            }, function(ret) {
                                if (ret)
                                    backToLanding(false);
                            });
                        }
                    }
                    function removeExitButton() {
                        document.getElementById("tb_exit").style.display = "none";
                    }
                    function initCreateUsername(init_name="") {
                        history.replaceState({}, '', "/?sign_up");
                        setExitObButton();
                        var temp = hb.newCreateUsername();
                        main_container.innerHTML = temp;
                        document.getElementById("create_username_input").value = init_name;
                        setListener({
                            ele: document.getElementById("create_username_login_button"),
                            func: backToLanding
                        });
                        setListener({
                            ele: document.getElementById("create_username_main_button"),
                            func: checkUsernameSubmit
                        });
                        setListener({
                            ele: document.getElementById("create_username_input"),
                            action: 'beforeinput',
                            func: biCheckUsernameSubmit
                        });
                        var username_input = document.getElementById("create_username_input");
                        new handle_textarea_resize(username_input,{
                            disable_returns: true,
                            min_row_buffer: 1
                        });
                        requestAnimationFrame(function() {
                            username_input.focus();
                            username_input.value = '';
                            username_input.value = init_name.trim();
                        });
                    }
                    function biCheckUsernameSubmit(e, params) {
                        if (e.inputType === 'insertLineBreak') {
                            e.stopPropagation();
                            checkUsernameSubmit(e);
                        } else
                            document.getElementById("invalid_username_icon").style.display = "none";
                    }
                    function checkUsernameSubmit(e) {
                        e.preventDefault();
                        let potential_username = document.getElementById("create_username_input").value.trim();
                        if (/%/.test(potential_username)) {
                            invalidUsername();
                            alerts_h.setAlert("confirm", {
                                no_cancel_button: true,
                                submit_label: "Okay",
                                sub_heading: "Due to url encoding standards, the % character is forbidden in usernames",
                                alert_msg: "Illegal Character",
                                simple_close: true,
                                confirm_req: 1
                            }, function(ret) {
                                return;
                            });
                        } else {
                            if (potential_username != "" && potential_username.length >= 5) {
                                checkForAccount(potential_username, function(ret) {
                                    if (ret == null)
                                        validUsername();
                                    else
                                        invalidUsername();
                                });
                            } else
                                invalidUsername();
                        }
                        function invalidUsername() {
                            document.getElementById("invalid_username_icon").style.display = "unset";
                        }
                        function validUsername() {
                            setListener({
                                ele: document.getElementById("create_username_input"),
                                func: biReserveUsernameSubmit,
                                action: "beforeinput"
                            });
                            document.getElementById("invalid_username_icon").style.display = "none";
                            document.getElementById("valid_username_icon").style.display = "unset";
                            var main_button = document.getElementById("create_username_main_button");
                            main_button.style.backgroundColor = "#eef3fa";
                            main_button.style.color = "#000";
                            removeListener({
                                ele: main_button,
                                func: checkUsernameSubmit
                            });
                            removeListener({
                                ele: document.getElementById("create_username_input"),
                                action: 'beforeinput',
                                func: biCheckUsernameSubmit
                            });
                            setListener({
                                ele: main_button,
                                func: reserveUsernameSubmit
                            });
                            var eth_uc = getUsernameCost(potential_username);
                            main_button.innerHTML = "Continue";
                            var temp_cost = (eth_uc === 0) ? app_obj.base_username_cost : eth_uc;
                            var display_cost = temp_cost;
                            function reserveUsernameSubmit(e) {
                                e.preventDefault();
                                vh.setView("security_type", {
                                    username: potential_username,
                                    username_cost: eth_uc
                                });
                            }
                            function biReserveUsernameSubmit(e) {
                                if (e.inputType == "insertLineBreak" && e.data == null) {
                                    e.stopPropagation();
                                    reserveUsernameSubmit(e);
                                } else {
                                    requestAnimationFrame(function() {
                                        reset_basic();
                                        var ret_str = e.target.value.trim();
                                        initCreateUsername(ret_str);
                                    });
                                }
                            }
                        }
                    }
                    function selectSecurityType(init_params) {
                        main_container.innerHTML = hb.selectSecurity();
                        setListener({
                            ele: document.getElementById("ob_use_master_pass"),
                            func: useMasterPass,
                            action: "click"
                        });
                        setListener({
                            ele: document.getElementById("ob_use_security_key"),
                            func: secKeyMode,
                            action: "click"
                        });
                        function useMasterPass() {
                            vh.setView("create_mp", init_params);
                        }
                        function secKeyMode() {
                            setNewAccountMp(getRandomHexString(64), function() {
                                var ob_non_ls_temp_cred = {
                                    id: null
                                };
                                createPasskey(ob_non_ls_temp_cred, init_params.username, function(sec_key_obj) {
                                    if (sec_key_obj != null) {
                                        sec_key_obj.username = biometrics_h.rawToUsername(sec_key_obj.raw_id);
                                        sec_key_obj.username_hash = kh.keccak256(sec_key_obj.username);
                                        sec_key_obj.misc_data = bufferToHex(sec_key_obj.misc_data);
                                        init_params.sec_key_obj = sec_key_obj;
                                        createNewAccount(init_params);
                                    } else
                                        useBiometricsErrorHandler("no_prf");
                                });
                            });
                        }
                    }
                    function initCreateMP(init_params) {
                        let repeat_test = "";
                        let create_mp_input;
                        let sec_key_obj = null;
                        history.pushState({}, '', window.location.pathname + "?create_mp");
                        main_container.innerHTML = hb.newCreateMP();
                        create_mp_input = document.getElementById("create_mp_input");
                        create_mp_input.focus();
                        var ta_handler = new handle_textarea_resize(create_mp_input,{
                            disable_returns: true,
                            min_row_buffer: 1,
                            return_cb: textareaHandlerReturnEvent,
                            hide_text_target: document.getElementById("create_mp_eye")
                        });
                        ta_handler.defaultToggleHiddenInput(false);
                        setListener({
                            ele: document.getElementById("create_mp_generate_button"),
                            func: callGenRandom,
                            action: "click"
                        });
                        setListener({
                            ele: document.getElementById("create_mp_form"),
                            action: "submit",
                            func: checkSubmitMP
                        });
                        setListener({
                            ele: document.getElementById("create_mp_go_back"),
                            func: goBack
                        });
                        let zxc_h = new zxcvbn_handler({
                            lib_loaded: true,
                            path: "/pages/js/zxcvbn.js",
                            wordlist: WORDLISTS["english"]
                        });
                        setListener({
                            ele: create_mp_input,
                            func: testCrackStrength,
                            action: "keyup"
                        });
                        new tooltip_handler(document.getElementById("crack_cost_learn_more"),'We use the open source (and well regarded) zxcvbn to calculate password entropy, which we then adjust for the number of iterations we are using in PBKDF2 to generate the total search space an attacker would have to search to successfully brute force a password. On average, an attacker would need to guess half the total search space to crack a password, and we estimate what it would cost an attacker to do that based on past password crack competitions. We also account for compute speed increases over time, assuming that computation power doubles every eighteen months.');
                        function testCrackStrength(e) {
                            generateCrackCost(e.target.value);
                        }
                        function generateCrackCost(input_data) {
                            document.getElementById("crack_cost").innerHTML = (checkForProperty(input_data)) ? "$" + returnCrackCost(input_data) : "$0";
                        }
                        function returnCrackCost(input_data) {
                            return zxc_h.getCrackCost(input_data);
                        }
                        function goBack() {
                            document.getElementById("create_mp_go_back").style.display = "none";
                            reset_basic();
                            setExitObButton();
                            initCreateMP(init_params);
                        }
                        function textareaHandlerReturnEvent(e, params) {
                            if (e.inputType == "insertLineBreak" && e.data == null)
                                checkSubmitMP(e);
                            else
                                e.preventDefault();
                        }
                        function callGenRandom() {
                            ta_handler.defaultToggleHiddenInput(true);
                            create_mp_input.style.wordBreak = "break-word";
                            create_mp_input.value = getRandomPhrase(8);
                            ta_handler.updateReturns();
                            generateCrackCost(create_mp_input.value);
                        }
                        function checkSubmitMP(e) {
                            e.preventDefault();
                            let potential_mp = create_mp_input.value.trim();
                            if (potential_mp == "") {
                                inputFlash(create_mp_input, 500);
                                return;
                            }
                            if (repeat_test == "" && potential_mp != "") {
                                var tc = returnCrackCost(potential_mp);
                                tc = tc.replace(/,/g, "");
                                var p_cost = Number(tc);
                                if (p_cost < 1e9) {
                                    alerts_h.setAlert("confirm", {
                                        submit_label: "I Understand, Continue",
                                        cancel_label: "Go Back",
                                        sub_heading: "Consider choosing a stronger password, as weak passwords can be easily hacked. Note: you cant change your password later.",
                                        alert_msg: "Your password is weak",
                                        simple_close: true,
                                        confirm_req: 1
                                    }, function(ret) {
                                        if (ret)
                                            setInitialPass();
                                    });
                                } else
                                    setInitialPass();
                                function setInitialPass() {
                                    document.getElementById("create_mp_go_back").style.display = "flex";
                                    repeat_test = potential_mp;
                                    document.getElementById("create_mp_generate_button").style.display = "none";
                                    document.getElementById("crack_cost_container").style.display = "none";
                                    document.getElementById("create_mp_label").innerText = "Confirm Master Password";
                                    create_mp_input.value = "";
                                    create_mp_input.focus();
                                }
                            } else if (repeat_test != potential_mp) {
                                document.getElementById("create_mp_failed").style.display = "unset";
                                create_mp_input.value = "";
                            } else {
                                setNewAccountMp(potential_mp, function(ret) {
                                    if (ret != null)
                                        createNewAccount(init_params);
                                });
                            }
                        }
                    }
                    function setNewAccountMp(new_mp, cb) {
                        var text_encoder = new TextEncoder();
                        var encoded_material = text_encoder.encode(new_mp).buffer;
                        ww_h.sendMessageToWorker({
                            msg_type: "set_mp",
                            key_buff: encoded_material
                        }, [encoded_material], cb);
                    }
                    function createNewAccount(init_params) {
                        setLoadingScreen(true);
                        var msg_param = {
                            msg_type: "gen_ac"
                        };
                        ww_h.sendMessageToWorker(msg_param, [], function(ret) {
                            var pub_hex = bufferToHex(ret.pub_buff);
                            pub_hex = pub_hex.slice(2);
                            var address = kh.keccak256("0x" + pub_hex);
                            active_account.address = "0x" + address.slice(-40);
                            active_account.encrypted_key = bufferToHex(ret.salt_buff) + bufferToHex(ret.encrypted_buff);
                            init_params.enc_pk = active_account.encrypted_key;
                            init_params.address = active_account.address;
                            active_account.ecdh_public = ret.ecdh_pub_buff;
                            active_account.ecdh_enc_pk = init_params.ecdh_priv;
                            init_params.ecdh_priv = bufferToHex(ret.ecdh_salt_buff) + bufferToHex(ret.ecdh_priv_buff);
                            init_params.ecdh_pub = bufferToHex(ret.ecdh_pub_buff);
                            initFund(th.getActiveCurrencyRate());
                        });
                        function initFund(coin_in_usd) {
                            init_params.coin_in_usd = coin_in_usd;
                            setLoadingScreen(false);
                            vh.setView("fund_account", init_params);
                        }
                    }
                    function getUsernameCost(new_alias) {
                        var current_base = BigInt(1e18);
                        if (new_alias.length >= 5)
                            current_base = current_base / BigInt(100);
                        else if (new_alias.length == 4)
                            current_base = current_base / BigInt(10);
                        else if (new_alias.length == 3)
                            current_base = current_base / BigInt(1);
                        else if (new_alias.length == 2)
                            current_base = current_base * BigInt(10);
                        else if (new_alias.length == 1)
                            current_base = current_base * BigInt(100);
                        return current_base;
                    }
                    function setMigrationBox() {
                        let set_to_send = false;
                        document.getElementById("wallet_functions_send").addEventListener("click", determineCheckType);
                        function migrateClicked() {
                            var send_to_address = document.getElementById("wallet_functions_migration_addr").value.trim();
                            var valid_address = active_account.address;
                            var decoded_params = [];
                            var fcn_params = [];
                            var fcn_call = "";
                            var value = "100%";
                            if (validAddress(send_to_address)) {
                                var trans_obj = {
                                    fcn_call: fcn_call,
                                    fcn_params: fcn_params,
                                    user_address: valid_address,
                                    contract_address: send_to_address,
                                    custom_title: "Migrate Funds",
                                    constant_value: value,
                                    disable_nef: true
                                };
                                th.newTransactionPreview(trans_obj, simpleWait);
                            } else
                                inputFlash(document.getElementById("wallet_functions_migration_addr"), 500);
                        }
                        function determineCheckType(e) {
                            e.preventDefault();
                            var potential = document.getElementById("wallet_functions_migration_addr").value.trim();
                            if (validAddress(potential))
                                migrateClicked();
                            else
                                checkIfUsernameLink(potential);
                        }
                        function checkIfUsernameLink(potential_name) {
                            getAddressLink(potential_name, function(ret) {
                                if (ret != null && document.getElementById("wallet_functions_migration_addr").value.trim() == potential_name) {
                                    var temp = document.getElementById("wallet_functions_migration_addr");
                                    temp.value = ret;
                                    inputFlash(temp, 500, {
                                        bg: "#000000aa",
                                        color: "#fff"
                                    });
                                    migrateClicked();
                                } else
                                    inputFlash(document.getElementById("wallet_functions_migration_addr"), 500);
                            });
                        }
                    }
                    function simpleWait(tx_address, cb=null) {
                        if (tx_address != null) {
                            setLoadingScreen(true);
                            confirmReceipt(tx_address, 50, function(ret) {
                                walletFunctionsCheckFunds();
                                setLoadingScreen(false);
                                if (cb != null)
                                    cb(true);
                            });
                        }
                    }
                    function setViewSecretContainer() {
                        closeNotesMenu();
                        let new_container = document.createElement("div");
                        new_container.id = "share_note_container";
                        var temp = hb.viewSecretContainer({});
                        new_container.innerHTML = temp;
                        document.body.prepend(new_container);
                        document.getElementById("secret_close").addEventListener("click", closeSecretBox);
                        document.getElementById("secret_next_button").addEventListener("click", checkIfValidLink);
                        new handle_textarea_resize(document.getElementById("secret_link"),{
                            force_single_line: true,
                            disable_returns: true,
                            min_row_buffer: 1,
                            return_cb: checkIfValidLink
                        });
                        function checkIfValidLink(e) {
                            e.preventDefault();
                            var potential_link = document.getElementById("secret_link").value.trim();
                            potential_link = potential_link.replace("https://", "");
                            var re = new RegExp(/(\/.*?\/|^[^\/]*?\/|\/|)\?.*/);
                            var tc = potential_link.match(re);
                            potential_link = (tc != null) ? tc[0] : potential_link;
                            var params = {
                                shared_note: potential_link
                            };
                            setNewNote(params);
                            closeSecretBox();
                        }
                        function closeSecretBox() {
                            document.getElementById("secret_next_button").removeEventListener("click", checkIfValidLink);
                            document.getElementById("secret_close").removeEventListener("click", closeSecretBox);
                            new_container.remove();
                        }
                    }
                    function setSecretBox(params) {
                        closeUserNotesMenu();
                        var shared_msg = document.getElementById('user_note_textbox').value;
                        var shared_title = document.getElementById('user_note_titlebox').value;
                        let new_container = document.createElement("div");
                        new_container.id = "share_note_container";
                        var temp = hb.newSecretContainer({});
                        new_container.innerHTML = temp;
                        document.body.prepend(new_container);
                        document.getElementById("secret_close").addEventListener("click", closeSecretBox);
                        document.getElementById("secret_next_button").addEventListener("click", userSelected);
                        new handle_textarea_resize(document.getElementById("secret_username"),{
                            force_single_line: true,
                            disable_returns: true,
                            min_row_buffer: 1,
                            return_cb: userSelected
                        });
                        function userSelected(e) {
                            e.preventDefault();
                            var potential_username = document.getElementById("secret_username").value.trim();
                            checkForPubKey(potential_username, function(ecdh_pub) {
                                if (ecdh_pub != null) {
                                    document.getElementById("secret_next_button").removeEventListener("click", userSelected);
                                    document.getElementById("invalid_secret_username").style.display = "none";
                                    document.getElementById("secret_username_container").style.display = "none";
                                    var strong_username = "<strong>" + potential_username + "</strong>";
                                    document.getElementById("generated_sub_heading").innerHTML = `Send the link below to ${strong_username} to share this note. The link is encrypted and only ${strong_username} can access its contents.`;
                                    document.getElementById("secret_link_container").style.display = "block";
                                    var msg_array = [shared_msg];
                                    if (checkForProperty(shared_title))
                                        msg_array.push(shared_title);
                                    var su = window.location.pathname.replaceAll('/', '');
                                    var pre_aad_str = "/" + encodeURI(potential_username) + "/?su=" + su + "&";
                                    var aad = createAadFromShared(pre_aad_str);
                                    getEncryptedMessages(ecdh_pub, msg_array, aad, function(ret_array) {
                                        var output_link = window.location.host + pre_aad_str + "sm=" + hexToBase64(ret_array[0]);
                                        if (ret_array.length > 1)
                                            output_link += "&st=" + hexToBase64(ret_array[1]);
                                        document.getElementById("secret_link_text").innerText = output_link;
                                        document.getElementById("secret_copy_button").addEventListener("click", copySecretText);
                                    });
                                } else
                                    document.getElementById("invalid_secret_username").style.display = "block";
                            });
                        }
                        function getEncryptedMessages(user_ecdh_pub, msg_array, aad, callback) {
                            let end_point = msg_array.length;
                            let start_point = 0;
                            let encrypted_array = [];
                            (function encrypt_next(pointer) {
                                if (pointer < end_point) {
                                    var msg_buff = msg_array[pointer];
                                    var ecdh_pub = hexToArrayBuffer(user_ecdh_pub, Uint8Array).buffer;
                                    ecdhEncrypt({
                                        msg_buff,
                                        ecdh_pub,
                                        aad: aad.slice()
                                    }, function(enc_hex) {
                                        encrypted_array.push(enc_hex);
                                        encrypt_next(++pointer);
                                    });
                                } else
                                    callback(encrypted_array);
                            }
                            )(start_point);
                        }
                        function copySecretText() {
                            copy_to_clipboard(document.getElementById("secret_link_text").innerText);
                            let cc = this;
                            let tc = cc.innerText;
                            cc.innerText = "Copied!";
                            window.setTimeout(function() {
                                cc.innerText = tc;
                            }, 1000);
                        }
                        function closeSecretBox() {
                            document.getElementById("secret_close").removeEventListener("click", closeSecretBox);
                            new_container.remove();
                        }
                    }
                    function checkForPubKey(username, cb) {
                        getAddressLink(username, function(address) {
                            if (address != null)
                                checkForEcdhPub(address, cb);
                            else
                                cb(null);
                        });
                    }
                    function getDecryptedMessages(user_ecdh_pub, msg_array, aad, callback) {
                        let end_point = msg_array.length;
                        let start_point = 0;
                        let decrypted_array = [];
                        (function decryptNext(pointer) {
                            if (pointer < end_point) {
                                var msg_buff = hexToArrayBuffer(msg_array[pointer], Uint8Array).buffer;
                                var ecdh_pub = hexToArrayBuffer(user_ecdh_pub, Uint8Array).buffer;
                                ecdhDecrypt({
                                    msg_buff,
                                    ecdh_pub,
                                    aad: aad.slice()
                                }, function(decrypted_text) {
                                    if (decrypted_text != null) {
                                        decrypted_array.push(decrypted_text);
                                        decryptNext(++pointer);
                                    }
                                });
                            } else
                                callback(decrypted_array);
                        }
                        )(start_point);
                    }
                    function decryptSecret(shared_note, aad, cb) {
                        var url_pairs = parseUrlSecret(shared_note);
                        var secret_msg = (checkForProperty(url_pairs.sm)) ? url_pairs.sm : url_pairs;
                        var secret_title = (checkForProperty(url_pairs.st)) ? url_pairs.st : "";
                        var potential_user = (checkForProperty(url_pairs.su)) ? decodeURI(url_pairs.su) : null;
                        if (potential_user != null) {
                            checkForPubKey(potential_user, function(ecdh_pub) {
                                if (ecdh_pub != null) {
                                    secret_msg = base64ToHex(secret_msg);
                                    var msg_array = [secret_msg];
                                    if (secret_title != "") {
                                        secret_title = base64ToHex(secret_title);
                                        msg_array.push(secret_title);
                                    }
                                    if (secret_msg != null && secret_title != null)
                                        getDecryptedMessages(ecdh_pub, msg_array, aad, cb);
                                    else
                                        cb(null);
                                } else
                                    cb(null);
                            });
                        } else
                            cb(null);
                        function parseUrlSecret(data_str) {
                            var ret_secret;
                            var params = data_str.split("?");
                            params = (params.length > 1) ? params[1] : params[0];
                            params = params.split("&");
                            if (params.length > 1) {
                                var ret_pairs = parsePairs(params);
                                ret_secret = ret_pairs;
                            } else
                                ret_secret = params[0];
                            return ret_secret;
                            function parsePairs(possible_params) {
                                var ret_pairs = {};
                                for (var i = 0; i < possible_params.length; i++) {
                                    var temp_pair = possible_params[i].split("=");
                                    if (temp_pair.length > 1)
                                        ret_pairs[temp_pair[0]] = temp_pair[1];
                                }
                                return ret_pairs;
                            }
                        }
                    }
                    function prepTempCred() {
                        return (very_temp_cred != null) ? very_temp_cred : {
                            raw_id: null,
                            misc_data: null
                        };
                    }
                    function setSecKeyFunctions() {
                        let temp_cred = prepTempCred();
                        closeNotesMenu();
                        var temp = hb.registerSecurityKey({});
                        var cont = document.createElement("div");
                        cont.className = "standard_full_modal_container";
                        cont.id = "sec_key_functions_modal";
                        cont.innerHTML = temp;
                        document.body.prepend(cont);
                        setListener({
                            ele: document.getElementById("sec_key_functions_close"),
                            func: closeSecKeyFunctions
                        });
                        setListener({
                            ele: document.getElementById("sec_key_register"),
                            func: initNewSecKey
                        });
                        setListener({
                            ele: document.getElementById("sec_key_store"),
                            func: storeKeyClick
                        });
                        if (checkForAvailableKey(temp_cred))
                            setSecKeyWarning(temp_cred);
                        new tooltip_handler(document.getElementById("how_do_i_delete_sk"),"Remove security keys using your security key authentication manager (e.g. Yubico Authenticator)");
                        function initNewSecKey() {
                            createPasskey(temp_cred, active_account.username, function(sec_key_obj) {
                                if (sec_key_obj != null) {
                                    sec_key_obj.stored = false;
                                    sec_key_obj.not_on_chain = true;
                                    storeLocalSecKey(sec_key_obj);
                                    sec_key_obj.username = biometrics_h.rawToUsername(sec_key_obj.raw_id);
                                    sec_key_obj.username_hash = kh.keccak256(sec_key_obj.username);
                                    temp_cred.misc_data = sec_key_obj.misc_data.slice();
                                    Object.assign(temp_cred, sec_key_obj);
                                    checkForAvailableKey(temp_cred);
                                } else
                                    useBiometricsErrorHandler("no_prf");
                            });
                        }
                        function storeKeyClick() {
                            if (checkForAvailableKey(temp_cred))
                                prepStoreSecKey(temp_cred);
                        }
                        function closeSecKeyFunctions() {
                            removeListener({
                                ele: document.getElementById("sec_key_functions_close"),
                                func: closeSecKeyFunctions
                            });
                            removeListener({
                                ele: document.getElementById("sec_key_register"),
                                func: initNewSecKey
                            });
                            removeListener({
                                ele: document.getElementById("sec_key_store"),
                                func: storeKeyClick
                            });
                            document.getElementById("sec_key_functions_modal").remove();
                        }
                        function prepStoreSecKey(temp_cred) {
                            var hex_sk = bufferToHex(temp_cred.misc_data);
                            storeSecKey(temp_cred.raw_id, hex_sk, closeSecKeyFunctions);
                        }
                        function storeLocalSecKey(sec_key_obj) {
                            biometrics_h.storeUserCredential(sec_key_obj, function(response) {
                                var qq = 22;
                            });
                        }
                        function checkForAvailableKey(temp_cred) {
                            if (temp_cred.raw_id != null && temp_cred.misc_data != null && temp_cred.not_on_chain) {
                                document.getElementById("sec_key_store").style.opacity = 1;
                                document.getElementById("sk_icon_shifter").innerHTML = hb.getSvg("checkmark", {
                                    class_string: "standard_checkmark"
                                });
                                document.getElementById("sk_icon_shifter").firstElementChild.style.display = "block";
                                document.getElementById("chain_icon_shifter").innerHTML = hb.getSvg("back_arrow", {
                                    class_string: "standard_icon flip_180 dim_ele"
                                });
                                return true;
                            } else if (temp_cred.stored) {
                                return false;
                            } else {
                                document.getElementById("sec_key_store").style.opacity = "0.35";
                                document.getElementById("chain_icon_shifter").innerHTML = hb.getSvg("back_arrow", {
                                    class_string: "standard_icon flip_180 dim_ele"
                                });
                                document.getElementById("chain_icon_shifter").firstElementChild.style.display = "block";
                                return false;
                            }
                        }
                        function setSecKeyWarning(temp_cred) {
                            var new_notification = tb_h.newNotification({
                                msg_html: "Warning: your current security key is not stored on chain. You could easily lose access to your account. Tap here to fix.",
                                full_bar_target: true,
                                custom_bg_color: "#e99a32",
                                custom_color: "white",
                                close_icon: hb.getSvg("x", {
                                    class_string: "std_close_icon"
                                }),
                                svg_icon: hb.getSvg("warning_w_border", {
                                    class_string: "std_icon"
                                })
                            }, customWarningClose);
                            function customWarningClose(ret) {
                                if (ret)
                                    prepStoreSecKey(temp_cred);
                            }
                        }
                    }
                    function createPasskey(temp_cred, username, cb) {
                        var new_notification;
                        if (passkeyRdy(temp_cred) == false) {
                            var date = new Date().toLocaleString();
                            var default_name = username + " (" + date + ")";
                            alerts_h.setAlert("input", {
                                init_value: username,
                                placeholder: default_name,
                                submit_label: "Confirm",
                                sub_heading: "If blank, a default will be used.",
                                alert_msg: "Name your security key",
                                simple_close: true,
                                confirm_req: 1
                            }, function(ret) {
                                if (ret != null) {
                                    var key_name = (ret === "") ? default_name : ret;
                                    var prf_obj = {
                                        username: username,
                                        key_name: key_name
                                    };
                                    biometrics_h.createCredential(prf_obj, function(ret_id) {
                                        new_notification = tb_h.newNotification({
                                            msg_html: "Passkey registered. Keep going!",
                                            full_bar_target: true,
                                            custom_bg_color: "#4fe932",
                                            custom_color: "white",
                                            close_icon: hb.getSvg("x", {
                                                class_string: "std_close_icon"
                                            })
                                        });
                                        temp_cred.raw_id = ret_id;
                                        window.setTimeout(createSecKey, 500);
                                    });
                                }
                            });
                        } else
                            createSecKey();
                        function passkeyRdy(temp_cred) {
                            if (temp_cred.raw_id != null)
                                return true;
                            else
                                return false;
                        }
                        function createSecKey() {
                            var prf_obj = getPrfObject(temp_cred.raw_id);
                            biometrics_h.getCredential(prf_obj, handleKeyMat);
                            function handleKeyMat(key_mat, raw_id) {
                                new_notification.clear();
                                temp_cred.raw_id = raw_id;
                                if (key_mat != null)
                                    genSecKey(key_mat);
                                else
                                    cb(null);
                            }
                        }
                        function genSecKey(key_buff) {
                            var msg_param = {
                                msg_type: "encrypt_mp",
                                key_buff: key_buff,
                            };
                            var transfer_array = [msg_param.key_buff];
                            ww_h.sendMessageToWorker(msg_param, transfer_array, function(ret) {
                                if (ret != null) {
                                    var ret_sk = concatArrayBuffers(ret.salt_buff, ret.encrypted_buff);
                                    var user_id = kh.keccak256(biometrics_h.rawToUsername(temp_cred.raw_id));
                                    var params = {
                                        username: username,
                                        raw_id: temp_cred.raw_id,
                                        misc_data: ret_sk,
                                        user_id
                                    };
                                    cb(params);
                                }
                            });
                        }
                    }
                    function storeSecKey(raw_id, hex_sk, closeMenuFunction) {
                        var username = biometrics_h.rawToUsername(raw_id);
                        var username_hash = kh.keccak256(username);
                        var new_sec_key_obj = {
                            username,
                            username_hash,
                            misc_data: hex_sk
                        };
                        var trans_array = prep_SecKeyInit(active_account.username, active_account.address, new_sec_key_obj);
                        th.newTransactionPreview(trans_array, handleSecKeyRegister);
                        function handleSecKeyRegister(tx_addresses) {
                            if (tx_addresses != null) {
                                var params = {
                                    success_title: "<h5>Success!</h5>",
                                    success_msg: "<p>Your Security Key has been registered</p>",
                                    hide_skip: true,
                                };
                                closeMenuFunction();
                                multiHandleResults(tx_addresses, params, function(ret) {
                                    very_temp_cred = null;
                                    very_temp_cred = Object.assign({
                                        stored: true
                                    }, prepTempCred());
                                    biometrics_h.confirmOnChain(username_hash);
                                    biometrics_h.clearTempCred();
                                    backToNotesHome();
                                });
                            }
                        }
                    }
                    function prep_SecKeyInit(username_string, user_address, encoded_sec_key_obj) {
                        var new_address_link = {
                            fcn_call: "createAddressLink(bytes32,string)",
                            fcn_params: [encoded_sec_key_obj.username_hash, encoded_sec_key_obj.username],
                            user_address: user_address,
                            contract_address: current_mod_contract,
                            custom_title: "Store Security Key",
                            constant_value: getUsernameCost(encoded_sec_key_obj.username),
                            gwei_required: app_obj.known_gas_obj.sec_key_addr_link,
                        };
                        var new_data_link = {
                            fcn_call: "setDataAtIndex(bytes32,bytes,string)",
                            fcn_params: [encoded_sec_key_obj.username_hash, encoded_sec_key_obj.misc_data, username_string],
                            user_address: user_address,
                            contract_address: current_sk_contract,
                            custom_title: "Store Security Key",
                            gwei_required: calcExtraGasCost(app_obj.known_gas_obj.sec_key_register, username_string),
                        };
                        return [new_address_link, new_data_link];
                        function calcExtraGasCost(base_cost, str) {
                            return base_cost + BigInt((Math.floor(str.length / 32)) * 25000);
                        }
                    }
                    function setWalletFunctions() {
                        closeNotesMenu();
                        var temp = hb.newWalletFunctions({
                            coin_dn: active_contract.coin_dn,
                            ac_balance: 0
                        });
                        var cont = document.createElement("div");
                        cont.className = "standard_full_modal_container";
                        cont.id = "wallet_functons_modal";
                        cont.innerHTML = temp;
                        document.body.prepend(cont);
                        setMigrationBox();
                        walletFunctionsCheckFunds();
                        setListener({
                            ele: document.getElementById("wallet_functions_close"),
                            func: closeWalletFunctions
                        });
                        setListener({
                            ele: document.getElementById("wallet_functions_pk_button"),
                            func: pkButtonClicked
                        });
                        function closeWalletFunctions() {
                            removeListener({
                                ele: document.getElementById("wallet_functions_close"),
                                func: closeWalletFunctions
                            });
                            removeListener({
                                ele: document.getElementById("wallet_functions_pk_button"),
                                func: pkButtonClicked
                            });
                            document.getElementById("wallet_functons_modal").remove();
                        }
                        function pkButtonClicked() {
                            closeWalletFunctions();
                            setPkBox();
                        }
                    }
                    function walletFunctionsCheckFunds() {
                        getTotalCoin(active_account.address, function(ret_params) {
                            if (ret_params != null) {
                                var ret_value = hexToBigInt(ret_params.result);
                                updateWalletFunctionsCoin(ret_value);
                            }
                        });
                        function updateWalletFunctionsCoin(value) {
                            var wallet_functions_ac_cc_box = document.getElementById("wallet_functions_ac_cc_box");
                            if (wallet_functions_ac_cc_box != null) {
                                wallet_functions_ac_cc_box.firstElementChild.innerText = "$" + coinToUsd(value, th.getActiveCurrencyRate());
                                wallet_functions_ac_cc_box.lastElementChild.innerText = trimEth(weiToEth(value), 6) + " " + active_contract.coin_dn;
                            }
                        }
                    }
                    function setPkBox() {
                        closeNotesMenu();
                        var salt = active_account.encrypted_key.slice(0, 24);
                        var encrpyted_msg = active_account.encrypted_key.slice(24);
                        var temp = hb.newPkBox({
                            coin_dn: active_contract.coin_dn,
                            ac_balance: 0
                        });
                        var cont = document.createElement("div");
                        cont.className = "standard_full_modal_container";
                        cont.id = "private_key_modal";
                        cont.innerHTML = temp;
                        document.body.prepend(cont);
                        walletFunctionsCheckFunds();
                        setListener({
                            ele: document.getElementById("wallet_functions_close"),
                            func: closePrivateKeyBox
                        });
                        setListener({
                            ele: document.getElementById("private_key_copy_button"),
                            func: copyPk
                        });
                        getDecryptedPK(encrpyted_msg, salt, function(decrpyted_stuff) {
                            if (decrpyted_stuff != null)
                                document.getElementById("private_key_container").innerText = decrpyted_stuff;
                            else
                                closePrivateKeyBox();
                        });
                        function copyPk(e) {
                            copy_to_clipboard(document.getElementById("private_key_container").innerText);
                            let tc = e.target.innerText;
                            e.target.innerText = "Copied!";
                            window.setTimeout(function() {
                                e.target.innerText = tc;
                            }, 1000);
                        }
                        function closePrivateKeyBox() {
                            removeListener({
                                ele: document.getElementById("wallet_functions_close"),
                                func: closePrivateKeyBox
                            });
                            removeListener({
                                ele: document.getElementById("private_key_copy_button"),
                                func: copyPk
                            });
                            document.getElementById("private_key_modal").remove();
                        }
                    }
                    function getNoteById(note_id) {
                        for (var i = 0; i < active_account.note_obj.note_array.length; i++) {
                            if (active_account.note_obj.note_array[i].id == note_id)
                                return i;
                        }
                        return null;
                    }
                    function setActiveStartingNote(starting_note) {
                        if (/^0x/.test(starting_note))
                            var note_num = getNoteById(starting_note.slice(2));
                        else
                            var note_num = parseInt(starting_note);
                        if (note_num != null)
                            setUserNote(note_num);
                        else
                            setNotes();
                    }
                    function sortNotes(note_array, sort_obj) {
                        var temp_list = note_array.slice();
                        var sort_type, active_column;
                        active_column = sort_obj.type;
                        switch (active_column) {
                        case "ts":
                            sort_type = "number";
                            break;
                        }
                        if (temp_list.length > 0) {
                            if (sort_type == "number")
                                temp_list.sort(compareNumbers);
                            else
                                temp_list.sort(compareStrings);
                        }
                        var ret_obj;
                        var new_note_pos_array = [];
                        var new_id_ptr_obj = {};
                        for (var i = 0; i < temp_list.length; i++) {
                            new_note_pos_array.push(temp_list[i].chain_pos);
                            new_id_ptr_obj[temp_list[i].id] = {
                                sort_pos: i,
                                chain_pos: temp_list[i].chain_pos
                            };
                        }
                        ret_obj = {
                            note_pos_array: new_note_pos_array,
                            id_ptr_obj: new_id_ptr_obj
                        };
                        return ret_obj;
                        function compareNumbers(a, b) {
                            a[active_column] = (a[active_column] == null) ? -1 : a[active_column];
                            b[active_column] = (b[active_column] == null) ? -1 : b[active_column];
                            return (sort_obj.asc) ? a[active_column] - b[active_column] : b[active_column] - a[active_column];
                        }
                        function compareStrings(a, b) {
                            a[active_column] = (a[active_column] == null) ? "" : a[active_column];
                            b[active_column] = (b[active_column] == null) ? "" : b[active_column];
                            return (sort_obj.asc) ? a[active_column].localeCompare(b[active_column]) : b[active_column].localeCompare(a[active_column]);
                        }
                    }
                    function setActiveUserObj(params, cb) {
                        active_account.address = params.address;
                        active_account.username = params.username;
                        active_url_paths.username = (checkForProperty(active_account.username)) ? active_account.username : active_account.address;
                        params.force_check = (checkForProperty(params.force_check)) ? params.force_check : false;
                        if (params.force_check || !checkForProperty(active_account.note_obj.note_array) || active_account.note_obj.note_array.length == 0) {
                            getNotesCall(params.address, undefined, function(ret) {
                                active_account.note_obj.hash = kh.keccak256(ret);
                                var decoded = decodeParams("bytes[],uint256,bytes32[]", ret);
                                var decoded_array = decoded[0];
                                active_account.note_obj.last_update = hexToBigInt(decoded[1].data);
                                active_account.note_obj.index_array = decoded[2];
                                active_account.note_obj.note_array = parseNotes(decoded_array, active_account.note_obj.index_array);
                                active_account.note_obj.sorted_obj = sortNotes(active_account.note_obj.note_array, {
                                    asc: false,
                                    type: "ts"
                                });
                                cb();
                            });
                        } else
                            cb();
                    }
                    function forceUserCoinUpdate() {
                        setUserCoin(active_account.address, true);
                    }
                    function setUserCoin(address, force=false) {
                        if (active_account.coin_total == null || force) {
                            document.getElementById("notes_user_coin").previousElementSibling.innerHTML = "Balance: updating...";
                            getTotalCoin(address, function(user_coin_hex) {
                                active_account.coin_total = hexToBigInt(user_coin_hex.result);
                                setCoin(active_account.coin_total);
                                document.getElementById("notes_user_coin").previousElementSibling.innerHTML = "Balance:";
                            });
                        } else
                            setCoin(active_account.coin_total);
                        function setCoin(new_coin_total) {
                            document.getElementById("notes_user_coin").innerHTML = trimEth(weiToEth(new_coin_total), 5) + " " + main_currency_symbol;
                            if (th.getActiveCurrencyRate() != null)
                                document.getElementById("notes_user_coin").innerHTML += " ($" + coinToUsd(new_coin_total, th.getActiveCurrencyRate()) + ")";
                        }
                    }
                    function setUpdateWatcher() {
                        var watcher_obj = {
                            tag_name: "last_update_watcher",
                            timeout_ms: secsToMs(31536000),
                            interval_ms: secsToMs(300),
                            func: updateFunc,
                        };
                        watcher_h.setWatcher(watcher_obj);
                        function updateFunc(resolve_watcher) {
                            checkIfUpdateNeeded(function(ret) {
                                resolve_watcher(false);
                                if (ret === true) {
                                    if (active_account.note_obj.last_update != null)
                                        tb_h.newNotification({
                                            msg_html: "Notes updated",
                                            self_remove_ms: 5000,
                                            full_bar_target: true,
                                            custom_bg_color: "#4fe932",
                                            custom_color: "white",
                                            close_icon: hb.getSvg("x", {
                                                class_string: "std_close_icon"
                                            })
                                        });
                                    refreshNotes();
                                }
                            });
                        }
                    }
                    function checkIfUpdateNeeded(cb) {
                        checkLastUpdate(function(last_update) {
                            if (active_account.note_obj.last_update < last_update || (last_update == 0n && active_account.note_obj.last_update == null)) {
                                cb(true)
                            } else {
                                cb(false);
                            }
                        });
                    }
                    function menuImportNotes() {
                        closeNotesMenu();
                        watcher_h.evalWatchers();
                        let import_active = false;
                        main_container.innerHTML = hb.importNotes();
                        setListener({
                            ele: document.getElementById("import_notes_button"),
                            func: handleImportPublish
                        });
                        setListener({
                            ele: document.getElementById("import_notes_close"),
                            func: closeImportNotes
                        });
                        setListener({
                            ele: document.getElementById("import_notes_public_key"),
                            func: copyPublicKey
                        });
                        setListener({
                            ele: document.getElementById("import_notes_textarea"),
                            action: "paste",
                            func: checkPaste
                        });
                        setListener({
                            ele: document.getElementById("upload_file"),
                            action: "change",
                            func: setUploadButton
                        });
                        function closeImportNotes() {
                            clearImportNotes();
                            backToNotesHome();
                        }
                        function copyPublicKey(e) {
                            defaultCopyToClipboard(e.target, bufferToHex(active_account.ecdh_public), null);
                        }
                        function clearImportNotes() {
                            removeListener({
                                ele: document.getElementById("import_notes_close"),
                                func: closeImportNotes
                            });
                            removeListener({
                                ele: document.getElementById("import_notes_button"),
                                func: handleImportPublish
                            });
                        }
                        function checkPaste(e) {
                            var imported = e.clipboardData.getData("text").trim();
                            if (checkForValidImport(imported) === true)
                                e.preventDefault();
                        }
                        function checkForValidImport(data) {
                            var data_array = data.split("_");
                            if (data_array.length == 2) {
                                if (validHexStr(data_array[0]) && validHexStr(data_array[1])) {
                                    if (document.getElementById("import_notes_textarea").value.trim() == "") {
                                        var msg_param = {
                                            msg_buff: hexToArrayBuffer(data_array[1], Uint8Array).buffer,
                                            ecdh_pub: hexToArrayBuffer(data_array[0], Uint8Array).buffer
                                        };
                                        ecdhDecrypt(msg_param, function(import_json) {
                                            if (import_json != null) {
                                                import_json = import_json.replaceAll('{"note"', '\n{"note"');
                                                import_json = import_json.replace(/}]$/, '}\n]');
                                                document.getElementById("import_notes_textarea").value = import_json;
                                            }
                                        });
                                        return true;
                                    }
                                }
                            }
                            return false;
                        }
                        function handleImportPublish() {
                            prepareImportedNotes(function(new_note_array) {
                                publishNotesTransaction(new_note_array, null, "Import Notes", function(response_array) {
                                    import_active = false;
                                    if (response_array != null) {
                                        var params = {
                                            success_icon: hb.getSvg("bitnote_lock", {
                                                id: "results_bitnote_svg"
                                            }),
                                            success_title: "<h5>Your note(s) are now safely stored on the Avalanche Blockchain</h5>",
                                            success_msg: "",
                                            container_width: "475px",
                                            hide_skip: true,
                                        };
                                        multiHandleResults(response_array, params);
                                        clearImportNotes();
                                    }
                                });
                            });
                        }
                        function prepareImportedNotes(cb) {
                            if (import_active === false) {
                                import_active = true;
                                var new_notes_obj = parseImportedNotes();
                                if (new_notes_obj != null) {
                                    setLoadingScreen(true);
                                    encryptAllImports(new_notes_obj, cb);
                                } else {
                                    tb_h.newNotification({
                                        msg_html: "Error! Invalid import note format",
                                        self_remove_ms: 5000,
                                        full_bar_target: true,
                                        custom_bg_color: "#e93232",
                                        custom_color: "#fff"
                                    });
                                    import_active = false;
                                }
                            }
                        }
                        function parseImportedNotes() {
                            var import_data = document.getElementById("import_notes_textarea").value.trim();
                            import_data = import_data.replace(/^{/, "[{");
                            import_data = import_data.replace(/(}$|},$)/, "}]");
                            import_data = import_data.replace(/},\s*]$/, "}]");
                            try {
                                return JSON.parse(import_data);
                            } catch (e) {
                                return null;
                            }
                        }
                        function encryptAllImports(notes_obj, cb) {
                            let enc_array = [];
                            let text_encoder = new TextEncoder();
                            (function nextNote(current_pointer) {
                                if (current_pointer < notes_obj.length) {
                                    var title = prepTitle(notes_obj[current_pointer].title);
                                    var msg_buff = title + notes_obj[current_pointer].note;
                                    var ecdh_pub = active_account.ecdh_public.slice();
                                    ecdhEncrypt({
                                        msg_buff,
                                        ecdh_pub
                                    }, function(ret_hex) {
                                        if (ret_hex != null) {
                                            ret_hex = convertToBnNote(ret_hex, decimalTo2cHex(Date.now() + current_pointer));
                                            enc_array.push(ret_hex);
                                            nextNote(++current_pointer);
                                        }
                                    });
                                } else
                                    cb(splitImportNotes(enc_array));
                            }
                            )(0);
                        }
                        function splitImportNotes(enc_array) {
                            const max_length = app_obj.max_note_length;
                            var new_note_array = [];
                            var pointer, new_batch;
                            resetNote();
                            while (enc_array.length > 0) {
                                if (new_batch.len + enc_array[pointer].length < max_length) {
                                    var new_data = enc_array.splice(pointer, 1);
                                    new_data = new_data[0];
                                    pointer--;
                                    new_batch.len = new_batch.len + new_data.length;
                                    new_batch.data_array.push(new_data);
                                } else
                                    pointer--;
                                if (pointer < 0) {
                                    new_note_array.push(new_batch);
                                    resetNote();
                                }
                            }
                            if (new_batch.data_array.length > 0)
                                new_note_array.push(new_batch);
                            var ret_2d_array = [];
                            for (var i = 0; i < new_note_array.length; i++)
                                ret_2d_array.push(new_note_array[i].data_array);
                            return ret_2d_array;
                            function resetNote() {
                                resetPointer();
                                new_batch = {
                                    len: 0,
                                    data_array: []
                                };
                            }
                            function resetPointer() {
                                pointer = enc_array.length - 1;
                            }
                        }
                        function setUploadButton(e) {
                            var new_file = this.files[0];
                            e.target.value = "";
                            parseFile(new_file, function(result_obj) {
                                if (result_obj != null) {
                                    mergeBoards(result_obj.boards_array);
                                    mergeAcs(result_obj.address_obj_array, getCurrentBoardList);
                                }
                            });
                            function parseFile(file, cb) {
                                var reader = new FileReader();
                                reader.addEventListener("load", function(res) {
                                    var import_obj = findKeys(res.currentTarget.result);
                                    getEncodedMaterial(1, {
                                        alert_msg: ["Master Password:"],
                                        submit_label: "Unlock",
                                        placeholder: "Enter Master Password",
                                        biometrics: {
                                            label: "Log in with Security",
                                            handler: biometricsHandlerForAlerts
                                        }
                                    }, function(encoded_material) {
                                        if (checkForProperty(encoded_material))
                                            unlockImportedNotes(encoded_material.buffer, import_obj, setNoteImport);
                                    });
                                }, false);
                                reader.readAsText(file);
                            }
                            function setNoteImport(import_obj) {
                                var ret_str = "[\n";
                                for (var i = 0; i < import_obj.imported_notes.length; i++) {
                                    var new_note = import_obj.imported_notes[i].decrypted.replace(/(\r\n|\n)/g, "\\n");
                                    ret_str += `{"note":"${new_note}","title":"${import_obj.imported_notes[i].title}"},\n`;
                                }
                                ret_str += "]";
                                document.getElementById("import_notes_textarea").value = ret_str;
                            }
                            function unlockImportedNotes(encoded_material, import_obj, setNoteImport_cb) {
                                setLoadingScreen(true);
                                var salt_buff = hexToArrayBuffer(import_obj.ecdh_enc_pk.slice(0, 24), Uint8Array).buffer;
                                var cipher_buff = hexToArrayBuffer(import_obj.ecdh_enc_pk.slice(24), Uint8Array).buffer;
                                var msg_param = {
                                    msg_type: "de",
                                    mp_buff: encoded_material,
                                    cipher_buff: cipher_buff,
                                    salt_buff: salt_buff
                                };
                                var transfer_array = [msg_param.mp_buff, msg_param.cipher_buff, msg_param.salt_buff];
                                ww_h.sendMessageToWorker(msg_param, transfer_array, function(ecdh_pk_buff) {
                                    if (ecdh_pk_buff != null)
                                        multiDecrypt(import_obj, ecdh_pk_buff, setNoteImport_cb);
                                });
                                function multiDecrypt(import_obj, ecdh_pk_buff, cb) {
                                    nextDecrypt(0);
                                    function nextDecrypt(pointer) {
                                        var params = {
                                            msg_buff: hexToArrayBuffer(import_obj.imported_notes[pointer].salt + import_obj.imported_notes[pointer].encrypted_note, Uint8Array).buffer,
                                            ecdh_pub: hexToArrayBuffer(import_obj.ecdh_public, Uint8Array).buffer,
                                            ecdh_pk_buff: ecdh_pk_buff.slice(),
                                        };
                                        ecdhDecrypt(params, function(decrypted) {
                                            var note_obj = parseDecryptedNote({}, decrypted);
                                            import_obj.imported_notes[pointer].decrypted = note_obj.decrypted;
                                            import_obj.imported_notes[pointer].title = note_obj.title;
                                            if (++pointer < import_obj.imported_notes.length)
                                                nextDecrypt(pointer);
                                            else {
                                                setLoadingScreen(false);
                                                cb(import_obj);
                                            }
                                        });
                                    }
                                }
                            }
                            function findKeys(file_contents) {
                                var ecdh_enc_pk = file_contents.match(/exp_ecdh_enc_pk\s*=\s*".*?"/)[0].replace("exp_ecdh_enc_pk", "").replaceAll(" ", "").replace("=", "").replaceAll('"', "");
                                var ecdh_public = file_contents.match(/exp_ecdh_public\s*=\s*".*?"/)[0].replace("exp_ecdh_public", "").replaceAll(" ", "").replace("=", "").replaceAll('"', "");
                                var imported_notes = file_contents.match(/exp_user_obj.note_obj_array\s*=\s*\[.*?\]/)[0];
                                imported_notes = imported_notes.replace("exp_user_obj.note_obj_array", "").replaceAll(" ", "").replace("=", "");
                                imported_notes = getIfJSON(imported_notes);
                                if (imported_notes !== false)
                                    return {
                                        imported_notes,
                                        ecdh_enc_pk,
                                        ecdh_public
                                    };
                                else
                                    return null;
                            }
                            function getIfJSON(str) {
                                try {
                                    return JSON.parse(str);
                                } catch (e) {
                                    return false;
                                }
                            }
                        }
                    }
                    function setNotesHome(params) {
                        setTopbar(true);
                        setNotes();
                        setUpdateWatcher();
                        function setNotes() {
                            main_container.innerHTML = hb.newNotesHome(active_account.address, active_account.username, active_account.note_obj.sorted_obj);
                            setUserCoin(active_account.address);
                            setListener({
                                ele: document.getElementById("notes_user_address"),
                                func: copyNotesAddress
                            });
                            setListener({
                                ele: document.getElementById("notes_refresh_arrow"),
                                func: refreshNotesClick
                            });
                            setListener({
                                ele: document.getElementById("notes_home_back_arrow"),
                                func: backToLanding
                            });
                            setListener({
                                ele: document.getElementById("notes_box_container"),
                                func: determineUserNote
                            });
                            setListener({
                                ele: document.getElementById("notes_user_coin"),
                                func: forceUserCoinUpdate
                            });
                            setListener({
                                ele: document.getElementById("view_shared_note"),
                                func: setViewSecretContainer
                            });
                            setListener({
                                ele: document.getElementById("menu_export_notes"),
                                func: menuExportNotes
                            });
                            setListener({
                                ele: document.getElementById("menu_import_notes"),
                                func: menuImportNotesClick
                            });
                            setListener({
                                ele: document.getElementById("menu_referral_link"),
                                func: setReferralContainer
                            });
                            setListener({
                                ele: document.getElementById("menu_more_settings"),
                                func: showMoreSettings
                            });
                            setListener({
                                ele: document.getElementById("menu_wallet_functions"),
                                func: setWalletFunctions
                            });
                            setListener({
                                ele: document.getElementById("menu_sk_functions"),
                                func: setSecKeyFunctions
                            });
                            setListener({
                                ele: document.getElementById("menu_logout"),
                                func: menuLogout
                            });
                            setListener({
                                ele: document.getElementById("menu_keyboard_shortcuts"),
                                func: openShortcutSheet
                            });
                            setListener({
                                ele: document.getElementById("menu_clear_cache"),
                                func: clearCache
                            });
                            setListener({
                                ele: document.getElementById("notes_three_dot_icon"),
                                func: showNotesMenu
                            });
                            setListener({
                                ele: document.getElementById("user_notes_menu_container"),
                                func: closeNotesMenu
                            });
                            setListener({
                                ele: document.getElementById("user_notes_menu"),
                                func: stopProp
                            });
                            setListener({
                                ele: document.getElementById("notes_home_search_input"),
                                func: searchActiveNotes,
                                action: "keyup"
                            });
                            setListener({
                                ele: document.getElementById("notes_home_search_x"),
                                func: clearSearch,
                                action: "click"
                            });
                            updateUrlPath();
                            shortcut_h.addShortcut(window, setNewNote, "Enter", "keydown", "ctrlKey");
                            shortcut_h.addShortcut(window, menuLogout, "l", "keydown", "ctrlKey");
                            shortcut_h.addShortcut(window, toggleSearch, "f", "keydown", "ctrlKey");
                            setListener({
                                ele: document.getElementById("notes_home_search_input"),
                                func: focusSearch,
                                action: "click"
                            });
                            setListener({
                                ele: document.getElementById("notes_home_search_input"),
                                func: blurSearch,
                                action: "blur"
                            });
                        }
                        function showMoreSettings() {
                            document.getElementById("menu_more_settings").style.display = "none";
                            document.getElementById("menu_more_settings_container").style.display = "block";
                        }
                        function toggleSearch(set_to=null) {
                            if (document.activeElement === document.getElementById("notes_home_search_input"))
                                blurSearch();
                            else
                                focusSearch();
                        }
                        function focusSearch() {
                            document.getElementById("notes_home_search_input").focus();
                            newUnlockManyNotesFromView();
                        }
                        function blurSearch() {
                            document.getElementById("notes_home_search_input").blur();
                            lockAllNotes();
                        }
                        function openShortcutSheet() {
                            closeNotesMenu();
                            var new_menu = document.createElement("div");
                            new_menu.id = "shortcut_outer_menu";
                            document.body.prepend(new_menu);
                            new_menu.innerHTML = hb.buildShortcutSheet(apple_mode);
                            document.getElementById("shortcuts_close").addEventListener("click", closeShortcutsSheet);
                            document.getElementById("shortcut_outer_menu").addEventListener("click", closeShortcutsSheet);
                            document.getElementById("shortcut_menu").addEventListener("click", stopProp);
                            function closeShortcutsSheet() {
                                document.getElementById("shortcuts_close").removeEventListener("click", closeShortcutsSheet);
                                document.getElementById("shortcut_outer_menu").removeEventListener("click", closeShortcutsSheet);
                                document.getElementById("shortcut_outer_menu").remove();
                            }
                        }
                        function menuLogout() {
                            backToLanding(false);
                        }
                        function menuExportNotes() {
                            if (active_account.note_obj.note_array.length > 0) {
                                closeNotesMenu();
                                var keys = {
                                    address: active_account.address,
                                    ecdh_enc_pk_hex: bufferToHex(active_account.ecdh_enc_pk),
                                    encrypted_key: active_account.encrypted_key,
                                    ecdh_public_hex: bufferToHex(active_account.ecdh_public)
                                };
                                saveLocalBackup(active_account.username, active_account.note_obj.note_array, keys);
                            } else
                                tb_h.newNotification({
                                    msg_html: "There are no notes to export",
                                    full_bar_target: true,
                                    self_remove_ms: 5000,
                                    custom_bg_color: "#e99a32",
                                    custom_color: "#fff",
                                    svg_icon: hb.getSvg("warning_w_border", {
                                        class_string: "std_icon"
                                    }),
                                    close_icon: hb.getSvg("x", {
                                        class_string: "std_close_icon"
                                    })
                                });
                        }
                        function menuImportNotesClick() {
                            vh.setView("import_notes");
                        }
                        function searchActiveNotes(e) {
                            var nc = document.getElementById("notes_output_container").children;
                            var match_txt = e.target.value;
                            if (match_txt != "") {
                                setSearchX(true);
                                match_txt = new RegExp(match_txt,'i');
                                for (var i = 0; i < nc.length; i++) {
                                    if (nc[i].innerText.search(match_txt) != -1) {
                                        showNote(nc[i]);
                                        continue;
                                    }
                                    var tc = parseInt(nc[i].dataset.note_num);
                                    if (checkForProperty(active_account.note_obj.note_array[tc].decrypted) && active_account.note_obj.note_array[tc].decrypted.search(match_txt) != -1)
                                        showNote(nc[i]);
                                    else
                                        showNote(nc[i], false);
                                }
                            } else {
                                setSearchX(false);
                                for (var i = 0; i < nc.length; i++)
                                    showNote(nc[i]);
                            }
                            function showNote(note_ele, show=true) {
                                note_ele.style.display = (show) ? null : "none";
                            }
                        }
                        function setSearchX(show_x=true) {
                            document.getElementById("notes_home_search_x").style.display = (show_x) ? "block" : "none";
                        }
                        function clearSearch() {
                            document.getElementById("notes_home_search_input").value = "";
                            document.getElementById("notes_home_search_input").dispatchEvent(new Event('keyup'));
                            setSearchX(false);
                        }
                        function setNoteTitles() {
                            var nc = document.getElementById("notes_output_container").children;
                            for (var i = 0; i < nc.length; i++) {
                                var tc = parseInt(nc[i].dataset.note_num);
                                if (active_account.note_obj.note_array[tc].title != "")
                                    nc[i].firstElementChild.innerText = active_account.note_obj.note_array[tc].title;
                                else {
                                    if (checkForProperty(active_account.note_obj.note_array[tc].decrypted))
                                        nc[i].firstElementChild.innerText = "Note #" + ((nc.length - 1) - i);
                                    else
                                        nc[i].firstElementChild.innerText = "Encrypted Note #" + ((nc.length - 1) - i);
                                }
                                if (active_account.note_obj.note_array[tc].decrypted)
                                    nc[i].lastElementChild.innerText = "View";
                            }
                        }
                    }
                    function closeNotesMenu() {
                        if (checkForProperty(document.getElementById("user_notes_menu")))
                            showNotesMenu(null, false);
                    }
                    function showNotesMenu(ev, open_menu=true) {
                        var ele = document.getElementById("user_notes_menu");
                        document.getElementById("user_notes_menu_container").style.display = (open_menu) ? "block" : "none";
                        if (open_menu) {
                            placePopup(ev, ele, [document.getElementById("menu_more_settings_container")]);
                            ele.focus();
                        } else {
                            document.getElementById("menu_more_settings").style.display = null;
                            document.getElementById("menu_more_settings_container").style.display = null;
                            ele.style.left = null;
                            ele.style.top = null;
                        }
                    }
                    function parseNotes(pre_parsed_array, index_array) {
                        var text_decoder = new TextDecoder();
                        var note_obj_array = [];
                        for (var i = 0; i < pre_parsed_array.length; i++) {
                            if (pre_parsed_array[i].data == "") {
                                var id = "999999999999";
                                var new_dat = {
                                    chain_pos: i,
                                    id: id,
                                    ts: Number(hexToBigInt(id)),
                                    title: index_array[i],
                                    salt: "",
                                    decrypted: "blank_note",
                                    encrypted_note: "",
                                    title_enc_status: true
                                };
                                note_obj_array.push(new_dat);
                            } else {
                                var title_enc_status = true;
                                var note_title = "";
                                var slice_data = pre_parsed_array[i].data.slice();
                                var salt = slice_data.slice(0, 24);
                                var id = slice_data.slice(24, 36);
                                var encrypted_note = slice_data.slice(36);
                                var new_dat = {
                                    chain_pos: i,
                                    id: id,
                                    ts: Number(hexToBigInt(id)),
                                    title: note_title,
                                    salt: salt,
                                    encrypted_note: encrypted_note,
                                    title_enc_status: title_enc_status
                                };
                                note_obj_array.push(new_dat);
                            }
                        }
                        return note_obj_array;
                    }
                    this.determineUserNote = determineUserNote;
                    function determineUserNote(e) {
                        var note_num = (e.target.classList.contains("get_note_box")) ? e.target : e.target.parentNode;
                        note_num = (note_num.classList.contains("get_note_box")) ? note_num : note_num.parentNode;
                        note_num = parseInt(note_num.dataset.note_num);
                        if (e.target.classList.contains("note_three_dot"))
                            noteThreeDotMenu(e, note_num);
                        else {
                            if (!isNaN(note_num))
                                setUserNote(note_num);
                            else
                                setNewNote();
                        }
                    }
                    function noteThreeDotMenu(e, note_num) {
                        var user_note_3d_mc = document.createElement("div");
                        user_note_3d_mc.id = "user_note_3d_mc";
                        user_note_3d_mc.innerHTML = hb.userNotesMenu({});
                        document.body.prepend(user_note_3d_mc);
                        user_note_3d_mc.addEventListener("click", closeNoteThreeDot);
                        setAdditionalControls(["notes_3d_archive", "notes_3d_delete", "notes_3d_edit", "notes_3d_share"], true);
                        setAdditionalControls(["gen_random_phrase", "gen_random_string", "gen_random_pk", "succession_note"], false);
                        user_note_3d_mc.style.display = "block";
                        placePopup(e, user_note_3d_mc.firstElementChild);
                        setActiveNote(note_num);
                    }
                    function closeNoteThreeDot(remove_active_note=true) {
                        setAdditionalControls(["notes_3d_archive", "notes_3d_delete", "notes_3d_edit", "notes_3d_share"], false);
                        user_note_3d_mc.removeEventListener("click", closeNoteThreeDot);
                        user_note_3d_mc.remove();
                        if (remove_active_note)
                            clearActiveNote();
                    }
                    function setNewNote(params={}) {
                        setLoadingScreen(false);
                        watcher_h.evalWatchers();
                        shortcut_h.clearAll();
                        app_obj.active_view = "user_note";
                        history.pushState({}, '', window.location.pathname + "?new_note");
                        var new_note_num = active_account.note_obj.note_array.length;
                        main_container.innerHTML = hb.newNewNote({
                            note_number: new_note_num
                        });
                        setAdditionalControls(["standard_note", "note_3d_container"], true);
                        setAdditionalControls(["lock_note", "copy_note"], false);
                        setListener({
                            ele: document.getElementById("user_note_back_arrow"),
                            func: backToNotesHome
                        });
                        setPublishNoteButton();
                        if (params.shared_note)
                            fillSharedNote(params.shared_note);
                        else
                            setNoteTextBox();
                    }
                    function fillSharedNote(shared_note) {
                        var aad = createAadFromShared(shared_note);
                        shared_note = checkForSwap(shared_note);
                        decryptSecret(shared_note, aad, function(decrypted_array) {
                            if (decrypted_array != null) {
                                setNoteTextBox(decrypted_array[0], ((decrypted_array.length > 1) ? decrypted_array[1] : ""));
                                title_ta_handler.updateReturns();
                                note_ta_handler.updateReturns();
                            } else {
                                alerts_h.setAlert("confirm", {
                                    no_cancel_button: true,
                                    submit_label: "Go Back",
                                    sub_heading: "An error was encountered. Please check the link and try again.",
                                    alert_msg: "Unable to unlock note",
                                    simple_close: true,
                                    confirm_req: 1
                                }, function(ret) {
                                    backToNotesHome();
                                });
                            }
                        });
                        function checkForSwap(shared_note) {
                            var re = new RegExp("su=(" + active_account.username + ")(&|$)");
                            var tc = shared_note.match(re);
                            if (tc != null && tc[1] == active_account.username) {
                                shared_note = (shared_note.charAt(0) != "/") ? "/" + shared_note : shared_note;
                                re = new RegExp("\/.*?\/");
                                var new_tc = shared_note.match(re);
                                var other_user = new_tc[0].replaceAll("/", "");
                                shared_note = shared_note.replace(new_tc[0], "/" + active_account.username + "/");
                                shared_note = shared_note.replace(tc[0], "su=" + other_user + "&");
                            }
                            return shared_note;
                        }
                    }
                    function createAadFromShared(shared_note) {
                        var user_1 = shared_note.match(/\/.*?\//)[0];
                        var user_2 = shared_note.match(/\?su=.*?&/)[0];
                        user_1 = user_1.replace('/', '');
                        user_2 = user_2.replace('su=', '');
                        user_2 = user_2.replace('&', '');
                        return new TextEncoder().encode(user_1 + "_" + user_2).buffer;
                    }
                    function notesCharLimitCbHandler(limit_exceeded) {
                        if (limit_exceeded) {
                            if (limit_exceeded === allow_note_publishing)
                                document.getElementById("publish_button").style.opacity = "0.5";
                            allow_note_publishing = false;
                            if (notes_tt_h == null)
                                notes_tt_h = new tooltip_handler(document.getElementById("publish_button"),'Max note size is 20,000 characters');
                        } else {
                            if (limit_exceeded === allow_note_publishing)
                                document.getElementById("publish_button").style.opacity = "1";
                            allow_note_publishing = true;
                            if (notes_tt_h != null) {
                                notes_tt_h.removeHandler();
                                notes_tt_h = null;
                            }
                        }
                    }
                    function setPublishNoteButton(note_num=null) {
                        setListener({
                            ele: document.getElementById("publish_button"),
                            func: publishClick
                        });
                        document.getElementById("publish_button").style.display = "unset";
                        setAdditionalControls(["gen_random_phrase", "gen_random_string", "gen_random_pk", "share_note", "succession_note"], true);
                        setAdditionalControls(["archive_note", "delete_note", "edit_note"], false);
                        shortcut_h.addShortcut(window, publishClick, "s", "keydown", "ctrlKey");
                        shortcut_h.addShortcut(window, backToNotesHome, "Escape", "keydown");
                        function publishClick() {
                            if (allow_note_publishing) {
                                publishNote(active_account.address, note_num);
                            }
                        }
                    }
                    function setActiveNote(note_number) {
                        active_account.active_note = note_number;
                        active_account.active_note_index = active_account.note_obj.index_array[note_number];
                    }
                    function clearActiveNote() {
                        active_account.active_note = null;
                        active_account.active_note_index = null;
                    }
                    function setUserNote(note_number, cb=null) {
                        watcher_h.evalWatchers();
                        shortcut_h.clearAll();
                        app_obj.active_view = "user_note";
                        var id = active_account.note_obj.note_array[note_number].id;
                        setNewQueryParam("note_id", id);
                        updateUrlPath();
                        var current_note = active_account.note_obj.note_array[note_number];
                        setActiveNote(note_number);
                        var display_number = ((active_account.note_obj.note_array.length - 1) - active_account.note_obj.sorted_obj.id_ptr_obj[id].sort_pos);
                        var temp = hb.newNewNote({
                            note_number: display_number
                        });
                        main_container.innerHTML = temp;
                        setAdditionalControls(["note_3d_container"], true);
                        setListener({
                            ele: document.getElementById("user_note_back_arrow"),
                            func: backToNotesHome
                        });
                        shortcut_h.addShortcut(window, backToNotesHome, "Escape", "keydown");
                        shortcut_h.addShortcut(window, editNote, "e", "keydown", "ctrlKey");
                        if (checkForProperty(active_account.note_obj.note_array[note_number].decrypted))
                            setMainBox(active_account.note_obj.note_array[note_number].decrypted);
                        else {
                            var encrpyted_msg = current_note.encrypted_note;
                            var salt = current_note.salt;
                            unlockSingleNote(id, function(note_obj) {
                                if (note_obj.decrypted != null) {
                                    setMainBox(current_note.decrypted, current_note.title);
                                    active_account.note_obj.note_array[note_number] = current_note;
                                    if (cb != null)
                                        cb(true);
                                } else
                                    backToNotesHome();
                            });
                        }
                        function setMainBox(dn, title=undefined) {
                            pre_setTextbox(dn, title);
                            toggleUserNoteTextrarea(true);
                            setHoverListener();
                        }
                        function pre_setTextbox(msg, title="") {
                            setNoteTextBox(msg, title);
                            setAdditionalControls(["standard_note", "archive_note", "delete_note", "edit_note", "copy_note", "readonly_note", "readonly_title", "note_3d_container", "lock_note", "share_note", "succession_note"], true);
                            setAdditionalControls(["gen_random_phrase", "gen_random_string", "gen_random_pk"], false);
                        }
                    }
                    function setHoverListener() {
                        let textbox_conversion_container, active_hover_target, copy_bar, target_radius, still_valid_copy;
                        (function init() {
                            target_radius = 10;
                            active_hover_target = {
                                ele: null,
                                copying: false,
                                copy_bar: null
                            };
                            textbox_conversion_container = document.getElementById("textbox_conversion_container");
                            textbox_conversion_container.addEventListener("mousedown", textboxClickCheck);
                            textbox_conversion_container.addEventListener("mouseup", checkClickRelease);
                            textbox_conversion_container.addEventListener("mousemove", checkMovement);
                            textbox_conversion_container.addEventListener("mouseleave", clearLast);
                            still_valid_copy = false;
                        }
                        )();
                        function checkMovement(e) {
                            var new_target = e.target;
                            if (new_target.classList.contains("converted_text_line") && selected_length === 0 && e.buttons === 0) {
                                if (active_hover_target.ele === null || new_target != active_hover_target.ele || active_hover_target.copy_bar == null)
                                    setNewCopyBar(new_target, e);
                                else
                                    active_hover_target.copying = false;
                            } else if ((new_target.classList.contains("converted_text_line") || new_target.id == "copy_bar") && selected_length === 0)
                                setHoverPointer(new_target, "pointer");
                            else {
                                clearLast();
                                if (e.buttons === 1)
                                    setHoverPointer(new_target, "text");
                            }
                        }
                        function setNewCopyBar(new_target, e) {
                            clearLast();
                            setHoverPointer(new_target, "pointer");
                            active_hover_target = {
                                ele: new_target,
                                copying: false,
                                copy_bar: null
                            };
                            if (checkForProperty(new_target.innerText) && e.buttons === 0 && selected_length === 0) {
                                new_target.style.color = "#ccc";
                                new_target.style.backgroundColor = "#ffffff1d";
                                active_hover_target.copy_bar = initNewCopyBar(e.currentTarget, new_target);
                            }
                        }
                        function setHoverPointer(target_ele, pointer_type=null) {
                            if (target_ele != null)
                                target_ele.style.cursor = pointer_type;
                        }
                        function textboxClickCheck(e) {
                            var new_target = e.target;
                            still_valid_copy = true;
                            if (isValidClick(new_target)) {
                                setHoverPointer(new_target, "pointer");
                                active_hover_target.min_x = e.x - target_radius;
                                active_hover_target.min_y = e.y - target_radius;
                                active_hover_target.max_x = e.x + target_radius;
                                active_hover_target.max_y = e.y + target_radius;
                                active_hover_target.copying = true;
                            }
                        }
                        function isValidClick(new_target) {
                            if (selected_length > 0)
                                return false;
                            if (active_hover_target.ele != null && (new_target.id === "copy_bar" || (new_target === active_hover_target.ele && new_target.classList.contains("converted_text_line"))))
                                return true;
                            else
                                return false;
                        }
                        function checkClickRelease(e) {
                            var new_target = e.target;
                            if (active_hover_target.copying) {
                                if (isValidClick(new_target) && still_valid_copy) {
                                    var copy_text = active_hover_target.ele.firstChild.data;
                                    setCopyBarText("Copied!");
                                    copy_to_clipboard(copy_text.trim());
                                    window.setTimeout(function() {
                                        setCopyBarText("Copy");
                                        setHoverPointer(new_target, "pointer");
                                    }, 800);
                                } else {
                                    setNewCopyBar(new_target, e);
                                }
                            } else {
                                if (selected_length > 0) {
                                    window.setTimeout(function() {
                                        setNewCopyBar(new_target, e);
                                    }, 10);
                                } else
                                    setNewCopyBar(new_target, e);
                            }
                        }
                        function setCopyBarText(new_text) {
                            if (active_hover_target.copy_bar != null)
                                active_hover_target.copy_bar.lastElementChild.innerText = new_text;
                        }
                        function initNewCopyBar(current_target, new_target) {
                            copy_bar = document.createElement("span");
                            copy_bar.id = "copy_bar";
                            copy_bar.innerHTML = hb.getSvg("copy_icon", {
                                id: "copy_icon"
                            }) + " <span>Copy</span>";
                            new_target.firstElementChild.appendChild(copy_bar);
                            var default_offset = copy_bar.getBoundingClientRect().width;
                            copy_bar.style.left = (0 - ((new_target.firstElementChild.offsetLeft <= default_offset) ? new_target.firstElementChild.offsetLeft : default_offset)) + "px";
                            return copy_bar;
                        }
                        function clearLast() {
                            still_valid_copy = false;
                            if (active_hover_target.ele != null) {
                                active_hover_target.ele.style.backgroundColor = null;
                                active_hover_target.ele.style.color = null;
                                active_hover_target = {
                                    copying: active_hover_target.copying,
                                    ele: null
                                };
                            }
                            if (copy_bar != null) {
                                copy_bar.remove();
                                copy_bar = null;
                                active_hover_target.copy_bar = null;
                            }
                        }
                    }
                    function toggleUserNoteTextrarea(convert_textarea=null) {
                        const textarea = document.getElementById('user_note_textbox');
                        const container = document.getElementById('textbox_conversion_container');
                        if (convert_textarea === false || (convert_textarea === null && textarea.style.display === "none"))
                            showTextarea();
                        else
                            convertTextarea();
                        function showTextarea() {
                            note_ta_handler.updateReturns();
                            textarea.style.display = "block";
                            container.style.display = "none";
                            container.innerHTML = "";
                        }
                        function convertTextarea() {
                            container.style.display = "block";
                            textarea.style.display = "none";
                            const lines = textarea.value.split('\n');
                            lines.forEach(line=>{
                                const div = document.createElement('div');
                                div.classList.add('converted_text_line');
                                div.textContent = line;
                                var line_butter = document.createElement('span');
                                line_butter.classList.add('line_butter');
                                div.appendChild(line_butter);
                                container.appendChild(div);
                            }
                            );
                        }
                    }
                    function unlockSingleNote(note_id, cb) {
                        var pos = getNoteById(note_id);
                        if (pos != null) {
                            attemptUnlock(active_account.note_obj.note_array[pos], function(decrypted_stuff) {
                                if (decrypted_stuff == null)
                                    cb(false);
                                else {
                                    decrypted_stuff = parseDecryptedNote(active_account.note_obj.note_array[pos], decrypted_stuff);
                                    cb(decrypted_stuff);
                                }
                            });
                        }
                    }
                    function setNoteTextBox(value="", title="") {
                        var untb = document.getElementById("user_note_textbox");
                        if (title != "")
                            document.getElementById("user_note_titlebox").value = title;
                        untb.value = value;
                        untb.focus();
                        shortcut_h.addShortcut(window, toggleTextarea, "h", "keydown", "ctrlKey");
                    }
                    function toggleTextarea() {
                        if (document.activeElement === document.getElementById("user_note_textbox"))
                            document.getElementById("user_note_titlebox").focus();
                        else
                            document.getElementById("user_note_textbox").focus();
                    }
                    function setAdditionalControls(control_array, add=true) {
                        for (var i = 0; i < control_array.length; i++) {
                            var default_display = "block";
                            var found_control = {
                                ele: document.getElementById(control_array[i]),
                                func: null
                            };
                            switch (control_array[i]) {
                            case "notes_3d_archive":
                                found_control = {
                                    ele: document.getElementById("archive_note"),
                                    func: notesHomeMenuArchiveNote
                                };
                                break;
                            case "notes_3d_delete":
                                found_control = {
                                    ele: document.getElementById("delete_note"),
                                    func: notesHomeMenuDeleteNote
                                };
                                break;
                            case "notes_3d_edit":
                                found_control = {
                                    ele: document.getElementById("edit_note"),
                                    func: notesHomeMenuEditNote
                                };
                                break;
                            case "notes_3d_share":
                                found_control = {
                                    ele: document.getElementById("share_note"),
                                    func: notesHomeMenuShareNote
                                };
                                break;
                            case "share_note":
                                found_control.func = setSecretBox;
                                break;
                            case "succession_note":
                                found_control.func = setSuccessionBox;
                                break;
                            case "standard_note":
                                note_ta_handler = new handle_textarea_resize(document.getElementById('user_note_textbox'),{
                                    char_limit: app_obj.max_note_length,
                                    disable_returns: false,
                                    min_row_buffer: 3,
                                    char_limit_cb: notesCharLimitCbHandler
                                });
                                title_ta_handler = new handle_textarea_resize(document.getElementById('user_note_titlebox'),{
                                    disable_returns: true,
                                    min_row_buffer: 1
                                });
                                title_ta_handler.updateReturns();
                                note_ta_handler.updateReturns();
                                break;
                            case "archive_note":
                                found_control.func = archiveNote;
                                break;
                            case "delete_note":
                                found_control.func = deleteNote;
                                break;
                            case "edit_note":
                                found_control.func = editNote;
                                break;
                            case "copy_note":
                                found_control.func = copyNote;
                                default_display = null;
                                break;
                            case "readonly_note":
                                var tb = document.getElementById("user_note_textbox");
                                if (add) {
                                    tb.setAttribute("readonly", true);
                                    tb.style.cursor = "default";
                                } else {
                                    tb.removeAttribute("readonly");
                                    tb.focus();
                                    tb.style.cursor = null;
                                }
                                break;
                            case "readonly_title":
                                var tb = document.getElementById("user_note_titlebox");
                                if (add) {
                                    tb.setAttribute("readonly", true);
                                    tb.style.cursor = "default";
                                } else {
                                    tb.removeAttribute("readonly");
                                    tb.style.cursor = null;
                                }
                                break;
                            case "gen_random_pk":
                                found_control.func = genRandomPk_note;
                                document.getElementById("user_notes_divider").style.display = (add) ? "block" : "none";
                                break;
                            case "gen_random_phrase":
                                found_control.func = genRandomPhrase_note;
                                break;
                            case "gen_random_string":
                                found_control.func = genRandomString_note;
                                break;
                            case "note_3d_container":
                                found_control.func = showUserNotesMenu;
                                var t1 = document.getElementById("user_notes_menu_container");
                                var t2 = document.getElementById("user_notes_menu");
                                setListener({
                                    ele: t1,
                                    func: closeUserNotesMenu
                                });
                                setListener({
                                    ele: t2,
                                    func: stopProp
                                });
                                break;
                            }
                            if (found_control.func != null) {
                                if (add) {
                                    setListener(found_control);
                                    found_control.ele.style.display = default_display;
                                } else {
                                    removeListener(found_control);
                                    found_control.ele.style.display = "none";
                                }
                            }
                        }
                        function genRandomPk_note() {
                            genNewAc(function(rand_pk) {
                                document.getElementById("user_note_textbox").value += ((document.getElementById("user_note_textbox").value == "") ? "" : "\n") + rand_pk;
                                note_ta_handler.updateReturns();
                            });
                        }
                        function genRandomPhrase_note() {
                            document.getElementById("user_note_textbox").value += ((document.getElementById("user_note_textbox").value == "") ? "" : "\n") + getRandomPhrase(8);
                            note_ta_handler.updateReturns();
                        }
                        function genRandomString_note() {
                            document.getElementById("user_note_textbox").value += ((document.getElementById("user_note_textbox").value == "") ? "" : "\n") + getRandomString(38);
                            note_ta_handler.updateReturns();
                        }
                        function copyNote(e) {
                            var temp_ele = e.currentTarget;
                            var temp_txt = temp_ele.innerText;
                            temp_ele.innerText = "Copied!";
                            temp_ele.style.color = "#fff";
                            window.setTimeout(function() {
                                temp_ele.style.color = null;
                                temp_ele.innerText = temp_txt;
                            }, 500);
                            copy_to_clipboard(document.getElementById("user_note_textbox").value);
                        }
                        function removeReadOnlyRestriction() {
                            document.getElementById("user_note_textbox").removeAttribute("readonly");
                        }
                        function notesHomeMenuArchiveNote() {
                            closeNoteThreeDot(false);
                            archiveNote();
                        }
                        function notesHomeMenuDeleteNote() {
                            closeNoteThreeDot(false);
                            deleteNote();
                        }
                        function notesHomeMenuEditNote() {
                            setUserNote(active_account.active_note, function() {
                                closeNoteThreeDot(false);
                                editNote();
                            });
                        }
                        function notesHomeMenuShareNote() {
                            closeNoteThreeDot(false);
                            setUserNote(active_account.active_note, function() {
                                setSecretBox();
                            });
                        }
                        function prep_deleteSingleUserIndex() {
                            var hex_pos = active_account.active_note.toString(16);
                            return {
                                fcn_call: "deleteSingleUserIndex(uint256)",
                                fcn_params: [hex_pos],
                                user_address: active_account.address,
                                contract_address: active_contract.address,
                                custom_title: "Delete Note",
                                final_check_fcn: pre_finalCheckLastUpdate,
                                fcn_params_pos: 0,
                            };
                        }
                        function archiveNote() {
                            closeUserNotesMenu();
                            var trans_obj = prep_deleteSingleUserIndex();
                            preTransHandlerPositionCheck(trans_obj, archiveNotesResults);
                            function archiveNotesResults(tx_address) {
                                var scan_url = active_contract.scan_url + "tx/" + tx_address;
                                var params = {
                                    success_title: "<h5>Success!</h5>",
                                    success_msg: "<p>Your note was archived, data will remain at index: " + active_account.note_obj.index_array[active_account.active_note] + "</p>",
                                    hide_skip: true,
                                };
                                handleResults(tx_address, params);
                            }
                        }
                        function deleteNote() {
                            closeUserNotesMenu();
                            var fcn_call = "clearAll(uint256,bytes32)";
                            var fcn_params = [active_account.active_note.toString(16), active_account.note_obj.index_array[active_account.active_note]];
                            var trans_1 = {
                                fcn_call: fcn_call,
                                fcn_params: fcn_params,
                                user_address: active_account.address,
                                contract_address: active_contract.address,
                                custom_title: "Delete Note",
                                tax_rate: app_obj.tax_rate,
                                final_check_fcn: pre_finalCheckLastUpdate,
                                fcn_params_pos: 0,
                            };
                            var trans_obj = trans_1;
                            preTransHandlerPositionCheck(trans_obj, deleteNoteResults);
                        }
                        function clearBytesMulti() {
                            closeUserNotesMenu();
                            var fcn_call = "clearBytesMulti(bytes32[])";
                            var fcn_params = [[active_account.note_obj.index_array[active_account.active_note]]];
                            var trans_1 = {
                                fcn_call: fcn_call,
                                fcn_params: fcn_params,
                                user_address: active_account.address,
                                contract_address: active_contract.address,
                                custom_title: "Clear Many Notes",
                                tax_rate: app_obj.tax_rate,
                            };
                            th.newTransactionPreview(trans_obj, handleResults);
                        }
                        function deleteNoteResults(tx_address) {
                            if (tx_address != null) {
                                var params = {
                                    success_title: "<h5>Success!</h5>",
                                    success_msg: "<p>Your note was deleted</p>",
                                    hide_skip: true,
                                };
                                handleResults(tx_address, params);
                            }
                        }
                        function setSuccessionBox() {
                            var temp = document.getElementById("succession_note");
                            let tc = temp.innerText;
                            temp.innerText = "coming soon";
                            window.setTimeout(function() {
                                temp.innerText = tc
                            }, 750);
                        }
                    }
                    function editNote() {
                        setAdditionalControls(["archive_note", "delete_note", "copy_note", "edit_note", "readonly_note", "readonly_title", "succession_note"], false);
                        closeUserNotesMenu();
                        setPublishNoteButton(active_account.active_note);
                        toggleUserNoteTextrarea(false);
                        document.getElementById("user_note_textbox").focus();
                    }
                    function showUserNotesMenu(ev, open_menu=true) {
                        var ele = document.getElementById("user_notes_menu");
                        document.getElementById("user_notes_menu_container").style.display = (open_menu) ? "block" : "none";
                        if (open_menu) {
                            placePopup(ev, ele);
                            ele.focus();
                        } else {
                            ele.style.left = null;
                            ele.style.top = null;
                        }
                    }
                    function closeUserNotesMenu() {
                        showUserNotesMenu(null, false);
                    }
                    function newUnlockManyNotesFromView(cb=null) {
                        var iterations = 1000000;
                        var note_boxes = document.getElementById("notes_output_container").children;
                        unlock_all_active = true;
                        (function checkNext(pos) {
                            if (pos >= 0 && pos < note_boxes.length && unlock_all_active) {
                                var tc = parseInt(note_boxes[pos].dataset.note_num);
                                if (checkForProperty(active_account.note_obj.note_array[tc])) {
                                    if (checkForProperty(active_account.note_obj.note_array[tc].decrypted)) {
                                        setNoteBox(pos, active_account.note_obj.note_array[tc]);
                                        checkNext(pos + 1);
                                    } else {
                                        attemptUnlock(active_account.note_obj.note_array[tc], function(decrypted_stuff) {
                                            if (decrypted_stuff == null) {
                                                inputFlash(note_boxes[pos], 500);
                                                note_boxes[pos].firstElementChild.innerText = "rip note";
                                            } else {
                                                active_account.note_obj.note_array[tc] = parseDecryptedNote(active_account.note_obj.note_array[tc], decrypted_stuff);
                                                if (active_account.note_obj.note_array[tc] != null)
                                                    setNoteBox(pos, active_account.note_obj.note_array[tc]);
                                                if (unlock_all_active === false)
                                                    lockAllNotes();
                                            }
                                            checkNext(pos + 1);
                                        });
                                    }
                                } else
                                    return;
                            } else if (cb != null && pos >= note_boxes.length)
                                cb(true);
                        }
                        )(0);
                        closeNotesMenu();
                        function setNoteBox(pos, current_note) {
                            note_boxes[pos].firstElementChild.innerText = (current_note.title != "") ? current_note.title : "Note #" + ((note_boxes.length - 1) - pos);
                        }
                    }
                    function attemptUnlock(current_note_obj, cb) {
                        var ecdh_pub = active_account.ecdh_public.slice();
                        var msg_buff = hexToArrayBuffer(current_note_obj.salt + current_note_obj.encrypted_note, Uint8Array).buffer;
                        ecdhDecrypt({
                            msg_buff,
                            ecdh_pub
                        }, cb);
                    }
                    function lockNote(note_pos) {
                        delete active_account.note_obj.note_array[note_pos].decrypted;
                        if (active_account.note_obj.note_array[note_pos].title_enc_status)
                            active_account.note_obj.note_array[note_pos].title = "";
                    }
                    function lockAllNotes() {
                        for (var i = 0; i < active_account.note_obj.note_array.length; i++)
                            lockNote(i);
                        closeNotesMenu();
                    }
                    function refreshNotesClick(e) {
                        var min_delay = 1000;
                        var start = performance.now();
                        setLoadingScreen(true);
                        refreshNotes(function() {
                            var end = performance.now() - start;
                            end = Math.ceil(end);
                            if (end >= min_delay)
                                resolveRefresh();
                            else
                                window.setTimeout(resolveRefresh, (min_delay - end));
                        });
                        function resolveRefresh() {
                            setLoadingScreen(false);
                            backToNotesHome();
                        }
                    }
                    function refreshNotesClickQuick() {
                        refreshNotes(backToNotesHome, {
                            require_fresh: true
                        });
                    }
                    this.refreshNotes = refreshNotes;
                    function refreshNotes(cb=null, optional_params) {
                        optional_params = (checkForProperty(optional_params)) ? optional_params : {};
                        optional_params.require_fresh = (checkForProperty(optional_params.require_fresh)) ? optional_params.require_fresh : false;
                        optional_params.max_refresh_checks = (checkForProperty(optional_params.max_refresh_checks)) ? optional_params.max_refresh_checks : 5;
                        let original_hash = active_account.note_obj.hash;
                        let fail_obj = {
                            max_update_checks: 10,
                            update_delay: 300,
                            max_refresh_checks: optional_params.max_refresh_checks,
                            refresh_update_delay: 1000
                        };
                        if (optional_params.require_fresh)
                            waitForLastUpdated();
                        else
                            refreshOnlyIfNeeded();
                        function waitingRefresh() {
                            refresh(waitForFresh);
                        }
                        function waitForFresh() {
                            if (original_hash == active_account.note_obj.hash) {
                                if (--fail_obj.max_refresh_checks >= 0)
                                    window.setTimeout(waitingRefresh, fail_obj.refresh_update_delay);
                                else {
                                    tb_h.newNotification({
                                        msg_html: "Caution! Notes may have updated incorrectly, try again later",
                                        self_remove_ms: 10000,
                                        full_bar_target: true,
                                        custom_bg_color: "#e99a32",
                                        custom_color: "black"
                                    });
                                    resolveCallback();
                                }
                            } else
                                resolveCallback();
                        }
                        function refreshOnlyIfNeeded() {
                            checkIfUpdateNeeded(function(ret) {
                                if (ret)
                                    refresh(resolveCallback);
                                else
                                    resolveCallback();
                            });
                        }
                        function waitForLastUpdated() {
                            checkIfUpdateNeeded(function(ret) {
                                if (ret === true)
                                    waitingRefresh();
                                else {
                                    if (--fail_obj.max_update_checks >= 0)
                                        window.setTimeout(waitForLastUpdated, fail_obj.update_delay);
                                    else
                                        waitingRefresh();
                                }
                            });
                        }
                        function refresh(fresh_cb) {
                            clearActiveNote();
                            active_account.note_obj.note_array = [];
                            active_account.note_obj.last_update = null;
                            active_account.note_obj.update_ele = null;
                            active_account.note_obj.hash = null;
                            active_account.coin_total = null;
                            setActiveUserObj({
                                username: active_account.username,
                                address: active_account.address
                            }, fresh_cb);
                        }
                        function resolveCallback() {
                            if (cb == null)
                                backToNotesHome();
                            else
                                cb();
                        }
                    }
                    function copyNotesAddress(e) {
                        let tc = e.target.innerText;
                        e.target.innerText = "copied!";
                        copy_to_clipboard(active_account.address);
                        window.setTimeout(function() {
                            e.target.innerText = tc;
                        }, 500);
                    }
                    function setReferralContainer() {
                        closeNotesMenu();
                        let new_container = document.createElement("div");
                        new_container.id = "referral_container";
                        var temp = hb.newReferralContainer({
                            address: active_account.address
                        });
                        new_container.innerHTML = temp;
                        document.body.prepend(new_container);
                        document.getElementById("secret_close").addEventListener("click", closeSecretBox);
                        document.getElementById("referral_copy_button").addEventListener("click", copyReferralLink);
                        function closeSecretBox() {
                            document.getElementById("secret_close").removeEventListener("click", closeSecretBox);
                            new_container.remove();
                        }
                        function copyReferralLink() {
                            copy_to_clipboard(document.getElementById("referral_link_text").innerText);
                            let cc = this;
                            let tc = cc.innerText;
                            cc.innerText = "Copied!";
                            window.setTimeout(function() {
                                cc.innerText = tc;
                            }, 1000);
                        }
                    }
                    function setListener(new_listener) {
                        new_listener.action = (checkForProperty(new_listener.action) ? new_listener.action : "click");
                        new_listener.ele.addEventListener(new_listener.action, new_listener.func);
                        active_listeners.push(new_listener);
                    }
                    function removeActiveListeners() {
                        for (var i = 0; i < active_listeners.length; i++)
                            active_listeners[i].ele.removeEventListener(active_listeners[i].action, active_listeners[i].func);
                    }
                    function removeListener(target_listener) {
                        for (var i = 0; i < active_listeners.length; i++) {
                            if (target_listener.ele == active_listeners[i].ele && target_listener.func.name == active_listeners[i].func.name) {
                                active_listeners[i].ele.removeEventListener(active_listeners[i].action, active_listeners[i].func);
                                active_listeners.splice(i, 1);
                                return;
                            }
                        }
                    }
                    function checkLandingInput(e=null, misc_params={}) {
                        if (e != null)
                            e.preventDefault();
                        if (app_obj.active_unlock_attempt === false) {
                            app_obj.active_unlock_attempt = true;
                            var user_input = document.getElementById("landing_input");
                            var params = {
                                username: user_input.value.trim()
                            };
                            if (checkForProperty(misc_params.cred))
                                params.cred = misc_params.cred;
                            if (/\?(su|st|sm)\=/.test(window.location.search))
                                params.shared_note = window.location.pathname + window.location.search;
                            if (params.username != active_account.username && active_account.username != null) {
                                active_account = setNullAccount();
                                window.history.replaceState({}, '', window.location.pathname);
                            }
                            var encoded_material = document.getElementsByClassName("signin_mp_c_input")[0].value.trim();
                            var text_encoder = new TextEncoder();
                            encoded_material = text_encoder.encode(encoded_material).buffer;
                            var passed_note = checkForPassedNote(get_query_strings(true));
                            if (passed_note != null)
                                params.starting_note = passed_note;
                            checkForAccount(params.username, function(ret_param) {
                                if (ret_param != null) {
                                    params.address = ret_param.address;
                                    if (checkForProperty(encoded_material)) {
                                        if (active_account.encrypted_key == null) {
                                            checkForPK(params.address, function(ret) {
                                                if (ret != null) {
                                                    active_account.encrypted_key = ret;
                                                    initIfValidMP(params, active_account.encrypted_key, encoded_material);
                                                } else
                                                    failedLogin(false, true);
                                            });
                                        } else
                                            initIfValidMP(params, active_account.encrypted_key, encoded_material)
                                    } else
                                        failedLogin(true);
                                } else
                                    failedLogin(true);
                            });
                        }
                        function failedLogin(failed_ac=false, failed_pass=false) {
                            if (failed_ac)
                                inputFlash(user_input);
                            if (failed_pass)
                                inputFlash(document.getElementsByClassName("signin_mp_c_input")[0]);
                            app_obj.active_unlock_attempt = false;
                        }
                        function initIfValidMP(params, encrypted_key, encoded_material) {
                            setLoadingScreen(true);
                            checkForEcdhPKs(params.address, function(ecdh_pk_hex, ecdh_pub_hex) {
                                unlockAccount(encrypted_key, ecdh_pk_hex, encoded_material, function(unlocked) {
                                    if (unlocked) {
                                        setTempCredIfNeeded(params);
                                        active_account.ecdh_public = ecdh_pub_hex;
                                        active_account.ecdh_enc_pk = ecdh_pk_hex;
                                        params.force_check = true;
                                        setActiveUserObj(params, function() {
                                            if (checkForProperty(params.starting_note)) {
                                                unlockSingleCheck(params.starting_note, function(success) {
                                                    if (success) {
                                                        setActiveStartingNote(params.starting_note);
                                                        setLoadingScreen(false);
                                                    } else
                                                        vh.setView("notes_home", params);
                                                });
                                            } else {
                                                if (params.shared_note != null)
                                                    setNewNote(params);
                                                else
                                                    vh.setView("notes_home", params);
                                            }
                                        });
                                    } else {
                                        failedLogin(false, true);
                                        setLoadingScreen(false);
                                    }
                                });
                            });
                        }
                        function setTempCredIfNeeded(params) {
                            if (checkForProperty(params.cred)) {
                                if (checkIfTrue(params.cred.not_on_chain))
                                    very_temp_cred = Object.assign({}, params.cred);
                                else
                                    very_temp_cred = Object.assign({
                                        stored: true
                                    }, prepTempCred());
                            }
                        }
                        function unlockSingleCheck(note_id, cb) {
                            var pos = getNoteById(note_id.slice(2));
                            if (pos != null) {
                                attemptUnlock(active_account.note_obj.note_array[pos], function(decrypted_stuff) {
                                    if (decrypted_stuff == null)
                                        cb(false);
                                    else {
                                        decrypted_stuff = parseDecryptedNote(active_account.note_obj.note_array[pos], decrypted_stuff);
                                        cb(true);
                                    }
                                });
                            } else
                                cb(false);
                        }
                    }
                    function checkForEcdhPKs(address, cb) {
                        if (active_account.address != null && active_account.address === address && active_account.ecdh_enc_pk != null && active_account.ecdh_public != null)
                            cb(active_account.ecdh_enc_pk, active_account.ecdh_public);
                        else {
                            checkForEcdhPK(address, function(ecdh_pk) {
                                if (ecdh_pk != null) {
                                    checkForEcdhPub(address, function(ecdh_pub) {
                                        if (ecdh_pub != null)
                                            cb(hexToArrayBuffer(ecdh_pk, Uint8Array).buffer, hexToArrayBuffer(ecdh_pub, Uint8Array).buffer);
                                        else
                                            cb(null);
                                    });
                                } else
                                    cb(null);
                            });
                        }
                    }
                    function findNoteId(note_id) {
                        for (var i = 0; i < active_account.note_obj.note_array.length; i++) {
                            if (active_account.note_obj.note_array[i].id == note_id)
                                return i;
                        }
                        return null;
                    }
                    function publishNote(address, pos=null, cb) {
                        var valid_address = address;
                        var note_num = pos;
                        pos = (pos == null) ? null : pos.toString(16);
                        var title = prepTitle(document.getElementById("user_note_titlebox").value.trim());
                        setLoadingScreen(true);
                        getCurrentNote(title, function(encrypted_data) {
                            if (encrypted_data) {
                                if (note_num != null)
                                    var id = active_account.note_obj.note_array[note_num].id;
                                else
                                    var id = decimalTo2cHex(Date.now());
                                encrypted_data = convertToBnNote(encrypted_data, id);
                                var masked_pointer_array = [0];
                                if (pos == null) {
                                    var ret = prep_setUserBytes(encrypted_data);
                                } else {
                                    var ret = prep_setBytes(pos, encrypted_data);
                                }
                                var trans_obj = {
                                    fcn_call: ret.fcn_call,
                                    fcn_params: ret.fcn_params,
                                    masked_pointer_array: masked_pointer_array,
                                    user_address: valid_address,
                                    contract_address: active_contract.address,
                                    custom_title: "Save Note",
                                    tax_rate: app_obj.tax_rate,
                                    fcn_params_pos: 1,
                                };
                                if (pos != null) {
                                    trans_obj.final_check_fcn = pre_finalCheckLastUpdate,
                                    preTransHandlerPositionCheck(trans_obj, publishNoteResults);
                                } else
                                    th.newTransactionPreview(trans_obj, publishNoteResults);
                            }
                        });
                        function publishNoteResults(tx_address) {
                            var scan_url = active_contract.scan_url + "tx/" + tx_address;
                            var params = {
                                success_icon: hb.getSvg("bitnote_lock", {
                                    id: "results_bitnote_svg"
                                }),
                                success_title: "<h5>Your note is now safely stored on the Avalanche Blockchain</h5>",
                                success_msg: "",
                                container_width: "475px",
                                hide_skip: true,
                            };
                            handleResults(tx_address, params);
                        }
                    }
                    function prep_setUserBytes(encrypted_data) {
                        var fcn_params = [getBytesIndex(encrypted_data), encrypted_data];
                        var fcn_call = "setUserBytes(bytes32,bytes)";
                        return {
                            fcn_params,
                            fcn_call
                        };
                    }
                    function prep_setBytes(current_pos, encrypted_data) {
                        var current_index = getIndexFromPosition(current_pos);
                        var fcn_params = [current_index, encrypted_data];
                        var fcn_call = "setBytes(bytes32,bytes)";
                        return {
                            fcn_params,
                            fcn_call
                        };
                    }
                    function getIndexFromPosition(position) {
                        return active_account.active_note_index;
                    }
                    function getBytesIndex(ed) {
                        return kh.keccak256(ed).slice(2);
                    }
                    function prep_setBytesMulti(encrypted_data) {
                        var indexes = [];
                        for (var i = 0; i < encrypted_data.length; i++)
                            indexes.push(getBytesIndex(encrypted_data[i]));
                        var fcn_params = [indexes, encrypted_data];
                        var fcn_call = "setBytesMulti(bytes32[],bytes[])";
                        return {
                            fcn_params,
                            fcn_call
                        };
                    }
                    function publishNotesTransaction(encrypted_data, pos=null, custom_title="Save Note", cb) {
                        if (pos == null) {
                            if (Array.isArray(encrypted_data)) {
                                var trans_obj = [];
                                for (var i = 0; i < encrypted_data.length; i++) {
                                    if (Array.isArray(encrypted_data[i])) {
                                        var ret = prep_setBytesMulti(encrypted_data[i]);
                                    } else {
                                        var ret = prep_setUserBytes(encrypted_data);
                                    }
                                    var new_trans = prep_singleNoteTransaction(ret.fcn_params, ret.fcn_call);
                                    trans_obj.push(new_trans);
                                }
                            } else {
                                var trans_obj = prep_singleNoteTransaction(fcn_params, fcn_call);
                            }
                            th.newTransactionPreview(trans_obj, cb);
                        } else {
                            trans_obj.final_check_fcn = pre_finalCheckLastUpdate,
                            preTransHandlerPositionCheck(trans_obj, cb);
                        }
                        function prep_singleNoteTransaction(fcn_params, fcn_call) {
                            return {
                                fcn_call: fcn_call,
                                fcn_params: fcn_params,
                                user_address: active_account.address,
                                contract_address: active_contract.address,
                                custom_title: custom_title,
                                tax_rate: app_obj.tax_rate,
                                fcn_params_pos: 1,
                            };
                        }
                    }
                    function preTransHandlerPositionCheck(trans_obj, cb_target) {
                        finalCheckLastUpdate(function(ret, last_update) {
                            if (ret == false) {
                                replaceActiveNote(function(new_pos) {
                                    if (new_pos != null) {
                                        tb_h.newNotification({
                                            msg_html: "Warning! You're potentially overwriting a newer version",
                                            self_remove_ms: 10000,
                                            full_bar_target: true,
                                            custom_bg_color: "#e99a32",
                                            custom_color: "black"
                                        });
                                        trans_obj.fcn_params[trans_obj.fcn_params_pos] = new_pos.toString(16);
                                        th.newTransactionPreview(trans_obj, cb_target);
                                    } else {
                                        setLoadingScreen(false);
                                        tb_h.newNotification({
                                            msg_html: "Error! Note not found on chain",
                                            self_remove_ms: 5000,
                                            full_bar_target: true,
                                            custom_bg_color: "#e93232",
                                            custom_color: "black"
                                        });
                                    }
                                });
                            } else
                                th.newTransactionPreview(trans_obj, cb_target);
                        });
                    }
                    function multiHandleResults(tx_address_array, params={}, custom_cb=null) {
                        let done_selected = false;
                        let result_done_button;
                        let reamining_transactions = tx_address_array.length;
                        if (tx_address_array.length > 0) {
                            clearLastUpdated();
                            main_container.innerHTML = hb.multiWaitForResults(reamining_transactions);
                            result_done_button = document.getElementById("results_done_button");
                            document.getElementById("results_main_icon_container").append(getLoadingIcon("results_loading_icon"));
                            if (checkForProperty(params.hide_skip) && params.hide_skip)
                                result_done_button.style.display = "none";
                            else
                                document.getElementById("result_done_button").addEventListener("click", doneSelected);
                            customContainerWidth(params.container_width);
                            multiConfirmReceipt(tx_address_array, 50, transactionsComplete);
                        }
                        function transactionsComplete() {
                            if (!done_selected) {
                                result_done_button.style.display = null;
                                result_done_button.removeEventListener("click", doneSelected);
                                result_done_button.addEventListener("click", callbackOnDone);
                                result_done_button.focus();
                                params.success_icon = (checkForProperty(params.success_icon)) ? params.success_icon : '<svg viewBox="0 0 7 7" class="results_success_svg"><rect width="1" height="1" x="0" y="3"/><rect width="1" height="1" x="1" y="4"/><rect width="1" height="1" x="2" y="5"/><rect width="1" height="1" x="3" y="4"/><rect width="1" height="1" x="4" y="3"/><rect width="1" height="1" x="5" y="2"/><rect width="1" height="1" x="6" y="1"/></svg>';
                                params.success_title = (checkForProperty(params.success_title)) ? params.success_title : "<h5>Success!</h5>";
                                document.getElementById("results_main_icon_container").innerHTML = params.success_icon;
                                document.getElementById("results_msg_container").innerHTML = params.success_title + params.success_msg;
                            }
                            function callbackOnDone() {
                                result_done_button.removeEventListener("click", callbackOnDone);
                                if (custom_cb != null)
                                    custom_cb();
                                else
                                    refreshNotesClickQuick();
                            }
                        }
                        function customContainerWidth(width) {
                            if (checkForProperty(width))
                                document.getElementById("results_inner_container").style.width = width;
                        }
                        function doneSelected(e) {
                            if (!done_selected) {
                                done_selected = true;
                                backToNotesHome();
                            }
                        }
                    }
                    function handleResults(tx_address, params={}) {
                        let done_selected = false;
                        let result_done_button;
                        if (tx_address != null) {
                            clearLastUpdated();
                            let scan_url = active_contract.scan_url + "tx/" + tx_address;
                            main_container.innerHTML = hb.newWaitForResults(scan_url);
                            result_done_button = document.getElementById("results_done_button");
                            document.getElementById("results_main_icon_container").append(getLoadingIcon("results_loading_icon"));
                            if (checkForProperty(params.hide_skip) && params.hide_skip)
                                result_done_button.style.display = "none";
                            else
                                setListener({
                                    ele: result_done_button,
                                    func: doneSelected
                                });
                            customContainerWidth(params.container_width);
                            confirmReceipt(tx_address, 50, function(ret) {
                                if (!done_selected) {
                                    result_done_button.style.display = null;
                                    removeListener({
                                        ele: result_done_button,
                                        func: doneSelected
                                    });
                                    setListener({
                                        ele: result_done_button,
                                        func: refreshNotesClickQuick
                                    });
                                    result_done_button.focus();
                                    if (ret != null) {
                                        params.success_icon = (checkForProperty(params.success_icon)) ? params.success_icon : '<svg viewBox="0 0 7 7" class="results_success_svg"><rect width="1" height="1" x="0" y="3"/><rect width="1" height="1" x="1" y="4"/><rect width="1" height="1" x="2" y="5"/><rect width="1" height="1" x="3" y="4"/><rect width="1" height="1" x="4" y="3"/><rect width="1" height="1" x="5" y="2"/><rect width="1" height="1" x="6" y="1"/></svg>';
                                        params.success_title = (checkForProperty(params.success_title)) ? params.success_title : "<h5>Success!</h5>";
                                        document.getElementById("results_main_icon_container").innerHTML = params.success_icon;
                                        document.getElementById("results_msg_container").innerHTML = params.success_title + params.success_msg;
                                    }
                                }
                            });
                        }
                        function customContainerWidth(width) {
                            if (checkForProperty(width))
                                document.getElementById("results_inner_container").style.width = width;
                        }
                        function doneSelected(e) {
                            if (!done_selected) {
                                done_selected = true;
                                backToNotesHome();
                            }
                        }
                    }
                    function getLoadingIcon(add_class) {
                        var new_ele = document.createElement("div");
                        new_ele.classList.add(add_class);
                        setImageMask(new_ele, loading_icon_b64);
                        return new_ele;
                    }
                    function multiConfirmReceipt(receipt_array, total_reattempt_count=50, cb) {
                        let ret_array = [];
                        let success_countdown = receipt_array.length;
                        let max_active = 2;
                        var initial_delay = 1000;
                        window.setTimeout(checkStarter, initial_delay);
                        receipt_array.reverse();
                        function checkStarter() {
                            for (var i = 0; i < max_active; i++) {
                                nextReceipt();
                            }
                        }
                        function nextReceipt() {
                            if (success_countdown <= 0 && receipt_array.length === 0)
                                triggerCallback();
                            else if (success_countdown > 0 && receipt_array.length > 0) {
                                document.getElementById("multi_transaction_wait").innerText = receipt_array.length;
                                var next_receipt = receipt_array.pop();
                                if (checkForProperty(next_receipt)) {
                                    checkReceipt(next_receipt, function(ret) {
                                        if (checkForProperty(ret)) {
                                            ret_array.push(ret);
                                            success_countdown--;
                                        }
                                        nextReceipt();
                                    });
                                } else
                                    nextReceipt();
                            }
                        }
                        function triggerCallback() {
                            if (cb != null) {
                                cb(ret_array);
                                cb = null;
                            }
                        }
                        function checkReceipt(receipt, inner_cb) {
                            let fail_delay = 500;
                            var reattempt_count = total_reattempt_count;
                            let increment_delay_thresh = reattempt_count - 10;
                            (function checkIt() {
                                xhr_h_chain.sendXHR({
                                    asserted_status: 200,
                                    api: active_contract.rpc_list,
                                    params: {
                                        jsonrpc: "2.0",
                                        method: "eth_getTransactionReceipt",
                                        params: [receipt]
                                    },
                                }, function(res) {
                                    if (res.valid) {
                                        var ret = JSON.parse(res.response);
                                        if (ret.result == null || ret.result.status != "0x1") {
                                            reattempt_count--;
                                            if (reattempt_count > 0) {
                                                if (reattempt_count < increment_delay_thresh)
                                                    fail_delay += 1000;
                                                window.setTimeout(checkIt, fail_delay);
                                            } else
                                                inner_cb(null);
                                        } else
                                            inner_cb(ret.result);
                                    } else
                                        inner_cb(null);
                                });
                            }
                            )();
                        }
                    }
                    function confirmReceipt(receipt, reattempt_count=50, cb) {
                        let fail_delay = 500;
                        if (reattempt_count <= 0)
                            reattempt_count = 50;
                        let increment_delay_thresh = reattempt_count - 10;
                        window.setTimeout(checkReceipt, fail_delay);
                        function checkReceipt() {
                            xhr_h_chain.sendXHR({
                                asserted_status: 200,
                                api: active_contract.rpc_list,
                                params: {
                                    jsonrpc: "2.0",
                                    method: "eth_getTransactionReceipt",
                                    params: [receipt]
                                },
                            }, function(res) {
                                if (res.valid) {
                                    var ret = JSON.parse(res.response);
                                    if (ret.result == null || ret.result.status != "0x1") {
                                        reattempt_count--;
                                        if (reattempt_count > 0) {
                                            if (reattempt_count < increment_delay_thresh)
                                                fail_delay += 1000;
                                            window.setTimeout(checkReceipt, fail_delay);
                                        } else
                                            cb(null);
                                    } else {
                                        cb(ret.result);
                                    }
                                } else
                                    cb(null);
                            });
                        }
                        ;
                    }
                    function pre_finalCheckLastUpdate(cb) {
                        finalCheckLastUpdate(function(res) {
                            if (res === false)
                                tb_h.newNotification({
                                    msg_html: "Error handling note. Please try again",
                                    self_remove_ms: 5000,
                                    full_bar_target: true,
                                    custom_bg_color: "#e93232",
                                    custom_color: "black"
                                });
                            cb(res);
                        });
                    }
                    this.finalCheckLastUpdate = finalCheckLastUpdate;
                    function finalCheckLastUpdate(cb) {
                        checkLastUpdate(function(last_update) {
                            if (active_account.note_obj.last_update >= last_update)
                                cb(true);
                            else
                                cb(false);
                        });
                    }
                    this.checkLastUpdate = checkLastUpdate;
                    function checkLastUpdate(cb=null) {
                        var cpe = new contract_param_encoder();
                        var fcn_call = "getLastUpdate(address)";
                        var param_str = cpe.getEncoded([active_account.address], cpe.getHeaderArray(fcn_call));
                        param_str = cpe.combineParams(param_str);
                        var func_str = getFunctionStr(genFunctionHash(fcn_call), param_str);
                        miscFunctionCall(func_str, active_contract.address, active_contract.rpc_list, function(res) {
                            if (checkForProperty(res)) {
                                var tc = hexToBigInt(res);
                                if (cb != null)
                                    cb(tc);
                            }
                        });
                    }
                    this.clearLastUpdated = clearLastUpdated;
                    function clearLastUpdated() {
                        var last_updates_watcher = watcher_h.getWatcherIdsByTag("last_update_watcher");
                        if (last_updates_watcher.length > 0)
                            watcher_h.destroyWatchers(last_updates_watcher);
                        active_account.note_obj.last_update = null;
                        if (active_account.note_obj.update_ele != null) {
                            active_account.note_obj.update_ele.clear();
                            active_account.note_obj.update_ele = null;
                        }
                    }
                }
                function checkForAccount(user_input, cb) {
                    var params = {};
                    if (validAddress(user_input)) {
                        params.address = user_input;
                        cb(params);
                    } else if (active_account.username != null && user_input == active_account.username) {
                        params.address = active_account.address;
                        cb(params);
                    } else {
                        params.username = user_input;
                        getAddressLink(user_input, function(address) {
                            if (address == null)
                                cb(null);
                            else {
                                active_account.username = user_input;
                                active_account.address = address;
                                params.address = address;
                                cb(params);
                            }
                        });
                    }
                }
                function getAddressLink(input_msg, cb) {
                    var cpe = new contract_param_encoder();
                    var fcn_call = "getAddressLink(bytes32)";
                    var hex_param = kh.keccak256(input_msg);
                    var param_str = cpe.getEncoded([hex_param], cpe.getHeaderArray(fcn_call));
                    param_str = cpe.combineParams(param_str);
                    var func_str = getFunctionStr(genFunctionHash(fcn_call), param_str);
                    miscFunctionCall(func_str, current_mod_contract, active_contract.rpc_list, function(res) {
                        if (checkForProperty(res)) {
                            var decoded_ret = decodeParams("address", res);
                            if (checkForProperty(decoded_ret[0].data) && decoded_ret[0].data != "0000000000000000000000000000000000000000000000000000000000000000") {
                                cb("0x" + decoded_ret[0].data.slice(24));
                                return;
                            }
                        }
                        cb(null);
                    });
                }
                function getCurrentNote(pre_enc_title="", cb) {
                    var text_encoder = new TextEncoder();
                    var msg_buff = pre_enc_title + document.getElementById("user_note_textbox").value.trim();
                    var ecdh_pub = active_account.ecdh_public.slice();
                    ecdhEncrypt({
                        msg_buff,
                        ecdh_pub
                    }, cb);
                }
                function convertToBnNote(encrypted_hex, id=null) {
                    var salt = encrypted_hex.slice(0, 24);
                    encrypted_hex = encrypted_hex.slice(24);
                    var id = (id === null) ? decimalTo2cHex(Date.now()) : id;
                    return salt + id + encrypted_hex;
                }
                function getDecryptedPK(encrypted_msg, salt, cb) {
                    var iterations = 1000000;
                    var new_salt = hexToArrayBuffer(salt, Uint8Array);
                    var new_encrypted_msg = hexToArrayBuffer(encrypted_msg, Uint8Array);
                    getEncodedMaterial(1, {
                        alert_msg: ["Master Password:"],
                        submit_label: "Unlock",
                        placeholder: "Enter Master Password",
                        biometrics: {
                            label: "Log in with Security",
                            handler: biometricsHandlerForAlerts
                        }
                    }, function(encoded_material) {
                        if (checkForProperty(encoded_material)) {
                            setLoadingScreen(true);
                            eh.defaultDeriveKey(encoded_material, iterations, new_salt, function(key) {
                                eh.noDecodeDecrypt(key, new_encrypted_msg, new_salt, function(decrypted_stuff) {
                                    if (decrypted_stuff == null) {
                                        setLoadingScreen(false);
                                        getDecryptedPK(encrypted_msg, salt, cb);
                                        inputFlash(document.getElementById("alerts_input_box"), 750);
                                    } else {
                                        decrypted_stuff = "0x" + bufferToHex(decrypted_stuff);
                                        setLoadingScreen(false);
                                        cb(decrypted_stuff);
                                    }
                                });
                            });
                        } else
                            cb(null);
                    });
                }
                function biometricsHandlerForAlerts(alerts_cb) {
                    var prf_obj = getPrfObject();
                    biometrics_h.biometricsClick(prf_obj, function(key_mat, cred) {
                        convertBioRet(key_mat, cred, function(ret_key) {
                            if (checkForProperty(ret_key))
                                alerts_cb(new TextDecoder().decode(ret_key));
                        });
                    });
                }
                function convertBioRet(key_mat, cred, cb) {
                    getSecKey(key_mat, cred.misc_data, cb);
                    function getSecKey(key_buff, msg_buff, cb) {
                        var msg_param = {
                            msg_type: "decrypt_mp",
                            key_buff: key_buff,
                            msg_buff: msg_buff,
                        };
                        var transfer_array = [msg_param.key_buff, msg_param.msg_buff];
                        ww_h.sendMessageToWorker(msg_param, transfer_array, cb);
                    }
                }
                function unlockAccount(encrypted_key, ecdh_pk, encoded_material, cb) {
                    ww_h.sendMessageToWorker({
                        msg_type: "set_mp",
                        key_buff: encoded_material
                    }, [encoded_material], function(success) {
                        if (success)
                            attemptDecrypt(encrypted_key, ecdh_pk, cb);
                        else
                            cb(false);
                    });
                }
                function attemptDecrypt(encrypted_key, encrypted_ecdh, cb) {
                    var salt_byte_len = 12;
                    var salt_hex_len = 24;
                    var cipher_buff = hexToArrayBuffer(encrypted_key.slice(salt_hex_len), Uint8Array).buffer;
                    var salt_buff = hexToArrayBuffer(encrypted_key.slice(0, salt_hex_len), Uint8Array).buffer;
                    var ecdh_buff = encrypted_ecdh.slice(salt_byte_len);
                    var ecdh_salt_buff = encrypted_ecdh.slice(0, salt_byte_len);
                    var msg_param = {
                        msg_type: "unlock_ac",
                        cipher_buff: cipher_buff,
                        salt_buff: salt_buff,
                        ecdh_buff: ecdh_buff,
                        ecdh_salt_buff: ecdh_salt_buff,
                    };
                    var transfer_array = [msg_param.cipher_buff, msg_param.salt_buff, msg_param.ecdh_buff, msg_param.ecdh_salt_buff];
                    ww_h.sendMessageToWorker(msg_param, transfer_array, cb);
                }
                function parseDecryptedNote(current_note, decrypted_stuff) {
                    if (checkForProperty(current_note)) {
                        var anchor_point = decrypted_stuff.indexOf(String.fromCodePoint(216));
                        var title = decrypted_stuff.slice(0, anchor_point);
                        decrypted_stuff = decrypted_stuff.slice(anchor_point + 1);
                        current_note.title = title;
                        current_note.decrypted = decrypted_stuff;
                        return current_note;
                    } else
                        return null;
                }
                function ecdhDecrypt(params, cb, custom_decoder=null) {
                    var msg_param = {
                        msg_type: "ecdh_de",
                        msg_buff: params.msg_buff,
                        ecdh_pub: params.ecdh_pub
                    };
                    var transfer_array = [msg_param.msg_buff, msg_param.ecdh_pub];
                    if (checkForProperty(params.ecdh_pk_buff)) {
                        msg_param.ecdh_pk_buff = params.ecdh_pk_buff;
                        transfer_array.push(msg_param.ecdh_pk_buff);
                    }
                    if (checkForProperty(params.aad)) {
                        transfer_array.push(params.aad);
                        msg_param.aad = params.aad;
                    }
                    ww_h.sendMessageToWorker(msg_param, transfer_array, function(ret) {
                        if (ret != null)
                            noteDecoder(ret.decrypted_buff, cb);
                        else
                            cb(null);
                    });
                }
                function ecdhEncrypt(params, cb) {
                    noteEncoder(params.msg_buff, encryptMessage);
                    function encryptMessage(msg_buff) {
                        var msg_param = {
                            msg_type: "ecdh_enc",
                            msg_buff: msg_buff,
                            ecdh_pub: params.ecdh_pub
                        };
                        var transfer_array = [msg_param.msg_buff, msg_param.ecdh_pub];
                        if (checkForProperty(params.ecdh_pk_buff)) {
                            msg_param.ecdh_pk_buff = params.ecdh_pk_buff;
                            transfer_array.push(msg_param.ecdh_pk_buff);
                        }
                        if (checkForProperty(params.aad)) {
                            transfer_array.push(params.aad);
                            msg_param.aad = params.aad;
                        }
                        ww_h.sendMessageToWorker(msg_param, transfer_array, function(ret) {
                            if (ret != null)
                                cb(bufferToHex(ret.salt_buff) + bufferToHex(ret.encrypted_buff));
                            else
                                cb(null);
                        });
                    }
                }
                function noteEncoder(note_text, cb) {
                    compressor(note_text, true, cb);
                }
                function noteDecoder(note_text, cb) {
                    compressor(note_text, false, function(decompressed_text) {
                        cb(new TextDecoder().decode(decompressed_text));
                    });
                }
                function compressor(text, compress=true, cb) {
                    var cs;
                    var enc_alg = "deflate-raw";
                    if (compress) {
                        cs = new CompressionStream(enc_alg);
                        text = new TextEncoder().encode(text);
                    } else
                        cs = new DecompressionStream(enc_alg);
                    const writer = cs.writable.getWriter();
                    writer.write(text);
                    writer.close();
                    const chunks = [];
                    const reader = cs.readable.getReader();
                    (function readNext() {
                        reader.read().then(function(result) {
                            if (!result.done) {
                                chunks.push(result.value);
                                readNext();
                            } else
                                cb((new Uint8Array(chunks.reduce((acc,val)=>acc.concat(Array.from(val)), []))).buffer);
                        });
                    }
                    )();
                }
                function bufferToHex(buffer) {
                    return [...new Uint8Array(buffer)].map(b=>b.toString(16).padStart(2, "0")).join("");
                }
                function validHexStr(str) {
                    if (/^(0x){0,1}[0-9a-f]+$/i.test(str))
                        return true;
                    else
                        return false;
                }
            }
            function setLoadingScreen(set_to=true, ms_delay=null, allow_cancel_ms=null, cb=null) {
                ls_h.setLoading(set_to, ms_delay, allow_cancel_ms, cb);
            }
            function setLoadingWithMsg(msg="") {
                ls_h.newSetLoading(true, msg);
            }
            function getRandomString(size) {
                var random_str = "";
                var array = new Uint8Array(size);
                self.crypto.getRandomValues(array);
                var char_str = "!#$%&()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ^_abcdefghijklmnopqrstuvwxyz|~";
                for (var i = 0; i < array.length; i++)
                    random_str += char_str.charAt(array[i] % char_str.length);
                random_str = random_str.trim();
                return random_str;
            }
            function getRandomHexString(size) {
                var random_str = "";
                var array = new Uint8Array(size);
                self.crypto.getRandomValues(array);
                var char_str = "0123456789abcdef";
                for (var i = 0; i < array.length; i++)
                    random_str += char_str.charAt(array[i] % char_str.length);
                random_str = random_str.trim();
                return random_str;
            }
            function getRandomPhrase(size) {
                var temp_list = WORDLISTS['english'].slice();
                var random_str = "";
                var array = new Uint16Array(size);
                self.crypto.getRandomValues(array);
                for (var i = 0; i < array.length; i++) {
                    var rand = array[i] % temp_list.length;
                    random_str += temp_list[rand] + " ";
                }
                return random_str.trim();
            }
            function genNewAc(cb) {
                getRandomPk(function(new_keys) {
                    var pk_buff = new_keys.pk_buff;
                    var pub_buff = new_keys.pub_buff;
                    var pub_hex = bufferToHex(pub_buff);
                    pub_hex = pub_hex.slice(2);
                    var address = kh.keccak256("0x" + pub_hex);
                    address = address.slice(-40);
                    var new_pk_obj = {
                        priv_key: "0x" + bufferToHex(pk_buff),
                        pub_key: "0x" + bufferToHex(pub_buff),
                        address: "0x" + address
                    };
                    cb("Private key:\n" + new_pk_obj.priv_key + "\n\nAddress:\n" + new_pk_obj.address + "\n");
                });
            }
            function getRandomPk(cb) {
                ww_h.sendMessageToWorker({
                    msg_type: "new_key_pair"
                }, [], cb);
            }
            function msToShortDate(time_ms, full=true) {
                var nd = (time_ms != null) ? new Date(time_ms) : new Date(Date.now());
                var ret = fd(nd.getMonth() + 1) + "/" + fd(nd.getDate());
                if (full)
                    ret += "-" + fd(nd.getHours()) + ":" + fd(nd.getMinutes());
                return ret;
                function fd(value) {
                    return (value > 9) ? value : "0" + value;
                }
            }
            function msToTimestamp(time_ms, full=true) {
                var nd = (time_ms != null) ? new Date(time_ms) : new Date(Date.now());
                var ret = nd.getFullYear() + "/" + fd(nd.getMonth() + 1) + "/" + fd(nd.getDate());
                if (full)
                    ret += "-" + fd(nd.getHours()) + ":" + fd(nd.getMinutes());
                return ret;
                function fd(value) {
                    return (value > 9) ? value : "0" + value;
                }
            }
            function setImageMask(ele, path) {
                ele.style.webkitMaskImage = "url(" + path + ")";
                ele.style.maskImage = "url(" + path + ")";
            }
            function getPkCall(address, contract_address, cb) {
                var fcn_call, param_str;
                var cpe = new contract_param_encoder();
                var ret_str = "";
                fcn_call = "getString(address)";
                param_str = cpe.getEncoded([address], cpe.getHeaderArray(fcn_call));
                param_str = cpe.combineParams(param_str);
                var func_str = getFunctionStr(genFunctionHash(fcn_call), param_str);
                miscFunctionCall(func_str, contract_address, active_contract.rpc_list, cb);
            }
            function getNotesCall(address, pos=null, cb) {
                var fcn_call, param_str;
                var cpe = new contract_param_encoder();
                var ret_str = "";
                if (pos != null) {
                    fcn_call = "getStrings(address,uint256)";
                    pos = parseInt(pos).toString(16);
                    param_str = cpe.getEncoded([address, pos], cpe.getHeaderArray(fcn_call));
                } else {
                    fcn_call = "getUserBytes(address)";
                    param_str = cpe.getEncoded([address], cpe.getHeaderArray(fcn_call));
                }
                param_str = cpe.combineParams(param_str);
                var func_str = getFunctionStr(genFunctionHash(fcn_call), param_str);
                miscFunctionCall_single(func_str, active_contract.address, active_contract.rpc_list, cb);
            }
            function getActiveQueryParams() {
                var ret_str = "";
                for (var i = 0; i < active_url_paths.param_array.length; i++)
                    ret_str += active_url_paths.param_array[i].query_str + ((i + 1 < active_url_paths.param_array.length) ? "&" : "");
                return (ret_str != "") ? "?" + ret_str : "";
            }
            function setNewQueryParam(type, value) {
                for (var i = 0; i < active_url_paths.param_array.length; i++) {
                    if (type == active_url_paths.param_array[i].type) {
                        if (value == null)
                            active_url_paths.param_array.splice(i, 1);
                        else
                            active_url_paths.param_array[i] = setParam();
                        return;
                    }
                }
                if (value != null)
                    active_url_paths.param_array.push(setParam());
                function setParam() {
                    return {
                        value: value,
                        type: type,
                        query_str: (getParamVarName(type) + value)
                    };
                }
                function getParamVarName(type) {
                    switch (type) {
                    case "note":
                        return "n_";
                    case "contract":
                        return "c_";
                    case "note_id":
                        return "0x";
                    }
                }
            }
            function emptyUrlPaths() {
                return {
                    username: null,
                    param_array: []
                };
            }
            function buildCurrentUrl() {
                var ret_path = '/';
                if (active_url_paths.username != null)
                    ret_path += active_url_paths.username + '/';
                ret_path += getActiveQueryParams();
                return ret_path;
            }
            function updateUrlPath() {
                var new_path = buildCurrentUrl();
                history.pushState({}, '', new_path);
            }
            function clearUrlPath(preserve_query=false) {
                active_url_paths = emptyUrlPaths();
                history.replaceState({}, '', '/');
            }
            function miscFunctionCall(fn_data, contract_address, rpc_url, cb) {
                xhr_h_chain.sendXHR({
                    asserted_status: 200,
                    api: rpc_url,
                    params: {
                        jsonrpc: "2.0",
                        method: "eth_call",
                        params: [{
                            data: fn_data,
                            to: contract_address
                        }, "latest"]
                    },
                }, function(res) {
                    if (checkForProperty(res.valid)) {
                        var ret = JSON.parse(res.response);
                        cb(ret.result);
                    } else
                        cb(null);
                });
            }
            function miscFunctionCall_single(fn_data, contract_address, rpc_url, cb) {
                xhr_h_chain.sendXHR({
                    multi_send_count: 1,
                    asserted_status: 200,
                    api: rpc_url,
                    params: {
                        jsonrpc: "2.0",
                        method: "eth_call",
                        params: [{
                            data: fn_data,
                            to: contract_address
                        }, "latest"]
                    },
                }, function(res) {
                    if (checkForProperty(res.valid)) {
                        var ret = JSON.parse(res.response);
                        cb(ret.result);
                    } else
                        cb(null);
                });
            }
            function getEncodedMaterial(confirm_req=2, alert_params=null, cb) {
                var default_params = {
                    alert_msg: ["Note Password:", "Confirm Note Password:"],
                    submit_label: "Unlock",
                    simple_close: false
                };
                alert_params = (alert_params == null) ? default_params : alert_params;
                alert_params.confirm_req = confirm_req;
                var text_encoder = new TextEncoder();
                alerts_h.setAlert("hidden_input", alert_params, function(res) {
                    if (res == null)
                        cb(null);
                    else
                        cb(text_encoder.encode(res));
                });
            }
            function getCustomEncodedMaterial(confirm_req=2, alert_params=null, cb) {
                var default_params = {
                    alert_msg: ["Note Password:", "Confirm Note Password:"],
                    submit_label: "Unlock",
                    simple_close: false
                };
                alert_params = (alert_params == null) ? default_params : alert_params;
                alert_params.confirm_req = confirm_req;
                var text_encoder = new TextEncoder();
                alerts_h.setAlert("custom_bitnote_1", alert_params, function(res) {
                    if (res == null)
                        cb(null);
                    else
                        cb(text_encoder.encode(res));
                });
            }
            function HACKYFIXFORNOW(fcn_params) {
                for (var i = 0; i < fcn_params.length; i++) {
                    if (fcn_params[i].array_count >= 1)
                        fcn_params[i].dynamic = true;
                }
                return fcn_params;
            }
            function decodeParams(param_headers, param_str) {
                var cpe = new contract_param_encoder();
                var data = param_str;
                var fcn_ret_types = param_headers;
                if (checkForProperty(fcn_ret_types)) {
                    fcn_ret_types = findTuples(fcn_ret_types);
                    fcn_ret_types = fcn_ret_types.replace(/\s*/g, "");
                    fcn_ret_types = fcn_ret_types.split(",");
                    fcn_ret_types = cpe.getTypeDataFromHeaders(fcn_ret_types);
                    if (checkForProperty(fcn_ret_types)) {
                        var decoded_array = cpe.getDecoded(data, fcn_ret_types);
                        return decoded_array;
                    }
                }
                return null;
            }
            function findTuples(header_str) {
                var tuples = header_str.match(/\(.+\)/);
                if (tuples != null) {
                    for (var i = 0; i < tuples.length; i++) {
                        var new_tup = tuples[i].replace(/,/g, "__");
                        header_str = header_str.replace(tuples[i], new_tup);
                    }
                }
                return header_str;
            }
            function prepTitle(title) {
                return title + String.fromCodePoint(216);
            }
            function checkForEcdhPK(address, cb) {
                var cpe = new contract_param_encoder();
                var fcn_call = "getPrivString(address)";
                var param_str = cpe.getEncoded([address], cpe.getHeaderArray(fcn_call));
                param_str = cpe.combineParams(param_str);
                var func_str = getFunctionStr(genFunctionHash(fcn_call), param_str);
                miscFunctionCall(func_str, current_mod_contract, active_contract.rpc_list, function(res) {
                    if (checkForProperty(res)) {
                        var decoded_ret = decodeParams("bytes", res);
                        if (checkForProperty(decoded_ret[0].data)) {
                            cb(decoded_ret[0].data);
                            return;
                        }
                    }
                    cb(null);
                });
            }
            function checkForEcdhPub(address, cb) {
                var cpe = new contract_param_encoder();
                var fcn_call = "getPubString(address)";
                var param_str = cpe.getEncoded([address], cpe.getHeaderArray(fcn_call));
                param_str = cpe.combineParams(param_str);
                var func_str = getFunctionStr(genFunctionHash(fcn_call), param_str);
                miscFunctionCall(func_str, current_mod_contract, active_contract.rpc_list, function(res) {
                    if (checkForProperty(res)) {
                        var decoded_ret = decodeParams("bytes", res);
                        if (checkForProperty(decoded_ret[0].data)) {
                            cb(decoded_ret[0].data);
                            return;
                        }
                    } else
                        cb(null);
                });
            }
            function checkForPK(address, cb) {
                var cpe = new contract_param_encoder();
                var fcn_call = "getString(address)";
                var param_str = cpe.getEncoded([address], cpe.getHeaderArray(fcn_call));
                param_str = cpe.combineParams(param_str);
                var func_str = getFunctionStr(genFunctionHash(fcn_call), param_str);
                miscFunctionCall(func_str, current_mod_contract, active_contract.rpc_list, function(res) {
                    if (checkForProperty(res)) {
                        var decoded_ret = decodeParams("bytes", res);
                        if (checkForProperty(decoded_ret[0].data)) {
                            cb(decoded_ret[0].data);
                            return;
                        }
                    }
                    cb(null);
                });
            }
            function oldCheckForPK(address, cb) {
                var cpe = new contract_param_encoder();
                var fcn_call = "getStrings(address,uint256)";
                var param_str = cpe.getEncoded([address, "0"], cpe.getHeaderArray(fcn_call));
                param_str = cpe.combineParams(param_str);
                var func_str = getFunctionStr(genFunctionHash(fcn_call), param_str);
                miscFunctionCall(func_str, active_contract.address, active_contract.rpc_list, function(res) {
                    if (checkForProperty(res)) {
                        var decoded_ret = decodeParams("bytes", res);
                        if (checkForProperty(decoded_ret[0].data)) {
                            cb(decoded_ret[0].data);
                            return;
                        }
                    }
                    cb(null);
                });
            }
            function getPrfObject(id=null, first_data="bitnote.xyz", second_data="bitnote.xyz") {
                return {
                    id: (checkForProperty(id)) ? id : null,
                    first: hexToArrayBuffer(kh.keccak256(first_data), Uint8Array).buffer,
                    second: hexToArrayBuffer(kh.keccak256(second_data), Uint8Array).buffer,
                };
            }
            function loading_screen_handler() {
                this.newSetLoading = newSetLoading;
                function newSetLoading(set_to, msg="", cb=null) {
                    requestAnimationFrame(function() {
                        document.getElementById("loading_container").style.display = (set_to) ? "flex" : "none";
                    });
                    document.getElementById("loading_message").innerHTML = msg;
                    if (cb != null)
                        cb();
                }
                this.setLoading = setLoading;
                function setLoading(set_to=true, ms_delay=null, allow_cancel_ms=null, cb=null) {
                    var loading_message = document.getElementById("loading_message");
                    if (ms_delay != null) {
                        var tc = document.getElementById("loading_container").firstElementChild;
                        var temp_color = tc.style.backgroundColor;
                        tc.style.backgroundColor = "#fd4f4f";
                        loading_message.innerText = "Incorrect Password";
                        window.setTimeout(function() {
                            requestAnimationFrame(function() {
                                document.getElementById("loading_container").firstElementChild.style.backgroundColor = temp_color;
                                set();
                            });
                        }, ms_delay);
                    } else
                        set();
                    function set() {
                        loading_message.innerText = " ";
                        requestAnimationFrame(function() {
                            document.getElementById("loading_container").style.display = (set_to) ? "flex" : "none";
                        });
                        if (cb != null)
                            cb();
                        if (allow_cancel_ms != null) {
                            window.setTimeout(function() {
                                var close_x = document.createElement("div");
                                close_x.innerHTML = hb.getSvg("x", {
                                    class_string: "standard_back_arrow",
                                    id: "loading_close"
                                });
                                document.getElementById("loading_container").prepend(close_x);
                                close_x.addEventListener("click", callCancel);
                            }, allow_cancel_ms);
                        }
                        function callCancel() {
                            var close_x = document.getElementById("loading_close");
                            setLoading(false);
                            close_x.removeEventListener("click", callCancel);
                            close_x.remove();
                        }
                    }
                }
            }
            function placePopup(ev, ele, hidden_array=[], hidden_temp_status="block") {
                var buffer = 10;
                var restore_array = [];
                for (var i = 0; i < hidden_array.length; i++) {
                    restore_array.push(hidden_array[i].style.display);
                    hidden_array[i].style.display = hidden_temp_status;
                }
                var evx = (!checkForProperty(ev.x)) ? ev.detail.x : ev.x;
                var evy = (!checkForProperty(ev.y)) ? ev.detail.y : ev.y;
                var new_x = (evx + buffer + ele.offsetWidth >= window.innerWidth) ? evx - (ele.offsetWidth + buffer) : (evx + buffer);
                var new_y = (evy + buffer + ele.offsetHeight >= window.innerHeight) ? evy - (ele.offsetHeight + buffer) : (evy + buffer);
                new_x = (new_x < 0) ? 0 : new_x;
                new_y = (new_y <= 0 || ele.offsetHeight > (window.innerHeight * 0.80)) ? (window.innerHeight * 0.1) : new_y;
                ele.style.left = new_x + "px";
                ele.style.top = new_y + "px";
                ele.style.maxHeight = (window.innerHeight * 0.8) + "px";
                ele.style.overflow = "auto";
                for (var i = 0; i < hidden_array.length; i++)
                    hidden_array[i].style.display = restore_array[i];
            }
            function escapeSpecial(str) {
                return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#039;');
            }
            function bufferToHex(buffer) {
                return [...new Uint8Array(buffer)].map(b=>b.toString(16).padStart(2, "0")).join("");
            }
            function concatArrayBuffers(buffer1, buffer2) {
                var tmp = new Uint8Array(buffer1.byteLength + buffer2.byteLength);
                tmp.set(new Uint8Array(buffer1), 0);
                tmp.set(new Uint8Array(buffer2), buffer1.byteLength);
                return tmp.buffer;
            }
            function base64ToArrayBuffer(base64) {
                var binary_string = window.atob(base64);
                var len = binary_string.length;
                var bytes = new Uint8Array(len);
                for (var i = 0; i < len; i++)
                    bytes[i] = binary_string.charCodeAt(i);
                return bytes.buffer;
            }
            function hexToBase64(hex) {
                let result = '';
                for (let i = 0; i < hex.length; i += 2)
                    result += String.fromCharCode(parseInt(hex.substr(i, 2), 16));
                result = btoa(result);
                return result.replaceAll('+', '-').replaceAll('/', '_').replace(/=+$/, '');
            }
            function isUrlSafeBase64(str) {
                const regex = /^[A-Za-z0-9-_]+={0,2}$/;
                var ret = regex.test(str);
                return ret;
            }
            function isBase64(str) {
                const regex = /^[A-Za-z0-9+/]+={0,2}$/;
                return regex.test(str);
            }
            function base64ToHex(base64) {
                base64 = base64.replaceAll('-', '+').replaceAll('_', '/');
                while (base64.length % 4)
                    base64 += '=';
                try {
                    let result = atob(base64);
                    let hex = '';
                    for (let i = 0; i < result.length; i++) {
                        let byte = result.charCodeAt(i).toString(16);
                        hex += ('0' + byte).slice(-2);
                    }
                    return hex;
                } catch (e) {
                    return null
                }
            }
            function hexToBigInt(hex) {
                var regex = new RegExp(/0x/i);
                if (regex.test(hex.substring(0, 2)))
                    hex = hexStringToHexNumber(hex);
                if (hex.length % 2)
                    hex = '0' + hex;
                return BigInt('0x' + hex);
            }
            function validAddress(address) {
                if (isForcedHex(address) && hexStringToHexNumber(address).length == 40)
                    return true;
                return false;
            }
            function hexStringToHexNumber(hex_str) {
                return hex_str.substring(2);
            }
            function isForcedHex(str) {
                var re = /^[0-9a-f]*$/i;
                var re2 = /^0x[0-9a-f]*$/i;
                var ret = false;
                if (re.test(str) || re2.test(str))
                    ret = true;
                re.lastIndex = 0;
                return ret;
            }
            function checkForProperty(prop) {
                return (prop === "" || prop === null || prop === undefined) ? false : true;
            }
            function getFunctionStr(func_hash, func_params="") {
                if (func_params == "")
                    return func_hash;
                else if (func_params.charAt(1) == "x" || func_params.charAt(1) == "X")
                    return func_hash + func_params.slice(2);
                else
                    return func_hash + func_params;
            }
            function genFunctionHash(func_str) {
                return (func_str == "") ? "" : kh.keccak256(func_str).slice(0, 10);
            }
            function inputFlash(ele, ms_time=1000, options={
                bg: "#fd4f4f",
                color: "#fff",
                fill: "#fff"
            }) {
                (function flash(on=false) {
                    if (on) {
                        ele.style.backgroundColor = options.bg;
                        ele.style.color = options.color;
                        ele.style.fill = options.fill;
                        window.setTimeout(flash, ms_time);
                    } else {
                        ele.style.backgroundColor = null;
                        ele.style.color = null;
                        ele.style.fill = null;
                    }
                }
                )(true);
            }
            function getShortAddress(address) {
                return (address.substring(0, 5) + "..." + address.substring(address.length - 4));
            }
            function hexStringToHexNumber(hex_str) {
                return hex_str.substring(2);
            }
            function hexToArrayBuffer(hex_str, buffer_type=null) {
                const regex = new RegExp(/0x/i);
                if (regex.test(hex_str.substring(0, 2)))
                    hex_str = hexStringToHexNumber(hex_str);
                var ret = [];
                for (var i = 0; i < hex_str.length / 2; i++) {
                    var x = i * 2;
                    const n = parseInt(hex_str.substr(x, 2), 16);
                    ret.push(n);
                }
                if (buffer_type)
                    return new buffer_type(ret);
                else
                    return ret;
            }
            function stopProp(e) {
                e.stopPropagation();
            }
            function secsToMs(secs) {
                return secs * 1000;
            }
            function decimalTo2cHex(dec) {
                var hex = (dec).toString(16);
                return hex.length % 2 ? ('0' + hex) : hex;
            }
            function weiToEth(wei_quantity) {
                var ret_str = "";
                wei_quantity = BigInt(wei_quantity);
                var int_part = wei_quantity / BigInt(10 ** 18);
                if (int_part > 0)
                    wei_quantity = wei_quantity - (int_part * BigInt(10 ** 18));
                else
                    int_part = "0";
                return int_part + "." + wei_quantity.toString().padStart(18, '0');
            }
            function ethToWei(eth_quantity) {
                eth_quantity = eth_quantity.toString();
                var [int_part,dec_part=''] = eth_quantity.split('.');
                return BigInt(int_part) * BigInt(10 ** 18) + BigInt(dec_part.padEnd(18, '0').slice(0, 18));
            }
            function trimEth(eth_str, to_fixed=9, round_at_fixed=false) {
                var regex = new RegExp('[0-9]*\.[0-9]' + '{0,' + to_fixed + '}');
                var ret = eth_str.match(regex)[0];
                ret = (/.*\.$/.test(ret)) ? ret.replace('.', '') : ret;
                if (round_at_fixed)
                    ret = roundIfRemaining(ret, eth_str, to_fixed);
                return ret;
            }
            function roundIfRemaining(trimmed, original, fixed_len) {
                var remaining = original.replace(trimmed, '');
                if (/^0{1,}$/.test(remaining) == false) {
                    var tc = ethToWei(original);
                    tc = tc + BigInt(10 ** (18 - fixed_len));
                    tc = weiToEth(tc);
                    trimmed = trimEth(tc, fixed_len, false);
                }
                return "" + trimmed;
            }
            function removeTrailingZeros(eth_str) {
                var ret = eth_str.replace(/0+$/, '');
                return ret.replace(/\.$/, '');
            }
            function getTotalCoin(user_address, cb) {
                var call_obj = {
                    method: "eth_getBalance",
                    params: [user_address, "latest"],
                    api: active_contract.rpc_list,
                };
                getBaseTokenCall(call_obj, cb);
            }
            function getBaseTokenCall(call_obj, cb) {
                var call_params = {
                    asserted_status: 200,
                    api: call_obj.api,
                    params: {
                        jsonrpc: "2.0",
                        method: call_obj.method,
                        params: call_obj.params
                    }
                };
                xhr_h_chain.sendXHR(call_params, function(res) {
                    if (res.valid) {
                        var ret = JSON.parse(res.response);
                        cb(ret);
                    } else
                        cb(null);
                });
            }
            function checkIfApple() {
                return (navigator.platform.toUpperCase().indexOf('MAC') >= 0 || navigator.userAgent.indexOf('Mac') >= 0) ? true : false;
            }
            function getRandomInclusive(min, max) {
                return Math.floor(Math.random() * (max - min + 1)) + min;
            }
            function defaultCopyToClipboard(ele, text, cb=null) {
                copy_to_clipboard(text);
                let cc = ele;
                let tc = cc.innerText;
                cc.innerText = "Copied!";
                window.setTimeout(function() {
                    cc.innerText = tc;
                    if (cb != null)
                        cb(true);
                }, 1000);
            }
            function globalKeyUpEvent(e) {
                if (e.key === "Enter") {
                    switch (e.target.dataset.keyevent) {
                    case "notes_key_event":
                        app.externalDetermineUserNotes(e);
                        break;
                    case "menu_key_event":
                        var fake_x = e.target.offsetLeft + e.target.offsetWidth + 10;
                        var fake_y = e.target.offsetTop + e.target.offsetHeight + 10;
                        e.target.dispatchEvent(new CustomEvent('click',{
                            bubbles: true,
                            cancelable: true,
                            detail: {
                                x: fake_x,
                                y: fake_y
                            }
                        }));
                        break;
                    case "default_key_event":
                        e.target.dispatchEvent(new Event('click'));
                        break;
                    }
                }
            }
            function initAlerts() {
                var alert_params = {
                    custom_css: ` .alerts_container{font-family:'inter_variable', system-ui;display:flex;font-size: calc(1vw + 1vh) / 2);color:#001433;position: absolute;top:0;left:0;align-items: center;justify-content: center;width:100vw;height:100%;z-index:2140000001;background-color:#000000aa} .alerts_message_ele{font-size:22;font-weight:600;text-align:center;font-size:22px;margin:0} .alerts_prevent_bg_scroll{overflow:hidden;} #alerts_inner_container{ max-width:490px;width:90%;font-size:20px;outline:none;background-color: #1a1a1a;border-radius: 0;color:#fff; padding:32px 40px; margin:24px 0; position:relative; } .confirm_sub_heading{margin:20px 0;font-size:17px;opacity:.8;text-align:center;} #alert_input_container{ display:inline-flex;align-items:center;width:100%;margin: 1em 0;position:relative; } #alerts_view_input{cursor:pointer;margin:0 18px 0 0;opacity:.5;user-select:none;position:absolute;right:0;display:flex;fill:#fff} #alerts_view_input svg{width:20px} #alerts_input_box{ width:100%;white-space: nowrap; border:none;box-shadow:none;border-radius:0;padding:20px 60px 20px 20px;color: #fff; font-family: 'inter_variable', system-ui;font-weight: 400;font-size: 16px;line-height: 1.2; background-color:#242424; outline:none; } .alerts_std_btn{margin: 10px 0;background-color:#eef3fa;border:none;border-radius:0;padding:16px 0;font-size:20px;font-weight:500;cursor:pointer;width:100%} .alerts_std_btn:nth-child(2){background-color: #1a1a1a;border:1px solid #fff;color:#fff} .alerts_btn_container{display: inline-flex;justify-content: center;width: 100%;margin: 0 0 18px;flex-direction:column;} .alerts_boomer_close{color: ;position: absolute;top: 0;right: 0;margin: 0.25em;font-size: 2em;line-height: 1;cursor:pointer;user-select:none;} #suggestion_container{margin-bottom:29px;line-height:1;font-size:16px;font-weight:300; display:flex; align-items:flex-start; } #ttc_estimate{flex-grow:1;word-break:break-word;} #suggest_button_container{cursor:pointer;display:flex;align-items:center;white-space: nowrap;user-select: none;} #suggest_button_container svg{height:16px;fill:#fff;transform:rotate(90deg);} .password_security_link{font-size:16px;text-align:center;line-height:1.2;color:#fff;margin:0;} .password_security_container{line-height:1;text-align:center;} `
                };
                alert_params.custom_view_icon = '<svg viewBox="0 0 16 13"><rect width="5" height="1" x="5.5" y="1"/><rect width="2" height="1" x="4" y="2"/><rect width="2" height="1" x="10" y="2"/><rect width="2" height="1" x="3" y="3"/><rect width="2" height="1" x="11" y="3"/><rect width="2" height="1" x="2" y="4"/><rect width="2" height="1" x="12" y="4"/><rect width="2" height="1" x="1" y="5"/><rect width="2" height="1" x="13" y="5"/><rect width="2" height="1" x="0.5" y="6"/><rect width="2" height="1" x="13.5" y="6"/><rect width="2" height="1" x="1" y="7"/><rect width="2" height="1" x="13" y="7"/><rect width="2" height="1" x="2" y="8"/><rect width="2" height="1" x="12" y="8"/><rect width="2" height="1" x="3" y="9"/><rect width="2" height="1" x="11" y="9"/><rect width="2" height="1" x="4" y="10"/><rect width="2" height="1" x="10" y="10"/><rect width="4" height="1" x="6" y="6"/><rect width="2" height="3" x="7" y="5"/><rect width="5" height="1" x="5.5" y="11"/></svg>';
                var toast_params = {
                    custom_css: ` .toasts_container{position:fixed;color:#fff;width:100%;height:100vh;z-index:10;pointer-events:none;font-size: calc(1vw + 1vh) / 2);} .toasts_inner_container{width:100%} .toasts_success,.toasts_error,.toasts_wait{font-family:arial;margin:.75em auto;padding:.5em 1em;border-radius:.3em;opacity:0;transition:opacity .5s ease;max-width:15em} .toasts_success{background-color:#4acf4a;box-shadow:rgba(134, 255, 134,.6) 0 0 0.3em 0.1em} .toasts_error{background-color:#fc3263;box-shadow:rgba(255, 134, 134,.6) 0 0 0.3em 0.1em} .toasts_wait{background-color:#bf4acf;box-shadow:rgba(245, 134, 255,.6) 0 0 0.3em 0.1em} .toasts_status{font-size:1.1em;font-weight:bold;margin:0} .toasts_message{font-size:.8em;margin:0} `,
                };
                return {
                    alert_params: alert_params,
                    toast_params: toast_params
                };
            }
            function customTransactionHtml(trans_obj) {
                var main_svgs = {};
                main_svgs.lock = "";
                main_svgs.unlock = "";
                main_svgs.x = hb.getSvg("x", {
                    class_string: "standard_close_icon"
                });
                main_svgs.refresh = hb.getSvg("refresh_arrow", {
                    id: "trans_prev-estimate_b",
                    class_string: "trans_prev-refresh_estimate"
                });
                var new_ele = document.createElement("div");
                var new_html = ` <div id=trans_prev-outer_container><div id=trans_prev-main_container><span id=trans_prev-boomer_close>${main_svgs.x}</span><div id=trans_prev-lock_container>${main_svgs.lock}${main_svgs.unlock}</div><h5>Transaction: <span class=trans_prev-trans_title> ${trans_obj.custom_title}</span></h5><div id=trans_prev-estimate_container><span>Estimated Cost:&nbsp;</span><span id=trans_prev-estimate_results></span> ${main_svgs.refresh} </div><div id=trans_prev-response></div> ${checkForProperty(trans_obj.custom_param_html) ? trans_obj.custom_param_html : ""} <div class=trans_prev-button_container><button class=trans_prev-std_btn id=trans_prev-submit_b>Submit to Blockchain</button></div><div class=trans_prev-total_token_container><span>You have:&nbsp;</span><span id=total_token></span></div></div></div> `;
                document.body.appendChild(new_ele);
                new_ele.outerHTML = new_html.trim();
            }
            function customTransactionCss() {
                var valid_custom_css = ` #trans_prev-outer_container{font-family:'inter_variable', system-ui;display:flex;font-size: 18px;color:#001433;position: fixed;align-items: center;justify-content: center;top:0;left:0;width:100vw;height:100vh;z-index:2100000002;background-color:#000000cc} #trans_prev-main_container{padding:32px 40px 12px;max-width:100%;width:475px;font-size:20px;background-color:#1a1a1a;color:#fff;position:relative;} #trans_prev-main_container h5{font-size:24px;margin:5px 0;font-size:24px;text-align:center;font-weight: 600;} #trans_prev-main_container p{margin:20px 0;word-break: break-all;font-size:18px} .trans_prev-button_container{display:flex;margin:20px 0;} .trans_prev-std_btn{background-color:#eef3fa;padding:16px 0;font-size:20px;line-height:1.4;width:100%;border:none;cursor:pointer} .trans_prev-std_btn:active{transform:scale(.995)} .trans_prev-refresh_estimate{width:18px;fill:#fff;height: 18px;transform: rotate(90deg);margin-left:6px;cursor:pointer;} .trans_prev-btn_container{display: inline-flex;justify-content: center;width: 100%;margin: 0 0 1em;} #trans_prev-OLD_boomer_close{color: #ffffff22;position: absolute;top: 0;right: 0;margin: 0.25em;font-size: 2em;line-height: 1;cursor:pointer;user-select:none;} #trans_prev-lock_container{line-height:0;text-align:center;} .trans_prev-lock_svg{width:50px;opacity:.8;user-select:none;cursor:pointer;fill:#fff;margin-bottom:20px;} .trans_prev-lock_svg:hover{opacity:1} .trans_prev-lock_svg:active{transform:scale(.98)} #trans_prev-response{overflow:auto;} .trans_prev-total_token_container{font-size:16px;margin: 0;text-align:center;} #total_token{} #trans_prev-estimate_container{margin:5px 0;font-size:16px;display: flex;justify-content: center;align-items: center;flex-wrap:wrap} .trans_prev-loading_icon{position:absolute;right:10px;top:10px;width:50px;height:50px;background-color:purple;-webkit-mask-size: cover;} #trans_prev-estimate_b{display:none;} @media(orientation: portrait) and (max-width: 800px){ #trans_prev-main_container{padding:32px 20px 12px;} } `;
                return valid_custom_css;
            }
            function html_builder() {
                this.newSecretContainer = newSecretContainer;
                function newSecretContainer() {
                    return ` <div class=secret_outer_container><div class=secret_inner_container> ${getSvg("x", {
                        id: "secret_close",
                        class_string: "standard_close_icon"
                    })} <div id=secret_username_container><h5 class=secret_heading>Share with BitNote User</h5><p class=secret_sub_heading>Notes can only be shared with other BitNote users. Enter the username you would like to share the note with.</p><form id=secret_form><textarea id=secret_username class=standard_input placeholder="Search username" rows=1></textarea><button id=secret_next_button class=full_width_button>Next</button></form><p id=invalid_secret_username class=failed_input_text>Username doesn't exist</p></div><div id=secret_link_container><h5 class=secret_heading>Your share link</h5><p id=generated_sub_heading class=secret_sub_heading></p><div id=secret_link_text class=thin_gb></div><button id=secret_copy_button class="full_width_button dark_button">Copy Link</button></div></div></div> `;
                }
                this.newReferralContainer = newReferralContainer;
                function newReferralContainer(params) {
                    return ` <div class=secret_outer_container><div class=secret_inner_container> ${getSvg("x", {
                        id: "secret_close",
                        class_string: "standard_close_icon"
                    })} <div id=referral_link_container> ${getSvg("referral_icon", {
                        id: "referral_icon"
                    })} <h5 class=secret_heading>Your Referral Link</h5><p id=generated_sub_heading class=secret_sub_heading>Earn <strong>30%</strong>&nbsp;of the protocol fees your referrals generate. <strong>Forever.</strong></p><div id=referral_link_text class=thin_gb>${window.location.origin + "/?sign_up&ref="}${params.address}</div><button id=referral_copy_button class="full_width_button dark_button">Copy Link</button></div></div></div> `;
                }
                this.viewSecretContainer = viewSecretContainer;
                function viewSecretContainer() {
                    return ` <div class=secret_outer_container><div class=secret_inner_container> ${getSvg("x", {
                        id: "secret_close",
                        class_string: "standard_close_icon"
                    })} <div id=secret_username_container><h5 class=secret_heading>View Shared Note</h5><p class=secret_sub_heading>Enter the link that was shared with you to unlock it.</p><form id=secret_form><textarea id=secret_link class=standard_input placeholder="Add link here" rows=1></textarea><button id=secret_next_button class=full_width_button>Unlock</button></form><p id=invalid_secret_username class=failed_input_text>Link does not exist</p></div></div></div> `;
                }
                this.importNotes = importNotes;
                function importNotes(params={}) {
                    return ` <div class=standard_container id=user_note_outer_container><div class=standard_container_topbar id=user_note_topbar><div class=user_note_titlebox_container> ${getSvg("back_arrow", {
                        id: "import_notes_close",
                        class_string: "standard_back_arrow"
                    })} <textarea id=user_note_titlebox class=handled_textarea rows=1 readonly>Import Notes</textarea></div><div id=user_note_additional_controls class=ns><label class=notes_home_menu_label_container id=import_file_button>Import File <input type=file id="upload_file"/></label><span class=notes_home_menu_label_container id=import_notes_public_key>Copy Public Key</span><span id=import_notes_button>Import Notes</span></div></div><textarea class=standard_input id=import_notes_textarea placeholder='Paste imported notes here\n\n[\n{"note":"short example note","title":"example note #1"},\n{"title":"example note #2", "note":"the order of title and note do not matter"},\n{"note":"S4jlf?@k^&)(qvxTUfXA=)vXlb5r","title":"example password"},\n]\n'></textarea></div> `;
                }
                this.newNewNote = newNewNote;
                function newNewNote(params) {
                    var additional_controls = "<span id=copy_note class=notes_home_menu_label_container>Copy Text</span><span id=publish_button tabindex=0 data-keyevent=default_key_event>Encrypt & Save</span><div class=portrait_3dc_container><div id=note_3d_container class=notes_home_menu_label_container tabindex=0 data-keyevent=menu_key_event>" + getSvg("three_dot", {
                        id: "notes_three_dot_button"
                    }) + "</div></div>";
                    var textbox_props = "rows=" + ((system_vars.mobile) ? 4 : 8) + " ";
                    var custom_placeholder = (checkForProperty(params.custom_placeholder)) ? params.custom_placeholder : "Type your note here";
                    var default_title = (checkForProperty(params.note_number)) ? "Note #" + params.note_number : "";
                    return ` <div class=standard_container id=user_note_outer_container><div class=standard_container_topbar id=user_note_topbar><div class=user_note_titlebox_container> ${getSvg("back_arrow", {
                        id: "user_note_back_arrow",
                        class_string: "standard_back_arrow"
                    })} <textarea id=user_note_titlebox class=handled_textarea rows=1 placeholder="${default_title}" autocomplete="one-time-code"></textarea></div><div id=user_note_additional_controls class=ns>${additional_controls}</div></div><textarea id=user_note_textbox ${textbox_props} placeholder="${custom_placeholder}"></textarea><div id=textbox_conversion_container></div></div><div id=user_notes_menu_container> ${userNotesMenu()} </div> `;
                }
                this.newPkBox = newPkBox;
                function newPkBox(params) {
                    var ac_balance = params.ac_balance;
                    var coin_dn = params.coin_dn;
                    return ` <div class=standard_modal_outer_container><div class=standard_modal_container> ${getSvg("x", {
                        id: "wallet_functions_close",
                        class_string: "standard_close_icon"
                    })} <h5 class=standard_modal_heading>BitNote Private Key</h5><p class=standard_modal_sub_heading>You can use this key to access your BitNote funds by importing it into another wallet</p><div class=thin_gl3></div><div class="fund_ac_payment_tc wallet_functions_ac_bal"><div class="bno_summary_flex_c"><div class=fund_ac_payment_lc>${getSvg("bitnote_lock", {
                        class_string: "standard_icon",
                        id: ""
                    })}<h6>Your BitNote Balance:</h6></div></div><div class="bno_summary_flex_c" id=wallet_functions_ac_cc_box><span>$0.00</span><span>${ac_balance} ${coin_dn}</span></div></div><div class=thin_gl3></div><div id=secret_username_container><div id=private_key_container class="func_ac_address_box thin_gb"></div><button id=private_key_copy_button class="full_width_button dark_button">Copy Text</button></div></div></div> `;
                }
                this.newWalletFunctions = newWalletFunctions;
                function newWalletFunctions(params) {
                    var ac_balance = params.ac_balance;
                    var coin_dn = params.coin_dn;
                    return ` <div class=standard_modal_outer_container><div class=standard_modal_container> ${getSvg("x", {
                        id: "wallet_functions_close",
                        class_string: "standard_close_icon"
                    })} <h5 class=standard_modal_heading>Wallet Settings</h5><p class=standard_modal_sub_heading>Migrate funds to another address or access your BitNote private key for more control.</p><div class=thin_gl3></div><div class="fund_ac_payment_tc wallet_functions_ac_bal"><div class="bno_summary_flex_c"><div class=fund_ac_payment_lc>${getSvg("bitnote_lock", {
                        class_string: "standard_icon",
                        id: ""
                    })}<h6>Your BitNote Balance:</h6></div></div><div class="bno_summary_flex_c" id=wallet_functions_ac_cc_box><span>$0.00</span><span>${ac_balance} ${coin_dn}</span></div></div><div class=thin_gl3></div><div id=wallet_functions_form><form id=secret_form><input id=wallet_functions_migration_addr class=standard_input placeholder="Enter username/address for funds transfer"></input><button id=wallet_functions_send class="full_width_button standard_modal_main_button">Send All Funds</button></form><button id=wallet_functions_pk_button class="full_width_button dark_button">View BitNote Private Key</button></div></div></div> `;
                }
                this.userNotesMenu = userNotesMenu;
                function userNotesMenu() {
                    return ` <div id=user_notes_menu class=standard_menu_modal tabindex=0><p id=edit_note tabindex=0 data-keyevent=default_key_event>Edit Note</p><p id=archive_note tabindex=0 data-keyevent=default_key_event>Archive Note</p><p id=delete_note tabindex=0 data-keyevent=default_key_event>Delete Note</p><p id=share_note tabindex=0 data-keyevent=default_key_event>Share Note</p><p id=succession_note tabindex=0 data-keyevent=default_key_event>Succession Rules</p><div id=user_notes_divider><span class=line_divider></span><h6 class="three_dot_menu_label">Note Tools:</h6></div><p id=gen_random_string tabindex=0 data-keyevent=default_key_event>Generate Password</p><p id=gen_random_phrase tabindex=0 data-keyevent=default_key_event>Generate Passphrase</p><p id=gen_random_pk tabindex=0 data-keyevent=default_key_event>Generate EVM Private Key</p></div> `;
                }
                this.newLanding = newLanding;
                function newLanding() {
                    return ` <div class=standard_container id=landing_container><h2>Log in</h2><div class=landing_input_container><form id=signin_form><input id=landing_input class="standard_input handled_textarea" placeholder="Enter Username" autocomplete="off" spellcheck="false"></input><div class=mp_input_container><input name="bitnote_mp" class="signin_mp_c_input standard_input handled_textarea" placeholder="Enter Master Password" autocomplete="new-password" autocorrect="off" spellcheck="false" type=password></input> ${getSvg("eye", {
                        id: "signin_mp_view_input",
                        class_string: "input_inline_eye_svg",
                        tabindex: 0
                    })} </div><button class=full_width_button id=signin_submit_button>Log in</button><span id=use_biometrics class=use_security_key tabindex=0 data-keyevent=default_key_event>Log in with Security Key</span></form></div><div id=learn_more_link></div><div id=landing_footer_container><span class=landing_cta>Don't have an account?&nbsp;<span id=sign_up_button tabindex=0 data-keyevent=default_key_event>Sign Up</span></span></div></div> `;
                }
                this.newNotesHome = newNotesHome;
                function newNotesHome(address, username, sorted_obj) {
                    var note_box_list = "";
                    if (checkForProperty(sorted_obj) && checkForProperty(sorted_obj.note_pos_array)) {
                        for (var i = 0; i < sorted_obj.note_pos_array.length; i++) {
                            note_box_list += `<div class=get_note_box data-note_num=${sorted_obj.note_pos_array[i]} tabindex=0 data-keyevent=notes_key_event><span></span><span>${getSvg("three_dot", {
                                class_string: "note_three_dot"
                            })}</span></div>`;
                        }
                    }
                    return ` <div class=standard_container id=user_notes_container><div class=standard_container_topbar id=notes_address_container><div class=topbar_left_flex> ${getSvg("back_arrow", {
                        id: "notes_home_back_arrow",
                        class_string: "standard_back_arrow"
                    })} <h5 class=notes_for_box> Notes for ${(username.length >= 14) ? getShortAddress(username) : username} </h5></div><div id=notes_three_dot_icon class=notes_home_menu_label_container tabindex=0 data-keyevent=menu_key_event> ${getSvg("three_dot", {
                        class_string: "notes_home_menu_icons"
                    })} <span class=notes_home_menu_label>More</span></div></div><div id=notes_home_search_container> ${getSvg("magnify", {
                        class_string: "notes_home_search_icon"
                    })} <input class=standard_input id=notes_home_search_input placeholder="Search notes" autocomplete="one-time-code"></input> ${getSvg("x", {
                        id: "notes_home_search_x"
                    })} </div><div id=notes_box_container><div id=new_note class="get_note_box" tabindex=0 data-keyevent=notes_key_event><span>New Note</span><svg viewBox="0 0 10 10"><rect width="1.5" height="10" x="4.25" y="0" rx=".5"/><rect width="10" height="1.5" x="0" y="4.25" rx=".5"/></svg></div><div id=notes_output_container> ${note_box_list} </div></div></div><div id=user_notes_menu_container><div id=user_notes_menu class=standard_menu_modal tabindex=0><p id=notes_refresh_arrow tabindex=0 data-keyevent=default_key_event>Refresh Notes</p><p id=menu_referral_link tabindex=0 data-keyevent=default_key_event>Refer and Earn</p><span class=line_divider></span><h6 class="three_dot_menu_label">Public Address:</h6><p id=notes_user_address title=${address} tabindex=0 data-keyevent=default_key_event>${getShortAddress(address)}</p><h6 class="three_dot_menu_label">Balance:</h6><p id=notes_user_coin tabindex=0 data-keyevent=default_key_event>0 ${main_currency_symbol}</p><p id=menu_wallet_functions tabindex=0 data-keyevent=default_key_event>Wallet Settings</p><span class=line_divider></span><p id=menu_more_settings tabindex=0 data-keyevent=default_key_event>More Settings</p><div id=menu_more_settings_container><p id=menu_sk_functions tabindex=0 data-keyevent=default_key_event>Security Keys</p><p id=menu_export_notes tabindex=0 data-keyevent=default_key_event>Export Notes</p><p id=menu_import_notes tabindex=0 data-keyevent=default_key_event>Import Notes</p><p id=view_shared_note tabindex=0 data-keyevent=default_key_event>View Shared Note</p><p id=menu_keyboard_shortcuts tabindex=0 data-keyevent=default_key_event>Keyboard Shortcuts</p><p><a href="${active_contract.scan_url}/address/${address}" target=_blank>View Chain Explorer</a></p><p id=menu_clear_cache tabindex=0 data-keyevent=default_key_event>Clear Cache</p></div><a href="mailto:support@bitnote.xyz" target=_blank>Contact Us</a><p id=menu_logout tabindex=0 data-keyevent=default_key_event>Log out</p><h5 id=version_number>${"v " + getCurrentVersion()}</h5></div></div> `;
                }
                this.newWaitForResults = newWaitForResults;
                function newWaitForResults(scan_url) {
                    return ` <div class=standard_container id=results_outer_container><div id=results_inner_container><div id=results_main_icon_container></div><div id=results_msg_container><h5>Please Wait...</h5><p>Your transaction should be processed shortly.</p></div><div id=results_done_button tabindex=0 data-keyevent=default_key_event>Done</div></div></div> `;
                }
                this.multiWaitForResults = multiWaitForResults;
                function multiWaitForResults(num_of_transactions) {
                    return ` <div class=standard_container id=results_outer_container><div id=results_inner_container><div id=results_main_icon_container></div><div id=results_msg_container><h5>Please Wait...</h5><p><span id=multi_transaction_wait>${num_of_transactions}</span>&nbsp;transaction(s) are being processed.</p></div><div id=results_done_button tabindex=0 data-keyevent=default_key_event>Done</div></div></div> `;
                }
                this.newCreateUsername = newCreateUsername;
                function newCreateUsername() {
                    return ` <div class=new_user_container id=create_username_container><p class=current_step_label>Step 1/3</p><h2>Create Username</h2><form id=create_username_form spellcheck="false" autocomplete="off"><div id=create_username_input_container><textarea class="standard_input handled_textarea" id=create_username_input placeholder="Search username for availability" autocomplete="one-time-code"></textarea> ${getSvg("checkmark", {
                        id: "valid_username_icon"
                    })} ${getSvg("x", {
                        id: "invalid_username_icon"
                    })} </div><button class=full_width_button id=create_username_main_button>Check Availability</button><div id=create_username_type_box><span id=create_username_type>Normal Username</span>&nbsp; <span id=username_questionmark class=questionmark_container>${getSvg("questionmark", {
                        class_string: "standard_icon"
                    })}</span></div></form><div class=tips_container><div class=tips_box><div class=tips_label_container> ${getSvg("lightbulb", {
                        class_string: "standard_icon tips_label_svg"
                    })} <h6 class=tips_label>Tips:</h6></div><ul><li><strong>If you forget your username we can't help you, make sure to remember it.</strong></li><li>Usernames are case sensitive (e.g. "Matthew" and "matthew" are different usernames).</li></ul></div></div><h5>Already have an account? <span id=create_username_login_button>Log in</h5></div> `;
                }
                this.newCreateMP = newCreateMP;
                function newCreateMP(init_name) {
                    return ` <div class=new_user_container id=create_mp_container><p class=current_step_label>Step 2/3</p><h2 id=create_mp_label>Create Master Password</h2><form id=create_mp_form spellcheck="false" autocomplete="off"><div id=create_mp_input_container><textarea class="standard_input handled_textarea" id=create_mp_input placeholder="Enter your password" autocomplete="off" ></textarea> ${getSvg("eye", {
                        class_string: "input_inline_eye_svg",
                        id: "create_mp_eye",
                        tabindex: 0
                    })} </div><div id=crack_cost_container><span class=crack_cost_label>Cost to crack:&nbsp;</span><span id=crack_cost>$0</span></div><button class=full_width_button id=create_mp_main_button>Continue</button><p class=full_width_button id=create_mp_generate_button>Generate Strong Password</p><div class=dont_match_container><span id=create_mp_failed class=failed_input_text>Doesn't match. Try again or&nbsp;</span><span id="create_mp_go_back" class=ul>Go Back</span></div></form><div class=tips_container><div class=tips_box><div class=tips_label_container> ${getSvg("lightbulb", {
                        class_string: "standard_icon tips_label_svg"
                    })} <h6 class=tips_label>Tips:</h6></div><ul><li><strong>We don't store your master password, make sure to remember it or you will lose access to your data</strong></li><li>Choose a strong password to keep your data safe.</li><li>Your password cannot be changed, please choose wisely.</li><li>"Cost to crack" estimates the cost to brute force your selected password. <span id=crack_cost_learn_more>Learn more</span></li></ul></div></div></div> `;
                }
                this.registerSecurityKey = registerSecurityKey;
                function registerSecurityKey(params) {
                    return ` <div class=standard_hc_outer> ${getSvg("x", {
                        id: "sec_key_functions_close",
                        class_string: "standard_close_icon"
                    })} <div class=standard_hc><div class=inner_hc><h4 class=onboarding_header>Create Security Key</h4><div class=security_types_container><div class="security_type_box fund_ac_payment_tc" id=sec_key_register><div class=fund_ac_payment_lc>${getSvg("key", {
                        class_string: "standard_icon align_baseline",
                        id: ""
                    })}<div><h4>Step 1: Link Security Key</h4><p>Link a hardware based security key to access your BitNote account from this device.</p></div></div><div id=sk_icon_shifter>${getSvg("back_arrow", {
                        class_string: "standard_icon flip_180 dim_ele",
                        id: ""
                    })}</div></div> ${getSvg("back_arrow_long_tail", {
                        class_string: "standard_icon flip_270_asc dim_ele",
                        id: ""
                    })} <div class="security_type_box fund_ac_payment_tc" id=sec_key_store><div class=fund_ac_payment_lc>${getSvg("download_icon", {
                        class_string: "standard_icon align_baseline",
                        id: ""
                    })}<div><h4>Step 2: Store Security Key (optional)</h4><p>Store your hardware security key credentials on-chain to access your BitNote account from any device.</p></div></div><div id=chain_icon_shifter>${getSvg("back_arrow", {
                        class_string: "standard_icon flip_180 dim_ele",
                        id: ""
                    })}</div></div></div><p class=ul id=how_do_i_delete_sk>How do I delete a security key?</p></div></div></div> `;
                }
                this.selectSecurity = selectSecurity;
                function selectSecurity(params) {
                    return ` <div class=standard_hc_outer><div class=standard_hc><div class=inner_hc><p class="current_step_label func_ac_step_label" id=fund_ac_step_label>Step 2/3</p><h4 class=onboarding_header>How would you like to secure your account?</h4><div class=security_types_container><div class="security_type_box fund_ac_payment_tc" id=ob_use_master_pass><div class=fund_ac_payment_lc>${getSvg("basic_lock", {
                        class_string: "standard_icon align_baseline",
                        id: ""
                    })}<div><h4>Master Password</h4><p>Choose a strong password and make sure to remember it, or you will lose access.</p></div></div> ${getSvg("back_arrow", {
                        class_string: "standard_icon flip_180 dim_ele",
                        id: ""
                    })} </div><div class="security_type_box fund_ac_payment_tc" id=ob_use_security_key><div class=fund_ac_payment_lc>${getSvg("key", {
                        class_string: "standard_icon align_baseline",
                        id: ""
                    })}<div><h4>Security Key</h4><p>More secure. Use a physical hardware-based security key (e.g. Yubikey).</p></div></div> ${getSvg("back_arrow", {
                        class_string: "standard_icon flip_180 dim_ele",
                        id: ""
                    })} </div></div></div></div></div> `;
                }
                this.fundAccount = fundAccount;
                function fundAccount(params) {
                    return ` <div class=standard_hc_outer><div class=standard_hc id=primay_fund_ac_container><div class=inner_hc id=how_you_pay><p class="current_step_label func_ac_step_label" id=fund_ac_step_label>Step 3/3</p><h4 class=onboarding_header>How would you like to pay?</h4><h6 id=fund_ac_sub_title>BitNote is pay-as-you-go. No subscriptions. Fund your account to use BitNote.</h6><div class=fund_types_container><div class=fund_ac_payment_tc data-type=crypto><div class=fund_ac_payment_lc>${getSvg("crypto_icon", {
                        class_string: "standard_icon",
                        id: ""
                    })}<span>Crypto</span></div><div class=fund_ac_select_box><div class=fund_ac_selected></div></div></div><div class=fund_ac_payment_tc data-type=credit><div class=fund_ac_payment_lc>${getSvg("c_card", {
                        class_string: "standard_icon c_card",
                        id: ""
                    })}<span>Credit card <br class=portrait_br>(coming soon)</span></div><div class=fund_ac_select_box><div data-selected=true class=fund_ac_selected></div></div></div><div class=fund_ac_payment_tc data-type=debit><div class=fund_ac_payment_lc>${getSvg("c_card", {
                        class_string: "standard_icon c_card",
                        id: ""
                    })}<span>Debit card <br class=portrait_br>(coming soon)</span></div><div class=fund_ac_select_box><div data-selected=true class=fund_ac_selected></div></div></div></div><button class=full_width_button id=select_payment_method>Continue</button></div></div> ${yourBno(params)} </div> `;
                }
                this.yourBno = yourBno;
                function yourBno(params) {
                    return ` <div class=standard_hc id=your_bno_outer_container><h5 class=onboarding_header>Your BitNote Order</h5><div id=your_bno_container class="inner_hc thin_gb"><div class=your_bno_username><span>Bitnote Username:</span><span>${params.username}</span></div><div id=your_bno_summary_container></div><div class=thin_gl></div><div id=your_bno_total_container><div class=bno_summary_flex_c><h6 id=bno_total_label>Your Total</h6></div><div class=bno_summary_flex_c id=you_pay_fee_cost><span></span><span></span></div></div></div><button class="full_width_button button_len_cap" id=continue_payment_button>Continue to payment</button></div> `;
                }
                this.addUsernameFee = addUsernameFee;
                function addUsernameFee(eth_value, dollar_value) {
                    return ` <div id=add_username_fee_container><div class=bno_summary_flex_c><h6>Registration fee</h6><span><span id=what_is_this class=title_text>What is this charge?</span></span></div><div class=bno_summary_flex_c id=add_username_fee_cost><span>$${dollar_value}</span><span>${eth_value}&nbsp;${main_currency_symbol}</span></div></div> `;
                }
                this.addMiscNoteCost = addMiscNoteCost;
                function addMiscNoteCost(eth_value, dollar_value) {
                    return ` <div id=add_misc_note_fee_container><div class=bno_summary_flex_c><h6>Note transaction fee</h6><span>Top up your BitNote balance to finish transaction</span></div><div class=bno_summary_flex_c id=add_misc_note_cost><span>$${dollar_value}</span><span>${eth_value}&nbsp;${main_currency_symbol}</span></div></div> `;
                }
                this.addAddMoney = addAddMoney;
                function addAddMoney() {
                    return ` <div id=add_money_fee_container><div class=bno_summary_flex_c><h6>Add BitNote Balance</h6><span id=temp_tt_test>To save notes on the blockchain</span></div><div class=bno_summary_flex_c id=add_money_fee_cost><span></span><span></span></div></div><div id=add_money_options_container><div class=add_money_option_cont data-preset=5>$5</div><div class=add_money_option_cont data-preset=15>$15</div><div class="add_money_option_cont add_money_input_container"><input id=add_money_other type=number placeholder=Other step=1 min=1></input></div></div> `;
                }
                this.fundWithCrypto = fundWithCrypto;
                function fundWithCrypto(address, value_req, network_name, coin_dn, ac_balance) {
                    var avax_faucet_link = "https://core.app/tools/testnet-faucet/?subnet=c&token=c";
                    return ` <div class=inner_hc id=pay_with_crypto><h4 class=onboarding_header>Send Payment</h4><h6 id=fund_ac_sub_title>Transfer <span class=six_hundo id=fund_ac_remaining_coin_req>${value_req}&nbsp;${coin_dn}&nbsp;</span>to your BitNote account on the <span class=six_hundo>${network_name}</span>&nbsp;network.</h6><div class="func_ac_address_container thin_gb"><div class=fund_ac_title_container><h5>Your BitNote address:</h5><span id=pay_with_crypto_3d>${getSvg("wallet_settings", {
                        class_string: "standard_icon",
                        id: ""
                    })}</span></div><div class="func_ac_address_box thin_gb">${address}</div><button class="full_width_button dark_button" id=fund_ac_copy_address>Copy Address</button><div class=thin_gl2></div><div class="fund_ac_payment_tc fund_ac_current_bal"><div class="bno_summary_flex_c"><div class=fund_ac_payment_lc>${getSvg("bitnote_lock", {
                        class_string: "standard_icon",
                        id: ""
                    })}<h6>Your BitNote Balance:</h6></div></div><div class="bno_summary_flex_c" id=fund_ac_cc_box><span>$0.00</span><span>${ac_balance} ${coin_dn}</span></div></div></div><button class=full_width_button id=continue_payment_button></button></div> `;
                }
                this.buildShortcutSheet = buildShortcutSheet;
                function buildShortcutSheet(apple_version=false) {
                    var special_key = (apple_version) ? "&#8984;" : "ctrl";
                    return ` <div id=shortcut_menu> ${getSvg("x", {
                        id: "shortcuts_close",
                        class_string: "standard_close_icon"
                    })} <h3 class=shortcut_title>Keyboard Shortcuts</h3><div class=shortcut_overflow_container><div class=shortcut_row><span class=shortcut_heading>New Note</span>${getSvg("small_key", {
                        class_string: "key_svg apple_cmd",
                        key_text: special_key
                    })}${getSvg("long_key", {
                        class_string: "key_svg enter_key",
                        key_text: "enter"
                    })}</div><div class=shortcut_row><span class=shortcut_heading>Save Note</span>${getSvg("small_key", {
                        class_string: "key_svg apple_cmd",
                        key_text: special_key
                    })}${getSvg("small_key", {
                        class_string: "key_svg",
                        key_text: "s"
                    })}</div><div class=shortcut_row><span class=shortcut_heading>Search Note</span>${getSvg("small_key", {
                        class_string: "key_svg apple_cmd",
                        key_text: special_key
                    })}${getSvg("small_key", {
                        class_string: "key_svg",
                        key_text: "f"
                    })}</div><div class=shortcut_row><span class=shortcut_heading>Toggle Header/Body</span>${getSvg("small_key", {
                        class_string: "key_svg apple_cmd",
                        key_text: special_key
                    })}${getSvg("small_key", {
                        class_string: "key_svg",
                        key_text: "h"
                    })}</div><div class=shortcut_row><span class=shortcut_heading>Edit Note</span>${getSvg("small_key", {
                        class_string: "key_svg apple_cmd",
                        key_text: special_key
                    })}${getSvg("small_key", {
                        class_string: "key_svg",
                        key_text: "e"
                    })}</div><div class=shortcut_row><span class=shortcut_heading>Go Back</span>${getSvg("small_key", {
                        class_string: "key_svg",
                        key_text: "esc"
                    })}</div><div class=shortcut_row><span class=shortcut_heading>Log Out</span>${getSvg("small_key", {
                        class_string: "key_svg apple_cmd",
                        key_text: special_key
                    })}${getSvg("small_key", {
                        class_string: "key_svg",
                        key_text: "l"
                    })}</div></div></div> `;
                }
                this.getSvg = getSvg;
                function getSvg(svg_name, params={}) {
                    var id = "";
                    var class_string = "";
                    var tabindex = "";
                    if (checkForProperty(params.id))
                        id += " id=" + params.id;
                    if (checkForProperty(params.class_string))
                        class_string += ' class="' + params.class_string + '"';
                    if (checkForProperty(params.tabindex)) {
                        tabindex += " tabindex=" + params.tabindex;
                        if (checkForProperty(params.prevent_tabbed_enter) == false)
                            tabindex += ' data-keyevent=default_key_event';
                    }
                    switch (svg_name) {
                    case "long_key":
                        return ` <svg viewBox="0 0 94 37"${class_string}${id}${tabindex}><rect class="km" y="0" height="37" width="94" x="0"/><path class="kt" d="M 0,0 H 94 L 82.46,5.286 H 12.38 Z"/><path class="kb" d="M 7.784,27.09 H 87.06 L 94,37 H 0 Z"/><path class="kf" d="M 5.464,3.304 C 5.464,2.574 6.056,1.982 6.786,1.982 H 88.05 C 88.78,1.982 89.37,2.574 89.37,3.304 V 29.07 C 89.37,29.8 88.78,30.39 88.05,30.39 H 6.786 C 6.056,30.39 5.464,29.8 5.464,29.07 Z"/><text><tspan x="9.88" y="14.87">${params.key_text}</tspan></text></svg> `;
                        break;
                    case "small_key":
                        return ` <svg viewBox="0 0 37 37"${class_string}${id}${tabindex}><rect class="km" y="0" height="37" width="37" x="0"/><path class="kt" d="M 0,0 H 37 L 23.8,5.286 H 13.23 Z"/><path class="kb" d="M 7.946,26.76 H 29.09 L 37,37 H 0 Z"/><path class="kf" d="M 5.304,3.304 C 5.304,2.574 5.895,1.982 6.625,1.982 H 30.41 C 31.14,1.982 31.73,2.574 31.73,3.304 V 29.07 C 31.73,29.8 31.14,30.39 30.41,30.39 H 6.625 C 5.895,30.39 5.304,29.8 5.304,29.07 Z"/><text x="9.98" y="15.05"><tspan x="9.98" y="15.05">${params.key_text}</tspan></text></svg> `;
                        break;
                    case "back_arrow":
                        return ` <svg viewBox="0 0 5 5"${class_string}${id}${tabindex}><rect width="1" height="1" x="3" y="0"/><rect width="1" height="1" x="2" y="1"/><rect width="1" height="1" x="1" y="2"/><rect width="1" height="1" x="2" y="3"/><rect width="1" height="1" x="3" y="4"/></svg> `;
                        break;
                    case "back_arrow_long_tail":
                        return ` <svg viewBox="0 0 7 7"${class_string}${id}${tabindex}><rect width="1" height="1" x="2" y="1"/><rect width="1" height="1" x="1" y="2"/><rect width="1" height="1" x="0" y="3"/><rect width="1" height="1" x="1" y="3"/><rect width="1" height="1" x="2" y="3"/><rect width="1" height="1" x="3" y="3"/><rect width="1" height="1" x="4" y="3"/><rect width="1" height="1" x="5" y="3"/><rect width="1" height="1" x="6" y="3"/><rect width="1" height="1" x="1" y="4"/><rect width="1" height="1" x="2" y="5"/></svg> `;
                        break;
                    case "refresh_arrow":
                        return ` <svg viewBox="0 0 16 16"${class_string}${id}${tabindex}><rect width="2" height="1" x="3" y="1"/><rect width="4" height="1" x="2" y="2"/><rect width="6" height="1" x="1" y="3"/><rect width="2" height="11" x="3" y="3"/><rect width="5" height="2" x="3" y="13"/><rect width="2" height="1" x="11" y="14"/><rect width="4" height="1" x="10" y="13"/><rect width="6" height="1" x="9" y="12"/><rect width="2" height="11" x="11" y="1"/><rect width="5" height="2" x="8" y="1"/></svg> `;
                        break;
                    case "ether_logo":
                        return ` <svg viewBox="0 0 5 5"${class_string}${id}${tabindex}><rect width="1" height="2" x="1" y="3"/><rect width="1" height="3" x="2.5" y="2"/><rect width="1" height="4" x="4" y="1"/></svg> `;
                        break;
                    case "checkmark":
                        return ` <svg viewBox="0 0 7 7"${class_string}${id}${tabindex}><rect width="1" height="1" x="0" y="3"/><rect width="1" height="1" x="1" y="4"/><rect width="1" height="1" x="2" y="5"/><rect width="1" height="1" x="3" y="4"/><rect width="1" height="1" x="4" y="3"/><rect width="1" height="1" x="5" y="2"/><rect width="1" height="1" x="6" y="1"/></svg> `;
                        break;
                    case "checkmark_w_border":
                        return ` <svg viewBox="0 0 12 12"${class_string}${id}${tabindex}><rect width="6" height="1" x="3" y="0"/><rect width="6" height="1" x="3" y="11"/><rect width="1" height="6" x="0" y="3"/><rect width="1" height="6" x="11" y="3"/><rect width="1" height="1" x="2" y="1"/><rect width="1" height="1" x="9" y="1"/><rect width="1" height="1" x="1" y="2"/><rect width="1" height="1" x="10" y="2"/><rect width="1" height="1" x="1" y="9"/><rect width="1" height="1" x="10" y="9"/><rect width="1" height="1" x="2" y="10"/><rect width="1" height="1" x="9" y="10"/><rect width="1" height="1" x="2" y="6.5"/><rect width="1" height="1" x="3" y="7.5"/><rect width="1" height="1" x="4" y="8.5"/><rect width="1" height="1" x="5" y="7.5"/><rect width="1" height="1" x="6" y="6.5"/><rect width="1" height="1" x="7" y="5.5"/><rect width="1" height="1" x="8" y="4.5"/><rect width="1" height="1" x="9" y="3.5"/></svg> `;
                        break;
                    case "warning_w_border":
                        return ` <svg viewBox="0 0 12 12"${class_string}${id}${tabindex}><rect width="6" height="1" x="3" y="0"/><rect width="6" height="1" x="3" y="11"/><rect width="1" height="6" x="0" y="3"/><rect width="1" height="6" x="11" y="3"/><rect width="1" height="1" x="2" y="1"/><rect width="1" height="1" x="9" y="1"/><rect width="1" height="1" x="1" y="2"/><rect width="1" height="1" x="10" y="2"/><rect width="1" height="1" x="1" y="9"/><rect width="1" height="1" x="10" y="9"/><rect width="1" height="1" x="2" y="10"/><rect width="1" height="1" x="9" y="10"/><rect width="1.5" height="1.5" x="5.25" y="8.25"/><rect width="1.5" height="5" x="5.25" y="2.25"/></svg> `;
                        break;
                    case "x":
                        return ` <svg viewBox="0 0 5 5"${class_string}${id}${tabindex}><rect width="1" height="1" x="0" y="0"/><rect width="1" height="1" x="1" y="1"/><rect width="1" height="1" x="2" y="2"/><rect width="1" height="1" x="3" y="3"/><rect width="1" height="1" x="4" y="4"/><rect width="1" height="1" x="0" y="4"/><rect width="1" height="1" x="1" y="3"/><rect width="1" height="1" x="3" y="1"/><rect width="1" height="1" x="4" y="0"/></svg> `;
                        break;
                    case "bitnote_lock":
                        return ` <svg viewBox="0 0 12 12"${class_string}${id}${tabindex}><rect width="6" height="1" x="3" y="0"/><rect width="6" height="1" x="3" y="11"/><rect width="1" height="6" x="0" y="3"/><rect width="1" height="6" x="11" y="3"/><rect width="1" height="1" x="2" y="1"/><rect width="1" height="1" x="9" y="1"/><rect width="1" height="1" x="1" y="2"/><rect width="1" height="1" x="10" y="2"/><rect width="1" height="1" x="1" y="9"/><rect width="1" height="1" x="10" y="9"/><rect width="1" height="1" x="2" y="10"/><rect width="1" height="1" x="9" y="10"/><rect width="6" height="4" x="3" y="5"/><rect width="1" height="3" x="4" y="3"/><rect width="1" height="3" x="7" y="3"/><rect width="2" height="1" x="5" y="2"/></svg>`;
                        break;
                    case "download_icon":
                        return ` <svg viewBox="0 0 12 12"${class_string}${id}${tabindex}><rect width="6" height="1" x="3" y="0"/><rect width="6" height="1" x="3" y="11"/><rect width="1" height="6" x="0" y="3"/><rect width="1" height="6" x="11" y="3"/><rect width="1" height="1" x="2" y="1"/><rect width="1" height="1" x="9" y="1"/><rect width="1" height="1" x="1" y="2"/><rect width="1" height="1" x="10" y="2"/><rect width="1" height="1" x="1" y="9"/><rect width="1" height="1" x="10" y="9"/><rect width="1" height="1" x="2" y="10"/><rect width="1" height="1" x="9" y="10"/><rect width="6" height="1" x="3" y="6"/><rect width="4" height="1.2" x="4" y="6.8"/><rect width="2" height="6" x="5" y="3"/></svg>`;
                        break;
                    case "wallet_settings":
                        return ` <svg viewBox="0 0 12 12"${class_string}${id}${tabindex}><rect width="6" height="1" x="3" y="0"/><rect width="6" height="1" x="3" y="11"/><rect width="1" height="6" x="0" y="3"/><rect width="1" height="6" x="11" y="3"/><rect width="1" height="1" x="2" y="1"/><rect width="1" height="1" x="9" y="1"/><rect width="1" height="1" x="1" y="2"/><rect width="1" height="1" x="10" y="2"/><rect width="1" height="1" x="1" y="9"/><rect width="1" height="1" x="10" y="9"/><rect width="1" height="1" x="2" y="10"/><rect width="1" height="1" x="9" y="10"/><rect width="1" height="6" x="4" y="3"/><rect width="1" height="6" x="7" y="3"/><rect width="3" height="1" x="3" y="4"/><rect width="3" height="1" x="6" y="7"/></svg>`;
                        break;
                    case "basic_lock":
                        return ` <svg viewBox="0 0 7 7"${class_string}${id}${tabindex}><rect width="6" height="4" x="0.5" y="3"/><rect width="1" height="3" x="1.5" y="1"/><rect width="1" height="3" x="4.5" y="1"/><rect width="2" height="1" x="2.5" y="0"/></svg> `;
                        break;
                    case "basic_unlock":
                        return ` <svg viewBox="0 0 7 7"${class_string}${id}${tabindex}><rect width="6" height="4" x="0.5" y="3"/><rect width="1" height="3" x="1.5" y="1"/><rect width="1" height="1" x="4.5" y="1"/><rect width="2" height="1" x="2.5" y="0"/></svg> `;
                        break;
                    case "checkedbox":
                        return ` <svg viewBox="0 0 7 7"${class_string}${id}${tabindex}><rect width="6.3" height="6.3" x="0.35" y=".35"/><rect width=".8" height=".8" x=".4" y="3.4"/><rect width=".8" height=".8" x="1.2" y="4.2"/><rect width=".8" height=".8" x="2" y="5"/><rect width=".8" height=".8" x="2.8" y="4.2"/><rect width=".8" height=".8" x="3.6" y="3.4"/><rect width=".8" height=".8" x="4.4" y="2.6"/><rect width=".8" height=".8" x="5.2" y="1.8"/><rect width=".8" height=".8" x="6" y="1"/></svg> `;
                        break;
                    case "copy_icon":
                        return ` <svg viewBox="0 0 8 8"${class_string}${id}${tabindex}><rect width="1" height="1" x="1" y="1"/><rect width="1" height="1" x="2" y="1"/><rect width="1" height="1" x="3" y="1"/><rect width="1" height="1" x="4" y="1"/><rect width="1" height="1" x="1" y="4"/><rect width="1" height="1" x="2" y="4"/><rect width="1" height="1" x="1" y="2"/><rect width="1" height="1" x="1" y="3"/><rect width="1" height="1" x="4" y="2"/><rect width="1" height="1" x="3.5" y="3.5"/><rect width="1" height="1" x="3.5" y="4.5"/><rect width="1" height="1" x="3.5" y="5.5"/><rect width="1" height="1" x="3.5" y="6.5"/><rect width="1" height="1" x="6.5" y="3.5"/><rect width="1" height="1" x="6.5" y="4.5"/><rect width="1" height="1" x="6.5" y="5.5"/><rect width="1" height="1" x="6.5" y="6.5"/><rect width="1" height="1" x="4.5" y="3.5"/><rect width="1" height="1" x="5.5" y="3.5"/><rect width="1" height="1" x="4.5" y="6.5"/><rect width="1" height="1" x="5.5" y="6.5"/></svg> `;
                        break;
                    case "checkbox":
                        return ` <svg viewBox="0 0 7 7"${class_string}${id}${tabindex}><rect width="6.3" height="6.3" x="0.35" y=".35"/></svg> `;
                        break;
                    case "magnify":
                        return ` <svg viewBox="0 0 10 10"${class_string}${id}${tabindex}><rect width="4" height="1" x="2" y="0"/><rect width="4" height="1" x="2" y="7"/><rect width="1" height="4" x="0" y="2"/><rect width="1" height="4" x="7" y="2"/><rect width="1" height="1" x="1" y="1"/><rect width="1" height="1" x="1" y="6"/><rect width="1" height="1" x="6" y="1"/><rect width="1" height="1" x="6" y="6"/><rect width="1" height="1" x="7" y="7"/><rect width="1" height="1" x="8" y="8"/><rect width="1" height="1" x="9" y="9"/></svg> `;
                        break;
                    case "three_dot":
                        return ` <svg viewBox="0 0 5 5"${class_string}${id}${tabindex}><rect width="1" height="1" x="2" y="0.25"/><rect width="1" height="1" x="2" y="2"/><rect width="1" height="1" x="2" y="3.75"/></svg> `;
                        break;
                    case "questionmark":
                        return ` <svg viewBox="0 0 5.5 5.5"${class_string}${id}${tabindex}><rect width="1" height="1" x="1.25" y=".25"/><rect width="1" height="1" x="2.25" y=".25"/><rect width="1" height="1" x="3.25" y=".25"/><rect width="1" height="1" x="3.25" y="1.25"/><rect width="1" height="1" x="2.25" y="2.25"/><rect width="1" height="1" x="2.25" y="4.25"/></svg> `;
                        break;
                    case "lightbulb":
                        return ` <svg viewBox="0 0 17 24"${class_string}${id}${tabindex}><path d="M16.4992 2.99947V10.5011H14.998V2.99947H16.4992ZM13.4991 14.9994H14.9982V10.5006H13.4991V14.9994ZM14.998 2.99947V1.49827H13.4989V2.99947H14.998ZM2.99752 17.9998V19.4985L13.499 19.4987V18L2.99752 17.9998ZM10.4986 14.9999V10.501H8.99744V14.9999H7.49834V10.501H5.99983V14.9999H2.99742V16.5011H13.4989V14.9999H10.4986ZM10.4986 10.501H12.0002V4.50083H10.4986V5.99954H8.99744V7.49824H10.4986V10.501ZM4.49843 21.0001V22.5013H6.00002V24H10.4986V22.5013H12.0002V21.0001H4.49843ZM8.99744 9.00013V7.49893H7.49834V9.00013H8.99744ZM6.00002 7.49893H7.49854V6.00022H6.00002V4.50151H4.49843V10.5017H6.00002V7.49893ZM13.4987 1.49871V0H2.99722V1.49871H13.4987ZM2.99722 10.5012H1.49851V15.0001H2.99722V10.5012ZM2.99722 1.49871H1.49851V2.99991H2.99722V1.49871ZM1.49871 2.99991H0V10.5015H1.49871V2.99991Z" fill="white"/></svg> `;
                        break;
                    case "key":
                        return ` <svg viewBox="0 0 19.5 19.5"${class_string}${id}${tabindex}><rect width="6" height="3" x="6.5" y=".5"></rect><rect width="8" height="1.1" x="5.5" y="1.5"></rect><rect width="3" height="6" x="4.5" y="2.5"></rect><rect width="3" height="6" x="11.5" y="2.5"></rect><rect width="6" height="3" x="6.5" y="7.5"></rect><rect width="8" height="1.1" x="5.5" y="8.4"></rect><rect width="3" height="10" x="8" y="9"></rect><rect width="1.7" height="3" x="10.9" y="12"></rect><rect width="2.1" height="3" x="10.9" y="16"></rect></svg> `;
                        break;
                    case "c_card":
                        return ` <svg viewBox="0 0 10 10"${class_string}${id}${tabindex}><rect width="9" height="6" x="0.5" y="2"></rect><rect width="9" height=".1" x="0.5" y="4"></rect><rect width=".1" height=".1" x="2" y="6.5"></rect></svg> `;
                        break;
                    case "eye":
                        return ` <svg viewBox="0 0 16 13"${class_string}${id}${tabindex}><rect width="5" height="1" x="5.5" y="1"/><rect width="2" height="1" x="4" y="2"/><rect width="2" height="1" x="10" y="2"/><rect width="2" height="1" x="3" y="3"/><rect width="2" height="1" x="11" y="3"/><rect width="2" height="1" x="2" y="4"/><rect width="2" height="1" x="12" y="4"/><rect width="2" height="1" x="1" y="5"/><rect width="2" height="1" x="13" y="5"/><rect width="2" height="1" x="0.5" y="6"/><rect width="2" height="1" x="13.5" y="6"/><rect width="2" height="1" x="1" y="7"/><rect width="2" height="1" x="13" y="7"/><rect width="2" height="1" x="2" y="8"/><rect width="2" height="1" x="12" y="8"/><rect width="2" height="1" x="3" y="9"/><rect width="2" height="1" x="11" y="9"/><rect width="2" height="1" x="4" y="10"/><rect width="2" height="1" x="10" y="10"/><rect width="4" height="1" x="6" y="6"/><rect width="2" height="3" x="7" y="5"/><rect width="5" height="1" x="5.5" y="11"/></svg> `;
                        break;
                    case "logout":
                        return ` <svg viewBox="0 0 8 8"${class_string}${id}${tabindex}><rect width="1" height="7" x="0.5" y="0.5"></rect><rect width="2.5" height="1" x="0.5" y="0.5"></rect><rect width="2.5" height="1" x="0.5" y="6.5"></rect><rect width="1" height="1" x="6.5" y="3.5"></rect><rect width="1" height="1" x="5.5" y="4.5"></rect><rect width="1" height="1" x="5.5" y="2.5"></rect><rect width="1" height="1" x="4.5" y="1.5"></rect><rect width="1" height="1" x="4.5" y="5.5"></rect></svg> `;
                        break;
                    case "crypto_icon":
                        return ` <svg viewBox="0 0 20 20" ${class_string}${id}${tabindex}><path d="M7.27259 18.1817H5.45447V20H7.27259V18.1817ZM9.09085 18.1817H7.27259V20H9.09085V18.1817ZM10.909 18.1817H9.09085V20H10.909V18.1817ZM12.7272 18.1817H10.909V20H12.7272V18.1817ZM14.5454 18.1817H12.7272V20H14.5454V18.1817ZM16.3636 16.3636H14.5454V18.1817H16.3636V16.3636ZM18.1817 14.5454H16.3636V16.3636H18.1817V14.5454ZM20 12.7272H18.1817V14.5454H20V12.7272ZM20 10.909H18.1817V12.7272H20V10.909ZM20 9.09085H18.1817V10.909H20V9.09085ZM20 7.27259H18.1817V9.09085H20V7.27259ZM20 5.45447H18.1817V7.27259H20V5.45447ZM18.1817 3.6362H16.3636V5.45447H18.1817V3.6362ZM16.3636 1.81808H14.5454V3.6362H16.3636V1.81808ZM14.5454-0.000181198H12.7272V1.81808H14.5454V-0.000181198ZM12.7272-0.000181198H10.909V1.81808H12.7272V-0.000181198ZM10.909-0.000181198H9.09085V1.81808H10.909V-0.000181198ZM9.09085-0.000181198H7.27259V1.81808H9.09085V-0.000181198ZM7.27259-0.000181198H5.45447V1.81808H7.27259V-0.000181198ZM5.45447 1.81808H3.6362V3.6362H5.45447V1.81808ZM3.6362 3.6362H1.81808V5.45447H3.6362V3.6362ZM1.81808 5.45447H-0.000183105V7.27259H1.81808V5.45447ZM1.81808 7.27259H-0.000183105V9.09085H1.81808V7.27259ZM1.81808 9.09085H-0.000183105V10.909H1.81808V9.09085ZM1.81808 10.909H-0.000183105V12.7272H1.81808V10.909ZM1.81808 12.7272H-0.000183105V14.5454H1.81808V12.7272ZM3.6362 14.5454H1.81808V16.3636H3.6362V14.5454ZM5.45447 16.3636H3.6362V18.1817H5.45447V16.3636ZM18.1818 10.909H16.3637V12.7273H18.1818V10.909ZM14.5454 10.909H12.7273V12.7273H14.5454V10.909ZM16.3637 10.909H14.5454V12.7273H16.3637V10.909ZM16.3637 12.7273H14.5454V14.5454H16.3637V12.7273ZM18.1818 12.7273H16.3637V14.5454H18.1818V12.7273ZM14.5454 12.7273H12.7273V14.5454H14.5454V12.7273ZM14.5454 14.5454H12.7273V16.3637H14.5454V14.5454ZM12.7273 16.3637H10.909V18.1818H12.7273V16.3637ZM14.5454 16.3637H12.7273V18.1818H14.5454V16.3637ZM16.3637 14.5454H14.5454V16.3637H16.3637V14.5454ZM18.1818 5.45447H16.3637V7.27259H18.1818V5.45447ZM3.63627 10.909H1.81816V12.7273H3.63627V10.909ZM5.45454 10.909H3.63627V12.7273H5.45454V10.909ZM7.27266 9.09092H5.45454V10.909H7.27266V9.09092ZM7.27266 7.27266H5.45454V9.09092H7.27266V7.27266ZM5.45454 5.45454H3.63627V7.27266H5.45454V5.45454ZM3.63627 5.45454H1.81816V7.27266H3.63627V5.45454ZM3.63627 7.27266H1.81816V9.09092H3.63627V7.27266ZM3.63627 9.09092H1.81816V10.909H3.63627V9.09092ZM5.45454 9.09092H3.63627V10.909H5.45454V9.09092ZM5.45454 7.27266H3.63627V9.09092H5.45454V7.27266ZM5.45454 14.5454H3.63627V16.3637H5.45454V14.5454ZM5.45454 12.7273H3.63627V14.5454H5.45454V12.7273ZM7.27266 14.5454H5.45454V16.3637H7.27266V14.5454ZM7.27266 16.3637H5.45454V18.1818H7.27266V16.3637ZM9.09092 14.5454H7.27266V16.3637H9.09092V14.5454ZM7.27266 12.7273H5.45454V14.5454H7.27266V12.7273ZM16.3636 5.45454H14.5454V7.27266H16.3636V5.45454ZM14.5454 3.63627H12.7272V5.45454H14.5454V3.63627ZM14.5454 1.81816H12.7272V3.63627H14.5454V1.81816ZM16.3636 3.63627H14.5454V5.45454H16.3636V3.63627ZM14.5454 9.09085H12.7272V10.909H14.5454V9.09085ZM12.7272 9.09085H10.909V10.909H12.7272V9.09085Z"/></svg> `;
                        break;
                    case "bitnote_text":
                        return ` <svg viewBox="0 0 98 23"${class_string}${id}${tabindex}><path d="M14.777 22.5H0.575543V0.399235H13.2015V1.98557H14.777V3.56111H16.3526V9.87407H14.777V11.4496H16.3526V13.036H17.9389V19.3489H16.3526V20.9245H14.777V22.5ZM3.72663 9.87407H11.6259V8.29853H13.2015V5.13665H11.6259V3.56111H3.72663V9.87407ZM3.72663 19.3489H13.2015V17.7734H14.777V14.6115H13.2015V13.036H3.72663V19.3489ZM24.2303 4.34888H21.0792V1.1978H24.2303V4.34888ZM24.2303 22.5H21.0792V6.72299H24.2303V22.5ZM35.2699 22.5H30.5324V20.9245H28.9569V9.0863H26.5936V6.72299H28.9569V1.98557H32.1188V6.72299H35.2699V9.0863H32.1188V19.3489H35.2699V22.5ZM40.8058 22.5H37.6548V0.399235H42.3814V3.56111H43.9677V6.72299H45.5433V9.87407H47.1188V13.036H48.7051V16.187H50.2807V0.399235H53.4318V22.5H48.7051V19.3489H47.1188V16.187H45.5433V13.036H43.9677V9.87407H42.3814V6.72299H40.8058V22.5ZM67.6548 22.5H59.7555V20.9245H58.18V19.3489H56.6044V9.87407H58.18V8.29853H59.7555V6.72299H67.6548V8.29853H69.2304V9.87407H70.8059V19.3489H69.2304V20.9245H67.6548V22.5ZM61.3311 19.3489H66.0685V17.7734H67.6548V11.4496H66.0685V9.87407H61.3311V11.4496H59.7555V17.7734H61.3311V19.3489ZM81.0685 22.5H76.3311V20.9245H74.7556V9.0863H72.3922V6.72299H74.7556V1.98557H77.9174V6.72299H81.0685V9.0863H77.9174V19.3489H81.0685V22.5ZM94.5038 22.5H86.6045V20.9245H85.029V19.3489H83.4534V9.87407H85.029V8.29853H86.6045V6.72299H94.5038V8.29853H96.0793V9.87407H97.6549V15.3993H86.6045V17.7734H88.18V19.3489H92.9175V17.7734H97.6549V19.3489H96.0793V20.9245H94.5038V22.5ZM86.6045 13.036H94.5038V11.4496H92.9175V9.87407H88.18V11.4496H86.6045V13.036Z"/></svg> `;
                        break;
                    case "twitter_icon":
                        return ` <svg viewBox="0 0 18 18"${class_string}${id}${tabindex}><path d="M18 3.73137C17.3306 4.025 16.6174 4.21962 15.8737 4.31412C16.6387 3.85737 17.2226 3.13962 17.4971 2.2745C16.7839 2.69975 15.9964 3.00013 15.1571 3.16775C14.4799 2.44663 13.5146 2 12.4616 2C10.4186 2 8.77387 3.65825 8.77387 5.69112C8.77387 5.98362 8.79862 6.26487 8.85937 6.53262C5.7915 6.383 3.07687 4.91262 1.25325 2.67275C0.934875 3.22512 0.748125 3.85737 0.748125 4.538C0.748125 5.816 1.40625 6.94887 2.38725 7.60475C1.79437 7.5935 1.21275 7.42137 0.72 7.15025C0.72 7.1615 0.72 7.17612 0.72 7.19075C0.72 8.984 1.99912 10.4735 3.6765 10.8166C3.37612 10.8987 3.04875 10.9381 2.709 10.9381C2.47275 10.9381 2.23425 10.9246 2.01037 10.8751C2.4885 12.3365 3.84525 13.4109 5.4585 13.4457C4.203 14.4279 2.60887 15.0196 0.883125 15.0196C0.5805 15.0196 0.29025 15.0061 0 14.969C1.63462 16.0231 3.57187 16.625 5.661 16.625C12.4515 16.625 16.164 11 16.164 6.12425C16.164 5.96112 16.1584 5.80362 16.1505 5.64725C16.8829 5.1275 17.4982 4.47837 18 3.73137Z"/></svg> `;
                        break;
                    case "telegram_icon":
                        return ` <svg viewBox="0 0 40 40"${class_string}${id}${tabindex}><path d="M40 20C40 31.0457 31.0457 40 20 40C8.95431 40 0 31.0457 0 20C0 8.95431 8.95431 0 20 0C31.0457 0 40 8.95431 40 20ZM20.7167 14.7649C18.7714 15.574 14.8835 17.2486 9.05313 19.7889C8.10637 20.1654 7.61041 20.5337 7.56526 20.8938C7.48896 21.5025 8.25117 21.7422 9.2891 22.0685C9.43029 22.1129 9.57657 22.1589 9.72654 22.2077C10.7477 22.5396 12.1214 22.928 12.8355 22.9434C13.4832 22.9574 14.2062 22.6903 15.0044 22.1422C20.4519 18.465 23.2639 16.6063 23.4405 16.5663C23.565 16.538 23.7376 16.5025 23.8546 16.6064C23.9715 16.7103 23.96 16.9072 23.9476 16.96C23.8721 17.2819 20.8801 20.0635 19.3318 21.503C18.8491 21.9517 18.5068 22.27 18.4368 22.3427C18.28 22.5056 18.1202 22.6596 17.9666 22.8077C17.0179 23.7222 16.3065 24.408 18.006 25.528C18.8227 26.0662 19.4762 26.5112 20.1282 26.9552C20.8403 27.4401 21.5505 27.9238 22.4693 28.5261C22.7034 28.6796 22.927 28.839 23.1448 28.9942C23.9734 29.585 24.7179 30.1157 25.6376 30.0311C26.1721 29.9819 26.7241 29.4794 27.0044 27.9806C27.667 24.4386 28.9694 16.7641 29.2703 13.6016C29.2967 13.3245 29.2635 12.9699 29.2369 12.8143C29.2103 12.6586 29.1546 12.4368 28.9523 12.2726C28.7126 12.0782 28.3427 12.0372 28.1773 12.0401C27.425 12.0534 26.2709 12.4547 20.7167 14.7649Z"/></svg> `;
                        break;
                    case "referral_icon":
                        return `<svg viewBox="0 0 53 53"${class_string}${id}${tabindex}><path d="M13.6875 0.875V5.14583H17.9583H22.2292H26.5H30.7708H35.0417H39.3125V0.875H35.0417H30.7708H26.5H22.2292H17.9583H13.6875ZM39.3125 5.14583V9.41667H43.5833V5.14583H39.3125ZM43.5833 9.41667V13.6875H47.8542V9.41667H43.5833ZM47.8542 13.6875V17.9583V22.2292V26.5V30.7708V35.0417V39.3125H52.125V35.0417V30.7708V26.5V22.2292V17.9583V13.6875H47.8542ZM47.8542 39.3125H43.5833V43.5833H47.8542V39.3125ZM43.5833 43.5833H39.3125V47.8542H43.5833V43.5833ZM39.3125 47.8542H35.0417H30.7708H26.5H22.2292H17.9583H13.6875V52.125H17.9583H22.2292H26.5H30.7708H35.0417H39.3125V47.8542ZM13.6875 47.8542V43.5833H9.41667V47.8542H13.6875ZM9.41667 43.5833V39.3125H5.14583V43.5833H9.41667ZM5.14583 39.3125V35.0417V30.7708V26.5V22.2292V17.9583V13.6875H0.875V17.9583V22.2292V26.5V30.7708V35.0417V39.3125H5.14583ZM5.14583 13.6875H9.41667V9.41667H5.14583V13.6875ZM9.41667 9.41667H13.6875V5.14583H9.41667V9.41667ZM26.5 9.41667V13.6875V17.9583H30.7708H35.0417V13.6875V9.41667H30.7708H26.5ZM26.5 17.9583H22.2292H17.9583V22.2292H22.2292H26.5V17.9583ZM17.9583 22.2292H13.6875H9.41667V26.5V30.7708H13.6875H17.9583V26.5V22.2292ZM17.9583 30.7708V35.0417H22.2292H26.5V30.7708H22.2292H17.9583ZM26.5 35.0417V39.3125V43.5833H30.7708H35.0417V39.3125V35.0417H30.7708H26.5Z"/></svg>`;
                        break;
                    }
                }
            }
            function getCustomToastCss() {
                return {
                    custom_css: ` .toasts_container{position:fixed;width:100%;height:100vh;z-index:10;pointer-events:none;font-size: calc(1vw + 1vh) / 2);left:0} .toasts_inner_container{width:100%} .toasts_success,.toasts_error,.toasts_wait{font-family:arial;margin:.75em auto;padding:.5em 1em;opacity:0;transition:opacity .5s ease;max-width:15em} .toasts_success{color:#000;background-color:#fff;box-shadow:#dddddddd 0 0 0.3em 0.1em} .toasts_error{color:#fff;background-color:#fd4f4f;box-shadow:#fd4f4faa 0 0 0.3em 0.1em} .toasts_wait{color:#000;background-color:#bf4acf;box-shadow:rgba(245, 134, 255,.6) 0 0 0.3em 0.1em} .toasts_status{font-size:1.1em;font-weight:bold;margin:0} .toasts_message{font-size:.8em;margin:0} `
                };
            }
            function saveLocalBackup(username="", json_encrypted_notes, keys) {
                var export_assets = {};
                export_assets.bitnote_text = hb.getSvg("bitnote_text", {
                    class_string: "bitnote_logo_text"
                });
                export_assets.bitnote_lock = hb.getSvg("bitnote_lock", {
                    class_string: "bitnote_logo_icon"
                });
                export_assets.eye = hb.getSvg("eye", {
                    class_string: "input_inline_eye_svg"
                });
                var pre_csp = callExportHTML(ww_script, JSON.stringify(json_encrypted_notes), export_assets, keys);
                generateCspContent(pre_csp, function(csp) {
                    var with_csp = callExportHTML(ww_script, JSON.stringify(json_encrypted_notes), export_assets, keys, csp);
                    download(username + "_bitnote_export.html", with_csp);
                });
            }
            function generateHash(input, cb) {
                window.crypto.subtle.digest('SHA-256', new TextEncoder().encode(input)).then(function(hash) {
                    const hashBase64 = btoa(String.fromCharCode.apply(null, new Uint8Array(hash)));
                    cb(hashBase64);
                });
            }
            function generateCspContent(html_file, cb) {
                var csp_js = html_file.match(/<script>(.|\n)*<\/script>/)[0];
                csp_js = csp_js.replace("<" + "script>", "");
                csp_js = csp_js.replace("</" + "script>", "");
                generateHash(csp_js, function(js_hash) {
                    js_hash = "sha256-" + js_hash;
                    var csp_css = html_file.match(/<style>(.|\n)*<\/style>/)[0];
                    csp_css = csp_css.replace("<" + "style>", "");
                    csp_css = csp_css.replace("</" + "style>", "");
                    generateHash(csp_css, function(css_hash) {
                        css_hash = "sha256-" + css_hash;
                        var ret_csp = `default-src 'self'; script-src '${js_hash}'; style-src '${css_hash}'; worker-src 'self' blob:; img-src 'self' data:;`;
                        cb(ret_csp);
                    });
                });
            }
            function download(filename, text) {
                var d = document.createElement('a');
                d.setAttribute('href', 'data:text/html;charset=utf-8,' + encodeURIComponent(text));
                d.setAttribute('download', filename);
                if (document.createEvent) {
                    var event = document.createEvent('MouseEvents');
                    event.initEvent('click', true, true);
                    d.dispatchEvent(event);
                } else
                    d.click();
            }
            function callExportHTML(ww_script, json_encrypted_notes, main_assets, keys, csp=null) {
                return getExportHTML(ww_script, json_encrypted_notes, main_assets, keys, csp);
                function getExportHTML(ww_script, json_encrypted_notes, main_assets, keys, csp=null) {
                    let ww_script_64 = btoa(ww_script);
                    csp = (checkForProperty(csp)) ? csp : `"default-src 'self';"`;
                    var meta_csp = "<meta" + ` http-equiv="Content-Security-Policy" content="${csp}">`;
                    return ` <!DOCTYPE html><html><head><title>BitNote Backup</title><meta http-equiv=Content-Type content="text/html; charset=UTF-8"> ${meta_csp} <meta name=viewport content="width=device-width, initial-scale=1.0"><link rel=icon type=image/png href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAMAAAD04JH5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAZQTFRF////AAAAVcLTfgAAAJFJREFUeNrs2kEOwCAIBED6/0/3CVbRKma4GjZzMgaMZ3MFAAAAAAAAQBlAdBYAAMA9gN7A3j4AAIBzAa2ArxdP8xwAAOA4wGjgcB8AAAAAAABAGUB2QAEAAAAAAAAAAAAAAAAAAFAHkF1Y/rYxAQAAWA7IQnzhAAC4BzDrQQIAAFAfsKoAAAAAAAAAtgNeAQYAzqswgc0CbIoAAAAASUVORK5CYII="/><style>*,*:before,*:after{box-sizing:inherit} html{box-sizing:border-box;height:100%;font-family:system-ui,arial,Helvetica,sans-serif;color:#fff;font-size:16px;} body{height:100%;background-color:#000;padding:0;margin:0} #unlock_form{max-width: 575px;width: 100%;position:relative;display:flex;align-items:center;} #bitnote_pw_container{width:100%;display:flex;align-items:center;justify-content:center;flex-direction: column;margin:24px 0} .unlock_bitnote{outline:none;border:none;font-size:18px;color:#fff;background-color:#1e1e1e;padding:23px 50px 23px 23px;width:100%;} #output_container{display:none;} td,th{padding:5px 10px;text-align:left;} .bitnote_logo_text{height:50px;fill:#fff;margin-right: 2.16px;} .bitnote_logo_icon{height:36px;fill:#fff;margin:4px 2.16px 0} .input_inline_eye_svg{height:20px;width:20px;padding:3px 0;position:absolute;right:18px;opacity:.5;fill:#fff;cursor:pointer;user-select:none;} .topbar_container{width:100%;display:flex;justify-content:center;padding-top:32px;height:35vh;align-items:end;} .topbar_link{line-height:0;font-size:0;} #unlock_button{width:100%;max-width:575px;height:60px;background-color:#eef3fa;margin:16px 0;cursor:pointer;border:none;user-select:none;font-weight:500;font-size:20px} #create_import, .public_key_input{display:none;} </style></head><body><noscript>Turn your JavaScript on or this ain't gonna work</noscript><div class=topbar_container><a class=topbar_link href="https://bitnote.xyz" target=_blank> ${main_assets.bitnote_text} ${main_assets.bitnote_lock} </a></div><div id=bitnote_pw_container><form id=unlock_form><input class=unlock_bitnote type=password placeholder="Enter BitNote Password"></input> ${main_assets.eye} </form><button id=unlock_button>Unlock</button></div><button id=create_import>Copy Import String</button><input class=public_key_input placeholder="Paste Public Key"></input><div id=output_container><table><tr><th>Note Title:</th><th>Note:</th></tr></table></div><script> window.addEventListener("DOMContentLoaded", domInit); window.addEventListener("load", loadInit); let exp_user_obj; let ww_h; let exp_ecdh_enc_pk="${keys.ecdh_enc_pk_hex}"; let exp_ecdh_public="${keys.ecdh_public_hex}"; let exp_encrypted_key="${keys.encrypted_key}"; let exp_address="${keys.address}"; let export_public_key=exp_ecdh_public; let active_ecdh_priv_buff=null; function domInit(){ var script_list=[]; loadScripts(script_list); loadWorker(getWorker()); } function loadScripts(script_list){ for(var i=0; i < script_list.length; i++){ var new_script=document.createElement("script"); new_script.src=script_list[i]; document.body.appendChild(new_script); } } function loadInit(){ exp_ecdh_public=hexToArrayBuffer(exp_ecdh_public, Uint8Array).buffer; exp_ecdh_enc_pk=hexToArrayBuffer(exp_ecdh_enc_pk, Uint8Array).buffer; exp_user_obj={}; initActiveUserObj(); document.getElementsByClassName("unlock_bitnote")[0].focus(); } function loadWorker(worker_blob){ ww_h=new blobWorkersHandler(); ww_h.loadWorkerFromBlob(worker_blob); } function getWorker(){ var tc="${ww_script_64}"; var str=atob(tc); return URL.createObjectURL(new Blob([str], { type: 'application/javascript'})); } function initActiveUserObj(){ exp_user_obj.note_obj_array=${json_encrypted_notes}; initSort(); initPwBox(); } function initSort(){ exp_user_obj.sorted_obj=sortNotes(exp_user_obj.note_obj_array, {asc: false, type:"ts"}); } function initPwBox(){ document.getElementById("unlock_form").addEventListener("submit", unlockKey); document.getElementById("unlock_button").addEventListener("click", unlockKey); document.getElementsByClassName("input_inline_eye_svg")[0].addEventListener("click", togglePasswordView); function unlockKey(e){ e.preventDefault(); var text_encoder=new TextEncoder(); var encoded_material=text_encoder.encode(document.getElementsByClassName("unlock_bitnote")[0].value.trim()); unlockAccount(exp_encrypted_key, exp_ecdh_enc_pk, encoded_material.buffer, function(unlocked){ if(unlocked){ unlockManyNotesFromView(function(){ }); } else inputFlash(document.getElementsByClassName("unlock_bitnote")[0]); }); } } function togglePasswordView(e){ var input_ele=document.getElementsByClassName("unlock_bitnote")[0]; if(input_ele.type=="password"){ input_ele.type=""; e.target.style.opacity="1"; } else{ input_ele.type="password"; e.target.style.opacity=".5"; } } function setImportButton(){ var create_import=document.getElementById("create_import"); create_import.style.display="block"; document.getElementsByClassName("public_key_input")[0].style.display="block"; create_import.addEventListener("click", createImport); }  function createImport(e){ let public_key=getPublicKey(); if(checkForProperty(public_key)){ var import_json=prepImport(); encryptImport(import_json, public_key, function(ret){ ret=export_public_key+"_"+ret; const original_button_text=e.target.innerText; e.target.innerText="copied!"; copy_to_clipboard(ret, function(result){ if(result){ window.setTimeout(function(){ e.target.innerText=original_button_text; }, 500); } }); }); } } function encryptImport(import_json, public_key, cb){ var msg_param={ msg_buff: (new TextEncoder().encode(import_json).buffer), ecdh_pub: hexToArrayBuffer(public_key, Uint8Array).buffer, }; ecdhEncrypt(msg_param, function(hex_ret){ cb(hex_ret); }); } function getPublicKey(){ var tc=document.getElementsByClassName("public_key_input")[0].value.trim(); tc=tc.match(/^(0x){0,1}[0-9a-f]+$/i); if(checkForProperty(tc)){ tc=tc[0]; if(tc.length % 2===0) return tc; } return null; } function prepImport(){ var import_json=getImport(); return import_json; } function getImport(){ var import_array=[]; for(var i=0; i < exp_user_obj.sorted_obj.note_pos_array.length; i++){ var note=exp_user_obj.note_obj_array[exp_user_obj.sorted_obj.note_pos_array[i]].de_note; var title=exp_user_obj.note_obj_array[exp_user_obj.sorted_obj.note_pos_array[i]].de_title; import_array.push({note, title}); } return JSON.stringify(import_array); } function unlockManyNotesFromView(cb){ var text_decoder=new TextDecoder(); let pos=0; let max_pos=exp_user_obj.sorted_obj.note_pos_array.length-1; let key_confirmed=false; let output_container=document.getElementById("output_container"); (function checkNext(pos){ if(pos >=0 && pos <=max_pos){ let current_note_obj=exp_user_obj.note_obj_array[exp_user_obj.sorted_obj.note_pos_array[pos]]; var ecdh_pub=exp_ecdh_public.slice(); var msg_buff=hexToArrayBuffer(current_note_obj.salt+current_note_obj.encrypted_note, Uint8Array).buffer; ecdhDecrypt({msg_buff, ecdh_pub}, function(decoded_note){ if(decoded_note !=null){ if(key_confirmed==false) setOutputContainer(); current_note_obj=parseDecryptedNote(current_note_obj, decoded_note); var new_row=document.createElement("tr"); new_row.innerHTML="<td></td><td></td>"; new_row.firstElementChild.innerText=current_note_obj.title; new_row.lastElementChild.innerText=current_note_obj.decrypted; output_container.firstElementChild.appendChild(new_row); exp_user_obj.note_obj_array[exp_user_obj.sorted_obj.note_pos_array[pos]].de_note=current_note_obj.decrypted; exp_user_obj.note_obj_array[exp_user_obj.sorted_obj.note_pos_array[pos]].de_title=current_note_obj.title; checkNext(++pos); } }); } else cb(); })(pos); function setOutputContainer(){ key_confirmed=true; document.getElementById("bitnote_pw_container").style.display="none"; document.getElementsByClassName("bitnote_logo_text")[0].style.height="28px"; document.getElementsByClassName("bitnote_logo_icon")[0].style.height="20px"; document.getElementsByClassName("topbar_container")[0].style.height="auto"; output_container.style.display="block"; } } function unlockAccount(encrypted_key, ecdh_pk, encoded_material, cb){ ww_h.sendMessageToWorker({msg_type:"set_mp", key_buff:encoded_material}, [encoded_material], function(success){ if(success) attemptDecrypt(encrypted_key, ecdh_pk, cb); else cb(false); }); } function attemptDecrypt(encrypted_key, encrypted_ecdh, cb){ var salt_byte_len=12; var salt_hex_len=24; var cipher_buff=hexToArrayBuffer(encrypted_key.slice(salt_hex_len), Uint8Array).buffer; var salt_buff=hexToArrayBuffer(encrypted_key.slice(0,salt_hex_len), Uint8Array).buffer; var ecdh_buff=encrypted_ecdh.slice(salt_byte_len); var ecdh_salt_buff=encrypted_ecdh.slice(0,salt_byte_len); var msg_param={ msg_type: "unlock_ac", cipher_buff: cipher_buff, salt_buff: salt_buff, ecdh_buff: ecdh_buff, ecdh_salt_buff: ecdh_salt_buff, }; var transfer_array=[msg_param.cipher_buff, msg_param.salt_buff, msg_param.ecdh_buff, msg_param.ecdh_salt_buff]; ww_h.sendMessageToWorker(msg_param, transfer_array, cb); } function parseDecryptedNote(current_note, decrypted_stuff){ if(checkForProperty(current_note)){ var anchor_point=decrypted_stuff.indexOf(String.fromCodePoint(216)); var title=decrypted_stuff.slice(0,anchor_point); decrypted_stuff=decrypted_stuff.slice(anchor_point+1); current_note.title=title; current_note.decrypted=decrypted_stuff; return current_note; } else return null; } function ecdhDecrypt(params, cb, custom_decoder=null){ var msg_param={ msg_type: "ecdh_de", msg_buff: params.msg_buff, ecdh_pub: params.ecdh_pub }; var transfer_array=[msg_param.msg_buff, msg_param.ecdh_pub]; if(checkForProperty(params.ecdh_pk_buff)){ msg_param.ecdh_pk_buff=params.ecdh_pk_buff; transfer_array.push(msg_param.ecdh_pk_buff); } if(checkForProperty(params.aad)){ transfer_array.push(params.aad); msg_param.aad=params.aad; } ww_h.sendMessageToWorker(msg_param, transfer_array, function(ret){ if(ret !=null) noteDecoder(ret.decrypted_buff, cb); else cb(null); }); } function ecdhEncrypt(params, cb){ noteEncoder(params.msg_buff, encryptMessage); function encryptMessage(msg_buff){ var msg_param={ msg_type: "ecdh_enc", msg_buff: msg_buff, ecdh_pub: params.ecdh_pub }; var transfer_array=[msg_param.msg_buff, msg_param.ecdh_pub]; if(checkForProperty(params.ecdh_pk_buff)){ msg_param.ecdh_pk_buff=params.ecdh_pk_buff; transfer_array.push(msg_param.ecdh_pk_buff); } if(checkForProperty(params.aad)){ transfer_array.push(params.aad); msg_param.aad=params.aad; } ww_h.sendMessageToWorker(msg_param, transfer_array, function(ret){ if(ret !=null) cb(bufferToHex(ret.salt_buff)+bufferToHex(ret.encrypted_buff)); else cb(null); }); } } function noteEncoder(note_text, cb){ compressor(note_text, true, cb); } function noteDecoder(note_text, cb){ compressor(note_text, false, function(decompressed_text){ cb(new TextDecoder().decode(decompressed_text)); }); } function compressor(text, compress=true, cb) { var cs; var enc_alg="deflate-raw"; if(compress){ cs=new CompressionStream(enc_alg); text=new TextEncoder().encode(text); } else cs=new DecompressionStream(enc_alg); const writer=cs.writable.getWriter(); writer.write(text); writer.close(); const chunks=[]; const reader=cs.readable.getReader(); (function readNext(){ reader.read().then(function(result){ if(!result.done){ chunks.push(result.value); readNext(); } else cb((new Uint8Array(chunks.reduce((acc, val)=> acc.concat(Array.from(val)), []))).buffer); }); })(); } function bufferToHex (buffer) { return [...new Uint8Array (buffer)].map (b=> b.toString (16).padStart (2, "0")).join (""); } function validHexStr(str){ if(/^(0x){0,1}[0-9a-f]+$/i.test(str)) return true; else return false; } function sortNotes(note_array, sort_obj){ var temp_list=note_array.slice(); var sort_type, active_column; active_column=sort_obj.type; switch(active_column){  case "ts": sort_type="number"; break; } if(temp_list.length > 0){ if(sort_type=="number") temp_list.sort(compareNumbers); else temp_list.sort(compareStrings); } var ret_obj; var new_note_pos_array=[]; var new_id_ptr_obj={}; for (var i=0; i < temp_list.length; i++){ new_note_pos_array.push(temp_list[i].chain_pos); new_id_ptr_obj[temp_list[i].id]={sort_pos: i, chain_pos: temp_list[i].chain_pos}; } ret_obj={note_pos_array: new_note_pos_array, id_ptr_obj: new_id_ptr_obj}; return ret_obj; function compareNumbers(a, b){ a[active_column]=(a[active_column]==null) ?-1 : a[active_column]; b[active_column]=(b[active_column]==null) ?-1 : b[active_column]; return (sort_obj.asc) ? a[active_column]-b[active_column] : b[active_column]-a[active_column]; } function compareStrings(a,b){ a[active_column]=(a[active_column]==null) ? "" : a[active_column]; b[active_column]=(b[active_column]==null) ? "" : b[active_column]; return (sort_obj.asc) ? a[active_column].localeCompare(b[active_column]) : b[active_column].localeCompare(a[active_column]); } } function hexToArrayBuffer(hex_str, buffer_type=null){ const regex=new RegExp(/0x/i); if(regex.test(hex_str.substring(0,2))) hex_str=hexStringToHexNumber(hex_str); var ret=[]; for(var i=0; i < hex_str.length/2; i++){ var x=i*2; const n=parseInt(hex_str.substr(x, 2), 16); ret.push(n); } if(buffer_type) return new buffer_type(ret); else return ret; } function checkForProperty(prop){return (prop==="" || prop===null || prop===undefined) ? false : true;} function inputFlash(ele, ms_time=1000, options={bg: "#fd4f4f", color:"#fff", fill:"#fff"}){ (function flash(on=false){ if(on){ ele.style.backgroundColor=options.bg; ele.style.color=options.color; ele.style.fill=options.fill; window.setTimeout(flash, ms_time); } else{ ele.style.backgroundColor=null; ele.style.color=null; ele.style.fill=null; } })(true); } function copy_to_clipboard(text_to_copy, cb=null){ navigator.clipboard.writeText(text_to_copy).then(()=> { if(cb !=null) cb(true); }).catch(err=> { if(cb !=null) cb(false, err); }); } function clear_clipboard(cb=null, params={}){ let prefix=(params.prefix !=null) ? params.prefix : ""; let suffix=(params.suffix !=null) ? params.suffix : ""; let default_item_clear=(params.item_clear !=null) ? params.item_clear : 40; (function next(pointer){ if(pointer < default_item_clear){ navigator.clipboard.writeText(prefix+pointer+suffix).then(function(){++pointer; window.setTimeout(function(){next(pointer)}, 250); }); } else if(cb !=null){ cb(true); cb=null; } })(0); } function blobWorkersHandler(){ let workers=[]; let worker_pointer=0; let worker_blob=null; this.loadWorkerScript=loadWorkerScript; function loadWorkerScript(new_worker_url, cb){ getWorkerScript(new_worker_url, function(ret_blob, ret_script){ if(ret_blob !=null){ worker_blob=ret_blob; cb(true, ret_script); } else cb(false, null); }); } this.loadWorkerFromBlob=loadWorkerFromBlob; function loadWorkerFromBlob(new_blob, cb){ worker_blob=new_blob; buildWorkers(worker_blob); } this.scriptReady=scriptReady; function scriptReady(){return (worker_blob !=null) ? true : false} this.initWorkers=initWorkers; function initWorkers(cb){ buildWorkers(worker_blob); sendMessageToWorker({msg_type:"get_version"}, [], function(ret){ cb(ret); }); } this.sendMessageToWorker=sendMessageToWorker; function sendMessageToWorker(msg_param, transfer_array, cb){ let temp_pointer=worker_pointer; worker_pointer=(worker_pointer+1 < workers.length) ? worker_pointer+1 : 0; sendArrayBufferToWorker(temp_pointer, msg_param, transfer_array, cb); } function sendArrayBufferToWorker(worker_pointer, msg_param, transfer_array, cb) { workers[worker_pointer].worker.postMessage(msg_param, transfer_array); if(cb !=null) workers[worker_pointer].worker.addEventListener("message", handleDeResponse); function handleDeResponse(event){ workers[worker_pointer].worker.removeEventListener("message", handleDeResponse); var data=event.data; if(cb !=null) cb(data); } } function buildWorkers(worker_blob_obj){ const num_workers=1; for(var i=0; i < num_workers; i++) workers.push({id: i, worker: createWorker_blob(worker_blob_obj), in_use:false}); function createWorker_blob(blobURL) { const worker=new Worker(blobURL); return worker; } } function getWorkerScript(main_worker_url, cb){ const xhr=new XMLHttpRequest(); xhr.open('GET', main_worker_url, true); xhr.onreadystatechange=function (){ var ret; if(xhr.readyState===4 && xhr.status===200) cb(URL.createObjectURL(new Blob([xhr.response], { type: 'application/javascript'})), xhr.responseText); else if(xhr.readyState===4) cb(null); }; xhr.send(); } } </scr` + `ipt></body></html> `;
                }
            }
            function checkIfTrue(prop) {
                return (checkForProperty(prop) && prop === true) ? true : false;
            }
            function callbackIfExists(callback=null, cb_value) {
                if (callback != null)
                    callback(cb_value);
            }
            function alerts_handler(handler_params={}) {
                let hp;
                let custom_view_icon;
                let custom_cancel_ele;
                (function init() {
                    hp = handler_params;
                    hp.bg_color = (checkForProperty(hp.bg_color) ? hp.bg_color : "#000");
                    hp.class_prefix = (checkForProperty(hp.class_prefix) ? hp.class_prefix + "_" : "");
                    custom_view_icon = (checkForProperty(hp.custom_view_icon)) ? hp.custom_view_icon : "&#128065";
                    custom_cancel_ele = (checkForProperty(hp.custom_cancel_ele)) ? hp.custom_cancel_ele : null;
                    var css = (checkForProperty(handler_params.custom_css)) ? handler_params.custom_css : ` .alerts_container{display:flex;font-size: calc(1vw + 1vh) / 2);color:#fff;font-family:system-ui;position: fixed;align-items: center;justify-content: center;top:0;left:0;width:100vw;height:100vh;z-index:2140000001;background-color:${handler_params.bg_color}} .alerts_message_ele{font-size:1.5em;font-weight:400;text-align:center;} .alerts_prevent_bg_scroll{overflow:hidden;} #alerts_inner_container{width:85vmin;background-color:gray;border-radius:0.75vmin;max-height: 90vh;overflow: auto;} #alert_input_container{display:inline-flex;justify-content:center;width:100%;margin: 1em 0;} #alerts_view_input{cursor:pointer;margin:0 .5em;opacity:.5;user-select:none} #alerts_input_box{max-width:85%;width: 35em;white-space: nowrap;} .alerts_std_btn{background-color: rgb(239, 239, 239);margin: 0 0.4rem;display: inline-block;padding: 0 0.2rem;border-radius: 0.15rem;color:#000;font-size: 1.4em;border: 1px solid #000;user-select: none;cursor: pointer;} .alerts_std_btn:active{transform:scale(.95)} .alerts_std_btn:focus{background-color:#970000;color:#fff} .alerts_btn_container{display: inline-flex;justify-content: center;width: 100%;margin: 0 0 1em;} .alerts_boomer_close{position: absolute;top: 0;right: 0;margin: 0.25em;font-size: 2em;line-height: 1;cursor:pointer;user-select:none;} `;
                    css = css.trim().split("}");
                    var styles = window.document.styleSheets[0];
                    for (var i = 0; i < css.length - 1; i++) {
                        var new_style = (css[i] + "}").trim();
                        styles.insertRule(new_style);
                    }
                }
                )();
                function tempTest() {
                    setAlert("hidden_input", {
                        alert_msg: ["Enter your encryption phrase", "Retype your encryption phrase"],
                        simple_close: true,
                        confirm_req: 2
                    }, function(qq) {
                        var qew = qq;
                    });
                }
                this.setAlert = setAlert;
                function setAlert(alert_type="input", user_params={}, cb) {
                    let params = {};
                    let alert_obj = {
                        event_array: []
                    };
                    (function init() {
                        createListener({
                            ele: document,
                            func: catchKeys,
                            type: "keypress",
                            options: true
                        });
                        var focus_set = false;
                        params.confirm_count = 0;
                        params.confirm_req = (checkForProperty(user_params.confirm_req) ? user_params.confirm_req : 1);
                        params.simple_close = (checkForProperty(user_params.simple_close) ? user_params.simple_close : false);
                        params.alert_msg = prepArray(checkForProperty(user_params.alert_msg) ? user_params.alert_msg : "Are you sure?");
                        params.submit_label = prepArray(checkForProperty(user_params.submit_label) ? user_params.submit_label : "Submit");
                        params.cancel_label = prepArray(checkForProperty(user_params.cancel_label) ? user_params.cancel_label : "Cancel");
                        params.sub_heading = (checkForProperty(user_params.sub_heading) ? user_params.sub_heading : "");
                        params.no_cancel_button = (checkForProperty(user_params.no_cancel_button) ? user_params.no_cancel_button : false);
                        params.init_value = (checkForProperty(user_params.init_value) ? user_params.init_value : "");
                        var custom_placeholder = (checkForProperty(user_params.placeholder) ? "placeholder='" + user_params.placeholder + "'" : "");
                        alert_obj.container_ele = document.createElement("div");
                        alert_obj.container_ele.className = "alerts_container";
                        document.body.prepend(alert_obj.container_ele);
                        document.body.classList.add("alerts_prevent_bg_scroll");
                        alert_obj.container_ele.innerHTML = "<div id=alerts_inner_container><h2 class=alerts_message_ele></h2></div>";
                        alert_obj.inner_container_ele = alert_obj.container_ele.firstElementChild;
                        switch (alert_type) {
                        case "hidden_input":
                            alert_obj.inner_container_ele.innerHTML += ` <form id=alert_input_container autocomplete="off"><input id=alerts_input_box type=password autocomplete="new-password" ${custom_placeholder}></input><span id=alerts_view_input>${custom_view_icon}</span></form> `;
                            addBiometricsButton();
                            params.view_input = document.getElementById("alerts_view_input");
                            createListener({
                                ele: params.view_input,
                                func: viewHiddenInput,
                                type: "click"
                            });
                            params.input_box = document.getElementById("alerts_input_box");
                            params.input_box.focus();
                            focus_set = true;
                            setFormSubmit();
                            break;
                        case "input":
                            var inner_c_html = (!params.sub_heading) ? "" : `<p class=confirm_sub_heading>${params.sub_heading}</p>`;
                            inner_c_html += ` <form id=alert_input_container autocomplete="off"><input id=alerts_input_box autocomplete="new-password" ${custom_placeholder}></input></form> `;
                            alert_obj.inner_container_ele.innerHTML += inner_c_html;
                            params.input_box = document.getElementById("alerts_input_box");
                            params.input_box.focus();
                            focus_set = true;
                            setFormSubmit();
                            break;
                        case "match_input":
                            alert_obj.inner_container_ele.innerHTML += ` <form id=alert_input_container autocomplete="off"><input id=alerts_input_box autocomplete="new-password" ${custom_placeholder}></input></form> `;
                            params.match_input = prepArray(user_params.match_input);
                            params.input_box = document.getElementById("alerts_input_box");
                            params.input_box.focus();
                            focus_set = true;
                            setFormSubmit();
                            break;
                        case "confirm":
                            if (checkForProperty(params.sub_heading))
                                document.getElementById("alerts_inner_container").innerHTML += "<p class=confirm_sub_heading>" + params.sub_heading + "</p>";
                            break;
                        case "custom_bitnote_1":
                            alert_obj.inner_container_ele.innerHTML += ` <form id=alert_input_container autocomplete="off"><input id=alerts_input_box type=password autocomplete="new-password"></input><span id=alerts_view_input>${custom_view_icon}</span></form><div id=suggestion_container><span id=ttc_estimate></span><span id=suggest_button_container><svg viewBox="0 0 16 16"><rect width="2" height="1" x="3" y="1"/><rect width="4" height="1" x="2" y="2"/><rect width="6" height="1" x="1" y="3"/><rect width="2" height="11" x="3" y="3"/><rect width="5" height="2" x="3" y="13"/><rect width="2" height="1" x="11" y="14"/><rect width="4" height="1" x="10" y="13"/><rect width="6" height="1" x="9" y="12"/><rect width="2" height="11" x="11" y="1"/><rect width="5" height="2" x="8" y="1"/></svg>&nbsp;Suggest&nbsp;</span></div> `;
                            params.view_input = document.getElementById("alerts_view_input");
                            createListener({
                                ele: params.view_input,
                                func: viewHiddenInput,
                                type: "click"
                            });
                            createListener({
                                ele: document.getElementById("suggest_button_container"),
                                func: getSuggestion,
                                type: "click"
                            });
                            createListener({
                                ele: document.getElementById("alerts_input_box"),
                                func: checkTtcKeyUp,
                                type: "keyup"
                            });
                            params.input_box = document.getElementById("alerts_input_box");
                            params.input_box.focus();
                            focus_set = true;
                            setFormSubmit();
                            createListener({
                                ele: alert_obj.inner_container_ele,
                                func: stopProp,
                                type: "click"
                            });
                            if (params.simple_close)
                                addCancels();
                            addButtons(focus_set);
                            var temp_a = document.createElement("a");
                            var temp_d = document.createElement("div");
                            temp_d.classList.add("password_security_container");
                            temp_a.href = "/pages/password_security/";
                            temp_a.innerText = "Password Security";
                            temp_a.target = "_blank";
                            temp_a.classList.add("password_security_link");
                            temp_d.append(temp_a);
                            alert_obj.inner_container_ele.append(temp_d);
                            setFormState(params.confirm_count);
                            return;
                        }
                        createListener({
                            ele: alert_obj.inner_container_ele,
                            func: stopProp,
                            type: "click"
                        });
                        if (params.simple_close)
                            addCancels();
                        addButtons(focus_set);
                        setFormState(params.confirm_count);
                        if (checkForProperty(params.init_value) && checkForProperty(params.input_box))
                            params.input_box.value = params.init_value;
                        scroll(0, 0);
                        function addBiometricsButton() {
                            if (checkForProperty(user_params.biometrics)) {
                                var new_bio_button = document.createElement("div");
                                new_bio_button.id = "alerts_use_biometrics";
                                new_bio_button.classList.add("use_security_key_alert");
                                new_bio_button.innerText = (checkForProperty(user_params.biometrics.label)) ? user_params.biometrics.label : "Use Biometrics";
                                alert_obj.inner_container_ele.appendChild(new_bio_button);
                                createListener({
                                    ele: new_bio_button,
                                    func: alertsBioHandler,
                                    type: "click"
                                });
                            }
                        }
                    }
                    )();
                    function alertsBioHandler() {
                        user_params.biometrics.handler(function(ret_key) {
                            if (ret_key != null)
                                document.getElementById("alerts_input_box").value = ret_key;
                        });
                    }
                    function checkTtcKeyUp(e) {}
                    function checkTTC(phrase) {
                        var phrase_str_obj = checkPhraseStrength(phrase);
                        var ttc_estimate = document.getElementById("ttc_estimate");
                        ttc_estimate.innerText = "Time to Crack: " + phrase_str_obj.output_value + " " + phrase_str_obj.duration_label;
                        ttc_estimate.style.color = phrase_str_obj.color;
                    }
                    function clearSuggest() {
                        removeListener({
                            ele: document.getElementById("alerts_input_box"),
                            func: checkTtcKeyUp,
                            type: "keyup"
                        });
                        document.getElementById("suggestion_container").remove();
                    }
                    function getRandomInclusive(min, max) {
                        return Math.floor(Math.random() * (max - min + 1)) + min;
                    }
                    function getSuggestion() {
                        var tc = getRandomPhrase(getRandomInclusive(4, 6));
                        document.getElementById("alerts_input_box").value = tc;
                        document.getElementById("alerts_view_input").style.opacity = "1";
                        document.getElementById("alerts_input_box").type = "";
                    }
                    function setFormSubmit() {
                        var new_form = document.getElementById("alert_input_container");
                        if (checkForProperty(new_form)) {
                            params.form = new_form;
                            createListener({
                                ele: params.form,
                                func: callSubmit,
                                type: "submit"
                            });
                        }
                    }
                    function prepArray(data) {
                        if (!Array.isArray(data))
                            data = [data];
                        if (data.length < params.confirm_req) {
                            for (var i = 1; i < params.confirm_req; i++) {
                                if (!checkForProperty(data[i]))
                                    data[i] = data[i - 1];
                            }
                        }
                        return data;
                    }
                    function setFormState(state) {
                        if (checkForProperty(params.input_box))
                            params.input_box.value = "";
                        if (alert_type == "custom_bitnote_1" && state > 0)
                            clearSuggest();
                        document.getElementsByClassName("alerts_message_ele")[0].innerHTML = params.alert_msg[state];
                        alert_obj.submit_btn.innerText = params.submit_label[state];
                        if (custom_cancel_ele == null && params.no_cancel_button == false)
                            alert_obj.cancel_btn.innerText = params.cancel_label[state];
                    }
                    function callSubmit(e) {
                        e.preventDefault();
                        var match_value;
                        if (checkForProperty(params.match_input)) {
                            if (params.match_input[params.confirm_count] == params.input_box.value) {
                                alert_obj.temp_ret = params.input_box.value;
                                params.confirm_count++;
                            } else {
                                triggerFailedMatch();
                                return
                            }
                        } else if (params.confirm_count == 0) {
                            alert_obj.temp_ret = (checkForProperty(params.input_box)) ? params.input_box.value : true;
                            params.confirm_count++;
                        } else {
                            if (alert_obj.temp_ret == ((checkForProperty(params.input_box)) ? params.input_box.value : true))
                                params.confirm_count++;
                            else {
                                triggerFailedMatch();
                                return;
                            }
                        }
                        if (params.confirm_count == params.confirm_req)
                            triggerCallback(alert_obj.temp_ret);
                        else
                            setFormState(params.confirm_count);
                    }
                    function triggerCallback(ret) {
                        dropListners();
                        params = {};
                        alert_obj.container_ele.remove();
                        alert_obj = {};
                        document.body.classList.remove("alerts_prevent_bg_scroll");
                        cb(ret);
                        cb = null;
                    }
                    function triggerFailedMatch() {
                        alert_obj.container_ele.innerHTML = "nope";
                        dropListners();
                        params = {};
                        window.setTimeout(function() {
                            alert_obj.container_ele.remove();
                            alert_obj = {};
                            setAlert(alert_type, user_params, cb);
                        }, 1000);
                    }
                    function callCancel() {
                        triggerCallback(null);
                    }
                    function addCancels() {
                        alert_obj.boomer_close = document.createElement("span");
                        alert_obj.boomer_close.innerHTML = "&#10005;";
                        alert_obj.boomer_close.classList.add("alerts_boomer_close");
                        alert_obj.container_ele.append(alert_obj.boomer_close);
                        createListener({
                            ele: alert_obj.container_ele,
                            func: callCancel,
                            type: "click"
                        });
                        createListener({
                            ele: alert_obj.boomer_close,
                            func: callCancel,
                            type: "click"
                        });
                    }
                    function addButtons(focus_set) {
                        var btn_container = document.createElement("div");
                        btn_container.classList.add("alerts_btn_container");
                        alert_obj.submit_btn = document.createElement("button");
                        alert_obj.submit_btn.classList.add("alerts_std_btn");
                        if (custom_cancel_ele != null) {
                            alert_obj.cancel_btn = custom_cancel_ele;
                        } else if (params.no_cancel_button == false) {
                            alert_obj.cancel_btn = document.createElement("button");
                            alert_obj.cancel_btn.classList.add("alerts_std_btn");
                        }
                        btn_container.append(alert_obj.submit_btn);
                        alert_obj.inner_container_ele.append(btn_container);
                        createListener({
                            ele: alert_obj.submit_btn,
                            func: callSubmit,
                            type: "click"
                        });
                        createListener({
                            ele: alert_obj.submit_btn,
                            func: callSubmit,
                            type: "submit"
                        });
                        if (params.no_cancel_button == false) {
                            btn_container.append(alert_obj.cancel_btn);
                            createListener({
                                ele: alert_obj.cancel_btn,
                                func: callCancel,
                                type: "click"
                            });
                            createListener({
                                ele: alert_obj.cancel_btn,
                                func: callCancel,
                                type: "submit"
                            });
                        }
                        if (!focus_set)
                            alert_obj.submit_btn.focus();
                    }
                    function viewHiddenInput(e) {
                        if (params.input_box.type == "password") {
                            params.input_box.type = "";
                            this.style.opacity = "1";
                        } else {
                            params.input_box.type = "password";
                            this.style.opacity = ".5";
                        }
                    }
                    function catchKeys(e) {
                        e.stopPropagation();
                    }
                    function stopProp(e) {
                        e.stopPropagation();
                    }
                    function createListener(event_params) {
                        var options = checkForProperty(event_params.options) ? event_params.options : undefined;
                        event_params.ele.addEventListener(event_params.type, event_params.func, options);
                        alert_obj.event_array.push(event_params);
                    }
                    function dropListners() {
                        for (var i = 0; i < alert_obj.event_array.length; i++) {
                            var options = checkForProperty(alert_obj.event_array[i].options) ? alert_obj.event_array[i].options : undefined;
                            alert_obj.event_array[i].ele.removeEventListener(alert_obj.event_array[i].type, alert_obj.event_array[i].func, options);
                        }
                        alert_obj.event_array = [];
                    }
                    function removeListener(target_listener) {
                        for (var i = 0; i < alert_obj.event_array.length; i++) {
                            if (target_listener.ele == alert_obj.event_array[i].ele && target_listener.func == alert_obj.event_array[i].func) {
                                var options = checkForProperty(alert_obj.event_array[i].options) ? alert_obj.event_array[i].options : undefined;
                                alert_obj.event_array[i].ele.removeEventListener(alert_obj.event_array[i].type, alert_obj.event_array[i].func, options);
                                alert_obj.event_array.splice(i, 1);
                                return;
                            }
                        }
                    }
                }
                function checkPhraseStrength(phrase) {
                    return phraseRanker(zxcvbn(phrase).crack_times_seconds.offline_slow_hashing_1e4_per_second);
                }
                var key_time_objs = {
                    hour: BigInt(3600),
                    day: BigInt(86400),
                    week: BigInt(604800),
                    year: BigInt(31536000),
                    decade: BigInt(315360000),
                    century: BigInt(3153600000),
                };
                function phraseRanker(total_secs) {
                    var duration_label = "";
                    var color = "";
                    var output_value = "";
                    if (total_secs < 1) {
                        duration_label = "better";
                        output_value = "do";
                        color = "#a00010";
                    } else {
                        var big_secs = BigInt(Math.round(total_secs));
                        if (big_secs >= key_time_objs.century) {
                            duration_label = (big_secs > (key_time_objs.century * BigInt(2))) ? "centuries" : "century";
                            output_value = big_secs / key_time_objs.century;
                            color = "#E6CC80";
                        } else if (big_secs >= key_time_objs.decade) {
                            duration_label = (big_secs > (key_time_objs.decade * BigInt(2))) ? "decades" : "decade";
                            output_value = big_secs / key_time_objs.decade;
                            color = "#FF8000";
                        } else if (big_secs >= key_time_objs.year) {
                            duration_label = (big_secs > (key_time_objs.year * BigInt(2))) ? "years" : "year";
                            output_value = big_secs / key_time_objs.year;
                            color = "#A335EE";
                        } else if (big_secs >= key_time_objs.week) {
                            duration_label = (big_secs > (key_time_objs.week * BigInt(2))) ? "weeks" : "week";
                            output_value = big_secs / key_time_objs.week;
                            color = "#0070FF";
                        } else if (big_secs >= key_time_objs.day) {
                            duration_label = (big_secs > (key_time_objs.day * BigInt(2))) ? "days" : "day";
                            output_value = big_secs / key_time_objs.day;
                            color = "#1EFF0C";
                        } else if (big_secs >= key_time_objs.hour) {
                            duration_label = (big_secs > (key_time_objs.hour * BigInt(2))) ? "hours" : "hour";
                            output_value = big_secs / key_time_objs.hour;
                            color = "#ffffff";
                        } else {
                            duration_label = "seconds";
                            output_value = big_secs;
                            color = "#889D9D";
                        }
                    }
                    return {
                        color: color,
                        duration_label: duration_label,
                        total_secs: big_secs,
                        output_value: output_value
                    };
                }
                function checkForProperty(prop) {
                    return (prop === "" || prop === null || prop === undefined) ? false : true;
                }
            }
            function get_query_strings(return_as_array=false) {
                var results = {};
                if (window.location.search != "") {
                    var param;
                    var searched = window.location.search;
                    searched = searched.substring(1);
                    searched = searched.split("&");
                    if (return_as_array)
                        return searched;
                    else {
                        for (var i = 0; i < searched.length; i++)
                            parsePair(results, searched);
                    }
                }
                return results;
                function parsePair(results, pair) {
                    var value;
                    pair = pair[i].split("=");
                    if ((typeof pair[1] === "undefined"))
                        value = true;
                    else {
                        switch (pair[1]) {
                        case "null":
                            value = null;
                            break;
                        case "false":
                            value = false;
                            break;
                        case "true":
                            value = true;
                            break;
                        default:
                            var temp = parseInt(pair[1]);
                            if (isNaN(temp))
                                value = pair[1];
                            else
                                value = (temp.toString().length == pair[1].length) ? temp : pair[1];
                        }
                    }
                    results[pair[0]] = value;
                }
            }
            function encryption_handler() {
                this.encrypt = encrypt;
                function encrypt(key, plaintext, iv, cb) {
                    var alg_obj2 = {
                        name: "AES-GCM",
                        iv
                    };
                    window.crypto.subtle.encrypt(alg_obj2, key, plaintext).then((encrpyted_stuff)=>{
                        cb(encrpyted_stuff);
                    }
                    );
                }
                this.decrypt = decrypt;
                function decrypt(key, ciphertext, iv, cb) {
                    var alg_obj = {
                        name: "AES-GCM",
                        iv
                    };
                    window.crypto.subtle.decrypt(alg_obj, key, ciphertext).then((decrpyted_stuff)=>{
                        var text_decoder = new TextDecoder();
                        cb(text_decoder.decode(decrpyted_stuff));
                    }
                    ).catch(function(e) {
                        cb(null)
                    });
                }
                this.noDecodeDecrypt = noDecodeDecrypt;
                function noDecodeDecrypt(key, ciphertext, iv, cb) {
                    var alg_obj = {
                        name: "AES-GCM",
                        iv
                    };
                    window.crypto.subtle.decrypt(alg_obj, key, ciphertext).then((decrpyted_stuff)=>{
                        cb(decrpyted_stuff);
                    }
                    ).catch(function(e) {
                        cb(null)
                    });
                }
                this.defaultDeriveKey = defaultDeriveKey;
                function defaultDeriveKey(encoded_material, iterations, salt, cb) {
                    var alg_obj = {
                        name: "PBKDF2",
                        salt,
                        iterations: iterations,
                        hash: "SHA-512",
                    };
                    var derived_for_alg = {
                        "name": "AES-GCM",
                        "length": 256
                    };
                    window.crypto.subtle.importKey("raw", encoded_material, alg_obj.name, false, ["deriveBits", "deriveKey"]).then((key_mat)=>{
                        window.crypto.subtle.deriveKey(alg_obj, key_mat, derived_for_alg, true, ["encrypt", "decrypt"]).then((key)=>{
                            cb(key);
                        }
                        );
                    }
                    );
                }
                this.betterSalt = betterSalt;
                function betterSalt(size) {
                    return window.crypto.getRandomValues(new Uint8Array(size));
                }
                this.defaultGenerateSalt = defaultGenerateSalt;
                function defaultGenerateSalt(size) {
                    var hb = [];
                    var ns = "";
                    for (var i = 48; i <= 122; i++)
                        if (i < 58 || i > 97)
                            hb.push(String.fromCodePoint(i));
                    for (var i = 0; i < size; i++)
                        ns += hb[getRandomInclusive(0, (hb.length - 1))];
                    return ns;
                }
                this.hexToArrayBuffer = hexToArrayBuffer;
                function hexToArrayBuffer(hex_str, buffer_type=null) {
                    const regex = new RegExp(/0x/i);
                    if (regex.test(hex_str.substring(0, 2)))
                        hex_str = hex_str.substring(2);
                    var ret = [];
                    for (var i = 0; i < hex_str.length / 2; i++) {
                        var x = i * 2;
                        const n = parseInt(hex_str.substr(x, 2), 16);
                        ret.push(n);
                    }
                    if (buffer_type)
                        return new buffer_type(ret);
                    else
                        return ret;
                }
                function getRandomInclusive(min, max) {
                    return Math.floor(Math.random() * (max - min + 1)) + min;
                }
                this.generateECDHKeys = generateECDHKeys;
                function generateECDHKeys(callback) {
                    window.crypto.subtle.generateKey({
                        name: "ECDH",
                        namedCurve: "P-521",
                    }, true, ["deriveKey"]).then(callback);
                }
                this.importEcdhKey = importEcdhKey;
                function importEcdhKey(keyData, keyType, usage, keyFormat, callback) {
                    window.crypto.subtle.importKey(keyFormat, keyData, {
                        name: "ECDH",
                        namedCurve: "P-521",
                    }, keyType !== "privateKey", usage ? [usage] : []).then(callback);
                }
                this.exportKey = exportKey;
                function exportKey(key, keyFormat, callback) {
                    window.crypto.subtle.exportKey(keyFormat, key).then(callback);
                }
                this.deriveEcdhKey = deriveEcdhKey;
                function deriveEcdhKey(privateKey, publicKey, callback) {
                    window.crypto.subtle.deriveKey({
                        name: "ECDH",
                        public: publicKey,
                    }, privateKey, {
                        name: "AES-GCM",
                        length: 256,
                    }, true, ["encrypt", "decrypt"]).then(callback);
                }
            }
            function simple_rlp_encode(buffer_array) {
                var ret_payload = [];
                for (var i = 0; i < buffer_array.length; i++) {
                    ret_payload = traverseBuffer(ret_payload, buffer_array[i]);
                }
                var full_buffer;
                if (ret_payload.length <= 55)
                    full_buffer = [192 + ret_payload.length];
                else {
                    full_buffer = [247 + lengthInBytes(ret_payload.length)];
                    var new_length = ret_payload.length;
                    full_buffer = appendLengthToBuffer(full_buffer, new_length);
                }
                return full_buffer.concat(ret_payload);
                function traverseBuffer(current_buffer, new_buff) {
                    if (new_buff.length == 0 || (new_buff.length == 1 && new_buff[0] === 0))
                        current_buffer.push(128);
                    else if (new_buff.length == 1 && new_buff[0].length == 0)
                        current_buffer.push(192);
                    else if (new_buff.length == 1 && new_buff[0] < 128)
                        current_buffer = current_buffer.concat(new_buff);
                    else if (new_buff.length <= 55) {
                        current_buffer.push(128 + new_buff.length);
                        current_buffer = current_buffer.concat(new_buff);
                    } else {
                        var byte_length = lengthInBytes(new_buff.length);
                        current_buffer.push(183 + byte_length);
                        var new_length = new_buff.length;
                        current_buffer = appendLengthToBuffer(current_buffer, new_length);
                        current_buffer = current_buffer.concat(new_buff);
                    }
                    return current_buffer;
                }
                function lengthInBytes(len) {
                    var ret = 1;
                    while (len > (256 ** ret) - 1)
                        ret++;
                    return ret;
                }
                function appendLengthToBuffer(current_buffer, buff_length) {
                    var new_vals = decimalTo2cHex(buff_length);
                    new_vals = hexToArrayBuffer(new_vals);
                    current_buffer = current_buffer.concat(new_vals);
                    return current_buffer;
                }
                function decimalTo2cHex(dec) {
                    var hex = (dec).toString(16);
                    return hex.length % 2 ? ('0' + hex) : hex;
                }
            }
            function simple_rlp_decode(rlp) {}
            function keccak_handler() {
                var HEX_CHARS = '0123456789abcdef'.split('');
                var KECCAK_PADDING = [1, 256, 65536, 16777216];
                var SHIFT = [0, 8, 16, 24];
                var RC = [1, 0, 32898, 0, 32906, 2147483648, 2147516416, 2147483648, 32907, 0, 2147483649, 0, 2147516545, 2147483648, 32777, 2147483648, 138, 0, 136, 0, 2147516425, 0, 2147483658, 0, 2147516555, 0, 139, 2147483648, 32905, 2147483648, 32771, 2147483648, 32770, 2147483648, 128, 2147483648, 32778, 0, 2147483658, 2147483648, 2147516545, 2147483648, 32896, 2147483648, 2147483649, 0, 2147516424, 2147483648];
                this.keccak256 = keccak256;
                function keccak256(hex_str) {
                    return (keccak(256))(hex_str);
                }
                function Keccak(bits) {
                    return {
                        blocks: [],
                        reset: true,
                        block: 0,
                        start: 0,
                        blockCount: 1600 - (bits << 1) >> 5,
                        outputBlocks: bits >> 5,
                        s: function(s) {
                            return [].concat(s, s, s, s, s);
                        }([0, 0, 0, 0, 0, 0, 0, 0, 0, 0])
                    };
                }
                ;var update = function update(state, message) {
                    var length = message.length, blocks = state.blocks, byteCount = state.blockCount << 2, blockCount = state.blockCount, outputBlocks = state.outputBlocks, s = state.s, index = 0, i, code;
                    while (index < length) {
                        if (state.reset) {
                            state.reset = false;
                            blocks[0] = state.block;
                            for (i = 1; i < blockCount + 1; ++i) {
                                blocks[i] = 0;
                            }
                        }
                        if (typeof message !== "string") {
                            for (i = state.start; index < length && i < byteCount; ++index) {
                                blocks[i >> 2] |= message[index] << SHIFT[i++ & 3];
                            }
                        } else {
                            for (i = state.start; index < length && i < byteCount; ++index) {
                                code = message.charCodeAt(index);
                                if (code < 0x80) {
                                    blocks[i >> 2] |= code << SHIFT[i++ & 3];
                                } else if (code < 0x800) {
                                    blocks[i >> 2] |= (0xc0 | code >> 6) << SHIFT[i++ & 3];
                                    blocks[i >> 2] |= (0x80 | code & 0x3f) << SHIFT[i++ & 3];
                                } else if (code < 0xd800 || code >= 0xe000) {
                                    blocks[i >> 2] |= (0xe0 | code >> 12) << SHIFT[i++ & 3];
                                    blocks[i >> 2] |= (0x80 | code >> 6 & 0x3f) << SHIFT[i++ & 3];
                                    blocks[i >> 2] |= (0x80 | code & 0x3f) << SHIFT[i++ & 3];
                                } else {
                                    code = 0x10000 + ((code & 0x3ff) << 10 | message.charCodeAt(++index) & 0x3ff);
                                    blocks[i >> 2] |= (0xf0 | code >> 18) << SHIFT[i++ & 3];
                                    blocks[i >> 2] |= (0x80 | code >> 12 & 0x3f) << SHIFT[i++ & 3];
                                    blocks[i >> 2] |= (0x80 | code >> 6 & 0x3f) << SHIFT[i++ & 3];
                                    blocks[i >> 2] |= (0x80 | code & 0x3f) << SHIFT[i++ & 3];
                                }
                            }
                        }
                        state.lastByteIndex = i;
                        if (i >= byteCount) {
                            state.start = i - byteCount;
                            state.block = blocks[blockCount];
                            for (i = 0; i < blockCount; ++i) {
                                s[i] ^= blocks[i];
                            }
                            f(s);
                            state.reset = true;
                        } else {
                            state.start = i;
                        }
                    }
                    i = state.lastByteIndex;
                    blocks[i >> 2] |= KECCAK_PADDING[i & 3];
                    if (state.lastByteIndex === byteCount) {
                        blocks[0] = blocks[blockCount];
                        for (i = 1; i < blockCount + 1; ++i) {
                            blocks[i] = 0;
                        }
                    }
                    blocks[blockCount - 1] |= 0x80000000;
                    for (i = 0; i < blockCount; ++i) {
                        s[i] ^= blocks[i];
                    }
                    f(s);
                    var hex = '', i = 0, j = 0, block;
                    while (j < outputBlocks) {
                        for (i = 0; i < blockCount && j < outputBlocks; ++i,
                        ++j) {
                            block = s[i];
                            hex += HEX_CHARS[block >> 4 & 0x0F] + HEX_CHARS[block & 0x0F] + HEX_CHARS[block >> 12 & 0x0F] + HEX_CHARS[block >> 8 & 0x0F] + HEX_CHARS[block >> 20 & 0x0F] + HEX_CHARS[block >> 16 & 0x0F] + HEX_CHARS[block >> 28 & 0x0F] + HEX_CHARS[block >> 24 & 0x0F];
                        }
                        if (j % blockCount === 0) {
                            f(s);
                            i = 0;
                        }
                    }
                    return "0x" + hex;
                };
                var f = function f(s) {
                    var h, l, n, c0, c1, c2, c3, c4, c5, c6, c7, c8, c9, b0, b1, b2, b3, b4, b5, b6, b7, b8, b9, b10, b11, b12, b13, b14, b15, b16, b17, b18, b19, b20, b21, b22, b23, b24, b25, b26, b27, b28, b29, b30, b31, b32, b33, b34, b35, b36, b37, b38, b39, b40, b41, b42, b43, b44, b45, b46, b47, b48, b49;
                    for (n = 0; n < 48; n += 2) {
                        c0 = s[0] ^ s[10] ^ s[20] ^ s[30] ^ s[40];
                        c1 = s[1] ^ s[11] ^ s[21] ^ s[31] ^ s[41];
                        c2 = s[2] ^ s[12] ^ s[22] ^ s[32] ^ s[42];
                        c3 = s[3] ^ s[13] ^ s[23] ^ s[33] ^ s[43];
                        c4 = s[4] ^ s[14] ^ s[24] ^ s[34] ^ s[44];
                        c5 = s[5] ^ s[15] ^ s[25] ^ s[35] ^ s[45];
                        c6 = s[6] ^ s[16] ^ s[26] ^ s[36] ^ s[46];
                        c7 = s[7] ^ s[17] ^ s[27] ^ s[37] ^ s[47];
                        c8 = s[8] ^ s[18] ^ s[28] ^ s[38] ^ s[48];
                        c9 = s[9] ^ s[19] ^ s[29] ^ s[39] ^ s[49];
                        h = c8 ^ (c2 << 1 | c3 >>> 31);
                        l = c9 ^ (c3 << 1 | c2 >>> 31);
                        s[0] ^= h;
                        s[1] ^= l;
                        s[10] ^= h;
                        s[11] ^= l;
                        s[20] ^= h;
                        s[21] ^= l;
                        s[30] ^= h;
                        s[31] ^= l;
                        s[40] ^= h;
                        s[41] ^= l;
                        h = c0 ^ (c4 << 1 | c5 >>> 31);
                        l = c1 ^ (c5 << 1 | c4 >>> 31);
                        s[2] ^= h;
                        s[3] ^= l;
                        s[12] ^= h;
                        s[13] ^= l;
                        s[22] ^= h;
                        s[23] ^= l;
                        s[32] ^= h;
                        s[33] ^= l;
                        s[42] ^= h;
                        s[43] ^= l;
                        h = c2 ^ (c6 << 1 | c7 >>> 31);
                        l = c3 ^ (c7 << 1 | c6 >>> 31);
                        s[4] ^= h;
                        s[5] ^= l;
                        s[14] ^= h;
                        s[15] ^= l;
                        s[24] ^= h;
                        s[25] ^= l;
                        s[34] ^= h;
                        s[35] ^= l;
                        s[44] ^= h;
                        s[45] ^= l;
                        h = c4 ^ (c8 << 1 | c9 >>> 31);
                        l = c5 ^ (c9 << 1 | c8 >>> 31);
                        s[6] ^= h;
                        s[7] ^= l;
                        s[16] ^= h;
                        s[17] ^= l;
                        s[26] ^= h;
                        s[27] ^= l;
                        s[36] ^= h;
                        s[37] ^= l;
                        s[46] ^= h;
                        s[47] ^= l;
                        h = c6 ^ (c0 << 1 | c1 >>> 31);
                        l = c7 ^ (c1 << 1 | c0 >>> 31);
                        s[8] ^= h;
                        s[9] ^= l;
                        s[18] ^= h;
                        s[19] ^= l;
                        s[28] ^= h;
                        s[29] ^= l;
                        s[38] ^= h;
                        s[39] ^= l;
                        s[48] ^= h;
                        s[49] ^= l;
                        b0 = s[0];
                        b1 = s[1];
                        b32 = s[11] << 4 | s[10] >>> 28;
                        b33 = s[10] << 4 | s[11] >>> 28;
                        b14 = s[20] << 3 | s[21] >>> 29;
                        b15 = s[21] << 3 | s[20] >>> 29;
                        b46 = s[31] << 9 | s[30] >>> 23;
                        b47 = s[30] << 9 | s[31] >>> 23;
                        b28 = s[40] << 18 | s[41] >>> 14;
                        b29 = s[41] << 18 | s[40] >>> 14;
                        b20 = s[2] << 1 | s[3] >>> 31;
                        b21 = s[3] << 1 | s[2] >>> 31;
                        b2 = s[13] << 12 | s[12] >>> 20;
                        b3 = s[12] << 12 | s[13] >>> 20;
                        b34 = s[22] << 10 | s[23] >>> 22;
                        b35 = s[23] << 10 | s[22] >>> 22;
                        b16 = s[33] << 13 | s[32] >>> 19;
                        b17 = s[32] << 13 | s[33] >>> 19;
                        b48 = s[42] << 2 | s[43] >>> 30;
                        b49 = s[43] << 2 | s[42] >>> 30;
                        b40 = s[5] << 30 | s[4] >>> 2;
                        b41 = s[4] << 30 | s[5] >>> 2;
                        b22 = s[14] << 6 | s[15] >>> 26;
                        b23 = s[15] << 6 | s[14] >>> 26;
                        b4 = s[25] << 11 | s[24] >>> 21;
                        b5 = s[24] << 11 | s[25] >>> 21;
                        b36 = s[34] << 15 | s[35] >>> 17;
                        b37 = s[35] << 15 | s[34] >>> 17;
                        b18 = s[45] << 29 | s[44] >>> 3;
                        b19 = s[44] << 29 | s[45] >>> 3;
                        b10 = s[6] << 28 | s[7] >>> 4;
                        b11 = s[7] << 28 | s[6] >>> 4;
                        b42 = s[17] << 23 | s[16] >>> 9;
                        b43 = s[16] << 23 | s[17] >>> 9;
                        b24 = s[26] << 25 | s[27] >>> 7;
                        b25 = s[27] << 25 | s[26] >>> 7;
                        b6 = s[36] << 21 | s[37] >>> 11;
                        b7 = s[37] << 21 | s[36] >>> 11;
                        b38 = s[47] << 24 | s[46] >>> 8;
                        b39 = s[46] << 24 | s[47] >>> 8;
                        b30 = s[8] << 27 | s[9] >>> 5;
                        b31 = s[9] << 27 | s[8] >>> 5;
                        b12 = s[18] << 20 | s[19] >>> 12;
                        b13 = s[19] << 20 | s[18] >>> 12;
                        b44 = s[29] << 7 | s[28] >>> 25;
                        b45 = s[28] << 7 | s[29] >>> 25;
                        b26 = s[38] << 8 | s[39] >>> 24;
                        b27 = s[39] << 8 | s[38] >>> 24;
                        b8 = s[48] << 14 | s[49] >>> 18;
                        b9 = s[49] << 14 | s[48] >>> 18;
                        s[0] = b0 ^ ~b2 & b4;
                        s[1] = b1 ^ ~b3 & b5;
                        s[10] = b10 ^ ~b12 & b14;
                        s[11] = b11 ^ ~b13 & b15;
                        s[20] = b20 ^ ~b22 & b24;
                        s[21] = b21 ^ ~b23 & b25;
                        s[30] = b30 ^ ~b32 & b34;
                        s[31] = b31 ^ ~b33 & b35;
                        s[40] = b40 ^ ~b42 & b44;
                        s[41] = b41 ^ ~b43 & b45;
                        s[2] = b2 ^ ~b4 & b6;
                        s[3] = b3 ^ ~b5 & b7;
                        s[12] = b12 ^ ~b14 & b16;
                        s[13] = b13 ^ ~b15 & b17;
                        s[22] = b22 ^ ~b24 & b26;
                        s[23] = b23 ^ ~b25 & b27;
                        s[32] = b32 ^ ~b34 & b36;
                        s[33] = b33 ^ ~b35 & b37;
                        s[42] = b42 ^ ~b44 & b46;
                        s[43] = b43 ^ ~b45 & b47;
                        s[4] = b4 ^ ~b6 & b8;
                        s[5] = b5 ^ ~b7 & b9;
                        s[14] = b14 ^ ~b16 & b18;
                        s[15] = b15 ^ ~b17 & b19;
                        s[24] = b24 ^ ~b26 & b28;
                        s[25] = b25 ^ ~b27 & b29;
                        s[34] = b34 ^ ~b36 & b38;
                        s[35] = b35 ^ ~b37 & b39;
                        s[44] = b44 ^ ~b46 & b48;
                        s[45] = b45 ^ ~b47 & b49;
                        s[6] = b6 ^ ~b8 & b0;
                        s[7] = b7 ^ ~b9 & b1;
                        s[16] = b16 ^ ~b18 & b10;
                        s[17] = b17 ^ ~b19 & b11;
                        s[26] = b26 ^ ~b28 & b20;
                        s[27] = b27 ^ ~b29 & b21;
                        s[36] = b36 ^ ~b38 & b30;
                        s[37] = b37 ^ ~b39 & b31;
                        s[46] = b46 ^ ~b48 & b40;
                        s[47] = b47 ^ ~b49 & b41;
                        s[8] = b8 ^ ~b0 & b2;
                        s[9] = b9 ^ ~b1 & b3;
                        s[18] = b18 ^ ~b10 & b12;
                        s[19] = b19 ^ ~b11 & b13;
                        s[28] = b28 ^ ~b20 & b22;
                        s[29] = b29 ^ ~b21 & b23;
                        s[38] = b38 ^ ~b30 & b32;
                        s[39] = b39 ^ ~b31 & b33;
                        s[48] = b48 ^ ~b40 & b42;
                        s[49] = b49 ^ ~b41 & b43;
                        s[0] ^= RC[n];
                        s[1] ^= RC[n + 1];
                    }
                };
                function keccak(bits) {
                    return function(str) {
                        var msg;
                        if (str.slice(0, 2) === "0x") {
                            msg = [];
                            for (var i = 2, l = str.length; i < l; i += 2) {
                                msg.push(parseInt(str.slice(i, i + 2), 16));
                            }
                        } else {
                            msg = str;
                        }
                        return update(Keccak(bits, bits), msg);
                    }
                    ;
                }
                ;
            }
            function font_handler() {
                var loaded_obj = {};
                var styles = window.document.styleSheets[0];
                this.fontLoader = fontLoader;
                function fontLoader(font_path_list, params={}) {
                    params.font_display = checkForProperty(params.font_display) ? params.font_display : "optional";
                    if (font_path_list != "" && font_path_list != undefined) {
                        font_path_list = (Array.isArray(font_path_list)) ? font_path_list : [font_path_list];
                        for (var i = 0; i < font_path_list.length; i++) {
                            var font_info = getFontInfo(font_path_list[i]);
                            if (loaded_obj[font_info.full_name] == undefined || loaded_obj[font_info.full_name] == null) {
                                loaded_obj[font_info.full_name] = font_info;
                                loadNewFont(font_info, styles, params.font_display);
                            }
                        }
                    }
                }
                function loadNewFont(font_info, styles, font_display) {
                    var new_font = ` @font-face{ font-family: '${font_info.name}'; format('${font_info.type} supports variations'); format('${font_info.type}-variations'); src: url("${font_info.path}"); font-weight: 100 900; font-display: ${font_display}; } `;
                    styles.insertRule(new_font);
                }
                function getFontInfo(path) {
                    var font_info = {
                        path: path
                    };
                    var font_name = path.split("/");
                    font_info.full_name = font_name.pop();
                    font_name = font_info.full_name.split(".");
                    font_info.name = font_name[0];
                    font_info.type = font_name[1];
                    return font_info;
                }
                function checkForProperty(prop) {
                    return (prop === "" || prop === null || prop === undefined) ? false : true;
                }
            }
            function contract_param_encoder() {
                this.combineParams = combineParams;
                function combineParams(encoded_array) {
                    var ret_str = "";
                    var dynamic_array = [];
                    for (var i = 0; i < encoded_array.length; i++) {
                        if (!encoded_array[i].dynamic) {
                            ret_str += encoded_array[i].encoded_hex;
                        } else {
                            ret_str += getOffset(i, encoded_array);
                            dynamic_array.push(encoded_array[i]);
                        }
                    }
                    for (var i = 0; i < dynamic_array.length; i++)
                        ret_str += dynamic_array[i].encoded_hex;
                    return ret_str;
                    function getOffset(pos, encoded_array) {
                        var offset_byte_len = 0;
                        for (var i = 0; i < encoded_array.length; i++) {
                            if (encoded_array[i].dynamic && i < pos)
                                offset_byte_len += encoded_array[i].byte_len;
                            offset_byte_len += 32;
                        }
                        return decimalToHexBytes(offset_byte_len, 32);
                    }
                }
                this.genEncodedParamBreakdown = genEncodedParamBreakdown;
                function genEncodedParamBreakdown(encoded_array) {
                    var ret_table = "<table>";
                    for (var i = 0; i < encoded_array.length; i++) {
                        ret_table += "<tr><td>" + encoded_array[i].type + "</td><td>" + encoded_array[i].encoded_hex + "</td></tr>";
                    }
                    ret_table += "</table>";
                    return ret_table;
                }
                this.genDecodedParamBreakdown = genDecodedParamBreakdown;
                function genDecodedParamBreakdown(decoded_array, fcn_headers) {
                    var ret_table = "<table>";
                    for (var i = 0; i < decoded_array.length; i++) {
                        if (Array.isArray(decoded_array[i])) {
                            ret_table += fcn_headers[i].type + "[]";
                            for (var x = 0; x < decoded_array[i].length; x++)
                                ret_table += getNextRow(fcn_headers[i].type, decoded_array[i][x], x);
                        } else
                            ret_table += getNextRow(fcn_headers[i].type, decoded_array[i]);
                    }
                    ret_table += "</table>";
                    return ret_table;
                    function getNextRow(fcn_type, decoded_obj, pos=null) {
                        if (fcn_type == "address") {
                            pos = (pos != null) ? " [" + pos + "]" : "";
                            decoded_obj.data = decoded_obj.data.slice(24);
                            var vis_size_str = "(" + decoded_obj.data.length + ")";
                            decoded_obj.data = "0x" + decoded_obj.data;
                        } else {
                            var vis_size_str = "(" + decoded_obj.byte_size + ")";
                            pos = (pos != null) ? " [" + pos + "]" : "";
                        }
                        return "<tr><td>" + pos + " " + fcn_type + vis_size_str + "-</td><td>" + decoded_obj.data + "</td></tr>";
                    }
                }
                function displayArrayCount(array_count) {
                    var ret_str = "";
                    for (var i = 0; i < array_count; i++)
                        ret_str = ret_str + "[]";
                    return ret_str;
                }
                this.getDecoded = getDecoded;
                function getDecoded(encoded_data, fcn_headers) {
                    var current_pointer = 0;
                    var decoded_ret = [];
                    encoded_data = stripHex(encoded_data);
                    for (var i = 0; i < fcn_headers.length; i++) {
                        var byte_size = 32 * 2;
                        if (!fcn_headers[i].dynamic && fcn_headers[i].array_count == 0)
                            decoded_ret.push({
                                byte_size: byte_size,
                                data: getNextWord(encoded_data, current_pointer)
                            });
                        else {
                            var obj = getDynamicObj(encoded_data, fcn_headers[i], current_pointer);
                            decoded_ret.push(obj);
                        }
                        current_pointer += byte_size;
                    }
                    return decoded_ret;
                }
                function getNextWord(encoded_data, current_pointer, byte_size=(32 * 2)) {
                    return encoded_data.slice(current_pointer, current_pointer + byte_size);
                }
                function getDynamicObj(encoded_data, fcn_header_data, current_pointer) {
                    var offset = getNextWord(encoded_data, current_pointer);
                    offset = leftPaddedHexToHex(offset);
                    offset = hexToDecimal(offset) * 2;
                    var cp = offset;
                    var next_seg = getNextWord(encoded_data, cp);
                    next_seg = leftPaddedHexToHex(next_seg);
                    if (fcn_header_data.array_count == 0 && checkForProperty(fcn_header_data.tuple_array)) {
                        var ret_array = [];
                        var new_encoded = encoded_data.slice(cp);
                        cp = 0;
                        for (var i = 0; i < fcn_header_data.tuple_array.length; i++) {
                            var new_fcn_header_data = getTypeDataFromHeaders([fcn_header_data.tuple_array[i]]);
                            var obj = getDynamicObj(new_encoded, new_fcn_header_data[0], cp);
                            cp = skip32Bytes(cp);
                            ret_array.push(obj);
                        }
                        return ret_array;
                    } else if (fcn_header_data.array_count == 0) {
                        cp = skip32Bytes(cp);
                        var byte_size = hexToDecimal(next_seg) * 2;
                        var data = encoded_data.slice(cp, cp + byte_size);
                        return {
                            offset: offset,
                            byte_size: byte_size,
                            data: data
                        };
                    } else {
                        cp = skip32Bytes(cp);
                        var ret_array = [];
                        var var_count = hexToDecimal(next_seg);
                        var new_fcn_header_data = Object.assign({}, fcn_header_data);
                        new_fcn_header_data.array_count--;
                        var new_encoded = encoded_data.slice(cp);
                        cp = 0;
                        for (var i = 0; i < var_count; i++) {
                            if (new_fcn_header_data.dynamic || new_fcn_header_data.array_count > 0) {
                                var obj = getDynamicObj(new_encoded, new_fcn_header_data, cp);
                                cp = skip32Bytes(cp);
                                ret_array.push(obj);
                            } else {
                                var obj = getNextWord(new_encoded, cp);
                                cp = skip32Bytes(cp);
                                ret_array.push(obj);
                            }
                        }
                        return ret_array;
                    }
                    function skip32Bytes(current_point) {
                        return current_point + (32 * 2);
                    }
                }
                function leftPaddedHexToHex(hex) {
                    hex = stripHex(hex);
                    hex = hex.replace(/^0*/g, "");
                    hex = (hex.length % 2) ? ('0' + hex) : hex;
                    return hex;
                }
                this.getTypeDataFromHeaders = getTypeDataFromHeaders;
                function getTypeDataFromHeaders(header_array) {
                    var ret_array = [];
                    for (var i = 0; i < header_array.length; i++) {
                        var param_type = header_array[i].split("[]");
                        var array_count = param_type.length - 1;
                        param_type = param_type[0];
                        if (param_type.charAt(0) == "(") {
                            param_type = param_type.replace(/(\(|\))/g, "");
                            var tuple_array = param_type.split("__");
                            param_type = "tuple";
                        }
                        switch (param_type) {
                        case "tuple":
                            ret_array.push({
                                type: param_type,
                                tuple_array: tuple_array,
                                array_count: array_count,
                                dynamic: true
                            });
                            continue;
                        case "string":
                        case "bytes":
                            ret_array.push({
                                type: param_type,
                                array_count: array_count,
                                dynamic: true
                            });
                            continue;
                        case "address":
                            ret_array.push({
                                type: param_type,
                                array_count: array_count,
                                dynamic: false
                            });
                            continue;
                        }
                        switch (true) {
                        case /^(uint|uint\d{1,3})$/i.test(param_type):
                            var bit_count = param_type.match(/\d{1,3}$/);
                            bit_count = (bit_count == null) ? 256 : parseInt(bit_count);
                            ret_array.push({
                                bit_count: bit_count,
                                type: "uint",
                                array_count: array_count,
                                dynamic: false
                            });
                            continue;
                        case /^(int|int\d{1,3})$/i.test(param_type):
                            var bit_count = param_type.match(/\d{1,3}$/);
                            bit_count = (bit_count == null) ? 256 : parseInt(bit_count);
                            ret_array.push({
                                bit_count: bit_count,
                                type: "int",
                                array_count: array_count,
                                dynamic: false
                            });
                            continue;
                        case /^(bytes|bytes\d{1,2})$/i.test(param_type):
                            var bit_count = param_type.match(/\d{1,2}$/);
                            bit_count = (bit_count == null) ? 32 : parseInt(bit_count);
                            ret_array.push({
                                bit_count: bit_count,
                                type: "bytes",
                                array_count: array_count,
                                dynamic: false
                            });
                            continue;
                        }
                    }
                    return ret_array;
                }
                this.getEncoded = getEncoded;
                function getEncoded(data, fcn_headers) {
                    if (data.length != fcn_headers.length)
                        return null;
                    let ret_array = [];
                    for (let i = 0; i < data.length; i++) {
                        if (Array.isArray(data[i])) {
                            let data_obj = Object.assign({}, fcn_headers[i]);
                            let temp_param_array = [];
                            let encoded_array_length = decimalToHexBytes(data[i].length, 32);
                            for (let x = 0; x < data[i].length; x++) {
                                var temp_header = Object.assign({}, data_obj);
                                var temp2 = getEncoded([data[i][x]], [temp_header])[0];
                                var new_obj = Object.assign({}, temp2);
                                temp_param_array.push(new_obj);
                            }
                            var val = combineParams(temp_param_array);
                            val = encoded_array_length + val;
                            var byte_len = val.length / 2;
                            data_obj.byte_len = byte_len;
                            data_obj.encoded_hex = val;
                            ret_array.push(data_obj);
                        } else {
                            let byte_len = 0;
                            var val = data[i].trim();
                            var data_obj = fcn_headers[i];
                            switch (data_obj.type) {
                            case "address":
                            case "hex":
                                val = stripHex(val);
                                val = decimalToHexBytes(val, 32);
                                byte_len += 32;
                                break;
                            case "int":
                                val = decimalToSigned2cHex(val);
                            case "uint":
                                val = decimalToHexBytes(val, 32);
                                data_obj.type = (checkForProperty(data_obj.bit_count)) ? (data_obj.type + data_obj.bit_count) : (data_obj.type + "256");
                                byte_len += 32;
                                break;
                            case "bytes":
                                if (/^(0x|0X)/.test(val))
                                    val = val.slice(2);
                                if (checkForProperty(data_obj.bit_count)) {
                                    if (!validHexStr(val)) {
                                        val = new TextEncoder("utf-8").encode(val);
                                        val = bufferToHex(val);
                                    }
                                    val = hexToRightPaddedHex(val);
                                    data_obj.type = data_obj.type + data_obj.bit_count;
                                    byte_len += 32;
                                    break;
                                } else {
                                    byte_len = (val.length / 2);
                                    val = hexToRightPaddedHex(val);
                                    val = decimalToHexBytes(byte_len, 32) + val;
                                    byte_len = val.length / 2;
                                }
                                break;
                            case "string":
                                val = new TextEncoder("utf-8").encode(val);
                                val = bufferToHex(val);
                                byte_len = (val.length / 2);
                                val = hexToRightPaddedHex(val);
                                val = decimalToHexBytes(byte_len, 32) + val;
                                byte_len = val.length / 2;
                                break;
                            }
                            data_obj.byte_len = byte_len;
                            data_obj.encoded_hex = val;
                            ret_array.push(data_obj);
                        }
                    }
                    return ret_array;
                }
                function decimalToHexBytes(value, byte_length=8) {
                    var max_send = 10000000000000000000000000000000;
                    var buff = '00';
                    if (value >= max_send)
                        stopExe("Send value too large!");
                    else {
                        var value_in_hex = decimalTo2cHex(value);
                        var init_length = (byte_length * 2 - value_in_hex.length) / 2;
                        for (var i = init_length; i > 0; i--) {
                            value_in_hex = buff + value_in_hex;
                        }
                        return value_in_hex;
                    }
                }
                function decimalTo2cHex(dec) {
                    var hex = (dec).toString(16);
                    return hex.length % 2 ? ('0' + hex) : hex;
                }
                function checkForArray(param) {
                    if (param.charAt(0) == "[" && param.charAt(param.length - 1) == "]")
                        return {
                            data: param,
                            type: "array",
                            dynamic: true
                        };
                    return null;
                }
                function hexToRightPaddedHex(hex_str) {
                    var pad_length = 64 - (hex_str.length % 64);
                    if (pad_length < 64) {
                        for (var i = pad_length; i > 0; i--)
                            hex_str += "0";
                    }
                    return hex_str;
                }
                function ifArrayCount(array_count=0) {
                    return (array_count > 1) ? true : false;
                }
                function stripHex(str) {
                    if (/^0x/i.test(str))
                        return str.slice(2);
                    else
                        return str;
                }
                function validHexStr(str) {
                    str = str.toLowerCase();
                    if (/^(0x){0,1}[0-9a-f]+$/i.test(str))
                        return true;
                    else
                        return false;
                }
                function hexToDecimal(hex_str) {
                    const regex = new RegExp(/0x/i);
                    if (regex.test(hex_str.substring(0, 2)))
                        hex_str = hex_str.slice(2);
                    hex_str.replace(/^0*/, '');
                    return parseInt(hex_str, 16);
                }
                function decimalToSigned2cHex(dec) {
                    var hex = (dec).toString(16);
                    hex = (hex.charAt(0) == "-") ? hex.slice(1) : hex;
                    hex = ((dec >= 0) ? "1" : "0") + hex;
                    return hex.length % 2 ? ('0' + hex) : hex;
                }
                this.getHeaderArray = getHeaderArray;
                function getHeaderArray(fcn_call) {
                    var header_array = splitFcnCallHeaders(fcn_call);
                    return getTypeDataFromHeaders(header_array);
                }
                function splitFcnCallHeaders(fcn_call) {
                    var fcn_ret_types = fcn_call;
                    fcn_ret_types = fcn_ret_types.split("(")[1];
                    fcn_ret_types = fcn_ret_types.split(")")[0];
                    fcn_ret_types = fcn_ret_types.replace(/\s*/g, "");
                    fcn_ret_types = fcn_ret_types.split(",");
                    if (fcn_ret_types.length > 0) {
                        return fcn_ret_types
                    } else
                        return null;
                }
            }
            let default_gwei_overage = 20000;
            function transaction_handler(main_settings={}) {
                let current_preview;
                let transaction_cb = null;
                let custom_html_func = null;
                let nef_h = null;
                let allow_nef = true;
                let active_currency_rate = null;
                let active_submit = false;
                let active_exchange_url;
                let ls_handler = null;
                let kh, eh, alerts_h;
                let cpe = new contract_param_encoder();
                let xhr_h, mge;
                let current_listeners = [];
                (function init() {
                    ls_handler = (checkForProperty(main_settings.loading_screen_handler)) ? main_settings.loading_screen_handler : null;
                    kh = new keccak_handler();
                    eh = new encryption_handler();
                    alerts_h = (checkForProperty(main_settings.alert_handler)) ? main_settings.alert_handler : new alerts_handler(main_settings.alert_params);
                    active_exchange_url = main_settings.exchange_url;
                    xhr_h = main_settings.xhr;
                    mge = new multi_gas_estimator(xhr_h);
                    current_preview = null;
                    if (main_settings.nef_h != null)
                        nef_h = main_settings.nef_h;
                    if (checkForProperty(main_settings.custom_html_func))
                        custom_html_func = main_settings.custom_html_func;
                    loadCSS(main_settings.custom_css);
                    startCurrencyRateMonitor();
                }
                )();
                this.closeOpenTransactions = closeOpenTransactions;
                function closeOpenTransactions() {
                    callCancel();
                }
                this.getActiveCurrencyRate = getActiveCurrencyRate;
                function getActiveCurrencyRate() {
                    return active_currency_rate;
                }
                function startCurrencyRateMonitor() {
                    getCoinPrice(function(coin_in_usd) {
                        if (checkForProperty(coin_in_usd)) {
                            active_currency_rate = coin_in_usd;
                            window.setTimeout(startCurrencyRateMonitor, 1800000);
                        } else
                            window.setTimeout(startCurrencyRateMonitor, 30000);
                    });
                }
                function getCoinPrice(cb) {
                    let proxy_url = "/pages/cb_proxy";
                    var exchange = active_exchange_url;
                    var attempts = 1;
                    (function getPrice(api_url) {
                        xhr_h.sendXHR({
                            asserted_status: 200,
                            api: api_url,
                            method: "GET"
                        }, function(res) {
                            if (res.valid) {
                                var ret = JSON.parse(res.response);
                                if (checkForProperty(ret.data)) {
                                    cb(Math.round((ret.data.rates.USD) * 10000) / 10000);
                                } else
                                    cb(null);
                            } else {
                                if (attempts-- > 0)
                                    getPrice(proxy_url);
                                else
                                    cb(null);
                            }
                        });
                    }
                    )(exchange);
                }
                this.setContract = setContract;
                function setContract(new_contract) {
                    active_contract = {};
                    active_contract = Object.assign(active_contract, new_contract);
                    mge.setContract(active_contract);
                }
                this.newTransactionPreview = newTransactionPreview;
                function newTransactionPreview(init_obj, new_transaction_cb) {
                    let active_trans_obj;
                    (function init() {
                        active_trans_obj = {};
                        allow_nef = (checkForProperty(init_obj.disable_nef) == false || !init_obj.disable_nef) ? true : false;
                        active_trans_obj.final_check_fcn = (checkForProperty(init_obj.final_check_fcn) == false) ? null : init_obj.final_check_fcn;
                        removePrevious();
                        multiPreview((Array.isArray(init_obj) ? init_obj : [init_obj]));
                    }
                    )();
                    function multiPreview(obj_array) {
                        if (ls_handler != null)
                            ls_handler.setLoading(true);
                        let trans_array = [];
                        var new_address = obj_array[0].user_address;
                        confirmReqParams(obj_array, new_address, function(rdy) {
                            if (rdy === true) {
                                transaction_cb = new_transaction_cb;
                                for (var i = 0; i < obj_array.length; i++)
                                    trans_array.push(prepNewTrans(obj_array[i]));
                                active_trans_obj.user_address = new_address;
                                active_trans_obj.trans_array = trans_array;
                                preMultiEstimateMisc({
                                    non_submit_est: true
                                }, trans_array, createPreview);
                            } else
                                callCancel();
                        });
                        function createPreview(est_obj) {
                            if (est_obj != null) {
                                createTransactionContainer(obj_array, est_obj);
                                var avgs_obj = mge.getPriceStats();
                                var above_avg = avgs_obj.avg_wei + (avgs_obj.avg_wei / 10n);
                                if (est_obj.wei_base > above_avg)
                                    tb_h.newNotification({
                                        msg_html: "Current gas price higher than usual.",
                                        full_bar_target: true,
                                        self_remove_ms: 10000,
                                        custom_bg_color: "#e99a32",
                                        custom_color: "#fff",
                                        svg_icon: hb.getSvg("warning_w_border", {
                                            class_string: "std_icon"
                                        }),
                                        close_icon: hb.getSvg("x", {
                                            class_string: "std_close_icon"
                                        })
                                    });
                            } else {
                                ls_handler.setLoading(false);
                                callCancel();
                            }
                        }
                    }
                    function HACKYFIXFORNOW(fcn_params) {
                        for (var i = 0; i < fcn_params.length; i++) {
                            if (fcn_params[i].array_count >= 1)
                                fcn_params[i].dynamic = true;
                        }
                        return fcn_params;
                    }
                    function prepNewTrans(trans_obj) {
                        var cpe = new contract_param_encoder();
                        var new_trans = {};
                        var fcn_call = trans_obj.fcn_call;
                        var header_array = (fcn_call != "") ? cpe.getHeaderArray(fcn_call) : "";
                        var fcn_params = cpe.getEncoded(trans_obj.fcn_params, header_array);
                        fcn_params = HACKYFIXFORNOW(fcn_params);
                        fcn_params = cpe.combineParams(fcn_params);
                        new_trans.encoded_params = getFunctionStr(genFunctionHash(fcn_call), fcn_params);
                        new_trans.contract_address = trans_obj.contract_address;
                        new_trans.user_address = trans_obj.user_address;
                        if (checkForProperty(trans_obj.gwei_required))
                            new_trans.gwei_required = trans_obj.gwei_required;
                        new_trans.tax_rate = (checkForProperty(trans_obj.tax_rate) && trans_obj.tax_rate > 0) ? trans_obj.tax_rate : null;
                        new_trans.constant_wei = (checkForProperty(trans_obj.constant_value) && (trans_obj.constant_value > 0 || trans_obj.constant_value == "100%")) ? trans_obj.constant_value : null;
                        return new_trans;
                    }
                    function preMultiEstimateMisc(est_params={}, trans_array, internal_cb) {
                        mge.multiEstimateMisc(est_params, trans_array, function(new_trans_array) {
                            var big_wei = hexToBigInt(new_trans_array[0].user_total_hex);
                            var totals_obj = calcMultiTotals(new_trans_array, big_wei);
                            if (checkForNef(totals_obj, big_wei))
                                internal_cb(null);
                            else
                                internal_cb(totals_obj);
                        });
                        function calcMultiTotals(new_trans_array, user_wei) {
                            var gwei_required = 0n;
                            var gas_total = new_trans_array[0].gas_obj.total;
                            var tax_rate = new_trans_array[0].tax_rate;
                            var required_funds = 0n;
                            for (var i = 0; i < new_trans_array.length; i++) {
                                required_funds += getTotalWithTax(tax_rate, new_trans_array[i].estimate_obj.gwei_required, gas_total);
                                gwei_required += new_trans_array[i].estimate_obj.gwei_required;
                            }
                            var totals_obj = {
                                required_funds,
                                gwei_required,
                                gas_total,
                                user_total_hex: new_trans_array[0].user_total_hex,
                                wei_base: new_trans_array[0].gas_obj.wei_base
                            };
                            if (tax_rate != null)
                                totals_obj = doubleCheckThatGasForaSecond(totals_obj, user_wei, tax_rate);
                            totals_obj.user_eth = totals_obj.user_total_hex;
                            return totals_obj;
                        }
                        function checkForNef(totals_obj, user_wei) {
                            if (nef_h != null && totals_obj.required_funds > user_wei) {
                                if (allow_nef)
                                    nef_h(totals_obj);
                                return true;
                            } else
                                return false;
                        }
                        function doubleCheckThatGasForaSecond(totals_obj, user_wei, tax_rate) {
                            var user_max_gas = user_wei - ((user_wei / BigInt(100)) * BigInt(tax_rate));
                            user_max_gas = user_max_gas / totals_obj.gas_total;
                            if (totals_obj.gwei_required > user_max_gas) {
                                var missing_gwei = (totals_obj.gwei_required - user_max_gas) * totals_obj.gas_total;
                                var extra_buffer = (missing_gwei / BigInt(10));
                                totals_obj.required_funds += missing_gwei + extra_buffer;
                            }
                            return totals_obj;
                        }
                    }
                    function createTransactionContainer(create_array, est_obj) {
                        if (ls_handler != null) {
                            ls_handler.setLoading(false);
                        }
                        if (est_obj != null) {
                            var total_wei = est_obj.required_funds;
                            for (var i = 0; i < create_array.length; i++) {
                                if (create_array[i].constant_value != null) {
                                    if (create_array[i].constant_value === "100%") {
                                        total_wei = hexToBigInt(est_obj.user_total_hex);
                                        break;
                                    } else
                                        total_wei += create_array[i].constant_value;
                                }
                            }
                            var custom_title = create_array[0].custom_title;
                            var html_obj = {
                                custom_param_html: create_array[0].custom_param_html,
                                custom_title: custom_title
                            };
                            mainSetHTML(html_obj);
                            current_preview = document.getElementById("trans_prev-outer_container");
                            createListener({
                                ele: window,
                                func: quickClose,
                                type: "keydown",
                                options: {
                                    capture: true
                                }
                            });
                            createListener({
                                ele: document.getElementById("trans_prev-submit_b"),
                                func: multiSubmitClick,
                                type: "click"
                            });
                            createListener({
                                ele: document.getElementById("trans_prev-boomer_close"),
                                func: callCancel,
                                type: "click"
                            });
                            var temp_result_ele = document.getElementById("trans_prev-estimate_results");
                            var title_vars = "$" + active_currency_rate + "*(" + est_obj.gwei_required + "*(" + est_obj.gas_total + "))";
                            temp_result_ele.title = "eth_price*gas (gwei_required*wei_rate (current_base_fee+tip))\n" + title_vars;
                            var t1 = (Number(total_wei) / (10 ** 18)).toFixed(6);
                            var total_eth = (Number(total_wei / BigInt(10 ** 9)) / 10 ** 9);
                            var t2 = (total_eth * active_currency_rate).toFixed(3);
                            var total_cost_usd = (active_currency_rate != null) ? " ($" + t2 + ")" : "";
                            temp_result_ele.innerHTML = t1 + " " + main_currency_symbol + total_cost_usd;
                            var denom = BigInt(10 ** 9);
                            var user_eth = (Number(hexToBigInt(est_obj.user_total_hex) / denom) / 10 ** 9);
                            var total_user_coin_usd = (active_currency_rate != null) ? (" ($" + (user_eth * active_currency_rate).toFixed(3) + ")") : "";
                            document.getElementById("total_token").innerText = user_eth.toFixed(6) + " " + main_currency_symbol + total_user_coin_usd;
                            document.getElementById("trans_prev-submit_b").focus();
                        }
                    }
                    function multiSubmitClick() {
                        if (active_submit == false) {
                            active_submit = true;
                            handleMultiSubmit();
                        }
                    }
                    function handleMultiSubmit() {
                        let remaining_transactions = active_trans_obj.trans_array.length;
                        let response_array = [];
                        let cb_called = false;
                        (function init() {
                            preMultiEstimateMisc({
                                non_submit_est: false
                            }, active_trans_obj.trans_array, function(est_obj) {
                                if (est_obj != null) {
                                    getUserNonce(active_trans_obj.user_address, function(hex_nonce) {
                                        if (hex_nonce != null) {
                                            var dec_nonce = hexToDecimal(hex_nonce);
                                            submitNext(0, dec_nonce);
                                        }
                                    });
                                }
                            });
                        }
                        )();
                        function submitNext(pointer, init_nonce_dec) {
                            var transaction_user_nonce = decimalTo2cHex(parseInt(init_nonce_dec + pointer));
                            if (pointer < active_trans_obj.trans_array.length)
                                multiSubmitTransaction(active_trans_obj.trans_array[pointer], active_trans_obj.trans_array[pointer].encoded_params, active_trans_obj.user_address, active_trans_obj.trans_array[pointer].contract_address, transaction_user_nonce, waitToSendNext);
                            function waitToSendNext(ret) {
                                if (ret.valid && checkForProperty(ret.response)) {
                                    response_array.push(ret.response);
                                    remaining_transactions--;
                                    submitNext(++pointer, init_nonce_dec);
                                }
                                if (remaining_transactions <= 0 && !cb_called) {
                                    cb_called = true;
                                    preCallback(response_array);
                                    active_submit = false;
                                }
                            }
                        }
                    }
                    function preCallback(response_array) {
                        triggerCallback((Array.isArray(init_obj) ? response_array : response_array[0]));
                    }
                    function multiSubmitTransaction(trans_obj, func_str, user_address, contract_address, custom_nonce=null, mst_internal_cb) {
                        let gas_est;
                        let retry_count = 5;
                        var b_animation;
                        (function init() {
                            b_animation = new button_animation(document.getElementById("trans_prev-submit_b"));
                            b_animation.setButtonAnimation(true);
                            gas_est = {
                                gwei_required: trans_obj.estimate_obj.gwei_required,
                                gas: trans_obj.gas_obj,
                                user_eth: trans_obj.user_total_hex,
                                value: trans_obj.gas_obj.hex_price
                            };
                            submit();
                        }
                        )();
                        function submit() {
                            var wei_value = determinePayableValue();
                            prepRawTransaction(contract_address, wei_value, user_address, func_str, function(rlp_trans) {
                                multiSendRaw(rlp_trans, function(ret) {
                                    if (ret.valid)
                                        mst_internal_cb(ret);
                                });
                            });
                        }
                        function determinePayableValue() {
                            var base_gas_price = gas_est.gas.total;
                            var ret = (trans_obj.tax_rate != null && gas_est.value) ? (((gas_est.gwei_required * base_gas_price) / BigInt(100)) * trans_obj.tax_rate) : BigInt(0);
                            if (trans_obj.constant_wei != null) {
                                if (trans_obj.constant_wei === "100%") {
                                    gas_est.gwei_required -= BigInt(default_gwei_overage);
                                    gas_est.gas.total = (gas_est.gas.wei_base / BigInt(11)) * BigInt(10) + gas_est.gas.wei_tip;
                                    ret = hexToBigInt(gas_est.user_eth) - (gas_est.gwei_required * gas_est.gas.total);
                                } else
                                    ret = ret + trans_obj.constant_wei;
                            }
                            return decimalTo2cHex(ret);
                        }
                        function prepRawTransaction(to_ac, eth_quantity=0, from_ac, bytecode_params=null, cb) {
                            getInitialPayoutMessage(to_ac, eth_quantity, from_ac, bytecode_params, function(res) {
                                if (res.valid) {
                                    getTransactionInput(res.result, function(signed_data) {
                                        cb("0x02" + signed_data);
                                    });
                                } else
                                    cb(res);
                            });
                        }
                        function multiSendRaw(input, cb) {
                            var id = getCurrentNano();
                            if (active_trans_obj.final_check_fcn == null)
                                sendIt();
                            else {
                                active_trans_obj.final_check_fcn(function(ret) {
                                    if (ret)
                                        sendIt();
                                    else {
                                        callCancel();
                                        active_submit = false;
                                    }
                                });
                            }
                            function sendIt() {
                                xhr_h.sendXHR({
                                    asserted_status: 200,
                                    api: active_contract.rpc_list,
                                    multi_send_count: 1,
                                    params: {
                                        id: id,
                                        jsonrpc: "2.0",
                                        method: "eth_sendRawTransaction",
                                        params: [input]
                                    },
                                }, function(res) {
                                    if (res.valid) {
                                        var json_response = (JSON.parse(res.response));
                                        if (checkForProperty(json_response.error)) {
                                            retry_count--;
                                            if (retry_count > 0) {
                                                submit();
                                            } else
                                                cb({
                                                    valid: res.valid,
                                                    error: res.response
                                                })
                                        }
                                        cb({
                                            valid: res.valid,
                                            response: json_response.result
                                        });
                                    } else
                                        cb({
                                            valid: res.valid,
                                            error: res.response
                                        })
                                });
                            }
                        }
                        function newGetSignature(hex_hash, cb) {
                            var msg_buff = hexToArrayBuffer(hex_hash, Uint8Array).buffer;
                            var msg_param = {
                                msg_type: "sign_stuff",
                                msg_buff: msg_buff,
                            };
                            var transfer_array = [msg_buff];
                            ww_h.sendMessageToWorker(msg_param, transfer_array, function(sig) {
                                if (sig != null)
                                    cb(sig);
                            });
                        }
                        function getTransactionInput(main_msg, cb) {
                            var rlp = simple_rlp_encode(main_msg);
                            var encoded = "0x02" + bufferToHex(rlp);
                            var hex_hash = kh.keccak256(encoded);
                            newGetSignature(hex_hash, function(sig) {
                                main_msg.push(hexToArrayBuffer(decimalTo2cHex(sig.recovery)));
                                main_msg.push(arrayBufferToArray(new Uint8Array(sig.r)));
                                main_msg.push(arrayBufferToArray(new Uint8Array(sig.s)));
                                checkForLeadingZeros(main_msg[10]);
                                checkForLeadingZeros(main_msg[11]);
                                var final_input = bufferToHex(simple_rlp_encode(main_msg));
                                cb(final_input);
                            });
                        }
                        function getInitialPayoutMessage(to_address, eth_quantity, from_ac, bytecode_params, cb) {
                            if (checkForProperty(custom_nonce)) {
                                finishPrep(custom_nonce);
                            } else {
                                getNonce(user_address, function(res) {
                                    if (res.valid) {
                                        var ret = JSON.parse(res.response);
                                        if (checkForProperty(ret.result)) {
                                            var transaction_user_nonce = hexToDecimal(ret.result);
                                            transaction_user_nonce = decimalTo2cHex(parseInt(transaction_user_nonce));
                                            finishPrep(transaction_user_nonce);
                                        }
                                    }
                                });
                            }
                            function finishPrep(transaction_user_nonce) {
                                var ret_msg = prepPreSignMsg(transaction_user_nonce, to_address, bytecode_params, eth_quantity);
                                cb(ret_msg);
                            }
                        }
                        function multi_getGasObj(gas_obj) {
                            return {
                                max_priority_fee: decimalTo2cHex(gas_obj.gas.wei_tip.toString(16)),
                                max_fee_per_gas: decimalTo2cHex(gas_obj.gas.total.toString(16)),
                                limit: decimalTo2cHex(gas_obj.gwei_required),
                            };
                        }
                        function strToBigToHex(str) {
                            return BigInt(str).toString(16);
                        }
                        function inputToBigIntGwei(value) {
                            return BigInt(Math.round(value * (10 ** 9)));
                        }
                        function prepPreSignMsg(nonce, to_address, bytecode_params, eth_quantity) {
                            var eth_value = (checkForProperty(eth_quantity) ? hexToArrayBuffer(eth_quantity) : []);
                            var msg_data = (checkForProperty(bytecode_params) ? hexToArrayBuffer(bytecode_params) : []);
                            var access_list = [];
                            var gas_obj = multi_getGasObj(gas_est);
                            return {
                                valid: true,
                                result: [hexToArrayBuffer(active_contract.chain_id.toString(16)), hexToArrayBuffer(nonce), hexToArrayBuffer(gas_obj.max_priority_fee), hexToArrayBuffer(gas_obj.max_fee_per_gas), hexToArrayBuffer(gas_obj.limit), hexToArrayBuffer(to_address), eth_value, msg_data, [access_list], ]
                            };
                        }
                        function ethToWei(eth_quantity) {
                            eth_quantity = eth_quantity.toString();
                            var [int_part,dec_part=''] = eth_quantity.split('.');
                            return BigInt(int_part) * BigInt(10 ** 18) + BigInt(dec_part.padEnd(18, '0').slice(0, 18));
                        }
                    }
                    function getUserNonce(from_ac, cb) {
                        xhr_h.sendXHR({
                            asserted_status: 200,
                            api: active_contract.rpc_list,
                            params: {
                                jsonrpc: "2.0",
                                method: "eth_getTransactionCount",
                                params: [from_ac, "pending"]
                            }
                        }, function(res) {
                            if (res.valid) {
                                var ret = JSON.parse(res.response);
                                if (checkForProperty(ret.result))
                                    cb(ret.result);
                                else
                                    cb(null);
                            }
                        });
                    }
                    function button_animation(main_button) {
                        let animation_status;
                        let dot_count = 3;
                        let delay_ms_count = 2000;
                        let initial_text;
                        let animated_button;
                        let block = " .";
                        let finish_animation = false;
                        let default_text = "Please Wait";
                        (function init() {
                            animated_button = main_button;
                            initial_text = animated_button.innerText;
                            animation_status = false;
                        }
                        )();
                        function animate() {
                            if (animation_status) {
                                var new_str = "";
                                for (var i = 0; i < dot_count; i++)
                                    new_str += block;
                                dot_count = (dot_count >= 3) ? 1 : ++dot_count;
                                animated_button.innerHTML = default_text + new_str;
                                window.setTimeout(animate, delay_ms_count);
                            } else if (!finish_animation)
                                animated_button.innerText = initial_text;
                        }
                        this.killAnimation = killAnimation;
                        function killAnimation() {
                            animation_status = false;
                            finish_animation = true;
                        }
                        this.setButtonAnimation = setButtonAnimation;
                        function setButtonAnimation(set_to=true) {
                            animation_status = set_to;
                            if (animation_status == true) {
                                animate();
                            }
                        }
                    }
                }
                function quickClose(e) {
                    if (e.key === "Escape") {
                        e.stopPropagation();
                        callCancel();
                    }
                }
                function getTotalWithTax(tax_rate_bi, gwei_required, gas_total) {
                    var total_bi = (gwei_required) * gas_total;
                    var total_tax = (tax_rate_bi != null) ? ((total_bi / BigInt(100)) * tax_rate_bi) : 0n;
                    return total_bi + total_tax;
                }
                function removePrevious() {
                    if (current_preview != null) {
                        current_preview.remove();
                        current_preview = null;
                        dropListners();
                        active_trans_obj = {};
                    }
                }
                function loadCSS(custom_css) {
                    var new_style = document.createElement("style");
                    new_style.innerHTML = custom_css;
                    document.head.appendChild(new_style);
                }
                function createListener(event_params) {
                    event_params.options = checkForProperty(event_params.options) ? event_params.options : undefined;
                    event_params.type = checkForProperty(event_params.type) ? event_params.type : "click";
                    event_params.ele.addEventListener(event_params.type, event_params.func, event_params.options);
                    current_listeners.push(event_params);
                }
                function removeSingleListener(event_params) {
                    for (var i = 0; i < current_listeners.length; i++) {
                        if (current_listeners[i].type == event_params.type && current_listeners[i].func == event_params.func && current_listeners[i].options == event_params.options) {
                            current_listeners[i].ele.removeEventListener(current_listeners[i].type, current_listeners[i].func, current_listeners[i].options);
                            current_listeners = current_listeners.splice(i, 1);
                        }
                    }
                }
                function dropListners() {
                    for (var i = 0; i < current_listeners.length; i++) {
                        current_listeners[i].ele.removeEventListener(current_listeners[i].type, current_listeners[i].func, current_listeners[i].options);
                    }
                    current_listeners = [];
                }
                function confirmReqParams(obj_array, new_address, cb) {
                    for (var i = 0; i < obj_array.length; i++) {
                        if (obj_array[i].user_address != new_address) {
                            cb(false);
                            return;
                        }
                    }
                    ww_h.sendMessageToWorker({
                        msg_type: "check_both"
                    }, [], cb);
                }
                function callCancel() {
                    triggerCallback(null);
                }
                function triggerCallback(ret) {
                    dropListners();
                    if (current_preview != null)
                        current_preview.remove();
                    current_preview = null;
                    if (transaction_cb != null)
                        transaction_cb(ret);
                    transaction_cb = null;
                }
                function mainSetHTML(create_obj) {
                    custom_html_func(create_obj);
                }
                function checkForProperty(prop) {
                    return (prop === "" || prop === null || prop === undefined) ? false : true;
                }
                function getFunctionStr(func_hash, func_params) {
                    if (func_params == "")
                        return func_hash;
                    else if (func_params.charAt(1) == "x" || func_params.charAt(1) == "X")
                        return func_hash + func_params.slice(2);
                    else
                        return func_hash + func_params;
                }
                function isHex(str) {
                    var re = /^0x[0-9a-f]*$/i;
                    var ret = false;
                    if (re.test(str))
                        ret = true;
                    re.lastIndex = 0;
                    return ret;
                }
                function isForcedHex(str) {
                    var re = /^[0-9a-f]*$/i;
                    var re2 = /^0x[0-9a-f]*$/i;
                    var ret = false;
                    if (re.test(str) || re2.test(str))
                        ret = true;
                    re.lastIndex = 0;
                    return ret;
                }
                function genFunctionHash(func_str) {
                    return (func_str == "") ? "" : kh.keccak256(func_str).slice(0, 10);
                }
                function checkForLeadingZeros(array_buffer) {
                    if (array_buffer[0] == 0) {
                        array_buffer.shift();
                        checkForLeadingZeros(array_buffer);
                    } else
                        return array_buffer;
                }
                function validAddress(address) {
                    if (isForcedHex(address) && hexStringToHexNumber(address).length == 40)
                        return true;
                    return false;
                }
                function hexToBigInt(hex) {
                    var regex = new RegExp(/0x/i);
                    if (regex.test(hex.substring(0, 2)))
                        hex = hexStringToHexNumber(hex);
                    if (hex.length % 2)
                        hex = '0' + hex;
                    return BigInt('0x' + hex);
                }
                function hexToDecimal(hex_str) {
                    const regex = new RegExp(/0x/i);
                    if (regex.test(hex_str.substring(0, 2)))
                        hex_str = hexStringToHexNumber(hex_str);
                    hex_str.replace(/^0*/, '');
                    return parseInt(hex_str, 16);
                }
                function decimalToHexBytes(value, byte_length=8) {
                    var max_send = 10000000000000000000000000000000;
                    var buff = '00';
                    if (value >= max_send)
                        stopExe("Send value too large!");
                    else {
                        var value_in_hex = decimalTo2cHex(value);
                        var init_length = (byte_length * 2 - value_in_hex.length) / 2;
                        for (var i = init_length; i > 0; i--) {
                            value_in_hex = buff + value_in_hex;
                        }
                        return value_in_hex;
                    }
                }
                function arrayBufferToArray(uint8_buffer) {
                    var ret = [];
                    for (var i = 0; i < uint8_buffer.length; i++) {
                        ret.push(uint8_buffer[i]);
                    }
                    return ret;
                }
                function decimalTo2cHex(dec) {
                    var hex = (dec).toString(16);
                    return hex.length % 2 ? ('0' + hex) : hex;
                }
                function decimalToSigned2cHex(dec) {
                    var hex = (dec).toString(16);
                    hex = (hex.charAt(0) == "-") ? hex.slice(1) : hex;
                    hex = ((dec >= 0) ? "1" : "0") + hex;
                    return hex.length % 2 ? ('0' + hex) : hex;
                }
                function bufferToHex(buffer) {
                    return [...new Uint8Array(buffer)].map(b=>b.toString(16).padStart(2, "0")).join("");
                }
                function hexStringToHexNumber(hex_str) {
                    return hex_str.substring(2);
                }
                function hexToArrayBuffer(hex_str, buffer_type=null) {
                    const regex = new RegExp(/0x/i);
                    if (regex.test(hex_str.substring(0, 2)))
                        hex_str = hexStringToHexNumber(hex_str);
                    var ret = [];
                    for (var i = 0; i < hex_str.length / 2; i++) {
                        var x = i * 2;
                        const n = parseInt(hex_str.substr(x, 2), 16);
                        ret.push(n);
                    }
                    if (buffer_type)
                        return new buffer_type(ret);
                    else
                        return ret;
                }
                function getByteEncoding(str) {
                    var bytesv2 = [];
                    for (var i = 0; i < str.length; ++i) {
                        var code = str.charCodeAt(i);
                        bytesv2 = bytesv2.concat([code & 0xff, code / 256 >>> 0]);
                    }
                    return bytesv2;
                }
                function checkForProperty(prop) {
                    return (prop === "" || prop === null || prop === undefined) ? false : true;
                }
                function getCurrentNano() {
                    var random_nano = 100 + getRandomInt(899);
                    return parseInt(Date.now() + "" + random_nano);
                }
                function getRandomInt(max) {
                    return Math.floor(Math.random() * max);
                }
                function bigGweiToNum(big_gwei) {
                    return (Number(big_gwei) / (10 ** 9));
                }
                function stopExe(msg) {
                    console.log("Error: " + msg);
                    throw new Error("Execution Halted");
                }
            }
            function multi_gas_estimator(passed_xhr) {
                let mge_active_contract;
                let xhr_h;
                let price_obj;
                (function init() {
                    mge_active_contract = null;
                    xhr_h = passed_xhr;
                    price_obj = {
                        init_obj: {
                            baseline_check_countdown: 10,
                            baseline_interval: 30000,
                            baseline_array: []
                        },
                        check_interval_ms: 300000,
                        fail_delay_ms: 100000,
                        obj_array: [],
                        check_count: 0n,
                        fresh_delay_ms: 6000,
                    };
                }
                )();
                function initAutoGasCheck() {
                    (checkGas)();
                    function checkGas() {
                        getGasPriceEst(undefined, genCheckRecord);
                        function genCheckRecord(ret) {
                            if (ret != null)
                                handleRecord({
                                    wei_price: ret.wei_base,
                                    ts: Date.now()
                                });
                            else
                                window.setTimeout(checkGas, price_obj.fail_delay_ms);
                        }
                    }
                    function handleRecord(new_obj) {
                        if (price_obj.init_obj.baseline_check_countdown > 0)
                            handleBaseline(new_obj);
                        else {
                            price_obj.obj_array.push(new_obj);
                            price_obj.check_count++;
                            window.setTimeout(checkGas, price_obj.check_interval_ms);
                        }
                    }
                    function handleBaseline(new_obj) {
                        price_obj.init_obj.baseline_array.push(new_obj);
                        if (--price_obj.init_obj.baseline_check_countdown === 0) {
                            var first_avg = calcAverages(price_obj.init_obj.baseline_array).avg_wei;
                            price_obj.obj_array.push({
                                wei_price: first_avg,
                                ts: Date.now()
                            })
                        }
                        window.setTimeout(checkGas, price_obj.init_obj.baseline_interval);
                    }
                }
                this.setContract = setContract;
                function setContract(new_contract) {
                    mge_active_contract = new_contract;
                    initAutoGasCheck();
                }
                this.getPriceStats = getPriceStats;
                function getPriceStats() {
                    var stats_obj = (price_obj.check_count > 0) ? calcAverages(price_obj.obj_array) : calcAverages(price_obj.init_obj.baseline_array);
                    stats_obj = appendCheckedStats(stats_obj);
                    return stats_obj;
                }
                function appendCheckedStats(stats_obj) {
                    if (stats_obj != null) {
                        stats_obj.last_checked = price_obj.obj_array[price_obj.obj_array.length - 1];
                        stats_obj.total_checked = price_obj.obj_array.length;
                    }
                    return stats_obj;
                }
                function calcAverages(obj_array) {
                    var ret_obj = {
                        avg_wei: 0n
                    };
                    for (var i = 0; i < obj_array.length; i++)
                        ret_obj.avg_wei += obj_array[i].wei_price;
                    ret_obj.avg_wei /= (obj_array.length > 0) ? BigInt(obj_array.length) : null;
                    return ret_obj;
                }
                this.multiEstimateMisc = multiEstimateMisc;
                function multiEstimateMisc(est_params, trans_array, cb=null) {
                    let active_user = null;
                    let remaining_estimates = trans_array.length;
                    (function init() {
                        standardCall();
                        function debugVersion() {}
                        function standardCall() {
                            active_user = trans_array[0].user_address;
                            getGasKeyValues(active_user, function(key_gas_obj) {
                                if (key_gas_obj != null) {
                                    determineTotalGasReq(key_gas_obj, function(trans_array) {
                                        cb(trans_array);
                                    });
                                }
                            });
                        }
                    }
                    )();
                    function determineTotalGasReq(key_gas_obj, cb) {
                        let non_submit_est = (checkForProperty(est_params.non_submit_est)) ? est_params.non_submit_est : false;
                        (function nextEstimate(pointer) {
                            if (pointer < trans_array.length) {
                                var trans_obj = trans_array[pointer];
                                var est_encoded_params = trans_obj.encoded_params;
                                var options = multiEstimatePrep(trans_obj, non_submit_est);
                                Object.assign(trans_obj, key_gas_obj);
                                gasOnly(trans_obj, est_encoded_params, options, function(res) {
                                    if (res != null) {
                                        trans_obj.estimate_obj = res;
                                        waitForFinished();
                                    }
                                });
                                nextEstimate(++pointer);
                            }
                        }
                        )(0);
                        function waitForFinished() {
                            remaining_estimates--;
                            if (remaining_estimates <= 0) {
                                cb(trans_array);
                            }
                        }
                    }
                    function multiEstimatePrep(trans_obj, non_submit_est=false) {
                        var options = {
                            from: trans_obj.user_address
                        };
                        if (trans_obj.gwei_required != null)
                            options.gwei_required = trans_obj.gwei_required;
                        if (non_submit_est)
                            options.non_submit_est = true;
                        return options;
                    }
                }
                function getGasKeyValues(user_address, cb) {
                    var ret_obj = {
                        user_total_hex: null,
                        gas_obj: null
                    };
                    getTotalEth(user_address, function(user_eth) {
                        ret_obj.user_total_hex = user_eth;
                        callbackOnComplete();
                    });
                    getGasPriceEst(undefined, function(gas_obj) {
                        ret_obj.gas_obj = gas_obj;
                        ret_obj.gas_obj.hex_price = "0x" + Number(gas_obj.total).toString(16);
                        callbackOnComplete();
                    });
                    function callbackOnComplete() {
                        if (ret_obj.user_total_hex != null && ret_obj.gas_obj != null)
                            cb(ret_obj);
                    }
                }
                function gasOnly(trans_obj, encoded_str, options, gasOnly_cb) {
                    let max_gas_cost = 15000000;
                    let results = {};
                    (function init() {
                        let temp_gas_price_hex = trans_obj.gas_obj.hex_price;
                        var gas_total_bi = hexToBigInt(temp_gas_price_hex);
                        var coin_total_bi = hexToBigInt(trans_obj.user_total_hex);
                        var coin_10_bi = (coin_total_bi / BigInt(10));
                        var temp_gas_limit = determineGasLimit(coin_10_bi, gas_total_bi);
                        var temp_value = coin_10_bi;
                        if (trans_obj.constant_wei != null && trans_obj.constant_wei != "100%")
                            temp_value = trans_obj.constant_wei;
                        temp_value = "0x" + temp_value.toString(16);
                        var temp_params = {
                            gas_limit: temp_gas_limit,
                            gas_price: temp_gas_price_hex
                        };
                        if (trans_obj.tax_rate != null || trans_obj.constant_wei != null)
                            temp_params.value = temp_value;
                        if (checkForProperty(trans_obj.gwei_required))
                            gasOnly_cb({
                                gwei_required: trans_obj.gwei_required
                            });
                        else
                            getGasUsedEst(encoded_str, temp_params);
                    }
                    )();
                    function determineGasLimit(coin_10_bi, gas_total_bi) {
                        var temp_gas_limit = coin_10_bi * BigInt(9);
                        temp_gas_limit = temp_gas_limit / gas_total_bi;
                        temp_gas_limit = "0x" + temp_gas_limit.toString(16);
                        return temp_gas_limit;
                    }
                    function getGasUsedEst(fcn_str, params_obj={}) {
                        var buffer_data = fcn_str;
                        var msg_data = {
                            to: trans_obj.contract_address,
                            data: buffer_data,
                            from: trans_obj.user_address
                        };
                        if (!checkForProperty(msg_data.to)) {
                            delete msg_data.to;
                            msg_data.data = "0x" + msg_data.data;
                        }
                        if (params_obj.value != null)
                            msg_data.value = params_obj.value;
                        if (options.non_submit_est != true) {
                            if (params_obj.gas_limit != null)
                                msg_data.gas = params_obj.gas_limit;
                            if (params_obj.gas_price != null)
                                msg_data.gasPrice = params_obj.gas_price;
                        }
                        var call_obj = {
                            method: "eth_estimateGas",
                            params: [msg_data],
                            id: getCurrentNano(),
                            api: active_contract.rpc_list,
                        };
                        getBaseTokenCall(call_obj, function(res) {
                            if (checkForProperty(res.result)) {
                                results.gwei_required = hexToBigInt(res.result);
                                results.gwei_required += BigInt(default_gwei_overage);
                                gasOnly_cb(results);
                            } else
                                gasOnly_cb(null);
                        });
                    }
                }
                function getGasPriceEst(tip="0.5", internal_cb) {
                    var call_obj = {
                        method: "eth_gasPrice",
                        params: [],
                        api: active_contract.rpc_list
                    };
                    getBaseTokenCall(call_obj, function(res) {
                        if (checkForProperty(res.result)) {
                            tip = Number(tip);
                            tip = BigInt(tip * (10 ** 9));
                            var wei_base = hexToBigInt(res.result);
                            wei_base = wei_base + wei_base / 10n;
                            internal_cb({
                                total: (wei_base + tip),
                                wei_base: wei_base,
                                wei_tip: tip
                            });
                        } else
                            internal_cb(null);
                    });
                }
                function getTotalEth(user_address, internal_cb) {
                    var call_obj = {
                        method: "eth_getBalance",
                        params: [user_address, "latest"],
                        api: active_contract.rpc_list,
                    };
                    getBaseTokenCall(call_obj, function(res) {
                        if (res != null && checkForProperty(res.result))
                            internal_cb(res.result);
                        else
                            internal_cb(null);
                    });
                }
                function getBaseTokenCall(call_obj, cb) {
                    var payload_params = (checkForProperty(call_obj.params)) ? call_obj.params : [];
                    var call_params = {
                        multi_send_count: 1,
                        asserted_status: 200,
                        api: call_obj.api,
                        params: {
                            jsonrpc: "2.0",
                            method: call_obj.method,
                            params: payload_params
                        }
                    };
                    if (checkForProperty(call_obj.id))
                        call_params.id = call_obj.id;
                    xhr_h.sendXHR(call_params, function(res) {
                        if (res.valid) {
                            var ret = JSON.parse(res.response);
                            cb(ret);
                        } else
                            cb(null);
                    });
                }
                function getCurrentNano() {
                    var random_nano = 100 + getRandomInt(899);
                    return parseInt(Date.now() + "" + random_nano);
                }
                function getRandomInt(max) {
                    return Math.floor(Math.random() * max);
                }
                function hexToBigInt(hex) {
                    var regex = new RegExp(/0x/i);
                    if (regex.test(hex.substring(0, 2)))
                        hex = hexStringToHexNumber(hex);
                    if (hex.length % 2)
                        hex = '0' + hex;
                    return BigInt('0x' + hex);
                }
                function checkForProperty(prop) {
                    return (prop === "" || prop === null || prop === undefined) ? false : true;
                }
            }
            function copy_to_clipboard(text_to_copy, cb=null) {
                navigator.clipboard.writeText(text_to_copy).then(()=>{
                    if (cb != null)
                        cb(true);
                }
                ).catch(err=>{
                    if (cb != null)
                        cb(false, err);
                }
                );
            }
            function clear_clipboard(cb=null, params={}) {
                let prefix = (params.prefix != null) ? params.prefix : "";
                let suffix = (params.suffix != null) ? params.suffix : "";
                let default_item_clear = (params.item_clear != null) ? params.item_clear : 40;
                (function next(pointer) {
                    if (pointer < default_item_clear) {
                        navigator.clipboard.writeText(prefix + pointer + suffix).then(function() {
                            ++pointer;
                            window.setTimeout(function() {
                                next(pointer)
                            }, 250);
                        });
                    } else if (cb != null) {
                        cb(true);
                        cb = null;
                    }
                }
                )(0);
            }
            function handle_textarea_resize(ele, params={
                force_single_line: false,
                min_row_buffer: 1,
                disable_returns: false,
                disable_whitespace: false,
                return_cb: null,
                hide_text_target: null,
                char_limit: null,
                char_limit_cb: null
            }) {
                let main_textarea = ele;
                let char_clock = null;
                main_textarea.setAttribute("rows", params.min_row_buffer);
                var force_single_line = (params.force_single_line != null) ? params.force_single_line : false;
                let char_limit = (params.char_limit != null) ? params.char_limit : null;
                let limit_display_point = (params.limit_display_point != null) ? params.limit_display_point : 200;
                if (char_limit != null) {
                    buildCharClock();
                    checkCharLimit();
                }
                if (force_single_line)
                    ele.style.whiteSpace = "nowrap";
                main_textarea.addEventListener('beforeinput', function(e) {
                    if (params.disable_returns && e.inputType === 'insertLineBreak') {
                        if (params.return_cb != null)
                            params.return_cb(e, params);
                        else
                            e.preventDefault();
                    } else {
                        if (force_single_line == false)
                            updateReturns();
                    }
                });
                if (checkForProperty(params.hide_text_target)) {
                    params.hide_text_target.addEventListener("click", click_defaultToggleHiddenInput);
                }
                if (params.disable_whitespace || params.disable_returns) {
                    main_textarea.addEventListener('paste', delayedRemoveWhitespace);
                    if (params.disable_whitespace)
                        main_textarea.addEventListener('keyup', removeTabs);
                }
                this.updateReturns = updateReturns;
                function updateReturns() {
                    window.setTimeout(function() {
                        var row_count;
                        row_count = (params.disable_returns) ? new_updateLineCountNoReturns() : updateLineCountWithReturns();
                        if (char_limit != null)
                            checkCharLimit();
                        main_textarea.setAttribute("rows", row_count);
                    }, 1);
                }
                function buildCharClock() {
                    char_clock = document.createElement("p");
                    char_clock.innerText = char_limit - main_textarea.value.length;
                    char_clock.style.textAlign = "right";
                    main_textarea.parentNode.insertBefore(char_clock, main_textarea.nextSibling);
                }
                function checkCharLimit() {
                    var ret = false;
                    if (main_textarea.value.length > (char_limit - limit_display_point)) {
                        char_clock.style.display = "block";
                        char_clock.innerText = char_limit - main_textarea.value.length;
                        if (main_textarea.value.length > (char_limit)) {
                            char_clock.style.color = "#fd4f4f";
                            ret = true;
                        } else
                            char_clock.style.color = "#fff";
                    } else
                        char_clock.style.display = "none";
                    if (params.char_limit_cb != undefined && params.char_limit_cb != null)
                        params.char_limit_cb(ret);
                }
                this.defaultToggleHiddenInput = defaultToggleHiddenInput;
                function defaultToggleHiddenInput(force_to=undefined) {
                    if (force_to || (checkForProperty(main_textarea.dataset.pass) && force_to !== false)) {
                        delete main_textarea.dataset.pass;
                        main_textarea.style.fontFamily = null;
                        params.hide_text_target.style.opacity = "1";
                    } else {
                        main_textarea.dataset.pass = "true";
                        main_textarea.style.fontFamily = "bitnote_box_font";
                        params.hide_text_target.style.opacity = ".5";
                    }
                }
                function click_defaultToggleHiddenInput(e) {
                    defaultToggleHiddenInput();
                    updateReturns();
                }
                function delayedRemoveWhitespace() {
                    window.setTimeout(removeWhitespace, 1);
                }
                function removeTabs(e) {
                    if (e.key == "Alt" || e.key == "Tab") {
                        window.setTimeout(function() {
                            var new_text = main_textarea.value;
                            new_text = new_text.replace(/\t/g, ' ');
                            main_textarea.value = new_text;
                        }, 1);
                    }
                }
                function removeWhitespace() {
                    var new_text = main_textarea.value;
                    new_text = new_text.replace(/(\r\n|\r|\n|\t)/g, ' ');
                    main_textarea.value = new_text;
                }
                function updateLineCountWithReturns() {
                    var text = main_textarea.value;
                    var line_width = main_textarea.clientWidth;
                    var padding_l = window.getComputedStyle(main_textarea).getPropertyValue('padding-left');
                    var padding_r = window.getComputedStyle(main_textarea).getPropertyValue('padding-right');
                    var paddings = Math.ceil(Number(padding_l.split("px")[0])) + Math.ceil(Number(padding_r.split("px")[0]));
                    var canvas = document.createElement('canvas');
                    var context = canvas.getContext('2d');
                    context.font = window.getComputedStyle(main_textarea).getPropertyValue('font');
                    var lines = text.split('\n');
                    var row_count = lines.length;
                    var font_size = Math.ceil(Number(context.font.split("px")[0]));
                    line_width -= paddings;
                    line_width -= font_size;
                    for (var i = 0; i < lines.length; i++) {
                        var metrics = context.measureText(lines[i]);
                        var otc = float2Int(metrics.width / line_width);
                        var tc = float2Int((metrics.width + (otc * (font_size / 2))) / line_width);
                        if (tc >= 1)
                            row_count += tc;
                    }
                    row_count = Math.ceil(row_count);
                    row_count += params.min_row_buffer;
                    return row_count;
                }
                function updateLineCountNoReturns() {
                    var text = main_textarea.value;
                    var line_width = main_textarea.clientWidth;
                    var padding_l = window.getComputedStyle(main_textarea).getPropertyValue('padding-left');
                    var padding_r = window.getComputedStyle(main_textarea).getPropertyValue('padding-right');
                    var paddings = Math.ceil(Number(padding_l.split("px")[0])) + Math.ceil(Number(padding_r.split("px")[0]));
                    var canvas = document.createElement('canvas');
                    var context = canvas.getContext('2d');
                    context.font = window.getComputedStyle(main_textarea).getPropertyValue('font');
                    var lines = text;
                    var row_count = 0;
                    var font_size = Math.ceil(Number(context.font.split("px")[0]));
                    line_width -= font_size;
                    line_width -= paddings;
                    var metrics = context.measureText(lines);
                    var tc = float2Int(metrics.width);
                    tc = tc / line_width;
                    var new_tc = Math.ceil(tc);
                    row_count += new_tc;
                    if (params.min_row_buffer === 1)
                        row_count = (row_count < params.min_row_buffer) ? params.min_row_buffer : row_count;
                    else
                        row_count += params.min_row_buffer;
                    main_textarea.setAttribute("rows", row_count);
                }
                function float2Int(value) {
                    return value | 0;
                }
                function new_updateLineCountNoReturns() {
                    var text = main_textarea.value;
                    var line_width = main_textarea.clientWidth;
                    var padding_l = window.getComputedStyle(main_textarea).getPropertyValue('padding-left');
                    var padding_r = window.getComputedStyle(main_textarea).getPropertyValue('padding-right');
                    var paddings = Math.ceil(Number(padding_l.split("px")[0])) + Math.ceil(Number(padding_r.split("px")[0]));
                    var temp_b = window.getComputedStyle(main_textarea).getPropertyValue('border').split("px")[0];
                    var border = Math.ceil(Number(temp_b));
                    var canvas = document.createElement('canvas');
                    var context = canvas.getContext('2d');
                    context.font = window.getComputedStyle(main_textarea).getPropertyValue('font');
                    var font_size = Math.ceil(Number(context.font.split("px")[0]));
                    line_width -= font_size / 2;
                    line_width -= (border * 2);
                    line_width -= paddings;
                    var lines = text;
                    var row_count = 0;
                    var metrics = context.measureText(lines);
                    var tc = float2Int(metrics.width);
                    tc = tc / line_width;
                    var new_tc = Math.ceil(tc);
                    row_count += new_tc;
                    if (params.min_row_buffer === 1)
                        row_count = (row_count < params.min_row_buffer) ? params.min_row_buffer : row_count;
                    else
                        row_count += params.min_row_buffer;
                    return row_count;
                }
            }
            function tooltip_handler(element, msg, params=null) {
                var default_box_cn = "tooltip_box";
                var tooltip_box;
                element.addEventListener('mouseover', mouseOverEvent);
                function mouseOverEvent(e) {
                    if (tooltip_box == null) {
                        tooltip_box = createNewTooltipBox(msg);
                        setToolboxPosition(e, tooltip_box);
                        element.addEventListener('mouseleave', removeOnLeave);
                    }
                }
                this.removeHandler = removeHandler;
                function removeHandler() {
                    element.removeEventListener('mouseover', mouseOverEvent);
                    element.removeEventListener('mouseleave', removeOnLeave);
                    removeOnLeave();
                }
                function removeOnLeave(e) {
                    if (tooltip_box) {
                        document.body.removeChild(tooltip_box);
                        tooltip_box = null;
                    }
                }
                function windowUpEvent(e) {
                    if (tooltip_box) {
                        document.body.removeChild(tooltip_box);
                        tooltip_box = null;
                    }
                    window.removeEventListener(e.type, windowUpEvent);
                    document.body.style.pointerEvents = null;
                    document.body.style.userSelect = null;
                    document.body.style.touchAction = null;
                }
                function createNewTooltipBox() {
                    var new_tooltip_box = document.createElement('div');
                    new_tooltip_box.classList.add(default_box_cn);
                    new_tooltip_box.innerHTML = msg;
                    document.body.appendChild(new_tooltip_box);
                    return new_tooltip_box;
                }
                function setToolboxPosition(e, tooltip_box) {
                    var e_target = (checkForProperty(e.touches)) ? e.touches[0] : e;
                    var offset_y = (30 + Math.round(tooltip_box.clientHeight));
                    offset_y = (e_target.clientY < offset_y) ? 30 : (0 - offset_y);
                    var offset_x = ((e_target.clientX) - Math.round(tooltip_box.clientWidth / 2));
                    offset_x = (offset_x <= 0) ? 0 : offset_x;
                    offset_x = (offset_x + tooltip_box.clientWidth >= window.screen.availWidth) ? window.screen.availWidth - (tooltip_box.clientWidth + 5) : offset_x;
                    tooltip_box.style.top = ((e_target.clientY) + offset_y) + 'px';
                    tooltip_box.style.left = offset_x + 'px';
                }
                function checkForProperty(prop) {
                    return (prop === "" || prop === null || prop === undefined) ? false : true;
                }
            }
            function zxcvbn_handler(params) {
                var main_wordlist = {};
                let pbkdf2_gps;
                let global_cost_per;
                let main_charlist;
                (function init() {
                    global_cost_per = determineCostPer();
                    main_charlist = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()-_=+[]{};:',.<>?/|\\";
                    if (checkForProperty(params.zxcvbn) === false && params.lib_loaded != true)
                        loadZxcvbn();
                    if (checkForProperty(params.wordlist)) {
                        for (var i = 0; i < params.wordlist.length; i++)
                            main_wordlist[params.wordlist[i]] = 1;
                    }
                }
                )();
                function loadZxcvbn() {
                    var script_list = ["zxcvbn.js", ];
                    if (checkForProperty(params.path))
                        script_list[0] = params.path;
                    for (var i = 0; i < script_list.length; i++) {
                        var new_script = document.createElement("script");
                        new_script.src = script_list[i];
                        document.body.appendChild(new_script);
                    }
                }
                this.getCrackCost = getCrackCost;
                function getCrackCost(pw_text) {
                    var total_guesses = null;
                    total_guesses = crackCost(pw_text, main_wordlist, main_charlist);
                    if (total_guesses != null)
                        total_guesses = Number(total_guesses);
                    else
                        total_guesses = zxcvbn(pw_text).guesses;
                    return getEstDollarValue(total_guesses / 2);
                }
                function crackCost(passphrase, wordlist, password_characters) {
                    const delimiters = /\s|,|_/;
                    let words = passphrase.split(delimiters);
                    let originalWords = [...words];
                    words = words.map(word=>word.toLowerCase());
                    let wordsFound = 0;
                    let remainingCharacters = 0;
                    let found_words = {};
                    words.forEach((word,index)=>{
                        if (wordlist[word]) {
                            if (!found_words[word]) {
                                found_words[word] = 1;
                                wordsFound++;
                            }
                        } else
                            remainingCharacters += (originalWords[index] == "") ? 1 : originalWords[index].length;
                    }
                    );
                    if (wordsFound > 1) {
                        let wordlistGuesses = Math.pow(Object.keys(wordlist).length, wordsFound);
                        let remainingGuesses = Math.pow(password_characters.length, remainingCharacters);
                        return BigInt(wordlistGuesses) * BigInt(remainingGuesses);
                    } else
                        return null;
                }
                function getEstDollarValue(total_guesses) {
                    var ret = (total_guesses * Number(global_cost_per)) * 1000000;
                    if (ret > 1)
                        ret = bigIntToNumberString(BigInt(Math.ceil(ret)));
                    else
                        ret = convertSciNotation(ret);
                    return ret;
                }
                function determineCostPer() {
                    var cost_per = (6 / 100000) / 2 ** 32;
                    var start_point_ms = 1546347661000;
                    var current_point_ms = Date.now();
                    var eighteen_months_ms = 47336400000;
                    var decrease_over_time = (2 ** ((current_point_ms - start_point_ms) / eighteen_months_ms));
                    cost_per = cost_per / decrease_over_time;
                    return cost_per;
                }
                function checkForProperty(prop) {
                    return (prop === "" || prop === null || prop === undefined) ? false : true;
                }
            }
            function convertSciNotation(num) {
                if (num === 0 || num < 1e-9)
                    return 0;
                else
                    return (num < 1) ? num.toFixed(9) : num.toFixed(0);
            }
            function bigIntToNumberString(bigNum, maxDigits=20) {
                const bigNumString = bigNum.toString();
                if (bigNumString.length > maxDigits) {
                    const mainPart = bigNumString.slice(0, maxDigits);
                    const mainPartWithCommas = mainPart.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                    const remainingDigitsCount = bigNumString.length - maxDigits;
                    return `${mainPartWithCommas}  10<sup>${remainingDigitsCount}</sup>`;
                }
                const bigNumWithCommas = bigNumString.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                return bigNumWithCommas;
            }
            function shortcut_handler(options={
                apple_mode: false
            }) {
                let shortcut_list = [];
                let apple_mode;
                (function init() {
                    apple_mode = (options.apple_mode) ? true : false;
                }
                )();
                this.addShortcut = addShortcut;
                function addShortcut(target, function_call, new_key, event_type, key_modifiers=null, tag_name=null) {
                    var new_key_shortcut = {
                        key: new_key,
                        func: function_call,
                        tag: tag_name
                    };
                    if (key_modifiers != null) {
                        if (!Array.isArray(key_modifiers))
                            key_modifiers = [key_modifiers];
                        if (apple_mode) {
                            for (var i = 0; i < key_modifiers.length; i++)
                                key_modifiers[i] = (key_modifiers[i] == "ctrlKey") ? "metaKey" : key_modifiers[i];
                        }
                    } else
                        key_modifiers = [];
                    new_key_shortcut.modifier_array = key_modifiers;
                    for (var n = 0; n < shortcut_list.length; n++) {
                        if (shortcut_list[n].target == target && shortcut_list[n].event_type == event_type) {
                            shortcut_list[n].active_listener.appendKeys(new_key_shortcut);
                            return;
                        }
                    }
                    var new_listener = new newKeyListener(target,event_type);
                    new_listener.appendKeys(new_key_shortcut);
                    shortcut_list.push({
                        active_listener: new_listener,
                        target: target,
                        event_type: event_type
                    });
                }
                this.clearAll = clearAll;
                function clearAll() {
                    for (var n = 0; n < shortcut_list.length; n++)
                        shortcut_list[n].active_listener.destroy();
                    shortcut_list = [];
                }
                this.clearByTarget = clearByTarget;
                function clearByTarget(target, event_type=null) {
                    for (var n = 0; n < shortcut_list.length; n++) {
                        if (shortcut_list[n].target == target && (event_type == null || shortcut_list[n].event_type == event_type))
                            shortcut_list[n].active_listener.destroy();
                    }
                }
                this.clearByTagName = clearByTagName;
                function clearByTagName(tag_name) {
                    for (var n = 0; n < shortcut_list.length; n++)
                        shortcut_list[n].active_listener.removeTag(tag_name);
                }
                function newKeyListener(target, event_type) {
                    let key_list = [];
                    let active_target;
                    let active_event;
                    (function init() {
                        active_target = target;
                        active_event = event_type;
                        active_target.addEventListener(active_event, checkKeys);
                    }
                    )();
                    this.destroy = destroy;
                    function destroy() {
                        active_target.removeEventListener(active_event, checkKeys);
                    }
                    this.removeTag = removeTag;
                    function removeTag(tag) {
                        for (var i = key_list.length - 1; i >= 0; i--) {
                            if (key_list[i].tag == tag)
                                key_list.splice(i, 1);
                        }
                    }
                    this.appendKeys = appendKeys;
                    function appendKeys(key_obj) {
                        key_list.push(key_obj);
                    }
                    function checkKeys(e) {
                        for (var i = 0; i < key_list.length; i++) {
                            if (e.key == key_list[i].key) {
                                for (var x = 0; x < key_list[i].modifier_array.length; x++) {
                                    if (e[key_list[i].modifier_array] == false)
                                        return;
                                }
                                e.preventDefault();
                                key_list[i].func();
                            }
                        }
                    }
                }
            }
            function toasts_handler(handler_params={}) {
                (function toasts_init() {
                    var css = (checkForProperty(handler_params.custom_css)) ? handler_params.custom_css : ` .toasts_container{position:fixed;width:100%;height:100vh;z-index:10;pointer-events:none;font-size: calc(1vw + 1vh) / 2);} .toasts_inner_container{width:100%} .toasts_success,.toasts_error,.toasts_wait{font-family:arial;margin:.75em auto;padding:.5em 1em;border-radius:.3em;opacity:0;transition:opacity .5s ease;max-width:15em} .toasts_success{background-color:#4acf4a;box-shadow:rgba(134, 255, 134,.6) 0 0 0.3em 0.1em} .toasts_error{background-color:#cf4a4a;box-shadow:rgba(255, 134, 134,.6) 0 0 0.3em 0.1em} .toasts_wait{background-color:#bf4acf;box-shadow:rgba(245, 134, 255,.6) 0 0 0.3em 0.1em} .toasts_status{font-size:1.1em;font-weight:bold;margin:0} .toasts_message{font-size:.8em;margin:0} `;
                    css = css.trim().split("}");
                    var styles = window.document.styleSheets[0];
                    for (var i = 0; i < css.length - 1; i++) {
                        var new_style = (css[i] + "}").trim();
                        styles.insertRule(new_style);
                    }
                    var fixed = document.createElement("div");
                    fixed.className = "toasts_container";
                    fixed.innerHTML = "<div class=toasts_inner_container></div>";
                    document.body.prepend(fixed);
                }
                )();
                this.setToast = setToast;
                function setToast(toast_type, toast_status, toast_message, toast_seconds=5) {
                    var new_toast = document.createElement("div");
                    switch (toast_type) {
                    case 0:
                        new_toast.className = "toasts_error";
                        break;
                    case 1:
                        new_toast.className = "toasts_success";
                        break;
                    case 2:
                        new_toast.className = "toasts_wait";
                        break;
                    }
                    new_toast.innerHTML = "<p class=toasts_status>" + toast_status + "<p class=toasts_message>" + toast_message + "</p>";
                    var new_toast_container = document.getElementsByClassName("toasts_inner_container")[0];
                    if (new_toast_container.firstChild)
                        new_toast_container.insertBefore(new_toast, new_toast_container.firstChild);
                    else
                        new_toast_container.appendChild(new_toast);
                    setTimeout(function() {
                        requestAnimationFrame(function() {
                            new_toast.style.opacity = "1"
                        })
                    }, 50);
                    setTimeout(function() {
                        new_toast.style.opacity = "0";
                        setTimeout(function() {
                            new_toast_container.removeChild(new_toast)
                        }, 600);
                    }, (toast_seconds * 1000));
                }
                function checkForProperty(prop) {
                    return (prop === "" || prop === null || prop === undefined) ? false : true;
                }
            }
            function simple_xhr() {
                let id_counter = 0;
                this.sendXHR = sendXHR;
                function sendXHR(data, callback, uniqueHandler=null) {
                    (function requestInit() {
                        var headers = (checkForProperty(data.headers)) ? data.headers : [["Content-type", "application/json"]];
                        var method = (checkForProperty(data.method)) ? data.method : "POST";
                        var xhr = new XMLHttpRequest();
                        var asserted_status = (checkForProperty(data.asserted_status)) ? (Array.isArray(data.asserted_status) ? data.asserted_status : [data.asserted_status]) : [200];
                        if (checkForProperty(data.params) && !checkForProperty(data.params.no_id))
                            data.params.id = (checkForProperty(data.params.id) ? data.params.id : id_counter++);
                        var encoded = (checkForProperty(data.params)) ? JSON.stringify(data.params) : "";
                        xhr.timeout = (checkForProperty(data.timeout)) ? (data.timeout * 1000) : 20000;
                        var api_url = (Array.isArray(data.api)) ? data.api[getRandomInt(data.api.length)] : data.api;
                        if (checkForProperty(data.auth))
                            xhr.open(method, api_url, true, data.auth.user, data.auth.password);
                        else
                            xhr.open(method, api_url, true);
                        xhr = setHeaders(xhr, headers);
                        if (checkForProperty(uniqueHandler))
                            uniqueHandler(xhr, encoded);
                        else {
                            xhr.ontimeout = function() {
                                callback({
                                    timeout: true,
                                    response: null
                                })
                            }
                            ;
                            xhr.onreadystatechange = function() {
                                if (xhr.readyState == 4) {
                                    var valid = (asserted_status.includes(xhr.status)) ? true : false;
                                    callback({
                                        valid: valid,
                                        response: xhr.response,
                                        status: xhr.status
                                    });
                                }
                            }
                            ;
                            xhr.send(encoded);
                        }
                    }
                    )();
                    function setHeaders(xhr, headers) {
                        for (var i = 0; i < headers.length; i++)
                            xhr.setRequestHeader(headers[i][0], headers[i][1]);
                        return xhr;
                    }
                }
                ;function checkForProperty(prop) {
                    return (prop === "" || prop === null || prop === undefined) ? false : true;
                }
                function getRandomInt(max) {
                    return Math.floor(Math.random() * max);
                }
            }
            function watcher_handler() {
                let watcher_id_counter = 0;
                let active_watchers = {};
                this.evalWatchers = evalWatchers;
                function evalWatchers() {
                    var watcher_list = Object.keys(active_watchers);
                    for (var i = 0; i < watcher_list.length; i++) {
                        if (active_watchers[watcher_list[i]].preserve == false)
                            destroyWatcher(watcher_list[i]);
                    }
                }
                this.setWatcher = setWatcher;
                function setWatcher(watch_obj) {
                    watcher_id_counter++;
                    watch_obj.init_epoch = Date.now();
                    watch_obj.timeout_epoch = watch_obj.init_epoch + (watch_obj.timeout_ms);
                    watch_obj.preserve = (!checkForProperty(watch_obj.preserve)) ? false : watch_obj.preserve;
                    active_watchers[watcher_id_counter] = watch_obj;
                    callWrapper(watcher_id_counter, active_watchers[watcher_id_counter]);
                    return watcher_id_counter;
                }
                this.resolveWatcher = resolveWatcher;
                function resolveWatcher(watcher_id, resolve_obj) {
                    active_watchers[watcher_id].cb(resolve_obj);
                    destroyWatcher(watcher_id);
                }
                function callWrapper(watcher_id, watcher_obj) {
                    (function call() {
                        requestAnimationFrame(function() {
                            if (checkForProperty(active_watchers[watcher_id])) {
                                if (Date.now() >= active_watchers[watcher_id].timeout_epoch) {
                                    active_watchers[watcher_id].cb(null);
                                    destroyWatcher(watcher_id);
                                } else {
                                    active_watchers[watcher_id].func(function(resolved, resolve_obj) {
                                        if (resolved)
                                            resolveWatcher(watcher_id, resolve_obj);
                                        else
                                            window.setTimeout(call, active_watchers[watcher_id].interval_ms);
                                    });
                                }
                            }
                        });
                    }
                    )();
                }
                this.getWatcherIdsByTag = getWatcherIdsByTag;
                function getWatcherIdsByTag(tag_name) {
                    var watcher_list = Object.keys(active_watchers);
                    var watcher_id_array = [];
                    for (var i = 0; i < watcher_list.length; i++) {
                        if (checkForProperty(active_watchers[watcher_list[i]].tag_name) && active_watchers[watcher_list[i]].tag_name == tag_name)
                            watcher_id_array.push(watcher_list[i]);
                    }
                    return watcher_id_array;
                }
                this.destroyWatchers = destroyWatchers;
                function destroyWatchers(watcher_id_array) {
                    if (!Array.isArray(watcher_id_array))
                        watcher_id_array = [watcher_id_array];
                    for (var i = watcher_id_array.length - 1; i >= 0; i--)
                        destroyWatcher(watcher_id_array[i]);
                }
                this.destroyWatcher = destroyWatcher;
                function destroyWatcher(watcher_id) {
                    if (checkForProperty(active_watchers[watcher_id]))
                        delete active_watchers[watcher_id];
                }
                function checkForProperty(prop) {
                    return (prop === "" || prop === null || prop === undefined) ? false : true;
                }
            }
            function biometrics_handler() {
                let bio_db;
                let db_rdy;
                (function init() {
                    db_rdy = false;
                    bio_db = new biometrics_db(function() {
                        console.log("indexed db ready");
                        db_rdy = true;
                    }
                    );
                }
                )();
                this.createCredential = createCredential;
                function createCredential(prf_obj, callback) {
                    navigator.credentials.create({
                        publicKey: {
                            rp: {
                                name: "BitNote",
                                id: "bitnote.xyz"
                            },
                            user: {
                                id: self.crypto.getRandomValues(new Uint8Array(16)),
                                name: prf_obj.key_name,
                                displayName: prf_obj.username,
                            },
                            pubKeyCredParams: [{
                                type: 'public-key',
                                alg: -7
                            }, {
                                type: "public-key",
                                alg: -8
                            }, {
                                type: "public-key",
                                alg: -257
                            }],
                            timeout: 60000,
                            authenticatorSelection: {
                                authenticatorAttachment: "cross-platform",
                                residentKey: "required",
                            },
                            extensions: {
                                prf: {}
                            },
                            challenge: new Uint8Array([0]).buffer,
                        }
                    }).then((c)=>{
                        if (checkForProperty(c.getClientExtensionResults().prf) && c.getClientExtensionResults().prf.enabled === true)
                            callback(c.rawId);
                        else
                            callback(null);
                    }
                    );
                }
                this.getCredential = getCredential;
                function getCredential(prf_obj, callback) {
                    var publicKey = {
                        timeout: 60000,
                        rpId: "bitnote.xyz",
                        challenge: self.crypto.getRandomValues(new Uint8Array(16)).buffer,
                        extensions: {
                            prf: {
                                eval: {
                                    first: prf_obj.first
                                }
                            }
                        },
                    };
                    if (checkForProperty(prf_obj.second))
                        publicKey.extensions.prf.eval.second = prf_obj.second;
                    if (checkForProperty(prf_obj.id)) {
                        publicKey.allowCredentials = [{
                            type: "public-key",
                            id: prf_obj.id,
                        }];
                    }
                    navigator.credentials.get({
                        publicKey
                    }).then((c)=>{
                        var ext_results = c.getClientExtensionResults();
                        if (checkForProperty(ext_results) && checkForProperty(ext_results.prf.results) && checkForProperty(ext_results.prf.results.first) && checkForProperty(ext_results.prf.results.second)) {
                            var key_mat = concatArrayBuffers(ext_results.prf.results.first, ext_results.prf.results.second);
                            callback(key_mat, c.rawId);
                        } else
                            callback(null);
                    }
                    ).catch((error)=>{}
                    );
                }
                this.confirmOnChain = confirmOnChain;
                function confirmOnChain(user_id, cb=null) {
                    bio_db.confirmOnChain(user_id, cb);
                }
                this.storeUserCredential = storeUserCredential;
                function storeUserCredential(params, cb=null) {
                    var stored_data = {
                        username: params.username,
                        raw_id: params.raw_id,
                        misc_data: params.misc_data
                    };
                    if (checkIfTrue(params.not_on_chain))
                        stored_data.not_on_chain = params.not_on_chain;
                    bio_db.saveNewBio(params.user_id, stored_data, function() {
                        callbackIfExists(cb, true);
                    });
                }
                this.clearTempCred = clearTempCred;
                function clearTempCred() {
                    localStorage.setItem('temp_sk', "");
                    localStorage.setItem('temp_id', "");
                }
                this.checkForUser = checkForUser;
                function checkForUser(user_id, cb) {
                    bio_db.getUserStore(user_id, function(ret) {
                        cb((ret != null && checkForProperty(ret.response)) ? ret.response : null);
                    });
                }
                this.registerAndStore = registerAndStore;
                function registerAndStore(params, cb) {}
                this.deleteLocalBiometrics = deleteLocalBiometrics;
                function deleteLocalBiometrics(username, cb=null) {
                    getAllByUsername(username, function(user_array) {
                        deleteNext(user_array);
                    });
                    function deleteNext(user_array) {
                        if (user_array != null && user_array.length > 0) {
                            var next_user = user_array.pop();
                            bio_db.deleteKey(next_user.user_id, function(ret) {
                                if (ret)
                                    deleteNext(user_array);
                            });
                        } else
                            callbackIfExists(cb, true);
                    }
                }
                this.checkForBiometrics = checkForBiometrics;
                function checkForBiometrics(username, cb) {
                    getAllByUsername(username, cb);
                }
                function getAllByUsername(username, cb) {
                    bio_db.getStore(null, function(store_array) {
                        if (store_array != null && store_array.length > 0) {
                            var user_array = [];
                            for (var i = 0; i < store_array.length; i++) {
                                if (store_array[i].username === username)
                                    user_array.push(store_array[i]);
                            }
                            callbackIfExists(cb, (((user_array.length > 0) ? user_array : null)));
                        } else
                            callbackIfExists(cb, null);
                    });
                }
                function findUserById(user_id, cb) {
                    bio_db.getUserStore(user_id, function(ret) {
                        if (ret != null && checkForProperty(ret.response))
                            cb(true);
                        else
                            cb(false);
                    });
                }
                function concatArrayBuffers(buffer1, buffer2) {
                    var tmp = new Uint8Array(buffer1.byteLength + buffer2.byteLength);
                    tmp.set(new Uint8Array(buffer1), 0);
                    tmp.set(new Uint8Array(buffer2), buffer1.byteLength);
                    return tmp.buffer;
                }
                this.biometricsClick = biometricsClick;
                function biometricsClick(prf_obj, bio_cb) {
                    getCredential(prf_obj, handleBioLogin);
                    function handleBioLogin(key_mat, raw_id) {
                        if (key_mat != null && raw_id != null) {
                            getBiometrics(raw_id, handleLogin);
                        } else
                            bio_cb(null);
                        function handleLogin(cred) {
                            bio_cb(key_mat, cred);
                        }
                        function getBiometrics(raw_id, cb) {
                            var user_id = kh.keccak256(rawToUsername(raw_id));
                            checkForUser(user_id, function(cred) {
                                if (cred != null)
                                    cb(cred);
                                else
                                    checkContractForSecKey();
                            });
                            function checkContractForSecKey() {
                                var cpe = new contract_param_encoder();
                                var fcn_call = "getDataAtIndex(bytes32)";
                                let user_id = kh.keccak256(rawToUsername(raw_id));
                                var param_str = cpe.getEncoded([user_id], cpe.getHeaderArray(fcn_call));
                                param_str = cpe.combineParams(param_str);
                                var func_str = getFunctionStr(genFunctionHash(fcn_call), param_str);
                                miscFunctionCall(func_str, current_sk_contract, active_contract.rpc_list, function(res) {
                                    if (checkForProperty(res)) {
                                        var decoded_ret = decodeParams("bytes,string", res);
                                        var misc_data = hexToArrayBuffer(decoded_ret[0].data, Uint8Array).buffer;
                                        var username_string = hexToArrayBuffer(decoded_ret[1].data, Uint8Array).buffer;
                                        username_string = new TextDecoder().decode(username_string);
                                        let params = {
                                            username: username_string,
                                            raw_id: raw_id.slice(),
                                            misc_data: misc_data.slice(),
                                            user_id
                                        };
                                        storeUserCredential(params, function() {
                                            cb(params);
                                        });
                                    } else
                                        cb(null);
                                });
                            }
                        }
                    }
                }
                this.rawToUsername = rawToUsername;
                function rawToUsername(raw_id) {
                    return bufferToHex(raw_id);
                }
                function checkForProperty(prop) {
                    return (prop === "" || prop === null || prop === undefined) ? false : true;
                }
            }
            function biometrics_db(cb) {
                let main_handler;
                var db_obj, db_name, version_number;
                init();
                function init() {
                    version_number = 1;
                    db_name = "biometrics_db";
                    db_obj = {
                        bio_store: {
                            name: "bio_store",
                            params: {
                                keyPath: "user_id"
                            }
                        },
                    };
                    main_handler = new database(db_name,[db_obj.bio_store],version_number,function(valid) {
                        if (!valid)
                            console.log("Unable to obtain persistent storage, use with caution. Bookmark page to resolve");
                        else {
                            main_handler.getPersist(function(result) {
                                if (result)
                                    console.log("Persistent storage granted");
                                else
                                    setPersistentWarning();
                                cb();
                            });
                        }
                    }
                    );
                }
                function setPersistentWarning() {
                    console.log("Unable to obtain persistent storage, use with caution. Bookmark page to resolve");
                }
                this.deleteKey = deleteKey;
                function deleteKey(key, cb) {
                    main_handler.getKey([db_obj.bio_store.name], key, function(ret) {
                        if (ret != null)
                            cb(ret.store.delete(key));
                        else
                            cb(null);
                    });
                }
                this.getStore = getStore;
                function getStore(key, cb) {
                    var store = main_handler.getStore(db_obj.bio_store.name);
                    if (key != null)
                        var req = store.get(key);
                    else
                        var req = store.getAll();
                    req.onsuccess = callbackStore;
                    req.onerror = function(e) {
                        cb(null)
                    }
                    ;
                    function callbackStore(e) {
                        cb(e.target.result);
                    }
                }
                this.getWriteableStore = function() {
                    return main_handler.getWriteableStore(db_obj.bio_store.name);
                }
                ;
                this.getUserStore = getUserStore;
                function getUserStore(user_id, cb) {
                    var store_obj = main_handler.getWriteableStore(db_obj.bio_store.name);
                    main_handler.getKeyWithStore(store_obj, user_id, cb);
                }
                this.confirmOnChain = confirmOnChain;
                function confirmOnChain(user_id, cb=null) {
                    getUserStore(user_id, function(ret) {
                        if (ret != null && checkForProperty(ret.response)) {
                            delete ret.response.not_on_chain;
                            ret.store.put(ret.response);
                            callbackIfExists(cb, true);
                        } else {
                            console.log("Warning", "Failed to set biometrics for: " + user_id);
                            callbackIfExists(cb, null);
                        }
                    });
                }
                this.saveNewBio = saveNewBio;
                function saveNewBio(user_id, data, cb) {
                    getUserStore(user_id, function(ret) {
                        if (ret != null) {
                            if (checkForProperty(ret.response)) {
                                ret.response.raw_id = data.raw_id;
                                ret.response.misc_data = data.misc_data;
                                ret.response.username = data.username;
                                ret.response = addIfNotOnChain(ret.response, data);
                                ret.store.put(ret.response);
                                cb();
                            } else {
                                var tc = {
                                    username: data.username,
                                    raw_id: data.raw_id,
                                    user_id: user_id,
                                    misc_data: data.misc_data
                                };
                                tc = addIfNotOnChain(tc, data);
                                ret.store.add(tc);
                                cb();
                            }
                        } else
                            console.log("Warning", "Failed to set biometrics for: " + user_id);
                    });
                    function addIfNotOnChain(response, data) {
                        if (checkIfTrue(data.not_on_chain))
                            response.not_on_chain = data.not_on_chain;
                        return response;
                    }
                }
            }
            function topbar_ns_handler(settings={}) {
                let topbar_ns_container;
                (function init() {
                    topbar_ns_container = document.createElement("div");
                    topbar_ns_container.className = "topbar_ns_container";
                    document.body.prepend(topbar_ns_container);
                    loadCSS((checkForProperty(settings.custom_css)) ? settings.custom_css : defaultCSS(settings));
                }
                )();
                this.setCustomCss = setCustomCss;
                function setCustomCss(css) {
                    loadCSS(css);
                }
                this.newNotification = newNotification;
                function newNotification(params, cb=null) {
                    let notification_cleared = false;
                    params.close_on_resolve = (checkForProperty(params.close_on_resolve)) ? params.close_on_resolve : true;
                    params.allow_close = (checkForProperty(params.allow_close)) ? params.allow_close : true;
                    params.full_bar_target = (checkForProperty(params.full_bar_target)) ? params.full_bar_target : false;
                    params.self_remove_ms = (checkForProperty(params.self_remove_ms)) ? params.self_remove_ms : 0;
                    let std_notification_bar = document.createElement("div");
                    std_notification_bar.className = "std_notification_bar";
                    let std_notification_msg = document.createElement("span");
                    std_notification_msg.className = "std_notification_msg";
                    std_notification_msg.innerHTML = params.msg_html;
                    std_notification_bar.prepend(std_notification_msg);
                    let std_notfication_close;
                    let std_close_container;
                    if (params.allow_close) {
                        std_close_container = document.createElement("div");
                        if (checkForProperty(params.close_icon)) {
                            std_notfication_close = document.createElement("svg");
                            std_close_container.appendChild(std_notfication_close);
                            std_notfication_close.outerHTML = params.close_icon;
                        } else {
                            std_notfication_close = document.createElement("span");
                            std_notfication_close.innerHTML = "x";
                            std_notfication_close.className = "std_notfication_close";
                            std_close_container.appendChild(std_notfication_close);
                        }
                        std_notification_bar.appendChild(std_close_container);
                    }
                    if (checkForProperty(params.svg_icon)) {
                        var std_icon_container = document.createElement("div");
                        std_icon_container.className = "std_icon_container";
                        std_icon_container.innerHTML = params.svg_icon;
                        std_notification_bar.prepend(std_icon_container);
                    }
                    topbar_ns_container.append(std_notification_bar);
                    if (checkForProperty(params.custom_bg_color))
                        std_notification_bar.style.backgroundColor = params.custom_bg_color;
                    if (checkForProperty(params.custom_color))
                        std_notification_msg.style.color = params.custom_color;
                    var main_target = (params.full_bar_target) ? std_notification_bar : std_notification_msg;
                    if (params.full_bar_target)
                        std_notification_bar.style.cursor = "pointer";
                    setStdListeners();
                    if (params.self_remove_ms > 0)
                        setRemoveTimer(params.self_remove_ms);
                    function setRemoveTimer(remove_timer_ms) {
                        var frame_count = 60;
                        var wait_increment = remove_timer_ms / frame_count;
                        var opacity_increment = 1 / frame_count;
                        var starting_opacity = 1;
                        (function wait() {
                            remove_timer_ms -= wait_increment;
                            requestAnimationFrame(handleFrame);
                            function handleFrame() {
                                if (!notification_cleared) {
                                    std_notification_bar.style.opacity = starting_opacity;
                                    starting_opacity -= opacity_increment;
                                    if (remove_timer_ms > 0)
                                        window.setTimeout(wait, wait_increment);
                                    else
                                        clearNotfication();
                                }
                            }
                        }
                        )();
                    }
                    function resolveHandler() {
                        if (params.close_on_resolve)
                            clearNotfication();
                        sendCallback(true);
                    }
                    function closeNotfication() {
                        clearNotfication();
                        sendCallback(false);
                    }
                    function sendCallback(response) {
                        if (cb != null)
                            cb(response);
                    }
                    function setStdListeners() {
                        if (params.allow_close)
                            std_close_container.addEventListener("click", closeNotfication, true);
                        main_target.addEventListener("click", resolveHandler, false);
                    }
                    function clearNotfication() {
                        if (!notification_cleared) {
                            notification_cleared = true;
                            main_target.removeEventListener("click", resolveHandler);
                            if (params.allow_close)
                                std_close_container.removeEventListener("click", closeNotfication, true);
                            std_notification_bar.remove();
                        }
                    }
                    return {
                        clear: clearNotfication
                    };
                }
                function defaultCSS(params) {
                    var valid_custom_css = `.topbar_ns_container{position:fixed;width:100%;left:0;z-index:2139002000} .std_notification_bar{position:relative;background-color:#ffdb01;display:flex;align-items: center;padding:20px 40px} .std_notification_msg{color:#000;cursor:pointer;font-size:20px;font-weight:500;flex-grow:1;line-height:19px;} .std_notfication_close{color:#000;right:10px;cursor:pointer;} .std_close_container{} .std_close_icon{right:10px;cursor:pointer;z-index:2100000004;fill:#fff;width:15px;height:15px;margin-left:10px;} .std_icon_container{margin-right:10px;line-height:1} .std_icon{fill:#fff;width:24px;height:24px;} @media(orientation: portrait) and (max-width: 800px) { .std_notification_msg{font-size:16px;} .std_notification_bar{flex-direction: row;align-items:center;padding:20px 15px} .std_notfication_close{position:unset;margin:0 0 0 auto;padding:0 5px} }`;
                    return valid_custom_css;
                }
                function checkForProperty(prop) {
                    return (prop === "" || prop === null || prop === undefined) ? false : true;
                }
                function loadCSS(custom_css) {
                    var new_style = document.createElement("style");
                    new_style.innerHTML = custom_css.trim();
                    document.head.appendChild(new_style);
                }
            }
            function database(db_name, stores, version_number, cb) {
                let db;
                (function openDatabase() {
                    var req = window.indexedDB.open(db_name, version_number);
                    req.onsuccess = function(event) {
                        console.log("DB Success");
                        db = this.result;
                        cb(true);
                    }
                    ;
                    req.onerror = function(event) {
                        console.log("Unable to open DB: ", event.target.message);
                        cb(false);
                    }
                    ;
                    req.onblocked = function(event) {
                        console.log("Opening db has been blocked", event.target.message);
                        cb(false);
                    }
                    ;
                    req.onupgradeneeded = function(event) {
                        console.log("DB Upgraded");
                        db = event.target.result;
                        for (var i = 0; i < stores.length; i++)
                            db.createObjectStore(stores[i].name, stores[i].params);
                    }
                    ;
                }
                )();
                this.getPersist = function(cb) {
                    navigator.permissions.query({
                        name: 'persistent-storage'
                    }).then(function(result) {
                        if (result.state == 'granted')
                            cb(true);
                        else if (result.state == 'prompt')
                            navigator.storage.persist().then(cb);
                        else
                            cb(false);
                    });
                }
                ;
                this.clearStore = clearStore;
                function clearStore(store_name) {
                    db.transaction(store_name, 'readwrite').objectStore(store_name).clear();
                }
                this.clearDatabase = clearDatabase;
                function clearDatabase(db_name) {
                    db.close();
                    window.indexedDB.deleteDatabase(db_name);
                }
                this.getWriteableStore = getWriteableStore;
                function getWriteableStore(store_name, cb) {
                    return db.transaction(store_name, 'readwrite').objectStore(store_name);
                }
                this.getKeyWithStore = getKeyWithStore;
                function getKeyWithStore(store_obj, keyname, cb) {
                    var req = store_obj.get(keyname);
                    req.onsuccess = handleSuccess;
                    req.onerror = function() {
                        cb(null)
                    }
                    ;
                    function handleSuccess(e) {
                        cb({
                            valid: true,
                            response: this.result,
                            store: store_obj
                        });
                    }
                }
                this.getStore = function(store_name, cb) {
                    return db.transaction(store_name, 'readonly').objectStore(store_name);
                }
                ;
                function getObjectStore(store_name, mode) {
                    return db.transaction(store_name, mode).objectStore(store_name);
                }
                this.getKey = function(store_names, key_name, cb) {
                    getKeyFromDB(store_names, key_name, cb);
                }
                ;
                function getKeyFromDB(store_names, keyname, cb) {
                    store_names = (typeof store_names === 'string') ? [store_names] : store_names;
                    var store = getObjectStore(store_names, 'readwrite');
                    var req = store.get(keyname);
                    req.onsuccess = handleSuccess;
                    req.onerror = function() {
                        cb(null)
                    }
                    ;
                    function handleSuccess(e) {
                        cb({
                            valid: true,
                            response: this.result,
                            store: store
                        });
                    }
                }
                function checkForProperty(prop) {
                    return (prop === "" || prop === null || prop === undefined) ? false : true;
                }
            }
            function best_choice_handler(xhr_handler, params) {
                let main_obj;
                let main_xhr;
                let speed_breakpoints;
                let ms_obj;
                (function init() {
                    main_xhr = xhr_handler;
                    main_obj = {
                        domain_list: {},
                    };
                    speed_breakpoints = {
                        download_mod: 14000n
                    };
                    ms_obj = {
                        one_sec: 1000,
                        one_min: 60000,
                        one_hour: 3600000,
                        one_day: 86400000,
                        max_resolve: 10000n,
                        ten_mins: 600000
                    };
                    getLocalRecords();
                    var total_stats = genCurrentOverallStats();
                    speed_breakpoints.bp_array = recalcBreakpoints(total_stats);
                }
                )();
                this.sendXHR = sendXHR;
                function QQ_sendXHR(data, callback, uniqueHandler) {
                    main_xhr.sendXHR(data, callback, uniqueHandler);
                }
                function sendXHR(data, callback, uniqueHandler) {
                    let resolved = false;
                    var req_domain_array = checkApis(data.api);
                    data.multi_send_count = (checkForProperty(data.multi_send_count) ? data.multi_send_count : 2);
                    let start = performance.now();
                    var api_obj_array = getBest(req_domain_array);
                    if (data.multi_send_count > 1)
                        multiSend(data, api_obj_array, callback);
                    else
                        singleSend(data, api_obj_array, callback);
                    function singleSend(data_obj, api_obj_array, cb) {
                        let api_obj = (Array.isArray(api_obj_array)) ? api_obj_array[0] : api_obj_array;
                        send(data_obj, api_obj, cb);
                    }
                    function send(data_obj, api_obj, cb) {
                        let domain_obj = main_obj.domain_list[api_obj.domain];
                        domain_obj.active_request_count++;
                        data_obj.api = api_obj.original_path;
                        main_xhr.sendXHR(data_obj, function(res_obj) {
                            logRecord(domain_obj, start, data_obj, res_obj);
                            if (res_obj.valid) {
                                res_obj.chosen_api = data_obj.api;
                                cb(res_obj);
                            } else
                                handleSendFail(api_obj, res_obj);
                        });
                        function handleSendFail(api_obj, res_obj) {
                            let max_fail_count = 2;
                            api_obj.fail_count = (checkForProperty(api_obj.fail_count)) ? ++api_obj.fail_count : 1;
                            if (api_obj.fail_count < max_fail_count)
                                send(data_obj, api_obj, cb);
                            else {
                                console.log("fail count exceeded: ", api_obj);
                                cb(res_obj);
                            }
                        }
                    }
                    function multiSend(data_obj, api_obj_array, cb) {
                        let finished = false;
                        let active_send_count = 0;
                        api_obj_array = setApiSendArray(api_obj_array, data.multi_send_count);
                        for (var i = 0; i < api_obj_array.length; i++) {
                            active_send_count++;
                            handleMultiSend(api_obj_array[i], Object.assign({}, data_obj));
                        }
                        function handleMultiSend(api_obj, new_data_obj) {
                            send(new_data_obj, api_obj, function(res_obj) {
                                if (res_obj.valid && finished === false) {
                                    main_obj.domain_list[api_obj.domain].multi_wins++;
                                    active_send_count--;
                                    handleFinish(res_obj);
                                } else
                                    handleMultiSendFail(api_obj, res_obj);
                            });
                        }
                        function handleMultiSendFail(api_obj, res_obj) {
                            active_send_count--;
                            if (active_send_count <= 0 && finished === false)
                                handleFinish(res_obj);
                        }
                        function handleFinish(res_obj) {
                            if (cb != null && finished === false) {
                                finished = true;
                                cb(res_obj);
                                cb = null;
                            }
                        }
                        function setApiSendArray(api_obj_array, multi_send_count) {
                            api_obj_array = (Array.isArray(api_obj_array)) ? api_obj_array : [api_obj_array];
                            var send_array = [];
                            var cut_off = Date.now() - ms_obj.one_hour;
                            for (var i = 0; i < api_obj_array.length; i++) {
                                if (i < multi_send_count)
                                    send_array.push(api_obj_array[i]);
                                else {
                                    if (multi_send_count > 1 && missingRecent(main_obj.domain_list[api_obj_array[i].domain], cut_off))
                                        send_array.push(api_obj_array[i]);
                                }
                            }
                            return send_array;
                        }
                        function missingRecent(domain_obj, cut_off) {
                            if (domain_obj.domain_s_requests_handled === 0n || (domain_obj.status_array.length > 0 && domain_obj.status_array[domain_obj.status_array.length - 1].ts < cut_off))
                                return true;
                            else
                                return false;
                        }
                    }
                }
                this.clearStats = clearStats;
                function clearStats() {
                    localStorage.setItem("api_stats", '');
                    localStorage.removeItem("api_stats");
                    main_obj.domain_list = {};
                }
                this.setNewXhr = setNewXhr;
                function setNewXhr(new_xhr) {
                    main_xhr = new_xhr;
                }
                this.checkStale = checkStale;
                function checkStale() {
                    var current = Date.now() - ms_obj.one_day;
                    var keys = Object.keys(main_obj.domain_list);
                    for (var i = 0; i < keys.length; i++) {
                        if (main_obj.domain_list[keys[i]].status_array.length > 0 && main_obj.domain_list[keys[i]].status_array[0].ts < current) {
                            main_obj.domain_list = parseStats(main_obj.domain_list);
                            return;
                        }
                    }
                }
                this.refreshStats = refreshStats;
                function refreshStats() {
                    checkStale();
                    var total_stats = genCurrentOverallStats();
                    speed_breakpoints.bp_array = recalcBreakpoints(total_stats);
                    localStorage.setItem("api_stats", JSON.stringify(main_obj));
                    console.log(total_stats);
                }
                this.recalcBreakpoints = recalcBreakpoints;
                function recalcBreakpoints(total_stats_obj) {
                    var new_bps = ms_obj.one_sec;
                    if (total_stats_obj.overall_s_requests_handled > 9n)
                        new_bps = Number(total_stats_obj.overall_avg_s_resolve_ms);
                    return [Math.ceil(new_bps * 0.9), Math.ceil(new_bps * 1.75), Math.ceil(new_bps * 3)];
                }
                function genCurrentOverallStats() {
                    var stats_obj = main_obj.domain_list;
                    var bch_stats = {
                        overall_s_requests_handled: 0n,
                        overall_l_requests_handled: 0n,
                        overall_downloaded: 0n,
                        overall_s_resolve_total: 0n,
                        overall_l_resolve_total: 0n,
                        overall_avg_s_resolve_ms: 0n,
                        domains: Object.assign({}, main_obj.domain_list),
                    };
                    var keys = Object.keys(stats_obj);
                    for (var i = 0; i < keys.length; i++) {
                        var temp_domain = main_obj.domain_list[keys[i]];
                        bch_stats.overall_s_requests_handled += temp_domain.domain_s_requests_handled;
                        bch_stats.overall_s_resolve_total += temp_domain.domain_s_resolve_total;
                        bch_stats.overall_l_resolve_total += temp_domain.domain_l_resolve_total;
                        bch_stats.overall_l_requests_handled += temp_domain.domain_l_requests_handled;
                        bch_stats.overall_downloaded += temp_domain.domain_bytes_downloaded;
                        bch_stats.overall_avg_s_resolve_ms += temp_domain.domain_avg_s_resolve_ms;
                    }
                    if (keys.length > 0)
                        bch_stats.overall_avg_s_resolve_ms = bch_stats.overall_avg_s_resolve_ms / BigInt(keys.length);
                    return bch_stats;
                }
                function logRecord(domain_obj, init_time, init_data, res_obj) {
                    var downloaded_bytes = (checkForProperty(res_obj.response)) ? BigInt(res_obj.response.length) : 0n;
                    var ts = Date.now();
                    var max_resolve_ms = ms_obj.max_resolve;
                    domain_obj.domain_bytes_downloaded += downloaded_bytes;
                    domain_obj.active_request_count--;
                    var resolve_time = BigInt(Math.round(performance.now() - init_time));
                    resolve_time = (resolve_time > max_resolve_ms) ? max_resolve_ms : resolve_time;
                    if (downloaded_bytes <= speed_breakpoints.download_mod) {
                        domain_obj.domain_s_requests_handled++;
                        domain_obj.domain_s_resolve_total += resolve_time;
                        domain_obj.domain_avg_s_resolve_ms = domain_obj.domain_s_resolve_total / domain_obj.domain_s_requests_handled;
                    } else {
                        domain_obj.domain_l_resolve_total += resolve_time;
                        domain_obj.domain_l_requests_handled++;
                    }
                    if (res_obj.valid) {
                        domain_obj.res_success_count++;
                        domain_obj.last_success = ts;
                    } else
                        domain_obj.last_fail = ts;
                    domain_obj.status_array.push({
                        valid: res_obj.valid,
                        status: res_obj.status,
                        ts,
                        resolve_time,
                        downloaded_bytes
                    });
                }
                function checkApis(api) {
                    var api = (Array.isArray(api)) ? api : [api];
                    var req_domain_array = [];
                    for (var i = 0; i < api.length; i++) {
                        var url = new URL(api[i]);
                        req_domain_array.push({
                            domain: url.hostname,
                            original_path: api[i]
                        });
                        addIfNotOnTheList(url.hostname);
                    }
                    return req_domain_array;
                }
                function testcase_getBest(req_domain_array) {
                    var best = getRandomInt(req_domain_array.length);
                    return req_domain_array[best];
                }
                function getBest(req_domain_array) {
                    req_domain_array = checkDisqualify(req_domain_array);
                    req_domain_array = checkBest(req_domain_array);
                    return finalCheck(req_domain_array);
                }
                function finalCheck(req_domain_array) {
                    var domain_to_beat = req_domain_array[0];
                    var runner_up_array = [];
                    var temp_domain_obj = main_obj.domain_list[domain_to_beat.domain];
                    for (var i = 1; i < req_domain_array.length; i++) {
                        var td = main_obj.domain_list[req_domain_array[i].domain];
                        if (td.domain_avg_s_resolve_ms < temp_domain_obj.domain_avg_s_resolve_ms && td.active_request_count < temp_domain_obj.active_request_count) {
                            temp_domain_obj = td;
                            runner_up_array = [domain_to_beat].concat(runner_up_array);
                            domain_to_beat = req_domain_array[i];
                        } else
                            runner_up_array.push(req_domain_array[i]);
                    }
                    return [domain_to_beat].concat(runner_up_array);
                }
                function checkBest(req_domain_array) {
                    var best_list = [];
                    var best_obj_array = [{
                        max_request_count: 1,
                        goal_speed_target: speed_breakpoints.bp_array[0],
                        acceptable_success_ms: Date.now() - ms_obj.one_hour,
                    }, {
                        max_request_count: 3,
                        goal_speed_target: speed_breakpoints.bp_array[1],
                        acceptable_success_ms: Date.now() - ms_obj.one_day,
                    }, {
                        max_request_count: 5,
                        goal_speed_target: speed_breakpoints.bp_array[2],
                        acceptable_success_ms: Date.now() - ms_obj.one_day,
                    }];
                    for (var x = 0; x < best_obj_array.length; x++) {
                        for (var i = req_domain_array.length - 1; i >= 0; i--) {
                            if (checkBestCriteria(main_obj.domain_list[req_domain_array[i].domain], best_obj_array[x]))
                                best_list.push(req_domain_array.splice(i, 1)[0]);
                        }
                        if (best_list.length > 0)
                            return best_list.concat(req_domain_array);
                    }
                    return req_domain_array;
                    function checkBestCriteria(domain_obj, check_obj) {
                        return (domain_obj.active_request_count < check_obj.max_request_count && domain_obj.domain_avg_s_resolve_ms < check_obj.goal_speed_target && (domain_obj.last_success >= domain_obj.last_fail && (domain_obj.last_success > check_obj.acceptable_success_ms || domain_obj.last_success === 0)) && (domain_obj.status_array.length === 0 || domain_obj.status_array[domain_obj.status_array.length - 1].resolve_time < check_obj.goal_speed_target)) ? true : false;
                    }
                }
                function checkDisqualify(req_domain_array) {
                    var recent_fail_cutoff = Date.now() - ms_obj.one_hour;
                    var recent_slow_cutoff = Date.now() - ms_obj.ten_mins;
                    var slow_speed_cutoff = speed_breakpoints.bp_array[speed_breakpoints.bp_array.length - 1];
                    var empty_list = [];
                    for (var i = req_domain_array.length - 1; i >= 0; i--) {
                        if (checkCutoffs(main_obj.domain_list[req_domain_array[i].domain]))
                            empty_list.push(req_domain_array.splice(i, 1)[0]);
                    }
                    if (req_domain_array.length <= 0)
                        req_domain_array = empty_list;
                    return req_domain_array;
                    function checkCutoffs(domain_obj) {
                        return (domain_obj.last_fail >= recent_fail_cutoff || domain_obj.domain_avg_s_resolve_ms >= slow_speed_cutoff || (domain_obj.status_array.length > 0 && domain_obj.status_array[domain_obj.status_array.length - 1].ts >= recent_slow_cutoff && domain_obj.status_array[domain_obj.status_array.length - 1].resolve_time >= slow_speed_cutoff)) ? true : false;
                    }
                }
                function addIfNotOnTheList(domain) {
                    if (!checkForProperty(main_obj.domain_list[domain]))
                        main_obj.domain_list[domain] = newApiObj();
                }
                function newApiObj() {
                    return {
                        multi_wins: 0,
                        domain_s_requests_handled: 0n,
                        domain_l_requests_handled: 0n,
                        domain_avg_s_resolve_ms: 0n,
                        domain_s_resolve_total: 0n,
                        domain_l_resolve_total: 0n,
                        domain_bytes_downloaded: 0n,
                        status_array: [],
                        res_success_count: 0n,
                        res_fail_count: 0n,
                        last_success: 0,
                        last_fail: 0,
                        active_request_count: 0,
                    };
                }
                function getLocalRecords() {
                    var temp = localStorage.getItem("api_stats");
                    if (checkForProperty(temp))
                        main_obj.domain_list = parseStats(JSON.parse(temp).domain_list);
                }
                function parseStats(stats_obj) {
                    var keys = Object.keys(stats_obj);
                    for (var i = 0; i < keys.length; i++)
                        stats_obj[keys[i]] = fixRecords(dropOldRecords(stats_obj[keys[i]].status_array));
                    return stats_obj;
                }
                function fixRecords(status_array=[]) {
                    var domain_stats = newApiObj();
                    for (var x = status_array.length - 1; x >= 0; x--) {
                        status_array[x].resolve_time = BigInt(status_array[x].resolve_time);
                        status_array[x].downloaded_bytes = BigInt(status_array[x].downloaded_bytes);
                        domain_stats.domain_bytes_downloaded += status_array[x].downloaded_bytes;
                        if (status_array[x].downloaded_bytes <= speed_breakpoints.download_mod) {
                            domain_stats.domain_s_resolve_total += status_array[x].resolve_time;
                            domain_stats.domain_s_requests_handled++;
                        } else {
                            domain_stats.domain_l_resolve_total += status_array[x].resolve_time;
                            domain_stats.domain_l_requests_handled++;
                        }
                        if (status_array[x].valid) {
                            domain_stats.res_success_count++;
                            if (domain_stats.last_success === 0)
                                domain_stats.last_success = status_array[x].ts;
                        } else {
                            domain_stats.res_fail_count++;
                            if (domain_stats.last_fail === 0)
                                domain_stats.last_fail = status_array[x].ts;
                        }
                    }
                    domain_stats.domain_avg_s_resolve_ms = (domain_stats.domain_s_requests_handled > 0n) ? domain_stats.domain_s_resolve_total / domain_stats.domain_s_requests_handled : domain_stats.domain_avg_s_resolve_ms;
                    domain_stats.status_array = status_array;
                    return domain_stats;
                }
                function dropOldRecords(status_array=[]) {
                    var day_olds = Date.now() - ms_obj.one_day;
                    for (var x = status_array.length - 1; x >= 0; x--) {
                        if (status_array[x].ts <= day_olds) {
                            status_array = status_array.splice(x);
                            status_array.shift();
                            break;
                        }
                    }
                    return status_array;
                }
                function checkForProperty(prop) {
                    return (prop === "" || prop === null || prop === undefined) ? false : true;
                }
                function getRandomInt(max) {
                    return Math.floor(Math.random() * max);
                }
            }
            BigInt.prototype.toJSON = function() {
                return this.toString()
            }
            ;
        </script>
    </body>
</html>
